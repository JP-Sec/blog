<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan CSS Security Support Blog</title>
  
  <subtitle>日本マイクロソフトのセキュリティ製品に関するサポート情報のブログです。</subtitle>
  <link href="https://jp-sec.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jp-sec.github.io/blog/"/>
  <updated>2024-10-21T08:59:25.153Z</updated>
  <id>https://jp-sec.github.io/blog/</id>
  
  <author>
    <name>CSS Japan Secuirty team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>お問い合わせの発行方法について</title>
    <link href="https://jp-sec.github.io/blog/how-to-create-supportcase/"/>
    <id>https://jp-sec.github.io/blog/how-to-create-supportcase/</id>
    <published>2024-08-05T01:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Security &amp; Compliance サポートチームです。<br>この記事では、Microsoft Defender for Endpoint (MDE) のサポートを効果的に利用するためのお問い合わせ(SR、サポートリクエスト) 発行方法についてご案内させていただきます。</p><p>本資料は、以下のようなお客様にお読みいただくことを想定しています。</p><ul><li><strong>お問い合わせを起票するための契約や、お問い合わせ発行から連絡をもらえるまでの応答時間などのルールと流れを知りたい</strong></li><li><strong>マイクロソフトのサポートからどのような内容を対応してもらえるのか知っておきたい</strong></li><li><strong>MDE に関するお問い合わせを発行する際に、どのように起票すれば効率的に成果が得られるか知りたい</strong></li></ul><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E5%86%85%E5%AE%B9">本記事の内容</a></li><li><a href="#%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B-sr%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88-%E3%81%AE%E4%BD%9C%E6%88%90%E6%96%B9%E6%B3%95">お問い合わせ (SR、サポートリクエスト) の作成方法</a><ul><li><a href="#1-%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E7%99%BA%E8%A1%8C%E7%94%BB%E9%9D%A2%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9">1. お問い合わせ発行画面へのアクセス</a></li><li><a href="#2-%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E8%A7%A3%E6%B1%BA%E7%AD%96%E3%81%AE%E7%A2%BA%E8%AA%8D">2. 一般的な解決策の確認</a></li><li><a href="#3-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%B8%E3%81%AE%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B-%E3%82%92%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF">3. 「サポートへの問い合わせ」 をクリック</a></li><li><a href="#4-%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E5%86%85%E5%AE%B9%E3%81%AE%E5%85%A5%E5%8A%9B">4. お問い合わせ内容の入力</a><ul><li><a href="#-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB">① タイトル</a></li><li><a href="#-%E8%AA%AC%E6%98%8E">② 説明</a></li><li><a href="#-%E8%A3%BD%E5%93%81">③ 製品</a></li><li><a href="#-%E9%87%8D%E5%A4%A7%E5%BA%A6%E3%82%92%E9%81%B8%E6%8A%9E">④ 重大度を選択</a></li><li><a href="#-%E9%9B%BB%E8%A9%B1%E7%95%AA%E5%8F%B7%E3%81%AE%E7%A2%BA%E8%AA%8D">⑤ 電話番号の確認</a></li><li><a href="#-%E6%89%BF%E8%AA%8D%E6%B8%88%E3%81%BF%E9%80%A3%E7%B5%A1%E5%85%88%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">⑥ 承認済み連絡先のメールアドレスを確認する</a></li><li><a href="#-%E3%81%93%E3%82%8C%E3%82%92%E8%A7%A3%E6%B1%BA%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AE%E9%80%9A%E8%A9%B1%E3%81%AE%E8%A8%98%E9%8C%B2%E3%81%AB%E5%90%8C%E6%84%8F%E3%81%97%E3%81%BE%E3%81%99">⑦ これを解決するために必要なすべての通話の記録に同意します</a></li><li><a href="#-%E5%B8%8C%E6%9C%9B%E3%81%99%E3%82%8B%E9%80%A3%E7%B5%A1%E6%96%B9%E6%B3%95">⑧ 希望する連絡方法</a></li><li><a href="#-%E6%B7%BB%E4%BB%98%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB">⑨ 添付ファイル</a></li><li><a href="#-%E5%9C%B0%E5%9F%9F%E3%81%AE%E8%A8%AD%E5%AE%9A">⑩ 地域の設定</a></li><li><a href="#-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E8%A3%9C%E5%8A%A9%E3%81%AE%E8%A8%AD%E5%AE%9A">⑪ ユーザー補助の設定</a></li></ul></li></ul></li><li><a href="#%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%81%AE%E5%AE%8C%E4%BA%86-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88-%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%81%AE%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%BA">お問い合わせの完了 (サポート リクエストのクローズ)</a><ul><li><a href="#%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%81%AE%E7%B5%82%E4%BA%86%E6%96%B9%E6%B3%95%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">お問い合わせの終了方法について</a></li><li><a href="#%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88-%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%81%AE%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%BA%E5%BE%8C%E3%81%AE%E3%82%A2%E3%83%B3%E3%82%B1%E3%83%BC%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">サポート リクエストのクローズ後のアンケートについて</a></li><li><a href="#%E8%A3%BD%E5%93%81%E3%81%B8%E3%81%AE%E3%83%95%E3%82%A3%E3%83%BC%E3%83%89%E3%83%90%E3%83%83%E3%82%AF%E3%82%84%E6%A9%9F%E8%83%BD%E8%BF%BD%E5%8A%A0%E3%81%AE%E8%A6%81%E6%9C%9B">製品へのフィードバックや機能追加の要望</a></li></ul></li></ul><h2 id="お問い合わせ-SR、サポートリクエスト-の作成方法"><a href="#お問い合わせ-SR、サポートリクエスト-の作成方法" class="headerlink" title="お問い合わせ (SR、サポートリクエスト) の作成方法"></a>お問い合わせ (SR、サポートリクエスト) の作成方法</h2><h3 id="1-お問い合わせ発行画面へのアクセス"><a href="#1-お問い合わせ発行画面へのアクセス" class="headerlink" title="1. お問い合わせ発行画面へのアクセス"></a>1. お問い合わせ発行画面へのアクセス</h3><p>Microsoft Defender ポータル (<a href="https://security.microsoft.com/">https://security.microsoft.com</a>) へアクセスし、画面右上の [?] マークをクリックします。</p><p><img src="../images/how-to-create-supportcase-001.png" alt="Microsoft Defender ポータルのヘルプアイコン"></p><h3 id="2-一般的な解決策の確認"><a href="#2-一般的な解決策の確認" class="headerlink" title="2. 一般的な解決策の確認"></a>2. 一般的な解決策の確認</h3><p>「何かお困りでしょうか？」 と表示されますので、検索ボックスに問い合わせ概要を記載します。</p><p>この際に、一般的な解決策が表示されますので、お問い合わせ発行前に一度ご確認いただくことをお勧めしております。</p><p><img src="../images/how-to-create-supportcase-002.png" alt="検索ボックス"></p><h3 id="3-「サポートへの問い合わせ」-をクリック"><a href="#3-「サポートへの問い合わせ」-をクリック" class="headerlink" title="3. 「サポートへの問い合わせ」 をクリック"></a>3. 「サポートへの問い合わせ」 をクリック</h3><p>画面下部の「サポートへの問い合わせ」 または画面上部の 「ヘッドセット」 マークをクリックします。</p><p><img src="../images/how-to-create-supportcase-003.png" alt="サポートへのお問い合わせ"></p><h3 id="4-お問い合わせ内容の入力"><a href="#4-お問い合わせ内容の入力" class="headerlink" title="4. お問い合わせ内容の入力"></a>4. お問い合わせ内容の入力</h3><p>「サポートへのお問い合わせ」 画面が表示されますので、問い合わせ内容等を入力します。</p><p>ここでは各項目ごとに留意事項を記載します。</p><p><img src="../images/how-to-create-supportcase-004.png" alt="お問い合わせ内容の入力 1"></p><p><img src="../images/how-to-create-supportcase-005.png" alt="お問い合わせ内容の入力 2"></p><h4 id="①-タイトル"><a href="#①-タイトル" class="headerlink" title="① タイトル"></a>① タイトル</h4><p>「2. 一般的な解決策の確認」 で記載した問い合わせ概要が自動入力されます。</p><p>お問い合わせ発行後、本画面で記載したタイトルを件名としたメールを弊社よりお送りいたしますので、件名にご希望等がございましたら、適宜編集いただけますと幸いです。</p><div class="alert is-success">  <p class="alert-title">ヒント</p>  <p>起票の単位</p>  <p>サポートをご利用いただく際には、問題の最小単位を切りだしたものを 1 件としてお問合せください。</p>  <p>これは、お問合せの量に応じて適切なサポート人員を配置し、また必要に応じて複数人での対応によりスピーディなご連絡を差し上げるためであり、弊社サポートサービスを利用される皆様にお願いさせて頂いております。</p>  <br/>  <p>お問い合わせの分割をお願いしている場合の例は以下の通りです。</p>  <p>- 同じ環境で問題が発生しているが、発生パターンが異なるなど同じ原因によるものか不明な場合</p>  <p>- お問い合わせの過程で、関連した追加質問が発生したが元のお問い合わせ内容と異なる場合</p>  <p>- 1つのご質問について、各プラットフォーム (Windows、Linux、macOS、Android、iOS) 毎の見解を希望される場合</p></div><h4 id="②-説明"><a href="#②-説明" class="headerlink" title="② 説明"></a>② 説明</h4><p>お問い合わせ詳細について記載してください。</p><p>トラブルシューティングの対応を希望される場合は、以下を参考に記載いただきますようお願いいたします。</p><table><thead><tr><th>項目</th><th>詳細</th></tr></thead><tbody><tr><td>発生している問題について</td><td>障害発生に伴うエラーの有無<br>(エラー画面等のスクリーンショットが取得できる場合は可能な限り添付してください。)</td></tr><tr><td>事象の再現手順</td><td>・問題発生に至った経緯や障害の再現方法 <br> ・事象開始日時や発生頻度</td></tr><tr><td>問題発生前の変更有無</td><td>問題発生前に弊社製品やハードウェア、設定等の変更を加えている場合は可能な限り詳細を記載</td></tr><tr><td>事象発生スコープ</td><td>以下の観点で事象の情報整理を行い、可能な範囲で発生台数やスコープを記載<br>・OS 情報 (クライアント or サーバーOS、バージョン、エディション等)<br>・該当マシン情報 (機種名、モデル等)<br>・お問い合わせ製品情報 (製品名、バージョン等)</td></tr><tr><td>実施済みの対処策</td><td>お客様にてお試しいただいた対策や、実施された調査内容、既知の回避策の有無</td></tr><tr><td>業務影響</td><td>本お問い合わせに伴う業務影響の有無や具体的な業務影響内容</td></tr><tr><td>関連SR番号</td><td>(既に他のサポートリクエストを起票済みの場合は) 関連するお問い合わせ番号</td></tr></tbody></table><div class="alert is-important">  <p class="alert-title">重要</p>  <p>お問い合わせ時には機密情報を記載しないようにお願いいたします。</p>  <p>これはお問い合わせ起票時以外にも、お問い合わせ最中 (弊社とのメールのやり取りでの本文内への記載、添付ファイル内での記載等) も含めてのお願いとなりますことをご理解頂けますと幸いです。</p>  <p>機密情報が含まれる場合、当該箇所をマスクしていただくようお願い申し上げます。</p>  <p>もし、お客様側より以下のような機密情報を記載されてしまった際は、弊社よりお客様へご連絡の上、弊社およびお客様側で当該情報の削除の対応や、場合によっては新規のお問い合わせ発行をお願いさせていただくといったお手間をおかけする可能性があります。</p>  <p>記載してはいけない機密情報の例:</p>  <p>・各種ポータルや OS 等へアクセスするためのパスワード</p>  <p>・クレジットカード番号</p>  <p>・MDE オンボードスクリプト (お客様テナントに紐付く貴重な情報が含まれております。)</p></div><h4 id="③-製品"><a href="#③-製品" class="headerlink" title="③ 製品"></a>③ 製品</h4><p>Microsoft Defender for Endpoint (MDE) または Microsoft Defender ウイルス対策(MDAV) に関するお問い合わせの際には 「Defender for Endpoint」 を選択して下さい。</p><h4 id="④-重大度を選択"><a href="#④-重大度を選択" class="headerlink" title="④ 重大度を選択"></a>④ 重大度を選択</h4><p>問題の状況によって、3 種類の重大度が設定可能です。<br>お客様がご利用されている契約と、重大度に応じて、初回応答時間が設定されています。<br>初回応答時間は、お問い合わせ起票後から Microsoft のサポートエンジニアがお客様と連絡を取り、サポートが開始されるまでの時間です。重大度 A 以外は営業時間内 (日本では午前9:00～午後17:30) でのご連絡となります。</p><ul><li>事業に軽微な影響が及ぶ場合 (重大度 C): Standard サポート契約の場合 8 時間以内</li><li>事業に部分的な影響が発生する場合 (重大度 B): Standard サポート契約の場合 4 時間以内</li><li>事業に大きな影響が発生する場合 (重大度 A): Standard サポート契約の場合 1 時間以内</li></ul><p>詳しくは、<a href="https://azure.microsoft.com/ja-jp/support/plans/response/">サポート プラン—サポート内容と応答性</a> のページを参照してください。</p><div class="alert is-important">  <p class="alert-title">重要</p>  <p>重大度 A について</p>  <p>平日の夜間と休日も含めた 24x7 (24 時間体制) でのご支援であり、具体的には以下のような即時の対応が必要な場面での利用を想定しております。</p>  <p>・原則として、事業が停止しているような危機的障害 (例 : 全社的に重要なシステムダウンが発生、重要な業務アプリケーションへのアクセスに失敗、など) からの復旧を目指したサポートとなります。このため、以下のような場合は重要度 B 以下を選択してください。</p>  <p>・復旧済みの問題についての原因の調査</p>  <p>・環境の構築中やこれまでと異なる設定への変更に伴う問題発生で切り戻しによって解消可能</p>  <p>・プロジェクトの進捗に影響が出ているので対応の加速を希望</p>  <p>・また、即時の情報提供などが必要なため、お客様にも常にお電話でのご連絡がつく体制の維持をお願いしております</p>  <p>障害からの復旧後には、お客様とのご相談の上で重要度を変更 (緊急対応の解除)させていただきます</p>  <br/>  <p><対応中の案件の緊急度 を A (24x7 対応) に上昇させたい場合></p>  <p>お問い合わせの件について緊急性が上昇した結果、重要度を A に変更されたい場合には、お手数ですが別途新規に重要度 A のお問い合わせの起票をお願いいたします。</p>  <p>新規のお問合せを起票いただくことで、そのタイミングの緊急対応担当へ呼び出しが行われます。</p>  <p>その際、既存のお問い合わせのお問合せ番号を文中に記載いただくことで、関連のお問い合わせの経緯も参考にしつつ対応します。</p></div><h4 id="⑤-電話番号の確認"><a href="#⑤-電話番号の確認" class="headerlink" title="⑤ 電話番号の確認"></a>⑤ 電話番号の確認</h4><p>お問い合わせ担当者様のお電話番号および国番号(日本: 81) を入力します。</p><div class="alert is-success">  <p class="alert-title">ヒント</p>  <p>ご希望の連絡先として 「メール」 を選択いただいた場合も、状況確認等を目的に弊社からのお電話を差し上げる場合がございます。</p>  <p>もし電話対応を希望されない場合は、その旨を 「②説明」 内に記載いただけますと幸いです。</p></div><h4 id="⑥-承認済み連絡先のメールアドレスを確認する"><a href="#⑥-承認済み連絡先のメールアドレスを確認する" class="headerlink" title="⑥ 承認済み連絡先のメールアドレスを確認する"></a>⑥ 承認済み連絡先のメールアドレスを確認する</h4><p>ご連絡を希望されるメールアドレスを記入してください。</p><p>複数のメールアドレスの場合は、セミコロン “;” を使用して区切ることができます。</p><h4 id="⑦-これを解決するために必要なすべての通話の記録に同意します"><a href="#⑦-これを解決するために必要なすべての通話の記録に同意します" class="headerlink" title="⑦ これを解決するために必要なすべての通話の記録に同意します"></a>⑦ これを解決するために必要なすべての通話の記録に同意します</h4><p>お問い合わせに対する通話で収集された情報のレコーディングや監視に同意いただける場合、「はい」 を選択します。</p><h4 id="⑧-希望する連絡方法"><a href="#⑧-希望する連絡方法" class="headerlink" title="⑧ 希望する連絡方法"></a>⑧ 希望する連絡方法</h4><p>「メール」 か 「携帯電話」、ご希望の連絡方法をご選択ください。選択した方法で初回のご連絡をさせていただきます。</p><p>なお、2 回目以降のご連絡はサポートエンジニアが状況に応じて異なるご連絡方法のお願いをさせて頂く場合がございます。</p><p>もし、より細かいご要望がございましたら、「② 説明」 欄にご記入いただきますようお願いいたします。</p><p>緊急度 A については電話のみでの対応となります。</p><h4 id="⑨-添付ファイル"><a href="#⑨-添付ファイル" class="headerlink" title="⑨ 添付ファイル"></a>⑨ 添付ファイル</h4><p>エラーメッセージのスクリーンショット等、添付ファイルがございましたらアップロードいただきますようお願いいたします。<br>添付ファイルは最大 10 GB (ファイル辺り 1GB、上限 10 ファイル) まで送信できます。</p><p>なお、1GB以上のファイルの共有を希望される場合、お問い合わせ時にお知らせいただけましたら、弊社よりアップロードサイト (1ファイルあたり100GBまで格納可能) のリンクを送付いたします。</p><h4 id="⑩-地域の設定"><a href="#⑩-地域の設定" class="headerlink" title="⑩ 地域の設定"></a>⑩ 地域の設定</h4><p>・新しいタイムゾーンの選択: 日本の場合 「(UTC+09:00) 大阪、札幌、東京」 を選択します。</p><p>・第2言語の選択: 対応を希望される言語を選択します。</p><div class="alert is-success">  <p class="alert-title">ヒント</p>  <p>日本語以外の言語での対応をご要望の場合は、お問い合わせ本文等についてもすべて対応希望言語での記載をお願いいたします。</p></div><h4 id="⑪-ユーザー補助の設定"><a href="#⑪-ユーザー補助の設定" class="headerlink" title="⑪ ユーザー補助の設定"></a>⑪ ユーザー補助の設定</h4><p>ユーザー補助関連のニーズがございましたら、本項目に記載いただきますようお願いいたします。</p><p>入力項目は以上の通りです。</p><p>上述の ①～⑪ までを入力し、「連絡を希望する」 を選択した後、初回応答時間内に、サポートエンジニアからのご連絡を差し上げます。</p><h2 id="お問い合わせの完了-サポート-リクエストのクローズ"><a href="#お問い合わせの完了-サポート-リクエストのクローズ" class="headerlink" title="お問い合わせの完了 (サポート リクエストのクローズ)"></a>お問い合わせの完了 (サポート リクエストのクローズ)</h2><h3 id="お問い合わせの終了方法について"><a href="#お問い合わせの終了方法について" class="headerlink" title="お問い合わせの終了方法について"></a>お問い合わせの終了方法について</h3><p>弊社のサポート エンジニアからの回答によって、お問い合わせに記載頂いた問題が解決した場合や、お客様ご自身で問題が解決した場合は、解決した旨をメール、お電話にてご連絡頂きますようお願い致します。<br>その後、弊社のサポート エンジニアにてお問い合わせ対応の終了 (クローズ) を実施します。</p><p>解決した旨のご連絡等、対応終了 (クローズ) をご承諾いただくご連絡が無い場合、担当エンジニアから継続してご連絡させていただくことになり、お手を煩わせることもございます。そのため、お手数ではございますが、対応終了をご承諾いただくご一報をいただけますと大変助かります。</p><p>また、弊社からの状況確認のご連絡を複数回実施し、お客様からご連絡を頂けなかった場合は、弊社のサポート エンジニアにてお問い合わせを対応終了のステータスとさせていただくことがあります。</p><h3 id="サポート-リクエストのクローズ後のアンケートについて"><a href="#サポート-リクエストのクローズ後のアンケートについて" class="headerlink" title="サポート リクエストのクローズ後のアンケートについて"></a>サポート リクエストのクローズ後のアンケートについて</h3><p>サポートリクエストをクローズ時にメールでアンケートを送付しています。<br>サポート対応の品質向上を目的として、各サポート リクエストでのサポート エンジニアによる対応品質をお客様にご評価いただいております。<br>回答内容については担当したサポート エンジニアならびに担当チームメンバーで共有し、次回以降のより良い対応に繋げたり、励みとさせていただいております。</p><h3 id="製品へのフィードバックや機能追加の要望"><a href="#製品へのフィードバックや機能追加の要望" class="headerlink" title="製品へのフィードバックや機能追加の要望"></a>製品へのフィードバックや機能追加の要望</h3><p>Microsoft Defender における製品自体の品質のフィードバック、機能追加・変更といったご要望については、Microsoft Defender ポータル上の 「フィードバック」 にて送信することができます。<br>以下の手順で Microsoft へのフィードバックを投稿していただくことで、開発部門に直接お声を届けることが可能となっています。</p><p>ご参考: <a href="https://learn.microsoft.com/ja-jp/defender-xdr/feedback">https://learn.microsoft.com/ja-jp/defender-xdr/feedback</a></p><ol><li>Microsoft Defender ポータルを開き、画面右上のフィードバックボタンを選択します。</li></ol><p><img src="../images/how-to-create-supportcase-006.png" alt="フィードバックボタン"></p><ol start="2"><li>Microsoft Defender のエクスペリエンスについて評価を行い、機能要望等につきまして可能な限り詳細を投稿いただくようお願いいたします。必要に応じて、Microsoft Defender ポータル上のスクリーンショットを含めることもできます。</li></ol><p><img src="../images/how-to-create-supportcase-007.png" alt="Microsoft にフィードバックを送信する"></p><div class="alert is-success">  <p class="alert-title">ヒント</p>  <p>・海外の開発チームが直接確認いたしますため、英語にてフィードバックを記載いただくことでご要望の内容がより正確に伝わることが期待されますので、お手数ですがご検討くださいますと幸いです。</p>  <p>・フィードバックいただいた上で弊社開発部門が実装可否や改善可否の検討をさせていただいており、実現のお約束は出来かねる内容となります。また、ご実施いただきましたフィードバックの確認結果や進捗状況については、本サポート窓口にお問い合わせいただきましてもご案内ができかねますこと、予めご理解くださいますようお願い申し上げます。</p></div><div class="alert is-important">  <p class="alert-title">重要</p>  <p>サポートと機能要望の違いについて</p>  <p>弊社サポートでは、現在進行形の問題に対して対処を行い、製品を使い続けられるような支援を行うことに注力しており、中・長期的に見た機能改善や追加のご要望、一過性の問題に対しての修正完了までの追跡はサポートでは行っておりません。上記フィードバック サイトでは、製品がより良くなるようなご要望について、その賛同意見や技術的な実現正とメリットを考え、今後の開発ロードマップに活かすべく開発者が直接参照しておりますので、ぜひとも積極的に投稿をお願いいたします。</p>  <p>なお、このような機能改善へのご要望について、中・長期的ではあっても、お客様にとって Microsoft Defender for Endpoint を継続利用するにあたって極めて大きな障壁となるようでしたら、プレミア サポートの契約をいただいている場合、担当の CSAM (カスタマー サクセス アカウント マネージャー) までご連絡をお願いします。</p></div><p>以上が弊社サポートサービスを効果的にご利用いただくためのお問い合わせ方法、および流れとなります。</p><p>なお、本ブログに記載しました内容はあくまで 「一般的なお問合せの流れ」 をご紹介していますので、もしこちらに記載がなくお悩みの点がございましたら、一旦お問合せを起票いただくか、既に対応させていただいている件があればそちらの担当サポートエンジニアまで、お気兼ねなくご相談ください。</p><p>Microsoft Defender for Endpoint をサポートサービスの質でお選び頂けるよう、チーム一同努めてまいりますので、これからも、弊社製品ならびにサポートサービスをご愛顧賜りますと幸いです。</p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Security &amp;amp; Compliance サポートチームです。&lt;br&gt;この記事では、Microsoft Defender for Endpoint (MDE) のサポートを効果的に利用するためのお問い合わせ(SR、サポートリクエスト) 発行方法について</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 1 弾&gt; Security &amp; Compliance サポートチームについて</title>
    <link href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-01/"/>
    <id>https://jp-sec.github.io/blog/Hiring-AboutSecurity-01/</id>
    <published>2024-05-16T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。日本マイクロソフト Security &amp; Compliance サポートチームの白木です。<br>現在わたしたちのチームでは、一緒に CSS (Customer Service &amp; Support) を盛り上げてくださるサポートエンジニアを募集しております。<br>本記事では、私たち Security &amp; Compliance チームの概要と、どのような製品を担当しているのかについてご案内させていただきます。</p><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#Security-amp-Compliance-%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Security &amp; Compliance チームについて</a></li><li><a href="#%E5%83%8D%E3%81%8D%E6%96%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">働き方について</a></li><li><a href="#Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96-MDAV-%E3%81%A3%E3%81%A6%E3%81%A9%E3%82%93%E3%81%AA%E8%A3%BD%E5%93%81%EF%BC%9F">Microsoft Defender ウイルス対策 (MDAV) ってどんな製品？</a></li><li><a href="#Microsoft-Defender-for-Endpoint-MDE-%E3%81%A3%E3%81%A6%E3%81%A9%E3%82%93%E3%81%AA%E8%A3%BD%E5%93%81%EF%BC%9F">Microsoft Defender for Endpoint (MDE) ってどんな製品？</a></li><li><a href="#Microsoft-Defender-SmartScreen-%E3%81%A3%E3%81%A6%E3%81%A9%E3%82%93%E3%81%AA%E8%A3%BD%E5%93%81%EF%BC%9F">Microsoft Defender SmartScreen ってどんな製品？</a></li><li><a href="#Microsoft-Defender-for-Office-365-MDO-%E3%81%A3%E3%81%A6%E3%81%A9%E3%82%93%E3%81%AA%E8%A3%BD%E5%93%81%EF%BC%9F">Microsoft Defender for Office 365 (MDO) ってどんな製品？</a></li><li><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B">関連記事</a></li></ul><h3 id="Security-amp-Compliance-チームについて"><a href="#Security-amp-Compliance-チームについて" class="headerlink" title="Security &amp; Compliance チームについて"></a>Security &amp; Compliance チームについて</h3><p>チーム名からお察しいただけます通り、当チームではセキュリティ製品とコンプライアンス製品を担当させていただいております。<br>セキュリティに関連した製品が非常に多くございます都合から、EP (EndPoint Protection) チームと CPC (Cloud Protection &amp; Compliance) チームに分かれて担当製品を分担しております (2024 年 5 月現在)。</p><p>この記事では EP チームの担当する製品についてご紹介をさせていただき、CPC チームの担当する製品は第 2 弾でご紹介させていただきます。</p><p>EP チームではエンドポイントを保護するための製品を中心にサポートしております。<br>主な製品といたしましては、Windows OS 組み込みのアンチウイルスソフトである Microsoft Defender ウイルス対策 (MDAV) や、エンドポイント上の振る舞い監視を提供する EDR (Endpoint Detection &amp; Response) 製品の Microsoft Defender for Endpoint (MDE)、Edge ブラウザを保護する Microsoft Defender SmartScreen があります。<br>また、2023 年から製品移管が行われており、現在は Messaging Protection 機能を提供する Microsoft Defender for Office 365 (MDO) も担当しております。</p><br><h3 id="働き方について"><a href="#働き方について" class="headerlink" title="働き方について"></a>働き方について</h3><p>サポートエンジニアの業務時間は、サポートの窓口の提供時間に合わせて 9:00-17:30 となっています。<br>ただし、一部のシフト制で稼働するエンジニアは 火-土 で勤務する等、例外的な勤務体制もございます。<br>また、本番環境においてお客様のビジネスに深刻な影響が発生した際の緊急対応に備え、24 時間単位での緊急体制の待機が求められる場合もあります。</p><p>勤務は出社とリモートワークをご自身で選んでいただくことが可能です。<br>私は概ね週に 1 日のみ出社し、4 日は在宅勤務としておりますが、フルリモート勤務の方や、週 3 程度出社される方もおります。<br>リモートワークでの働き方につきましては第 3 弾の記事でご紹介しておりますのでこちらもご参照いただければと思います。</p><br><h3 id="Microsoft-Defender-ウイルス対策-MDAV-ってどんな製品？"><a href="#Microsoft-Defender-ウイルス対策-MDAV-ってどんな製品？" class="headerlink" title="Microsoft Defender ウイルス対策 (MDAV) ってどんな製品？"></a>Microsoft Defender ウイルス対策 (MDAV) ってどんな製品？</h3><p><img src="../images/AboutSecurity01-01.png" alt="ウイルスと脅威の防止の設定画面"><br>MDAV は Windows 10 以降のクライアント OS や、Windows Server 2016 以降のサーバー OS に既定でインストールされているアンチウイルスソフトです。<br>リアルタイムスキャンによる脅威検出を提供する [リアルタイム保護] や、クラウドと連携することで新しい脅威の検出を可能にする [クラウド保護]、Office やスクリプトを使った攻撃を防御する [攻撃面の減少ルール (ASR ルール)] 等の機能があります。</p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-windows?view=o365-worldwide">Windows でのMicrosoft Defenderウイルス対策の概要</a></p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/cloud-protection-microsoft-defender-antivirus?view=o365-worldwide">クラウド保護と Microsoft Defender ウイルス対策</a></p><p><img src="../images/AboutSecurity01-02.png" alt="クラウド保護の画面"></p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment?view=o365-worldwide">攻撃面の縮小ルールの概要</a></p><br><h3 id="Microsoft-Defender-for-Endpoint-MDE-ってどんな製品？"><a href="#Microsoft-Defender-for-Endpoint-MDE-ってどんな製品？" class="headerlink" title="Microsoft Defender for Endpoint (MDE) ってどんな製品？"></a>Microsoft Defender for Endpoint (MDE) ってどんな製品？</h3><p><img src="../images/AboutSecurity01-03.png" alt="MDE の画面"></p><p>エンドポイント上の不審な動作や挙動を検知し、アラートを生成する EDR (Endpoint Detection &amp; Response) 製品です。<br>MDAV と異なり、MDE は Windows OS だけでなく Mac, Linux, iOS, Android 等の OS にも対応しています。<br>無償でご利用いただける MDAV と異なり、MDE をご利用いただく場合はライセンス購入が必要となります。<br>主な機能といたしましては、上述の通りエンドポイント上の振る舞い監視を提供する [エンドポイントでの検出と応答]、発生したアラートを自動で調査・修復する [自動調査と応答 (AIR)]、ネットワークの分離や調査パッケージの収集、デバイス上で発見された脆弱性に対する推奨事項の提供等があります。</p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-endpoint-detection-response?view=o365-worldwide">エンドポイントでの検出と対応の概要</a></p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/automated-investigations?view=o365-worldwide">自動調査の概要</a></p><p><img src="../images/AboutSecurity01-04.png" alt="自動調査の画面"></p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/respond-machine-alerts?view=o365-worldwide">デバイスの対応措置を講じる</a></p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-vulnerability-management/tvm-security-recommendation?view=o365-worldwide">セキュリティに関する推奨事項</a></p><br><h3 id="Microsoft-Defender-SmartScreen-ってどんな製品？"><a href="#Microsoft-Defender-SmartScreen-ってどんな製品？" class="headerlink" title="Microsoft Defender SmartScreen ってどんな製品？"></a>Microsoft Defender SmartScreen ってどんな製品？</h3><p><img src="../images/AboutSecurity01-06.png" alt="SmartScreen のブロック画面"></p><p>Microsoft Defender SmartScreen は Microsoft Edge ブラウザの保護を提供し、不審サイトへのアクセスや、脅威を含む可能性のあるファイルのダウンロードをブロックを提供します。<br>また、ネットワーク保護を有効化することにより、Google Chrome や Firefox 等のサードパーティ製ブラウザへの保護も提供可能です。</p><p><a href="https://learn.microsoft.com/ja-jp/windows/security/operating-system-security/virus-and-threat-protection/microsoft-defender-smartscreen/">Microsoft Defender SmartScreen</a></p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/network-protection?view=o365-worldwide">ネットワークを保護する</a></p><br><h3 id="Microsoft-Defender-for-Office-365-MDO-ってどんな製品？"><a href="#Microsoft-Defender-for-Office-365-MDO-ってどんな製品？" class="headerlink" title="Microsoft Defender for Office 365 (MDO) ってどんな製品？"></a>Microsoft Defender for Office 365 (MDO) ってどんな製品？</h3><p><img src="../images/AboutSecurity01-07.png" alt="MDO の画面"></p><p>なりすましメールやフィッシングメール、およびメールに添付された脅威を含むファイルをブロックします。<br>また、メールに記載された不審な URL の調査や、侵入した脅威に対する自動調査・修復機能などを提供します。<br>防御機能だけでなく、ユーザー様のトレーニングを目的とした攻撃シミュレーション機能もございます。</p><p><a href="https://learn.microsoft.com/ja-jp/defender-office-365/safe-attachments-about">Defender for Office 365 の安全な添付ファイル</a></p><p><a href="https://learn.microsoft.com/ja-jp/defender-endpoint/investigate-domain">ドメインと URL を調査する</a></p><p><img src="../images/AboutSecurity01-08.png" alt="ドメインの URL の調査画面"></p><p><a href="https://learn.microsoft.com/ja-jp/defender-office-365/air-about">Microsoft Defender for Office 365での自動調査と対応 (AIR)</a></p><p><a href="https://learn.microsoft.com/ja-jp/defender-office-365/attack-simulation-training-get-started">攻撃シミュレーション トレーニングの使用を開始する</a></p><br><h3 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h3><p>Security &amp; Compliance チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-01/">&lt;第 1 弾&gt; Security &amp; Compliance サポートチームについて</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-02/">&lt;第 2 弾&gt; CPC チームの製品紹介</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-03/">&lt;第 3 弾&gt; リモートワークでの働き方について</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-04/">&lt;第 4 弾&gt; チームの様子、雰囲気について</a>  </p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-05/">&lt;第 5 弾&gt; Security &amp; Compliance チームの多様性について</a></p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。日本マイクロソフト Security &amp;amp; Compliance サポートチームの白木です。&lt;br&gt;現在わたしたちのチームでは、一緒に CSS (Customer Service &amp;amp; Support) を盛り上げてくださるサポートエンジニアを募集し</summary>
      
    
    
    
    
    <category term="General" scheme="https://jp-sec.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jp-sec.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 2 弾&gt; CPC チームの製品紹介</title>
    <link href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-02/"/>
    <id>https://jp-sec.github.io/blog/Hiring-AboutSecurity-02/</id>
    <published>2024-05-16T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。日本マイクロソフト Security &amp; Compliance サポートチームの下浜です。<br>私たちのチームでは、現在 CSS (Customer Service &amp; Support) を盛り上げてくださるサポートエンジニアを募集しております。<br>本記事では、前回に引き続き、私たち Security &amp; Compliance チームがどのような製品を担当しているのかについてご案内させていただきます。</p><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#Cloud-Protection-amp-Compliance-CPC-%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Cloud Protection &amp; Compliance (CPC) チームについて</a></li><li><a href="#Microsoft-Defender-for-Cloud-MDfC-%E3%81%A3%E3%81%A6%E3%81%A9%E3%82%93%E3%81%AA%E8%A3%BD%E5%93%81%EF%BC%9F">Microsoft Defender for Cloud (MDfC) ってどんな製品？</a></li><li><a href="#Microsoft-Sentinel-%E3%81%A3%E3%81%A6%E3%81%A9%E3%82%93%E3%81%AA%E8%A3%BD%E5%93%81%EF%BC%9F">Microsoft Sentinel ってどんな製品？</a></li><li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E8%A3%BD%E5%93%81%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">その他の製品について</a></li><li><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B">関連記事</a></li></ul><h3 id="Cloud-Protection-amp-Compliance-CPC-チームについて"><a href="#Cloud-Protection-amp-Compliance-CPC-チームについて" class="headerlink" title="Cloud Protection &amp; Compliance (CPC) チームについて"></a>Cloud Protection &amp; Compliance (CPC) チームについて</h3><p>Security &amp; Compliance チームは EP (Endpoint Protection) と CPC (Cloud Protection &amp; Compliance) で製品を分担してサポートしております。<br>前回 EP チームについてご紹介させていただきましたので、第 2 弾のこの記事では CPC チームについて紹介していきます。</p><p>CPC チームでは組織がクラウド サービスを安全に利用するためのセキュリティ製品を幅広くサポートしています。<br>特にボリュームが多いのはクラウド上のサービスやデバイスを監視する Microsoft Defender for Cloud (MDfC)、そして各製品のログを分析し組織全体のセキュリティを強化する Microsoft Sentinel ですが、その他にも様々な製品も取り扱います。</p><p>EP と異なり多数の製品をサポートしていますが、はじめからすべての製品を担当するのではなく、一部の製品のサポートからスタートし徐々に担当する製品やサービスを広げていくので、負担なく知識を増やしていくことができます。</p><br><h3 id="Microsoft-Defender-for-Cloud-MDfC-ってどんな製品？"><a href="#Microsoft-Defender-for-Cloud-MDfC-ってどんな製品？" class="headerlink" title="Microsoft Defender for Cloud (MDfC) ってどんな製品？"></a>Microsoft Defender for Cloud (MDfC) ってどんな製品？</h3><p>一般的に CSPM と CWPP と呼ばれる機能を提供しています。<br>CSPM (クラウド セキュリティ態勢管理): 社内で利用するクラウド サービスの設定状況や構成を継続的に監視します。リスクとなりえるリソースや構成を検知すると管理者に通知し、改善を促すことでサービスを安全に利用することができます。<br>CWPP (クラウド ワークロード保護プラットフォーム): クラウド上に存在する仮想マシンやストレージなどのリソースで脆弱性やマルウェアなどの脅威の兆候が無いかを監視します。脅威の兆候をいち早く察知することで被害を防ぎ、影響範囲を最小化します。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/defender-for-cloud/defender-for-cloud-introduction">Microsoft Defender for Cloud とは</a></p><p><a href="https://learn.microsoft.com/ja-jp/azure/defender-for-cloud/concept-cloud-security-posture-management">クラウド セキュリティ態勢管理 (CSPM)</a></p><p><a href="https://www.microsoft.com/ja-jp/security/business/security-101/what-is-cwpp">CWPP とは</a></p><p>Microsoft Defender for Cloudを利用することで、組織全体で利用するクラウド リソースを監視し、攻撃の対象となりやすい構成やリスクがあるリソースが可視化されます。<br>新たに発見された脆弱性が対策されていないリソースを通知したり、マルウェアの兆候をアラートとして通知することで、セキュリティ担当者がリスクに対して迅速に対応できるよう手助けをしています。</p><br><h3 id="Microsoft-Sentinel-ってどんな製品？"><a href="#Microsoft-Sentinel-ってどんな製品？" class="headerlink" title="Microsoft Sentinel ってどんな製品？"></a>Microsoft Sentinel ってどんな製品？</h3><p>SIEM、SOAR と呼ばれる機能を提供しています。<br>SIEM (セキュリティ情報およびイベント管理): クラウドやオンプレミスなど場所を問わずあらゆるリソースや機器の情報を収集し分析します。高度な自動学習と脅威データベースと照合することで未知の脅威や高度な攻撃を発見します。<br>SOAR (セキュリティ オーケストレーション自動応答): 検知された脅威について発生するインシデントを作成する、担当者を割り当てる、危険性が無いアラートを終了するタスクを自動化し、組織のセキュリティ担当者の負担を軽減します。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/sentinel/overview">Microsoft Sentinel とは</a></p><p><a href="https://www.microsoft.com/ja-jp/security/business/security-101/what-is-siem">SIEM とは?</a></p><p><a href="https://learn.microsoft.com/ja-jp/azure/sentinel/automation">Microsoft Sentinel でのセキュリティ オーケストレーション、オートメーション、応答 (SOAR)</a></p><p>Microsoft Sentinel は様々な製品やサービスからログを収集し、分析することでより高度な攻撃から組織を保護します。<br>例えば単体のログからは検知できない攻撃の兆候を複数の製品のログを横断的に分析することで発見したり、組織に合わせてアラートやインシデントを調整することにより組織のセキュリティ担当者の負担を軽減し重要度の高い攻撃への対応を促します。</p><br><h3 id="その他の製品について"><a href="#その他の製品について" class="headerlink" title="その他の製品について"></a>その他の製品について</h3><p>CPC チームではその他にもクラウド アプリを監視する Microsoft Defender for Cloud Apps(MDA)、機密情報の保護や追跡を行う Purview Information Protection などなど、様々な製品をサポートしています。</p><p>Microsoft Defender for Cloud Apps (MDA) は CASB と呼ばれる製品に該当し、社内で利用する様々なクラウド アプリを適切に利用するための管理を行います。<br>この製品を利用することによりシャドウ IT の可視化やデータの保護を実現します。<br>Purview Information Protection は組織内の機密情報の検出や追跡、暗号化による保護を提供します。<br>ユーザーが作成したドキュメント上で機密情報を検知して自動的に暗号化を付与したり、ファイルが誰に共有されたかを管理者が追跡することができます。</p><p><a href="https://learn.microsoft.com/ja-jp/defender-cloud-apps/what-is-defender-for-cloud-apps">Microsoft Defender for Cloud Apps の概要</a></p><p><a href="https://learn.microsoft.com/ja-jp/azure/information-protection/what-is-information-protection">Azure Information Protection とは</a></p><br><h3 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h3><p>Security &amp; Compliance チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-01/">&lt;第 1 弾&gt; Security &amp; Compliance サポートチームについて</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-02/">&lt;第 2 弾&gt; CPC チームの製品紹介</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-03/">&lt;第 3 弾&gt; リモートワークでの働き方について</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-04/">&lt;第 4 弾&gt; チームの様子、雰囲気について</a>  </p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-05/">&lt;第 5 弾&gt; Security &amp; Compliance チームの多様性について</a></p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。日本マイクロソフト Security &amp;amp; Compliance サポートチームの下浜です。&lt;br&gt;私たちのチームでは、現在 CSS (Customer Service &amp;amp; Support) を盛り上げてくださるサポートエンジニアを募集しております</summary>
      
    
    
    
    
    <category term="General" scheme="https://jp-sec.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jp-sec.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 3 弾&gt; リモートワークでの働き方について</title>
    <link href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-03/"/>
    <id>https://jp-sec.github.io/blog/Hiring-AboutSecurity-03/</id>
    <published>2024-05-16T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。日本マイクロソフト Security &amp; Compliance サポートチームの沢です。<br>私たちのチームでは、現在 CSS (Customer Service &amp; Support) を盛り上げてくださるサポートエンジニアを募集しております。<br>本記事では、Security &amp; Compliance サポートチームの業務内容やリモートワークでの働き方についてご案内させていただきます。</p><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#%E6%A5%AD%E5%8B%99%E5%86%85%E5%AE%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">業務内容について</a></li><li><a href="#%E4%B8%80%E6%97%A5%E3%81%AE%E6%A5%AD%E5%8B%99%E3%81%AE%E6%B5%81%E3%82%8C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">一日の業務の流れについて</a></li><li><a href="#%E6%A5%AD%E5%8B%99%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">業務環境について</a><ul><li><a href="#%E5%8B%A4%E5%8B%99%E5%BD%A2%E6%85%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">勤務形態について</a></li><li><a href="#%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E6%89%8B%E6%AE%B5%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">コミュニケーション手段について</a></li><li><a href="#%E6%A5%AD%E5%8B%99%E7%94%A8%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%84%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">業務用デバイスや検証環境について</a></li></ul></li><li><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B">関連記事</a></li></ul><h2 id="業務内容について"><a href="#業務内容について" class="headerlink" title="業務内容について"></a>業務内容について</h2><p>Microsoft のクラウドサービスのサポートは、主にサービス料金内に含まれている無償サポートと別途追加のサポート契約が必要な有償サポートがあります。<br>わたしたちのチームでは主に有償サポート契約を締結されたお客様を中心にサービスを提供しています。</p><p>サービスリクエスト（SR）の受付からクローズまで基本的には担当するメンバーがオーナーシップを持って対応しており、基本的な案件対応の流れとしては、起票 → 調査方針合意 → 調査 → 回答 → クローズとなります。<br>SR の起票から終了までの期間につきましては内容にも依存しますので、一概に決まってはいないですが、大まかに下記のような感じだと認識いただければと思います。</p><ul><li>利用方法に関するお問合せや一般的なトラブルシューティング：１～１０日程度</li><li>類似事例のないトラブルシューティング：３～２０日程度<br>※ 製品不具合の改修が必要な場合も稀にありますので、そのような場合はクローズまで数ヶ月かかる時もあります。</li></ul><p>なお、時期によって増減はありますが、各エンジニアでは平均 10 ~ 20 件ほどのアクティブな SR を受け持ち、同時並行で案件対応を進める場合が多いです。<br>アクティブな SR の中にはお客様確認待ちステータスの SR も多く含まれますので、常に 10 数件の調査を並行して行うわけではございません。</p><br><h2 id="一日の業務の流れについて"><a href="#一日の業務の流れについて" class="headerlink" title="一日の業務の流れについて"></a>一日の業務の流れについて</h2><p>わたしのリモートワークでの 1 日の流れについて紹介いたします！</p><ul><li>09:00 Teams にて業務開始連絡。</li><li>09:00 SR 管理ツールにて担当 SR の対応状況整理及びタスクの洗い出しを実施。</li><li>09:30 新規担当 SR の対応開始。回答可能な内容であれば電話 or メールにて回答実施し、調査が必要な内容が含まれる場合は、次回連絡日程を沿えた上、受付連絡を実施。</li><li>10:30 既存担当 SR の調査を実施。（公開情報調査及び実機動作検証など）</li><li>11:00 SR 相談会に参加。（チームメンバー間の情報交換及び調査方法に関する相談などを目的とした、出入り自由な相談会）</li><li>12:00 お昼休憩。（SR 対応状況に応じて柔軟に取得時間を変更しています）</li><li>13:00 社内ミーティング参加。（社内別製品担当との協業調査など）</li><li>13:30 既存担当 SR の調査を実施。（公開情報調査及び実機動作検証など）</li><li>15:30 お客様からの電話に応対。（割合としては低いですが、メールでの案内内容に不明点がある場合や、急ぎ事情がある場合はお電話での対応もあります）</li><li>16:00 チームミーティング。（チームリーダからの重要事項周知やメンバーからの各種情報共有及び報告を目的としたミーティング）</li><li>17:00 通院のため、少し早めに業務を中断。</li><li>17:30 （サポート窓口が閉まります）</li><li>18:00 帰宅後、業務再開。（翌日分のタスク整理や実機動作検証など）</li><li>19:00 Teams にて業務終了連絡。</li></ul><br><h2 id="業務環境について"><a href="#業務環境について" class="headerlink" title="業務環境について"></a>業務環境について</h2><h3 id="勤務形態について"><a href="#勤務形態について" class="headerlink" title="勤務形態について"></a>勤務形態について</h3><p>わたしたちのチームでは主にリモートワーク中心で業務を行っています。<br>また、チームのメンバー内で話し合いをもって、必須ではありませんが毎週水曜日を推奨出社日とし、オフィスで席をならべて仕事をしている仲間も多いです。</p><br><h3 id="コミュニケーション手段について"><a href="#コミュニケーション手段について" class="headerlink" title="コミュニケーション手段について"></a>コミュニケーション手段について</h3><p>社内のコミュニケーションはほぼすべて Teams を利用して行います。<br>お客様とのコミュニケーション時はお客様にてご用意いただいた電話会議ツールや、電話を利用して行います。<br>社用携帯用の SIM が別途支給されていて、スマートフォンを利用した業務リソース（メール、Teams）へのアクセスも可能です。</p><br><h3 id="業務用デバイスや検証環境のスペックについて"><a href="#業務用デバイスや検証環境のスペックについて" class="headerlink" title="業務用デバイスや検証環境のスペックについて"></a>業務用デバイスや検証環境のスペックについて</h3><p>業務にて利用しているデバイスや検証環境のスペックについても簡単に紹介いたします！</p><ul><li>業務用デバイス１（Ryzen7 PRO 6850U / 32GB / 1TB）<ul><li>通常業務にて利用します。</li></ul></li></ul><p><img src="../images/AboutSecurity03-01.png" alt="業務用デバイス 1"></p><ul><li>業務用デバイス２（Azure Virtual Desktop）<ul><li>業務用デバイス１が利用できない場合などに、主に利用します。</li></ul></li></ul><p><img src="../images/AboutSecurity03-02.png" alt="業務用デバイス 2"></p><ul><li>検証環境１（サポート部門共用 Azure Subscriptions）<ul><li>主に業務関連検証にて利用します。</li></ul></li><li>検証環境２（個人に紐づく Azure Subscriptions）<ul><li>最大１０台までの VM が作成可能で、主に業務関連検証にて利用します。</li></ul></li><li>検証環境３（社員特典の Visual Studio Subscriptions 及び Subscriptions 付随 Azure Subscriptions 無償枠）<ul><li>業務以外の用途でも利用可能もので、担当外製品の検証や趣味のFPS ゲームサーバをホスティングする用途などで利用しています。</li></ul></li><li>チーム共用検証環境<ul><li>macOS デバイス及び Android / iOS デバイスが複数台ずつチーム共用デバイスとして用意されており、デバイス依存事象の調査の際に利用可能です。</li></ul></li><li>個人検証機１（Core i9-10900K / 128GB / 5TB）</li></ul><p><img src="../images/AboutSecurity03-03.png" alt="個人検証機 1"></p><ul><li>個人検証機２（Ryzen 5 PRO 3400GE / 64GB / 3TB）</li></ul><p><img src="../images/AboutSecurity03-04.png" alt="個人検証機 2"></p><br><h3 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h3><p>Security &amp; Compliance チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-01/">&lt;第 1 弾&gt; Security &amp; Compliance サポートチームについて</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-02/">&lt;第 2 弾&gt; CPC チームの製品紹介</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-03/">&lt;第 3 弾&gt; リモートワークでの働き方について</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-04/">&lt;第 4 弾&gt; チームの様子、雰囲気について</a>  </p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-05/">&lt;第 5 弾&gt; Security &amp; Compliance チームの多様性について</a></p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。日本マイクロソフト Security &amp;amp; Compliance サポートチームの沢です。&lt;br&gt;私たちのチームでは、現在 CSS (Customer Service &amp;amp; Support) を盛り上げてくださるサポートエンジニアを募集しております。</summary>
      
    
    
    
    
    <category term="General" scheme="https://jp-sec.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jp-sec.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 4 弾&gt; チームの様子、雰囲気について</title>
    <link href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-04/"/>
    <id>https://jp-sec.github.io/blog/Hiring-AboutSecurity-04/</id>
    <published>2024-05-16T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。日本マイクロソフト Security &amp; Compliance サポートチームの岡田です。<br>私たちのチームでは、現在 CSS (Customer Service &amp; Support) を盛り上げてくださるサポートエンジニアを募集しております。<br>本記事では、Security &amp; Compliance サポートチームの様子や雰囲気についてご案内させていただきます。</p><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#Security-amp-Compliance-%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E6%A7%98%E5%AD%90%E3%80%81%E9%9B%B0%E5%9B%B2%E6%B0%97">Security &amp; Compliance チームの様子、雰囲気</a></li><li><a href="#%E5%85%A5%E7%A4%BE%E5%89%8D%E3%81%AE-Microsoft-%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8">入社前の Microsoft のイメージ</a></li><li><a href="#%E3%83%81%E3%83%BC%E3%83%A0%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E3%81%AE%E6%80%9D%E3%81%86-Security-amp-Compliance-%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8">チームメンバーの思う Security &amp; Compliance チームのイメージ</a></li><li><a href="#Security-amp-Compliance-%E3%83%81%E3%83%BC%E3%83%A0%E3%82%92%E9%81%B8%E3%82%93%E3%81%A0%E7%90%86%E7%94%B1">Security &amp; Compliance チームを選んだ理由</a></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li><li><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B">関連記事</a></li></ul><h2 id="Security-amp-Compliance-チームの様子、雰囲気"><a href="#Security-amp-Compliance-チームの様子、雰囲気" class="headerlink" title="Security &amp; Compliance チームの様子、雰囲気"></a>Security &amp; Compliance チームの様子、雰囲気</h2><p>Security &amp; Compliance チームではそれぞれの自宅からのリモート勤務が可能です。<br>出社頻度などにルールや制限はなく、自分のライフスタイルに合わせてリモート勤務と出社を組み合わせることが可能です。<br>私は月に 1,2 回程度出社しており、それ以外は自宅からリモート勤務を行っております。<br>チームメンバーの中には札幌からフルリモートで勤務されている方もいます。<br>そのため、普段のやり取りは Teams のチャットや電話がメインとなります。<br>私も入社して約 2 年ほどたちますが、チームメンバーとのやり取りで困ったことはありません。</p><p>なお、フルリモートされている方が年に 1,2 回ほど品川のオフィスに出社されることがあります。<br>※ 交通費は会社持ちです。笑<br>その際には Security &amp; Compliance チーム全体で飲み会を開き普段会う機会がないチームメンバーと実際に会って会話をすることができます。<br>また、チームに新しく join された方の歓迎会や新年会、忘年会が Security &amp; Compliance チーム全体で行われます。<br>歓迎会や新年会、忘年会は品川オフィスで開催されることもありますが、外部の施設を利用することもあります。<br>参加は完全に自由となっておりますので、無理に参加する必要はなく、自分の予定に合わせて参加/不参加を決めることができます。<br>ちなみにですが、2024 年の 3 月に開催された歓迎会はダーツバーで行いました！</p><br><h2 id="入社前の-Microsoft-のイメージ"><a href="#入社前の-Microsoft-のイメージ" class="headerlink" title="入社前の Microsoft のイメージ"></a>入社前の Microsoft のイメージ</h2><p>皆さんは Microsoft と聞くとどのようなイメージを持たれるでしょうか。<br>私は Microsoft と言えば外資系ということもあり、実力主義でチームメンバー間のやり取りもなく冷たいイメージを持っておりました。笑<br>チームメンバーの方々に入社前の Microsoft に対するイメージについてアンケートを取りましたのでメンバーの思う Microsoft のイメージを確認してみましょう！</p><p>アンケート結果からも個人主義であったり、成果主義のためチームメンバー間のフォローがなく、冷たいイメージを持たれていた方が多くいました。。。<br>Microsoft 入社後の今だからこそわかる Security &amp; Compliance チームのイメージについても確認してみましょう！</p><p>◆ アンケート結果<br>・ 実力、成果主義のイメージ<br>・ あまり周りと関わらず、1人で黙々と仕事を進めるイメージ<br>・ 各々自分の仕事は人に助けを求めず自分の力で遂行しているイメージ<br>・ 個人主義<br>・ 入社後のトレーニング等もあまりないイメージ<br>・ 固く厳しいイメージ<br>・ エリートばかりで、知識が薄いとバカにされるかもしれないイメージ<br>・ 周りをフォローしない、冷たいイメージ<br>・ 明るくて活発なイメージ<br>・ 開発経験バリバリあってずっと IT の第一線を走ってきたような人たちばかりのイメージ<br>・ 残業まみれでワークライフバランスが無い会社のイメージ<br>・ 全員英語はネイティブレベルで人間関係がドライのイメージ</p><br><h2 id="チームメンバーの思う-Security-amp-Compliance-チームのイメージ"><a href="#チームメンバーの思う-Security-amp-Compliance-チームのイメージ" class="headerlink" title="チームメンバーの思う Security &amp; Compliance チームのイメージ"></a>チームメンバーの思う Security &amp; Compliance チームのイメージ</h2><p>Microsoft 入社前のイメージでは冷たいイメージを持たれていた方が多くいる結果となりましたが、今度は Security &amp; Compliance チームで働いている現在の Security &amp; Compliance チーム に対するイメージを紹介します。<br>Security &amp; Compliance チームのイメージについてもアンケートを取りましたので見てみましょう！</p><p>アンケートの結果、入社前のイメージとは変わり、お互いにフォローし合い暖かいイメージを持たれている方が多くいました！<br>私自身も普段の業務では多くの方にフォローいただいており、相談の際に嫌な顔をされたことは一度もありません！<br>困った時は支え合い、教え合う文化が根付いているため、入社歴に関係なく自分の知識を共有し業務に活かしています。<br>わからないことを互いに教え合う環境が整っていますので、知識がないから。。。と思わず、Security &amp; Compliance チームに少しでも興味を持たれた方は <a href="https://www.microsoft.com/ja-jp/mscorp/college/mskk-entry">こちら</a>からお申込みを検討いただけると嬉しいです！</p><p>◆ アンケート結果<br>・ お客様へのサポートに限らずメンバーのサポートもしっかりしているチーム。<br>・ 助け合いながら仕事が進められる<br>・ 困ったときに助けあえている<br>・ 分からないことは教えあう文化<br>・ 入社後のトレーニングも充実しており、手厚く育成してくれる<br>・ 様々なバックグラウンドを持つメンバーが集まっているが、相互に理解や配慮が感じられる素晴らしいチーム<br>・ 仕事には真面目に取り組むが、チームとしては仲良し<br>・ お互いにフォローしあう<br>・ みんな優しい<br>・ それぞれの得意分野を生かして協力しあっている<br>・ チームワークがよくて仕事がしやすい<br>・ 心理的安全性が高い<br>・ とにかく優しい人たちがたくさんいるため、相談もしやすく働きやすい</p><br><h2 id="Security-amp-Compliance-チームを選んだ理由"><a href="#Security-amp-Compliance-チームを選んだ理由" class="headerlink" title="Security &amp; Compliance チームを選んだ理由"></a>Security &amp; Compliance チームを選んだ理由</h2><p>Microsoft には多くの製品があり、多くの担当チームが存在します。<br>その中で Security &amp; Compliance チームを選んだ理由についてもメンバーにアンケートを取りましたので見てみましょう！</p><p>アンケートの結果、前職でセキュリティ関連のお仕事をされていた方が多くいらっしゃいましたが、中にはセキュリティ未経験で入社された方もいらっしゃいました！<br>セキュリティ未経験でもお互いに教え合う文化により活躍できる環境が整っています。<br>セキュリティ未経験でも臆せず <a href="https://www.microsoft.com/ja-jp/mscorp/college/mskk-entry">こちら</a>からお申込みを検討いただけると嬉しいです！</p><p>◆ アンケート結果<br>・ セキュリティ分野に興味があったから<br>・ セキュリティは未経験だったが、今後も需要が高まる分野だと考えたため<br>・ 前職でセキュリティ関連の業務をしており、興味があったため<br>・ 前職でセキュリティ関連の業務をしたこともあるが、Microsoft のセキュリティ製品に興味があったため<br>・ ここしかない！ と閃いたため<br>・ IT の括りの中で一番面白いと思っていて、知識をさらに深めたかったから<br>・ 前職でサイバー セキュリティの業務に従事していたため、貢献できると思ったため<br>・ サポート業務に従事することで Security 業界や製品に関する知見や対応経験が得られると思ったため<br>・ 前職で Security に関連する業務に携わっており、更にスキルアップを目指したいと思っていたため<br>・ 前職でユーザー部門セキュリティ担当をしており、Microsoft 製品の運用しており製品スキルを高めたかったため</p><br><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>皆さん、いかがだったでしょうか。<br>Security &amp; Compliance チームの雰囲気やイメージについて少しでもイメージがわきましたでしょうか。<br>入社前はメンバー間のフォローが希薄であり、冷たいイメージを持たれている方が多くいましたが、入社後のイメージではメンバー間のフォローが充実しており、安心して業務が行える環境であると回答した方が多くいました！<br>セキュリティ分野未経験の方でも日々切磋することで活躍することができるチームですので Security &amp; Compliance チームに少しでも興味を持たれた方は <a href="https://www.microsoft.com/ja-jp/mscorp/college/mskk-entry">こちら</a>からお申込みを検討いただけると嬉しいです！</p><br><h3 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h3><p>Security &amp; Compliance チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-01/">&lt;第 1 弾&gt; Security &amp; Compliance サポートチームについて</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-02/">&lt;第 2 弾&gt; CPC チームの製品紹介</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-03/">&lt;第 3 弾&gt; リモートワークでの働き方について</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-04/">&lt;第 4 弾&gt; チームの様子、雰囲気について</a>  </p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-05/">&lt;第 5 弾&gt; Security &amp; Compliance チームの多様性について</a></p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。日本マイクロソフト Security &amp;amp; Compliance サポートチームの岡田です。&lt;br&gt;私たちのチームでは、現在 CSS (Customer Service &amp;amp; Support) を盛り上げてくださるサポートエンジニアを募集しております</summary>
      
    
    
    
    
    <category term="General" scheme="https://jp-sec.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jp-sec.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 5 弾&gt; Security &amp; Compliance チームの多様性について</title>
    <link href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-05/"/>
    <id>https://jp-sec.github.io/blog/Hiring-AboutSecurity-05/</id>
    <published>2024-05-16T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。日本マイクロソフト Security &amp; Compliance サポート チームの下浜です。<br>私たちのチームでは、現在 CSS (Customer Service &amp; Support) を盛り上げてくださるサポートエンジニアを募集しております。<br>本記事では、Security &amp; Compliance チームで活躍するエンジニアについてご案内させていただきます。</p><p>現在 Security &amp; Compliance チームには 50 名程が所属しています。<br>メンバーのバックグラウンドは様々で、新卒として Microsoft に入社した方もいれば、20 年以上 IT 業界の第一線で活躍されてきた方もいます。<br>全社的にダイバーシティに取り組む弊社には様々なバックグラウンドを持つ社員が所属しておりますので、以下にご紹介させていただきます。</p><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#%E5%A5%B3%E6%80%A7%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">女性エンジニアについて</a></li><li><a href="#%E6%89%80%E5%B1%9E%E3%81%99%E3%82%8B%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AE%E7%B5%8C%E6%AD%B4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">所属するエンジニアの経歴について</a></li><li><a href="#%E8%A8%80%E8%AA%9E%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">言語について</a></li><li><a href="#%E5%A4%9A%E6%A7%98%E3%81%AA%E3%83%90%E3%83%83%E3%82%AF%E3%82%B0%E3%83%A9%E3%82%A6%E3%83%B3%E3%83%89%E3%82%92%E6%8C%81%E3%81%A4%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%82%92%E6%AD%93%E8%BF%8E%E3%81%97%E3%81%BE%E3%81%99">多様なバックグラウンドを持つエンジニアを歓迎します</a></li><li><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B">関連記事</a></li></ul><h3 id="女性エンジニアについて"><a href="#女性エンジニアについて" class="headerlink" title="女性エンジニアについて"></a>女性エンジニアについて</h3><p>サイバー セキュリティという業界柄絶対数は少ないものの、チームとしては女性エンジニアが増えてきて私を含め現在 10 名となりました。<br>普段の業務で性別を意識する機会はほとんどありませんが、イベントなどで集まると製品の壁を越えて積極的に情報交換しています。<br>各チームに先輩となる女性エンジニアがいることでより馴染みやすい環境になり、個人的にはまだまだ女性エンジニアが増えてくれたらいいなと期待しています。</p><p>セキュリティ チーム所属の Yuka さんのインタビュー記事がありますのでオススメさせていただきます。<br><a href="https://www.microsoft.com/ja-jp/mscorp/mid-career/se-video_interview_yuka">サポート未経験者でも成長できる助け合いのカルチャー</a></p><br><h3 id="所属するエンジニアの経歴について"><a href="#所属するエンジニアの経歴について" class="headerlink" title="所属するエンジニアの経歴について"></a>所属するエンジニアの経歴について</h3><p>サイバー セキュリティの第一線をずっと走ってきたいわゆる “強いエンジニア” をイメージされることが多い業務ですが、そのイメージに当てはまらないエンジニアも多くいます。<br>前職を聞いてみてもピープル マネジメント一色だった方、他社製品やアウトソース ベンダーでテクニカル サポート業務に従事していた方、プリ セールスや営業職など多岐にわたります。<br>また、一口に技術職といってもオンプレミス製品やネットワーク機器など、セキュリティ領域以外からのチャレンジも含めて様々な人が所属しています。</p><p>サポート業務の経験が無く入った方はお客様とのコミュニケーションに迷ったり、親和性のあまり無い領域から転職された方は技術的なキャッチアップに苦戦したりなど、Onbording 時にそれぞれ苦戦するポイントはありますが、チームのメンバーにフォローしてもらい相談しながら少しずつ慣れていくことができます。</p><p>ちなみに、前職からさらに遡ると飲食店や不動産営業やダイバーなどさらに多様な経歴の話も聞くことができるので、入社した後直接バックグラウンドについて聞いて回るのも面白いかもしれません。</p><br><h3 id="言語について"><a href="#言語について" class="headerlink" title="言語について"></a>言語について</h3><p>日本語でのサポートを提供する業務の性質上日本語が前提で、さらに英語の技術情報や海外のエンジニアとのやりとりがあるため、英語が分かると有利な場面は多いです。<br>一方で英語を苦手とする人には通訳や翻訳での配慮がされるので、英語が苦手 or 分からなくても問題ありません。<br>（対面でのリアルタイムの会話についていけない、などの場面は時々ありますが・・・）</p><p>なお、第一言語が日本語以外のサポート エンジニアも複数名在籍しています。<br>日本語ネイティブでなくとも特に不利になることもなく、近しい経験の方が多い分馴染みやすい環境でもあると思います。</p><br><h3 id="多様なバックグラウンドを持つエンジニアを歓迎します"><a href="#多様なバックグラウンドを持つエンジニアを歓迎します" class="headerlink" title="多様なバックグラウンドを持つエンジニアを歓迎します"></a>多様なバックグラウンドを持つエンジニアを歓迎します</h3><p>現在 Security &amp; Compliance チームに所属するエンジニアは、それぞれの経験を生かして協力しながら日々の業務を進めています。</p><p>サポート エンジニアは技術職なので、異なる領域からチャレンジされる場合、最初にキャッチアップの量に驚かれるかもしれません。<br>しかしチーム内には既に様々な領域からチャレンジして活躍するエンジニアが多数おりますので、豊富な経験でバックアップしてくれます。<br>入社してから日の浅いメンバー同士でも積極的にコミュニケーションをとっているので、困ったときに相談できる相手、助けてくれる相手がたくさんいます。</p><p>もし今の経験やスキルがマッチしていないと感じていても、思ってもいない形で強みになる場合があります。<br>現在のセキュリティ製品やクラウド サービスの経験だけでなく、様々なバックグラウンドを持つメンバーが合流してくれることで、チームの幅が広がることを楽しみにしています。<br>これからも注目度の高いセキュリティ業界で、一緒に成長していける方のご応募をお待ちしております。</p><br><h3 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h3><p>Security &amp; Compliance チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-01/">&lt;第 1 弾&gt; Security &amp; Compliance サポートチームについて</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-02/">&lt;第 2 弾&gt; CPC チームの製品紹介</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-03/">&lt;第 3 弾&gt; リモートワークでの働き方について</a></p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-04/">&lt;第 4 弾&gt; チームの様子、雰囲気について</a>  </p><p><a href="https://jp-sec.github.io/blog/Hiring-AboutSecurity-05/">&lt;第 5 弾&gt; Security &amp; Compliance チームの多様性について</a></p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。日本マイクロソフト Security &amp;amp; Compliance サポート チームの下浜です。&lt;br&gt;私たちのチームでは、現在 CSS (Customer Service &amp;amp; Support) を盛り上げてくださるサポートエンジニアを募集しておりま</summary>
      
    
    
    
    
    <category term="General" scheme="https://jp-sec.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jp-sec.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>デバイスコントロール機能を使用してリムーバブルメディアアクセス制御を構成する手順と確認ポイント</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2023-12-13/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2023-12-13/</id>
    <published>2024-02-07T06:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Security &amp; Compliance サポートチームです。</p><p>この記事では、Microsoft Defender for Endpoint(MDE) を使用する Windows マシンでデバイスコントロール機能を使用してリムーバブルメディアアクセスを制御する方法を紹介します。</p><p>なお、本記事の内容は、2024 年 1 月 24 日時点で最新の情報を元に作成いたしております。</p><p>また、本記事の手順はすべて Windows 11 23H2 にて動作確認を実施しております。</p><p>デバイスコントロール機能に関する最新情報については、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-removable-storage-protection?view=o365-worldwide">Microsoft Learn</a> をご参照ください。</p><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%81%AE%E6%A6%82%E8%A6%81">リムーバブルメディアアクセス制御の概要</a><ul><li><a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%81%A8%E3%81%AF">リムーバブルメディアアクセス制御とは</a></li><li><a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%81%AE%E5%89%8D%E6%8F%90%E8%A6%81%E4%BB%B6">リムーバブルメディアアクセス制御の前提要件</a></li><li><a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95">リムーバブルメディアアクセス制御の設定方法</a></li><li><a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B">リムーバブルメディアアクセス制御の設定方法を選択する</a></li></ul></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">グループポリシーを使用してリムーバブルメディアアクセス制御を構成する</a><ul><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">グループポリシーを使用するための事前準備</a></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%A7%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E6%A9%9F%E8%83%BD%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B">グループポリシーでデバイスコントロール機能を有効化する</a></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%A7%E6%97%A2%E5%AE%9A%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">グループポリシーで既定の処理を構成する</a></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%A7%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">グループポリシーでデバイスコントロールグループを構成する</a></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%A7%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">グループポリシーでアクセス制御ポリシーを構成する</a></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A%E7%8A%B6%E6%B3%81%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%AE%E6%9B%B4%E6%96%B0%E6%9C%89%E7%84%A1%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">デバイスコントロールの設定状況とポリシーの更新有無を確認する</a></li></ul></li><li><a href="#Intune-%E3%81%AE-OMA-URI-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">Intune の OMA-URI を使用してリムーバブルメディアアクセス制御を構成する</a><ul><li><a href="#Intune-%E3%81%AE-OMA-URI-%E3%81%A7%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E6%A9%9F%E8%83%BD%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B">Intune の OMA-URI でデバイスコントロール機能を有効化する</a></li><li><a href="#Intune-%E3%81%AE-OMA-URI-%E3%81%A7%E6%97%A2%E5%AE%9A%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">Intune の OMA-URI で既定の処理を構成する</a></li><li><a href="#Intune-%E3%81%AE-OMA-URI-%E3%81%A7%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">Intune の OMA-URI でデバイスコントロールグループを構成する</a></li><li><a href="#Intune-%E3%81%AE-OMA-URI-%E3%81%A7%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">Intune の OMA-URI でアクセス制御ポリシーを構成する</a></li></ul></li><li><a href="#Intune-%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">Intune のユーザインターフェースを使用してリムーバブルメディアアクセス制御を構成する</a></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92-XML-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">デバイスコントロールグループを XML ファイルで構成する</a><ul><li><a href="#PrimaryId-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E6%8C%87%E5%AE%9A">PrimaryId によるデバイスの指定</a></li><li><a href="#InstancePathUd-%E3%81%A8-VID_PID-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E6%8C%87%E5%AE%9A">InstancePathId と VID_PID によるデバイスの指定</a></li><li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E6%8C%87%E5%AE%9A%E6%96%B9%E6%B3%95">その他のデバイスコントロールグループの指定方法</a></li></ul></li><li><a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92-XML-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">リムーバブルメディアアクセス制御を XML ファイルで構成する</a><ul><li><a href="#%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%83%AC%E3%83%99%E3%83%AB%E3%81%A7%E8%AA%AD%E3%81%BF%E6%9B%B8%E3%81%8D%E5%AE%9F%E8%A1%8C%E3%82%92%E6%8B%92%E5%90%A6%E3%81%99%E3%82%8B">ディスクレベルで読み書き実行を拒否する</a></li><li><a href="#SID-%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E3%81%A8%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A8%B1%E5%8F%AF%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">SID を指定して読み取りと書き込みアクセス許可を構成する</a></li><li><a href="#Advanced-Hunging-%E3%81%A7%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">Advanced Hunging でリムーバブルメディアアクセス制御イベントを確認する</a></li></ul></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%BE%E3%81%9F%E3%81%AF-Intune-%E3%81%AE-OMA-URI-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA">グループポリシーまたは Intune の OMA-URI を使用してアクセス制御を構成するサンプルシナリオ</a><ul><li><a href="#%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA-1-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%A7%E6%97%A2%E5%AE%9A%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%8B%92%E5%90%A6%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">シナリオ 1 - カスタムポリシーで既定のアクセス拒否ポリシーを構成する</a></li><li><a href="#%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA-2-%E7%89%B9%E5%AE%9A%E3%81%AE-USB-%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%81%AE%E3%81%BF%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B">シナリオ 2 - 特定の USB メモリに対してのみアクセスを許可する</a></li><li><a href="#%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA-3-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%94%E3%81%A8%E3%81%AB%E7%95%B0%E3%81%AA%E3%82%8B%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A8%B1%E5%8F%AF%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">シナリオ 3 - デバイスごとに異なるアクセス許可を構成する</a></li><li><a href="#%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA-4-%E7%89%B9%E5%AE%9A%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B">シナリオ 4 - 特定のユーザに対してアクセスを許可する</a></li></ul></li><li><a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E8%B3%AA%E5%95%8F">リムーバブルメディアアクセス制御に関するよくある質問</a><ul><li><a href="#%E7%89%B9%E5%AE%9A%E3%81%AE%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%83%91%E3%82%B9%E3%81%AA%E3%81%A9%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95%E3%81%8C%E3%82%8F%E3%81%8B%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93">特定のメディアを指定するために使用するデバイスインスタンスパスなどの確認方法がわかりません</a></li><li><a href="#%E6%97%A2%E5%AE%9A%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E6%8B%92%E5%90%A6%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%A8%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E8%A8%B1%E5%8F%AF%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%8C%E5%8B%95%E4%BD%9C%E3%81%97%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">既定の処理を拒否に設定すると読み取り許可のアクセス制御ポリシーが動作しなくなるのはなぜですか？</a></li></ul></li></ul><h2 id="リムーバブルメディアアクセス制御の概要"><a href="#リムーバブルメディアアクセス制御の概要" class="headerlink" title="リムーバブルメディアアクセス制御の概要"></a>リムーバブルメディアアクセス制御の概要</h2><h3 id="リムーバブルメディアアクセス制御とは"><a href="#リムーバブルメディアアクセス制御とは" class="headerlink" title="リムーバブルメディアアクセス制御とは"></a>リムーバブルメディアアクセス制御とは</h3><p>MDE を利用する Windows マシンでデバイスコントロール機能を利用することで、リムーバブルメディアへのアクセス制御が可能です。</p><p>リムーバブルメディアへのアクセス制御を構成することで、USB フラッシュメモリや CD/DVD、WPAD 端末など、さまざまなリムーバブルメディアに対して読み取り、書き込みまたは実行アクセスの監査やブロックを行うことが可能です。</p><h3 id="リムーバブルメディアアクセス制御の前提要件"><a href="#リムーバブルメディアアクセス制御の前提要件" class="headerlink" title="リムーバブルメディアアクセス制御の前提要件"></a>リムーバブルメディアアクセス制御の前提要件</h3><p>下記公開情報に記載の通り、リムーバブルメディアアクセス制御は本記事執筆時点(2024 年 1 月) では、Windows 10 / 11 および macOS 11(Big Sur) 以降での利用をサポートしています。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-overview?view=o365-worldwide&tabs=Removable#prerequisites">Microsoft Defender for Endpointのデバイス制御 | Microsoft Learn</a></p><h3 id="リムーバブルメディアアクセス制御の設定方法"><a href="#リムーバブルメディアアクセス制御の設定方法" class="headerlink" title="リムーバブルメディアアクセス制御の設定方法"></a>リムーバブルメディアアクセス制御の設定方法</h3><p>Windows マシンの場合、リムーバブルメディアアクセス制御機能はグループポリシーまたは Intune で構成することができます。</p><p>Intune を使用して管理する場合は、OMA-URI および XML ファイルを使用する方法と、Intune ユーザー インターフェイスを使用する方法のいずれか一方にて設定を行うことができます。</p><p>リムーバブルメディアアクセス制御の設定を複数のサービスで管理することは非推奨の構成にあたるため、設定を行う場合はいずれか 1 つの方法を選択してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/deploy-manage-removable-storage-group-policy?view=o365-worldwide">グループ ポリシーを使用してリムーバブルメディアアクセス制御を展開および管理する | Microsoft Learn</a></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/deploy-manage-removable-storage-intune?view=o365-worldwide#deploy-removable-storage-access-control-by-using-intune-user-interface">Intune を使用してリムーバブルメディアアクセス制御を展開および管理する | Microsoft Learn</a></p><h3 id="リムーバブルメディアアクセス制御の設定方法を選択する"><a href="#リムーバブルメディアアクセス制御の設定方法を選択する" class="headerlink" title="リムーバブルメディアアクセス制御の設定方法を選択する"></a>リムーバブルメディアアクセス制御の設定方法を選択する</h3><p>Windows マシンのリムーバブルメディアアクセス制御は以下のいずれかの方法で構成できます。</p><ol><li><p><strong>グループポリシー</strong></p></li><li><p><strong>Intune(OMA-URI)</strong></p></li><li><p><strong>Intune(ユーザインタフェース)</strong></p></li></ol><p>グループポリシーまたは Intune(OMA-URI) を使用する場合は、制御対象となるリムーバブルメディアなどを指定するデバイスコントロールグループを指定する XML ファイルと、デバイスコントロールグループに対するアクセス制御ポリシーを記述する XML ファイルをそれぞれ作成し、端末にポリシーとして配布する必要があります。</p><p>グループポリシーまたは Intune(OMA-URI) でリムーバブルメディアアクセス制御を行う際に作成する必要がある XML ファイルについては、<a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92-XML-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">リムーバブルメディアアクセス制御を XML ファイルで構成する</a> の項の記載を参照してください。</p><p>一方で、Intune(ユーザインタフェース)を使用する場合は Intune ポータル上のポリシー構成画面から GUI にてリムーバブルメディアアクセス制御を構成できます。</p><p>そのため、Intune(ユーザインタフェース)を使用する場合は XML ファイルの作成は不要です。</p><p>※ リムーバブルメディアアクセス制御の設定を複数のサービスで管理することは非推奨の構成にあたるため、設定を行う場合はいずれか 1 つの方法を選択してください。</p><h2 id="グループポリシーを使用してリムーバブルメディアアクセス制御を構成する"><a href="#グループポリシーを使用してリムーバブルメディアアクセス制御を構成する" class="headerlink" title="グループポリシーを使用してリムーバブルメディアアクセス制御を構成する"></a>グループポリシーを使用してリムーバブルメディアアクセス制御を構成する</h2><h3 id="グループポリシーを使用するための事前準備"><a href="#グループポリシーを使用するための事前準備" class="headerlink" title="グループポリシーを使用するための事前準備"></a>グループポリシーを使用するための事前準備</h3><p>グループポリシーを使用してデバイスコントロール機能のリムーバブルメディアアクセス制御を実施する場合、現在ご利用中の管理用テンプレートにデバイスコントロール機能の設定項目が含まれているかどうか事前に確認する必要があります。</p><p>デバイスコントロール機能は、Windows 10 の既定の管理用テンプレートなどを利用する環境では、既定で設定を変更することができません。</p><p>そのため、Active Directory やローカルグループポリシーを使用してデバイスコントロール機能の設定を行う場合には、必ず事前に以下の 2 つの設定項目が存在していることを確認してください。</p><ul><li><p> <strong>[Microsoft Defender ウイルス対策]&gt;[機能]</strong> </p></li><li><p><strong>[Microsoft Defender ウイルス対策]&gt;[デバイス制御]</strong></p></li></ul><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-deploy-manage-gpo?view=o365-worldwide#enable-or-disable-removable-storage-access-control">Deploy and manage device control in Microsoft Defender for Endpoint with Group Policy | Microsoft Learn</a></p><p>以下は  <a href="https://www.microsoft.com/en-us/download/details.aspx?id=105390">Administrative Templates (.admx) for Windows 11 2022 Update (22H2) - v3.0</a> として配布している管理用テンプレートを使用してセントラル ストアの admx および adml を更新済みの環境でグループポリシーエディタを起動した画面です。</p><p>このように [Microsoft Defender ウイルス対策] 内に [機能] と [デバイス制御] の設定項目がそれぞれ表示されている場合には、デバイスコントロール機能のリムーバブルメディアアクセス制御をグループポリシーで構成することが可能です。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-001.png" alt="Windows 11 2022 Update (22H2) - v3.0 の管理用テンプレート (.admx) を使用する場合"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-JP/troubleshoot/windows-client/group-policy/create-and-manage-central-store">セントラル ストアの作成と管理 - Windows Client | Microsoft Learn</a></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/deploy-manage-removable-storage-group-policy?view=o365-worldwide#deploy-using-group-policy">グループ ポリシーを使用してデプロイする | Microsoft Learn</a></p><h3 id="グループポリシーでデバイスコントロール機能を有効化する"><a href="#グループポリシーでデバイスコントロール機能を有効化する" class="headerlink" title="グループポリシーでデバイスコントロール機能を有効化する"></a>グループポリシーでデバイスコントロール機能を有効化する</h3><p>グループポリシーエディタ上でデバイスコントロール機能に対応する設定項目が存在することを確認したら、**[Microsoft Defender ウイルス対策]&gt;[機能]&gt;[デバイス制御]** の設定項目を有効化します。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-002.png" alt="グループポリシーでデバイスコントロール機能を有効化する"></p><p>端末でデバイスコントロール機能が有効化されているかどうかを確認したい場合、PowerShell で <code>Select-Object DeviceControlState</code> を実行し、出力結果が Enabled となることを確認してください。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span>&gt; <span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> DeviceControlState</span><br><span class="line"></span><br><span class="line">DeviceControlState</span><br><span class="line">------------------</span><br><span class="line">Enabled</span><br></pre></td></tr></table></figure><h3 id="グループポリシーで既定の処理を構成する"><a href="#グループポリシーで既定の処理を構成する" class="headerlink" title="グループポリシーで既定の処理を構成する"></a>グループポリシーで既定の処理を構成する</h3><p>必要に応じて、**[Microsoft Defender ウイルス対策]&gt;[デバイス制御]&gt;[デバイスコントロールの既定の強制ポリシーの選択]** からデバイスコントロール機能の既定の処理を構成することが可能です。</p><p>既定の処理を [拒否] とした場合、ポリシーによって明示的に許可されていない操作がデバイスコントロール機能によってブロックされます。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-003.png" alt="デバイスコントロール機能の既定の処理"></p><p>端末に適用されているデバイスコントロール機能の既定の処理は <code>Get-MpComputerStatus | Select-Object DeviceControlDefaultEnforcement</code> を PowerShell で実行することで確認できます。</p><p>本記事執筆時点で最新の WIndows 11 デバイスでは、上記の設定が未構成の場合にはデバイスコントロール機能の既定の処理は [許可(DefaultAllow)] が設定されています。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span>&gt; <span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> DeviceControlDefaultEnforcement</span><br><span class="line"></span><br><span class="line">DeviceControlDefaultEnforcement</span><br><span class="line">-------------------------------</span><br><span class="line">DefaultAllow</span><br></pre></td></tr></table></figure><p>なお、この設定はリムーバブルメディアアクセス制御を含むすべてのデバイスコントロール機能に対する設定であるため、既定の処理を [拒否] とした場合にはデバイスコントロール機能のプリンター保護機能の動作にも影響する点に注意が必要です。</p><p>そのため、リムーバブルメディアアクセスに対してのみ既定の処理を構成したい場合には、[デバイスコントロールの既定の強制ポリシーの選択] の設定は未構成のままとし、後述する <a href="#%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA-1-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%A7%E6%97%A2%E5%AE%9A%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%8B%92%E5%90%A6%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">シナリオ 1 - カスタムポリシーで既定のアクセス拒否ポリシーを構成する</a> の手順でリムーバブルメディアアクセス制御ポリシーにて既定の動作を定義します。</p><blockquote><p><strong>organizationでプリンターがブロックされるのはなぜですか?</strong></p><p>既定の適用設定は、すべてのデバイスコントロールコンポーネントに対するものです。</p><p>つまり、 Deny設定すると、すべてのプリンターもブロックされます。 </p><p>プリンターを明示的に許可するカスタム ポリシーを作成するか、既定の適用ポリシーをカスタム ポリシーに置き換えることができます。</p></blockquote><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-removable-storage-access-control-faq?view=o365-worldwide#why-is-my-printer-blocked-in-my-organization">organizationでプリンターがブロックされるのはなぜですか? | Microsoft Learn</a></p><h3 id="グループポリシーでデバイスコントロールグループを構成する"><a href="#グループポリシーでデバイスコントロールグループを構成する" class="headerlink" title="グループポリシーでデバイスコントロールグループを構成する"></a>グループポリシーでデバイスコントロールグループを構成する</h3><p>グループポリシーでリムーバブルメディアアクセス制御を構成する際に必要なデバイスコントロールグループは、**[Microsoft Defender ウイルス対策]&gt;[デバイス制御]&gt;[デバイス制御ポリシーグループの定義]** から設定できます。 </p><p>このポリシーでは、デバイスコントロールグループの設定を記述した XML ファイルが存在するネットワークファイル共有の UNC パス、またはローカルファイルのフルパスを指定します。</p><p>設定を適切に反映するためには、デバイスコントロール機能を利用する端末がネットワークファイル共有の UNC パス、またはローカルファイルのフルパスから XML ファイルをロードできる必要があります。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-006.png" alt="デバイスコントロールグループの設定"></p><p>デバイスコントロールグループの設定を記述するための XML ファイルの作成方法については、後述する <a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92-XML-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">デバイスコントロールグループを XML ファイルで構成する</a> および、<a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%BE%E3%81%9F%E3%81%AF-Intune-%E3%81%AE-OMA-URI-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA">グループポリシーまたは Intune の OMA-URI を使用してアクセス制御を構成するサンプルシナリオ</a> の記載を参照してください。</p><h3 id="グループポリシーでアクセス制御ポリシーを構成する"><a href="#グループポリシーでアクセス制御ポリシーを構成する" class="headerlink" title="グループポリシーでアクセス制御ポリシーを構成する"></a>グループポリシーでアクセス制御ポリシーを構成する</h3><p>グループポリシーでリムーバブルメディアアクセス制御を構成する際に必要なアクセス制御ポリシーは、**[Microsoft Defender ウイルス対策]&gt;[デバイス制御]&gt;[デバイス制御ポリシールールの定義]** から設定できます。 </p><p>こちらも同じく、アクセス制御ポリシーの設定を記述した XML ファイルが存在するネットワークファイル共有の UNC パス、またはローカルファイルのフルパスを指定します。</p><p>設定を適切に反映するためには、デバイスコントロール機能を利用する端末がネットワークファイル共有の UNC パス、またはローカルファイルのフルパスから XML ファイルをロードできる必要があります。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-007.png" alt="アクセス制御ポリシーの設定"></p><p>アクセス制御ポリシーの設定を記述するための XML ファイルの作成方法については、後述する <a href="#%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92-XML-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">リムーバブルメディアアクセス制御を XML ファイルで構成する</a> および、<a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%BE%E3%81%9F%E3%81%AF-Intune-%E3%81%AE-OMA-URI-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%88%B6%E5%BE%A1%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA">グループポリシーまたは Intune の OMA-URI を使用してアクセス制御を構成するサンプルシナリオ</a> の記載を参照してください。</p><h3 id="デバイスコントロールの設定状況とポリシーの更新有無を確認する"><a href="#デバイスコントロールの設定状況とポリシーの更新有無を確認する" class="headerlink" title="デバイスコントロールの設定状況とポリシーの更新有無を確認する"></a>デバイスコントロールの設定状況とポリシーの更新有無を確認する</h3><p>デバイスコントロール機能の設定内容が反映されているか否かの確認のためには、以下の PowerShell コマンドレットを使用できます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span>&gt; <span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> DeviceControlState,DeviceControlDefaultEnforcement,DeviceControlPoliciesLastUpdated</span><br><span class="line"></span><br><span class="line">DeviceControlState DeviceControlDefaultEnforcement DeviceControlPoliciesLastUpdated</span><br><span class="line">------------------ ------------------------------- --------------------------------</span><br><span class="line">Enabled            DefaultAllow                    <span class="number">2024</span>/<span class="number">01</span>/<span class="number">20</span> <span class="number">8</span>:<span class="number">30</span>:<span class="number">36</span></span><br></pre></td></tr></table></figure><p>デバイスコントロール機能が正常に有効化されている場合には、<code>DeviceControlState</code> の値が <code>Enabled</code> になります。</p><p>また、デバイスコントロールグループおよびアクセス制御ポリシーの情報が反映された場合には、<code>DeviceControlPoliciesLastUpdated</code> に表示される時刻が更新されます。</p><h2 id="Intune-の-OMA-URI-を使用してリムーバブルメディアアクセス制御を構成する"><a href="#Intune-の-OMA-URI-を使用してリムーバブルメディアアクセス制御を構成する" class="headerlink" title="Intune の OMA-URI を使用してリムーバブルメディアアクセス制御を構成する"></a>Intune の OMA-URI を使用してリムーバブルメディアアクセス制御を構成する</h2><h3 id="Intune-の-OMA-URI-でデバイスコントロール機能を有効化する"><a href="#Intune-の-OMA-URI-でデバイスコントロール機能を有効化する" class="headerlink" title="Intune の OMA-URI でデバイスコントロール機能を有効化する"></a>Intune の OMA-URI でデバイスコントロール機能を有効化する</h3><p>MDE にオンボード済みの Windows マシンを Intune に登録したら、[デバイス]&gt;[構成プロファイル] から新規プロファイルを作成し、プラットフォームを [Windows 10 以降]、プロファイルの種類を [テンプレート] として、カスタム構成プロファイルを選択します。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-008.png" alt="Intune でカスタム構成プロファイルを作成する"></p><p>作成する構成プロファイルに、<code>Enable_DeviceControl</code> などの任意の名前を設定した後、[構成設定] 画面で <code>./Vendor/MSFT/Defender/Configuration/DeviceControlEnabled</code> という OMA-URI を追加し、データ型を [整数]、値を 1 とします。</p><p>この設定によって、マシンでデバイスコントロール機能を有効化できます。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-009.png" alt="DeviceControlEnabled でデバイスコントロール機能を有効化する"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-deploy-manage-intune?view=o365-worldwide#defining-settings-with-oma-uri">Microsoft Intuneを使用してMicrosoft Defender for Endpointでデバイス制御をデプロイおよび管理する | Microsoft Learn</a></p><h3 id="Intune-の-OMA-URI-で既定の処理を構成する"><a href="#Intune-の-OMA-URI-で既定の処理を構成する" class="headerlink" title="Intune の OMA-URI で既定の処理を構成する"></a>Intune の OMA-URI で既定の処理を構成する</h3><p>同じ構成プロファイルで <code>./Vendor/MSFT/Defender/Configuration/DefaultEnforcement</code> の OMA-URI を追加することで、デバイスコントロール機能の既定の処理を変更することができます。</p><p>データ型を [整数] とし、既定の処理を [許可] に設定する場合は 1 を、[拒否] に変更する場合は 2 を設定します。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-010.png" alt="DefaultEnforcement で既定の処理を設定する"></p><p>なお、グループポリシーで設定する場合と同じく、既定の処理の設定はリムーバブルメディアアクセス制御を含むすべてのデバイスコントロール機能に対する設定であるため、既定の処理を [拒否] とした場合にはデバイスコントロール機能のプリンター保護機能の動作にも影響する点に注意が必要です。</p><h3 id="Intune-の-OMA-URI-でデバイスコントロールグループを構成する"><a href="#Intune-の-OMA-URI-でデバイスコントロールグループを構成する" class="headerlink" title="Intune の OMA-URI でデバイスコントロールグループを構成する"></a>Intune の OMA-URI でデバイスコントロールグループを構成する</h3><p>Intune の OMA-URI を使用する場合も、グループポリシーで設定する場合と同じく XML ファイルでデバイスコントロールグループとアクセス制御ポリシーを設定します。</p><p>ただし、Intune の OMA-URI でデバイスコントロールグループを構成する場合、1 つのグループごとに 1 つの OMA-URI を割り当てる必要があります。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-deploy-manage-intune?view=o365-worldwide#creating-groups-with-oma-uri">OMA-URI を使用したグループの作成 | Microsoft Learn</a></p><p>この項では、<a href="#%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA-4-%E7%89%B9%E5%AE%9A%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B">シナリオ 4 - 特定のユーザに対してアクセスを許可する</a> のサンプルポリシーを Intne の OMA-URI で設定する手順を紹介します。</p><p>このサンプルシナリオで使用する OMA-URI 用の XML ファイルは、以下の公開リポジトリからダウンロード可能です。</p><p>参考情報：<a href="https://github.com/microsoft/mdatp-devicecontrol/tree/main/windows/Getting%20Started/Intune%20OMA-URI">Getting Started/Intune OMA-URI</a></p><p>デバイスコントロールグループの設定のため、以下の 3 つの XML ファイルを使用します。</p><ul><li><code>all_removable_media_devices&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Device&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyGroups/%7Bd8819053-24f4-444a-a0fb-9ce5a9e97862%7D/GroupData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>All removable media devices<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PrimaryId</span>&gt;</span>RemovableMediaDevices<span class="tag">&lt;/<span class="name">PrimaryId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>authorized_usbs&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Device&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyGroups/%7B368a2c82-17be-4137-bffa-370bbdff9672%7D/GroupData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>Authorized USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">InstancePathId</span>&gt;</span>USB\VID_154B<span class="symbol">&amp;amp;</span>PID_0028\6EA9150055800605<span class="tag">&lt;/<span class="name">InstancePathId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>readonly_usbs&#123;23c24566-98a5-4218-8802-59614513b97e&#125;.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;23c24566-98a5-4218-8802-59614513b97e&#125;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Device&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyGroups/%7B23c24566-98a5-4218-8802-59614513b97e%7D/GroupData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>Readonly USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">VID_PID</span>&gt;</span>090C_1000<span class="tag">&lt;/<span class="name">VID_PID</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Intune の OMA-URI でデバイスコントロールグループを定義する場合、1 つのグループごとに <code>./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyGroups/%7b[GroupId]%7d/GroupData</code> のような OMA-URI を作成し、グループの定義を含む XML ファイルをアップロードします。</p><p><code>[GroupId]</code> の箇所は構成するデバイスコントロールグループの GroupID に置き換えます。</p><p>例えば、上記のサンプルファイル <code>all_removable_media_devices&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;.xml</code> を使用する場合は、以下の <code>./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyGroups/%7Bd8819053-24f4-444a-a0fb-9ce5a9e97862%7D/GroupData</code> という OMA-URI を追加します。</p><p>この時、[データ型] は [文字列(XML ファイル)] を選択し、<code>Group</code> 要素を 1 つ含むファイルをアップロードします。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-011.png" alt="OMA-URI によるデバイスコントロールグループの設定"></p><p>上記と同様の手順で <code>Authorized USBs</code> と <code>Read Only USBs</code> のグループを定義する OMA-URI も追加します。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-012.png" alt="デバイスコントロールグループの OMA-URI を登録する"></p><p>グループの XML を適用する前に、<code>InstancePathId</code> や <code>VID_PID</code> の指定する値をユーザが利用するメディアの情報に置き換えてください。</p><p>また、特にデバイスインスタンスパスを使用して明示的にデバイスを指定する場合には、XML ファイル内で <code>&amp;</code> をエスケープ文字 <code>&amp;amp;</code> に置き換える必要がある点に注意してください。</p><h3 id="Intune-の-OMA-URI-でアクセス制御ポリシーを構成する"><a href="#Intune-の-OMA-URI-でアクセス制御ポリシーを構成する" class="headerlink" title="Intune の OMA-URI でアクセス制御ポリシーを構成する"></a>Intune の OMA-URI でアクセス制御ポリシーを構成する</h3><p>デバイスコントロールグループの OMA-URI を追加したので、次はこれらのグループと対応するアクセス制御ポリシーを登録します。</p><p>アクセス制御ポリシーを登録する場合も、1 つの <code>PolicyRule</code> ごとに 1 つの OMA-URI を登録する必要があります。</p><p>グループポリシー用の XML ファイルとは異なり、<code>PolicyRules</code> 要素にて複数の  <code>PolicyRule</code> をまとめて記述することができない点に注意が必要です。</p><p>このサンプルシナリオで使用する OMA-URI 用のポリシー XML ファイルは、以下の公開リポジトリからダウンロード可能です。(ファイル名が <code>step_4</code> から始まるものを使用します。)</p><p>参考情報：<a href="https://github.com/microsoft/mdatp-devicecontrol/tree/main/windows/Getting%20Started/Intune%20OMA-URI">Getting Started/Intune OMA-URI</a></p><p>アクセス制御ポリシーの設定のため、以下の XML ファイルを使用します。</p><ul><li><code>step_4_-_deny_all_other_usbs&#123;7beca8fe-313a-46f2-a090-399eb3d74318&#125;.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;7beca8fe-313a-46f2-a090-399eb3d74318&#125;&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7B7beca8fe-313a-46f2-a090-399eb3d74318%7D/RuleData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 4 - Deny all other USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;23c24566-98a5-4218-8802-59614513b97e&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;c82cb32c-4c56-4c76-8897-b2cc99558299&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Type</span>&gt;</span>Deny<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;70582e83-ea91-4b14-8f6c-f3921dab9d7a&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Type</span>&gt;</span>AuditDenied<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Options</span>&gt;</span>3<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>step_4_-_allow_access_to_writeable_usbs_for_some_users&#123;a054bbcf-3454-4b95-9058-f7ed00deeee9&#125;.xml</code> </li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;a054bbcf-3454-4b95-9058-f7ed00deeee9&#125;&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7Ba054bbcf-3454-4b95-9058-f7ed00deeee9%7D/RuleData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 4 - Allow Access to Writeable USBs for some users<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>63<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Sid</span>&gt;</span>S-1-1-0<span class="tag">&lt;/<span class="name">Sid</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>step_4_-_allow_read_only_access_to_read_only_usbs_for_some_users&#123;b2b9cfc0-799d-457c-babc-da617d9a8b83&#125;.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;b2b9cfc0-799d-457c-babc-da617d9a8b83&#125;&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7Bb2b9cfc0-799d-457c-babc-da617d9a8b83%7D/RuleData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 4 - Allow Read Only Access to Read Only USBs for some users<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;23c24566-98a5-4218-8802-59614513b97e&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>9<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Sid</span>&gt;</span>S-1-1-0<span class="tag">&lt;/<span class="name">Sid</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br></pre></td></tr></table></figure><p>アクセス制御ポリシーを登録する場合、<code>./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7b[PolicyRule Id]%7d/RuleData</code> のような OMA-URI を作成し、1 つの <code>PolicyRule</code> を記述した XML ファイルをアップロードします。</p><p>OMA-URI の  <code>[PolicyRule Id]</code> の箇所は、適用する <code>PolicyRule</code> の ID に置き換える必要があります。</p><p>例えば、サンプルポリシーの <code>step_4_-_allow_access_to_writeable_usbs_for_some_users&#123;a054bbcf-3454-4b95-9058-f7ed00deeee9&#125;.xml</code> を使用して OMA-URI を登録する場合には、<code>./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7Ba054bbcf-3454-4b95-9058-f7ed00deeee9%7D/RuleData</code> というパスを指定します。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-013.png" alt="アクセス制御ポリシーの OMA-URI を登録"></p><p>すべての設定が完了したら、カスタム構成プロファイルを保存し、任意のデバイスやユーザに割り当てます。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-014.png" alt="カスタム構成プロファイルの保存"></p><p>割り当てされたポリシーが端末に配信されると、デバイスコントロール機能が有効化され、端末にアクセス制御ポリシーが適用されます。</p><p>ポリシーが反映されたことを確認したい場合は PowerShell で <code>Get-MpComputerStatus | Select-Object DeviceControlState,DeviceControlDefaultEnforcement,DeviceControlPoliciesLastUpdated</code>  を実行し、<code>DeviceControlPoliciesLastUpdated</code> の時刻が更新されていることを確認します。</p><h2 id="Intune-のユーザインターフェースを使用してリムーバブルメディアアクセス制御を構成する"><a href="#Intune-のユーザインターフェースを使用してリムーバブルメディアアクセス制御を構成する" class="headerlink" title="Intune のユーザインターフェースを使用してリムーバブルメディアアクセス制御を構成する"></a>Intune のユーザインターフェースを使用してリムーバブルメディアアクセス制御を構成する</h2><p>Intune を使用する場合、カスタム構成プロファイルではなく [エンドポイントセキュリティ]&gt;[攻撃面の減少] からデバイスコントロールプロファイルを作成することでもリムーバブルメディアのアクセス制御ポリシーを構成できます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-deploy-manage-intune?view=o365-worldwide#configure-and-manage-device-control-in-intune">Intune でデバイス制御を構成および管理する | Microsoft Learn</a></p><p>例えば、以下の手順ですべてのリムーバブルメディアに対してアクセス拒否ポリシーを構成できます。</p><ol><li>まず、[エンドポイントセキュリティ]&gt;[攻撃面の減少] の [再利用可能な設定] から [リムーバブル記憶域] のインスタンスを追加し、[PrimaryId] を [RemovableMediaDevices] に設定します。</li></ol><p><img src="../images/Endpoint-MDAV-2023-12-13-018.png" alt="再利用可能な設定"></p><ol start="2"><li>次に、[エンドポイントセキュリティ]&gt;[攻撃面の減少] からデバイスコントロールプロファイルを作成し、[Device Control] のトグルを [構成されました] の状態に変更して [Included ID] に [再利用可能な設定] で作成したリムーバブルメディアグループを登録します。</li><li>続けて、以下の画面のように [+ Edit Entry] からリムーバブルメディア制御ポリシーを設定することで、デバイスに対するアクセス拒否を構成できます。</li></ol><p><img src="../images/Endpoint-MDAV-2023-12-13-015.png" alt="Intune のデバイスコントロールプロファイルを作成する"></p><p>Intune のユーザインタフェースによるリムーバブルメディアアクセス制御ポリシーの設定項目については以下の公開情報の記載を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=Removable#rules">Device control policies in Microsoft Defender for Endpoint | Microsoft Learn</a></p><h2 id="デバイスコントロールグループを-XML-ファイルで構成する"><a href="#デバイスコントロールグループを-XML-ファイルで構成する" class="headerlink" title="デバイスコントロールグループを XML ファイルで構成する"></a>デバイスコントロールグループを XML ファイルで構成する</h2><p>グループポリシーまたは Intune の OMA-URI を使用してリムーバブルメディアアクセス制御を構成する場合、まずは制御対象となるデバイスやリムーバブルメディアをデバイスコントロールグループとして定義する必要があります。</p><p>デバイスコントロールグループの定義に関する最新の情報は以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=XML#groups">Device control policies in Microsoft Defender for Endpoint | Microsoft Learn</a></p><p>グループポリシーを使用する場合、デバイスコントロールグループの XML ファイルは 、要素 <code>Groups</code> の中に 1 つ以上の <code>Group</code> を定義する構造となっています。つまり、1 つの XML ファイル内に複数の <code>Group</code> の定義を統合できます。</p><p>一方で、Intune の OMA-URI を使用する場合、要素 <code>Groups</code> は使用せず、1 つの <code>Group</code> ごとに 1 つの OMA-URI を使用します。</p><p>各 <code>Group</code> には <code>Id</code> 属性として GroupID を指定する必要があります。ここで使用可能な ID は、PowerShell で <code>New-Guid</code> コマンドレットを実行することでランダムに生成することが可能です。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-removable-storage-access-control-faq?view=o365-worldwide#how-do-i-generate-guid-for-group-idpolicyrule-identry-id">Microsoft Defender for Endpoint デバイス コントロールリムーバブル ストレージに関してよく寄せられる質問 | Microsoft Learn</a></p><h3 id="PrimaryId-によるデバイスの指定"><a href="#PrimaryId-によるデバイスの指定" class="headerlink" title="PrimaryId によるデバイスの指定"></a>PrimaryId によるデバイスの指定</h3><p>各 <code>Group</code> 要素には、グループ名や GroupID を記述できます。GroupID は後述するアクセス制御ポリシーの対象を指定するために使用します。</p><p><code>Group</code> 内では、<code>MatchType</code> と <code>DescriptorIdList</code> によりグループの対象となるデバイスのプロパティを定義します。</p><p>例えば、<code>MatchType</code> が <code>MatchAny</code> に設定されている場合は、<code>DescriptorIdList</code> 内の要素を OR リレーションシップで評価することを意味しています。</p><p>つまり、<code>DescriptorIdList</code> 要素内で定義されたいずれかの条件に合致するデバイスが存在する場合、対象のデバイスがそのグループの対象となることを意味します。</p><p><code>DescriptorIdList</code> 要素内で利用できる設定値として <code>PrimaryId</code> があります。</p><p> <code>PrimaryId</code> に <code>RemovableMediaDevices</code> を指定する場合、すべての <code>RemovableMediaDevices</code>(USB フラッシュメモリや USB 接続の外付け SSD など) を対象とする グループを定義することがきできます。</p><h3 id="InstancePathId-と-VID-PID-によるデバイスの指定"><a href="#InstancePathId-と-VID-PID-によるデバイスの指定" class="headerlink" title="InstancePathId と VID_PID によるデバイスの指定"></a>InstancePathId と VID_PID によるデバイスの指定</h3><p>グループの対象となるデバイスの条件を記述できる <code>DescriptorIdList</code> では、 <code>PrimaryId</code> 以外にも <code>InstancePathId</code> や <code>VID_PID</code> などを利用できます。</p><p><code>InstancePathId</code> は、デバイスインスタンスパスを利用して対象のデバイスを明示的に指定します。(<code>InstancePathId</code> の指定にはワイルドカードを使用することもできます。)</p><p>これは、特に USB フラッシュメモリなどの DiskDrive を指定するシナリオで使用できます。</p><p>なお、<code>InstancePathId</code> を指定する場合には、もともとのデバイスインスタンスパスに含まれる <code>&amp;</code> をエスケープ文字 <code>&amp;amp;</code> に置き換えて XML に記述する必要があります。</p><p><code>VID_PID</code> も同じく、特に USB フラッシュメモリなどの DiskDrive を指定するシナリオで使用できます。</p><p><code>VID_PID</code> による指定は、 Vendor ID と  Product ID のペアで記述されます。Product ID 部分についてはについてはワイルドカードもサポートしています。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/install/standard-usb-identifiers">標準 USB 識別子 - Windows drivers | Microsoft Learn</a></p><h3 id="その他のデバイスコントロールグループの指定方法"><a href="#その他のデバイスコントロールグループの指定方法" class="headerlink" title="その他のデバイスコントロールグループの指定方法"></a>その他のデバイスコントロールグループの指定方法</h3><p>デバイスコントロールグループに含めるためのデバイスの指定は、上記のサンプル以外にも様々な条件で記述できます。</p><p>例えば、USB フラッシュメモリや USB 接続の外付け SSD などのリムーバブルメディアの場合、<code>FriendlyNameId / PrimaryId / VID_PID / BusId / DeviceId / HardwareId / InstancePathId / SerialNumberId / PID / VID</code>  などの様々な値をデバイスの指定に使用できます。</p><p>特定のリムーバブルメディアの識別に使用できる値は、Windows デバイスマネージャや Microsoft Defender の Advanced Hunting クエリなどを使用して調査できます。</p><table><thead><tr><th align="center">XML 内で使用するプロパティ</th><th align="center">デバイスマネージャー上のプロパティ</th><th align="center">サンプル KQL の実行結果</th></tr></thead><tbody><tr><td align="center">FriendlyNameId</td><td align="center">フレンドリ名</td><td align="center">MediaName</td></tr><tr><td align="center">InstancePathId</td><td align="center">デバイスインスタンスパス</td><td align="center">DeviceId</td></tr><tr><td align="center">SerialNumberId</td><td align="center"><code>デバイスインスタンスパス</code> から確認可能</td><td align="center">Serial Number</td></tr><tr><td align="center">PID</td><td align="center"><code>親</code> から確認可能</td><td align="center">ProductId</td></tr><tr><td align="center">VID</td><td align="center"><code>親</code> から確認可能</td><td align="center">VendorId</td></tr></tbody></table><p>なお、Advanced Hunting で USB メディアの情報を調査するためには以下のような KQL クエリを使用できます。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DeviceEvents </span><br><span class="line"><span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">=</span><span class="operator">=</span> &quot;RemovableStoragePolicyTriggered&quot;</span><br></pre></td></tr></table></figure><p>より詳細な情報については以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=XML#groups">Device control policies in Microsoft Defender for Endpoint | Microsoft Learn</a></p><h2 id="リムーバブルメディアアクセス制御を-XML-ファイルで構成する"><a href="#リムーバブルメディアアクセス制御を-XML-ファイルで構成する" class="headerlink" title="リムーバブルメディアアクセス制御を XML ファイルで構成する"></a>リムーバブルメディアアクセス制御を XML ファイルで構成する</h2><p>制御対象となるデバイスやリムーバブルメディアをデバイスコントロールグループとして定義したら、各グループを対象とするアクセス制御ポリシーを作成します。</p><p>アクセス制御ポリシーの定義に関する最新の情報は以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=XML#policies">Device control policies in Microsoft Defender for Endpoint | Microsoft Learn</a></p><p>グループポリシーを使用する場合に使用するアクセス制御ポリシーの XML ファイルは、要素 <code>PolicyRules</code> の中に 1 つ以上の <code>PolicyRule</code> を定義する構造になっています。つまり、1 つの XML ファイル内に複数の <code>PolicyRule</code> の定義を統合できます。</p><p>一方で、Intune の OMA-URI を使用する場合、要素 <code>PolicyRules</code> は使用せず、1 つの <code>PolicyRule</code> ごとに 1 つの OMA-URI を使用します。</p><p>各 <code>PolicyRule</code> には <code>Id</code> 属性として PolicyRuleID を指定する必要があります。</p><p>※ ここで使用可能な ID は、デバイスコントロールグループと同じく PowerShell で <code>New-Guid</code> コマンドレットを実行することでランダムに生成することが可能です。</p><p> <code>PolicyRule</code>  要素の中には、<code>IncludedIdList</code> 、<code>ExcludedIdList</code>、<code>Entry</code> 要素などを記述します。</p><p><code>Entry</code> 要素には、具体的なアクセス制御ポリシーの定義を記述します。</p><p>一方で、<code>IncludedIdList</code> や <code>ExcludedIdList</code> には、デバイスコントロールグループの XML で定義した <code>Group</code> 要素の GroupID を含めることができます。</p><p>これによって、各 <code>PolicyRule</code>  要素では、<code>IncludedIdList</code> で指定されたグループに対して <code>Entry</code> 要素で定義したアクセス制御ポリシーが適用されるようになります。( <code>ExcludedIdList</code> で指定された GroupID のオブジェクトはアクセス制御ポリシーの対象外になります。)</p><h3 id="ディスクレベルで読み書き実行を拒否する"><a href="#ディスクレベルで読み書き実行を拒否する" class="headerlink" title="ディスクレベルで読み書き実行を拒否する"></a>ディスクレベルで読み書き実行を拒否する</h3><p>アクセス制御ポリシーでは、<code>PolicyRule</code> 要素の中に記述する <code>Entry</code> 要素にて詳細なアクセス許可や拒否を定義できます。</p><p>例えば、<code>Entry</code> 要素の <code>Type</code> が <code>Deny</code>、<code>AccessMask</code> に 7 が指定されている場合、ポリシーの対象となるグループに含まれるすべてのリムーバブルメディアに対して、DiskLevel での読み取り、書き込み、実行アクセスを拒否します。</p><p>このように、Windows マシンのリムーバブルメディアアクセス制御を行う場合、制御ポリシーは <code>Type</code>  と  <code>AccessMask</code> の組み合わせで定義されます。(<code>Options</code> 要素の設定値の意味は <code>Type</code>  要素の値によって変わります。)</p><p>まず、<code>Type</code> には、<code>Allow</code> または <code>Deny</code> および <code>AuditAllowed</code> または <code>AuditDenied</code> の 4 つのいずれかを指定できます。</p><p><code>Allow</code> が指定されている場合には、<code>AccessMask</code> 要素の指定に従ってメディアへのアクセスが「許可」されます。</p><p>一方で、<code>Deny</code> が指定されている場合には、<code>AccessMask</code> 要素の指定に従ってメディアへのアクセスが「拒否」されます。</p><p><code>AuditAllowed</code> または <code>AuditDenied</code> については、それぞれ <code>Allow</code> か <code>Deny</code> の動作に対応して通知やイベント送信を行うかどうかを指定できます。</p><p><code>AccessMask</code> 要素では、ディスクレベルもしくはファイルシステムレベルでメディアに対する Read, Write, Execute の操作をそれぞれ指定できます。</p><p>例えば、<code>AccessMask</code> が 7 で <code>Type</code> が<code>Deny</code>の場合には、ディスクレベルでの  Read, Write, Execute 操作をすべて拒否する設定が適用されます。</p><p>リムーバブルメディアアクセス制御ポリシーで使用できる <code>AccessMask</code> については以下の表を参照してください。</p><table><thead><tr><th align="center">アクセス制御</th><th align="center">AccessMask</th></tr></thead><tbody><tr><td align="center">DiskLevel の読み取りアクセス</td><td align="center">1</td></tr><tr><td align="center">DiskLevel の書き込みアクセス</td><td align="center">2</td></tr><tr><td align="center">DiskLevel の実行アクセス</td><td align="center">4</td></tr><tr><td align="center">FIleSystemLevel の読み取りアクセス</td><td align="center">8</td></tr><tr><td align="center">FIleSystemLevel の書き込みアクセス</td><td align="center">16</td></tr><tr><td align="center">FIleSystemLevel の実行アクセス</td><td align="center">32</td></tr></tbody></table><p>また、一般的に使用されるアクセス制御を構成するために使用する <code>AccessMask</code> については以下におまとめします。</p><table><thead><tr><th align="center">アクセス制御</th><th align="center">AccessMask</th></tr></thead><tbody><tr><td align="center">DiskLevel の読み、書き、実行アクセス</td><td align="center">7 (1 + 2 + 4)</td></tr><tr><td align="center">FileSystemLevel の読み、書き、実行アクセス</td><td align="center">56 (8 + 16 + 32)</td></tr><tr><td align="center">FileSystemLevel と DiskLevel の読み、書き、実行アクセス(フルアクセス)</td><td align="center">63 (7 + 56)</td></tr><tr><td align="center">DiskLevel + FileSystemLevel の読み取りアクセスのみ</td><td align="center">9 (1 + 8)</td></tr><tr><td align="center">DiskLevel + FileSystemLevel の読み取り、書き込みアクセスのみ</td><td align="center">27 (9 + 18)</td></tr></tbody></table><p>アクセス制御ポリシーに関するより詳細な情報については以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=XML#understand-mask-access-windows">Understand mask access (Windows) | Microsoft Learn</a></p><h3 id="SID-を指定して読み取りと書き込みアクセス許可を構成する"><a href="#SID-を指定して読み取りと書き込みアクセス許可を構成する" class="headerlink" title="SID を指定して読み取りと書き込みアクセス許可を構成する"></a>SID を指定して読み取りと書き込みアクセス許可を構成する</h3><p>ルールの <code>Entry</code> には、<code>Sid</code> や <code>ComputerSid</code> などの、より詳細な条件を定義可能な要素を含めることが可能です。</p><p>例えば、ルールの <code>Entry</code> に <code>Sid</code> 要素を追加し、特定のローカルユーザの SID を記述した場合には、その SID を持つユーザにのみリムーバブルメディアへのアクセスを許可を構成することが可能です。</p><p>例えば、以下のクエリを使用することで、 Microsoft Defender ポータルから Advanced Hunting にてログインユーザの SID を取得することができます。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DeviceLogonEvents</span><br><span class="line"><span class="operator">|</span> <span class="keyword">where</span> AccountSid <span class="operator">!=</span> &quot;&quot;</span><br><span class="line"><span class="operator">|</span> <span class="keyword">where</span> <span class="keyword">not</span>(AccountName startswith &quot;umfd-&quot;) <span class="keyword">and</span> <span class="keyword">not</span>(AccountName startswith &quot;dwm-&quot;)</span><br><span class="line"><span class="operator">|</span> <span class="keyword">distinct</span> AccountSid,AccountName,AccountDomain</span><br></pre></td></tr></table></figure><p>また、AD ユーザや AD グループの SID については、ドメインコントローラにて <a href="https://learn.microsoft.com/en-us/powershell/module/activedirectory/get-aduser?view=windowsserver2022-ps">Get-ADUser</a> や <a href="https://learn.microsoft.com/en-us/powershell/module/activedirectory/get-adgroup?view=windowsserver2022-ps">Get-ADGroup</a> コマンドレットを利用する方法などで調査できます。</p><p>ローカルユーザやローカルグループについては、一例として以下のコマンドで確認できます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">PS</span>&gt; (<span class="built_in">New-Object</span> System.Security.Principal.NTAccount(<span class="string">&#x27;Administrator&#x27;</span>)).Translate([<span class="type">System.Security.Principal.SecurityIdentifier</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ローカルグループ BUILTIN\Users の SID を参照できる</span></span><br><span class="line"><span class="built_in">PS</span>&gt; (<span class="built_in">New-Object</span> System.Security.Principal.NTAccount(<span class="string">&#x27;BUILTIN\Users&#x27;</span>)).Translate([<span class="type">System.Security.Principal.SecurityIdentifier</span>])</span><br></pre></td></tr></table></figure><p>汎用的な SID については <a href="https://learn.microsoft.com/ja-jp/windows/win32/secauthz/well-known-sids">既知の SID</a> の情報を参照してください。</p><p>また、その他、 <code>Entry</code> 要素で構成可能な項目の詳細は以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=XML#determine-the-security-id-of-a-user-group-or-device">Device control policies in Microsoft Defender for Endpoint | Microsoft Learn</a></p><h3 id="Advanced-Hunging-でリムーバブルメディアアクセス制御イベントを確認する"><a href="#Advanced-Hunging-でリムーバブルメディアアクセス制御イベントを確認する" class="headerlink" title="Advanced Hunging でリムーバブルメディアアクセス制御イベントを確認する"></a>Advanced Hunging でリムーバブルメディアアクセス制御イベントを確認する</h3><p>実際にこのポリシーを適用し、許可していないリムーバブルメディアデバイスへのアクセスがブロックされることを確認します。</p><p>既定の構成では、このポリシーによってリムーバブルメディアへのアクセスがブロックされた場合、Windows セキュリティアプリからポップアップ通知が行われます。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-004.png" alt="Windows セキュリティアプリのポップアップ通知"></p><p>また、Microsoft Device ポータルの [高度な追及] から、以下の Advanced Hunging クエリを発行することで、アクセス制御ポリシーによってブロックされた端末やリムーバブルメディアの詳細情報などを確認することができます。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DeviceEvents</span><br><span class="line"><span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">=</span><span class="operator">=</span> &quot;RemovableStoragePolicyTriggered&quot;</span><br><span class="line"><span class="operator">|</span> extend parsed<span class="operator">=</span>parse_json(AdditionalFields)</span><br><span class="line"><span class="operator">|</span> extend RemovableStorageAccess <span class="operator">=</span> tostring(parsed.RemovableStorageAccess)</span><br><span class="line"><span class="operator">|</span> extend RemovableStoragePolicyVerdict <span class="operator">=</span> tostring(parsed.RemovableStoragePolicyVerdict)</span><br><span class="line"><span class="operator">|</span> extend MediaBusType <span class="operator">=</span> tostring(parsed.BusType)</span><br><span class="line"><span class="operator">|</span> extend MediaClassGuid <span class="operator">=</span> tostring(parsed.ClassGuid)</span><br><span class="line"><span class="operator">|</span> extend MediaClassName <span class="operator">=</span> tostring(parsed.ClassName)</span><br><span class="line"><span class="operator">|</span> extend MediaDeviceId <span class="operator">=</span> tostring(parsed.DeviceId)</span><br><span class="line"><span class="operator">|</span> extend MediaInstanceId <span class="operator">=</span> tostring(parsed.DeviceInstanceId)</span><br><span class="line"><span class="operator">|</span> extend MediaName <span class="operator">=</span> tostring(parsed.MediaName)</span><br><span class="line"><span class="operator">|</span> extend RemovableStoragePolicy <span class="operator">=</span> tostring(parsed.RemovableStoragePolicy)</span><br><span class="line"><span class="operator">|</span> extend MediaProductId <span class="operator">=</span> tostring(parsed.ProductId)</span><br><span class="line"><span class="operator">|</span> extend MediaVendorId <span class="operator">=</span> tostring(parsed.VendorId)</span><br><span class="line"><span class="operator">|</span> extend MediaSerialNumber <span class="operator">=</span> tostring(parsed.SerialNumber)</span><br><span class="line"><span class="operator">|</span>project <span class="type">Timestamp</span>, DeviceId, DeviceName, InitiatingProcessAccountName, ActionType, RemovableStorageAccess, RemovableStoragePolicyVerdict, MediaBusType, MediaClassGuid, MediaClassName, MediaDeviceId, MediaInstanceId, MediaName, RemovableStoragePolicy, MediaProductId, MediaVendorId, MediaSerialNumber, FolderPath, FileSize</span><br><span class="line"><span class="operator">|</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">Timestamp</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure><p><img src="../images/Endpoint-MDAV-2023-12-13-005.png" alt="Advanced Hunting クエリ画面"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-walkthroughs?view=o365-worldwide">Device control walkthroughs | Microsoft Learn</a></p><h2 id="グループポリシーまたは-Intune-の-OMA-URI-を使用してアクセス制御を構成するサンプルシナリオ"><a href="#グループポリシーまたは-Intune-の-OMA-URI-を使用してアクセス制御を構成するサンプルシナリオ" class="headerlink" title="グループポリシーまたは Intune の OMA-URI を使用してアクセス制御を構成するサンプルシナリオ"></a>グループポリシーまたは Intune の OMA-URI を使用してアクセス制御を構成するサンプルシナリオ</h2><p>この項では、公開されているサンプルポリシーを使用してリムーバブルメディアアクセス制御を構成する方法を紹介します。</p><p>なお、以下で引用するサンプル XML ファイルは、グループポリシー用のサンプルファイルである点に留意してください。</p><p>デバイスコントロールグループやアクセス制御ポリシーの記述方法はグループポリシーと Intune の OMA-URI を利用する場合で共通ですが、<strong>Intune の OMA-URI を使用する場合には、1 つのデバイスコントロールグループやアクセス制御ポリシーごとに 1 つの OMA-URI を作成する必要がある</strong>点に注意してください。</p><h3 id="シナリオ-1-カスタムポリシーで既定のアクセス拒否ポリシーを構成する"><a href="#シナリオ-1-カスタムポリシーで既定のアクセス拒否ポリシーを構成する" class="headerlink" title="シナリオ 1 - カスタムポリシーで既定のアクセス拒否ポリシーを構成する"></a>シナリオ 1 - カスタムポリシーで既定のアクセス拒否ポリシーを構成する</h3><p>このサンプルポリシーのファイルは、以下の Github リポジトリからダウンロード可能です。</p><p>参考情報：<a href="/blog/Getting%20Started/deny_all_rules/">Device control policy sample: Step 1 - Deny all access</a></p><p>ここで紹介するサンプル XML にてデバイスコントロールグループとアクセス制御ポリシーを記述することで、すべての <code>RemovableMediaDevices</code> に対してシステムレベルのアクセス拒否を構成することが可能です。</p><p>以下の XML では、すべてのリムーバブルメディアデバイスを対象とするデバイスコントロールグループを定義しています。</p><p>プロパティ名 <code>MatchType</code> に <code>MatchAny</code> が指定されている場合、続く <code>DescriptorIdList</code> プロパティ内で定義された属性は OR で比較されます。</p><p>つまり、端末に接続したデバイスが <code>DescriptorIdList</code> プロパティ内で定義したいずれかの条件に合致した場合に、その端末は GroupID <code>&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;</code> を持つこのグループに含まれると判定されます。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Groups</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Device&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyGroups/%7Bd8819053-24f4-444a-a0fb-9ce5a9e97862%7D/GroupData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>All removable media devices<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PrimaryId</span>&gt;</span>RemovableMediaDevices<span class="tag">&lt;/<span class="name">PrimaryId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Groups</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上記のデバイスコントロールグループでは、<code>PrimaryId</code> が <code>RemovableMediaDevices</code> であるデバイスすべてを対象としています。</p><p>このようなデバイスには、USB フラッシュメモリや USB 接続の外付け SSD などが含まれます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-removable-storage-access-control?view=o365-worldwide#group">グループの設定 | Microsoft Learn</a></p><p>次に、以下のアクセス制御ポリシーを作成します。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;d8e6f56c-f4c1-4875-ac45-51ad75d4580e&#125;&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7Bd8e6f56c-f4c1-4875-ac45-51ad75d4580e%7D/RuleData --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>Audit Deny<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;ad059b6f-bc9d-44e4-8ab9-907d7d00fc97&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Type</span>&gt;</span>Deny<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;4cf50b77-0152-4999-8d82-6f6afdf27b0b&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Type</span>&gt;</span>AuditDenied<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Options</span>&gt;</span>3<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRules</span>&gt;</span></span><br></pre></td></tr></table></figure><p>アクセス制御ポリシーではまず、ポリシーを適用する対象のデバイスをグループ単位で指定する必要があります。</p><p>そのため、<code>IncludedIdList</code> には上記のデバイスコントロールグループの GroupID を指定しています。</p><p>今回は除外対象のグループは指定しないので <code>ExcludedIdList</code> は空のままとしています。</p><p>ポリシーを適用する対象のデバイスをグループにて指定したら、<code>Entry</code> にてアクセス制御を構成します。</p><p>サンプルポリシーではリムーバブルメディアに対してすべてのアクセスを拒否するために、<code>Type</code> が <code>Deny</code> であり、<code>AccessMask</code> が 7 の <code>Entry</code> を定義しています。</p><p>また、<code>Options</code> を 3 に設定した <code>AuditDenied</code> の <code>Entry</code> を同時に定義することで、通知の表示とイベントの送信を行うようにポリシーを定義しています。</p><p>このサンプルポリシーを使用すると、すべてのリムーバブルメディアへのアクセスがブロックされます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-walkthroughs?view=o365-worldwide#step-1-deny-all-removable-media">手順 1: リムーバブル メディアをすべて拒否する | Microsoft Learn</a></p><h3 id="シナリオ-2-特定の-USB-メモリに対してのみアクセスを許可する"><a href="#シナリオ-2-特定の-USB-メモリに対してのみアクセスを許可する" class="headerlink" title="シナリオ 2 - 特定の USB メモリに対してのみアクセスを許可する"></a>シナリオ 2 - 特定の USB メモリに対してのみアクセスを許可する</h3><p>このサンプルポリシーのファイルは、以下の Github リポジトリからダウンロード可能です。</p><p>参考情報：<a href="https://github.com/microsoft/mdatp-devicecontrol/tree/main/windows/Getting%20Started/Step%202">Step 2 - Allow authorized USBs full access</a></p><p>このシナリオでは、シナリオ 1 で作成した <code>RemovableMediaDevices</code> へのアクセス拒否ポリシーに加えて、特定の USB デバイスを使用する場合にのみアクセスを許可するポリシーを追加します。</p><p>まず、デバイスコントロールグループを定義する XML は以下の通りです。</p><p><code>All removable media devices</code> グループはシナリオ 1 で作成したものと同一ですが、新たに <code>Authorized USBs</code> というグループが追加されています。(Intune の OMA-URI を使用する場合は、グループの定義ごとに OMA-URI を追加します)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Groups</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Name</span>&gt;</span>All removable media devices<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PrimaryId</span>&gt;</span>RemovableMediaDevices<span class="tag">&lt;/<span class="name">PrimaryId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Authorized USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is an example.  Replace this with the instance path id of your device --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">InstancePathId</span>&gt;</span>USB\VID_154B<span class="symbol">&amp;amp;</span>PID_0028\6EA9150055800605<span class="tag">&lt;/<span class="name">InstancePathId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Groups</span>&gt;</span></span><br></pre></td></tr></table></figure><p>この XML では、<code>InstancePathId</code> を使用して、特定のデバイスインスタンスパスを持つ リムーバブルメディアのみを <code>Authorized USBs</code> グループの対象として指定しています。 (XML の仕様上、インスタンスパス内の <code>&amp;</code> を <code>&amp;amp;</code> にエスケープしています)</p><p>次に、以下のアクセス制御ポリシーの XML をチェックします。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;7beca8fe-313a-46f2-a090-399eb3d74318&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 2 - Deny all but authorized USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;c82cb32c-4c56-4c76-8897-b2cc99558299&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Deny<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;70582e83-ea91-4b14-8f6c-f3921dab9d7a&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>AuditDenied<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>3<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;a054bbcf-3454-4b95-9058-f7ed00deeee9&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>63<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 2 - Allow Full Access to Authorized USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span><span class="tag">&lt;/<span class="name">PolicyRules</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>Step 2 - Deny all but authorized USBs</code> というポリシーの <code>IncludedIdList</code> には、シナリオ 1 と同じく <code>All removable media devices</code> の GroupID を指定していますが、同時に <code>ExcludedIdList</code> に新に追加した <code>Authorized USBs</code> グループの GroupID を指定しています。</p><p>さらに、2 つ目のポリシーである <code>Step 2 - Allow Full Access to Authorized USBs</code> では、<code>IncludedIdList</code> に <code>Authorized USBs</code> グループの GroupID を指定し、<code>AccessMask</code> が 63 の許可ルールを構成し、すべてのアクセスを明示的に許可する設定を定義しています。(Intune の OMA-URI を使用する場合は、ルールの定義ごとに OMA-URI を追加します)</p><p>このサンプルポリシーを使用すると、<code>Authorized USBs</code> グループで指定した <code>InstancePathId</code> を持つリムーバブルメディアにのみアクセスが許可され、その他すべてのリムーバブルメディアへのアクセスがブロックされます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-walkthroughs?view=o365-worldwide#step-2-allow-access-for-authorized-usb-devices">手順 2: 承認された USB デバイスへのアクセスを許可する | Microsoft Learn</a></p><h3 id="シナリオ-3-デバイスごとに異なるアクセス許可を構成する"><a href="#シナリオ-3-デバイスごとに異なるアクセス許可を構成する" class="headerlink" title="シナリオ 3 - デバイスごとに異なるアクセス許可を構成する"></a>シナリオ 3 - デバイスごとに異なるアクセス許可を構成する</h3><p>このサンプルポリシーのファイルは、以下の Github リポジトリからダウンロード可能です。</p><p>参考情報：<a href="https://github.com/microsoft/mdatp-devicecontrol/tree/main/windows/Getting%20Started/Step%203">Step 3 - Allow different access to different devices</a></p><p>このシナリオでは、シナリオ 2 で作成したポリシーを同様の手順で、複数のリムーバブルメディアに対してそれぞれ異なるアクセスを許可する設定を行います。</p><p>まずはデバイスコントロールグループを定義するために、グループポリシー用の XML  ファイルである <code>allow_different_access_to_different_groups.xml</code> を確認します。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Groups</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Name</span>&gt;</span>All removable media devices<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PrimaryId</span>&gt;</span>RemovableMediaDevices<span class="tag">&lt;/<span class="name">PrimaryId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Writeable USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is an example.  Replace this with the instance path id of your device --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">InstancePathId</span>&gt;</span>USB\VID_154B<span class="symbol">&amp;amp;</span>PID_0028\6EA9150055800605<span class="tag">&lt;/<span class="name">InstancePathId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;23c24566-98a5-4218-8802-59614513b97e&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Readonly USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is an example.  Replace this with the VID PID of another device --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VID_PID</span>&gt;</span>090C_1000<span class="tag">&lt;/<span class="name">VID_PID</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Groups</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>All removable media devices</code> グループはこれまでのシナリオで作成したものと同じで、すべてのリムーバブルメディアを対象とするグループです。これは、カスタムポリシーによる既定のアクセス拒否を構成するために使用します。</p><p>上記のサンプル XML ファイルでは、<code>Writeable USBs</code> と <code>Readonly USBs</code> という 2 つのグループが追加で定義されます。(Intune の OMA-URI を使用する場合は、グループの定義ごとに OMA-URI を追加します)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Writeable USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is an example.  Replace this with the instance path id of your device --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">InstancePathId</span>&gt;</span>USB\VID_154B<span class="symbol">&amp;amp;</span>PID_0028\6EA9150055800605<span class="tag">&lt;/<span class="name">InstancePathId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;23c24566-98a5-4218-8802-59614513b97e&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Readonly USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is an example.  Replace this with the VID PID of another device --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VID_PID</span>&gt;</span>090C_1000<span class="tag">&lt;/<span class="name">VID_PID</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br></pre></td></tr></table></figure><p>それぞれのグループは <code>InstancePathId</code> や <code>VID_PID</code> によって特定のリムーバブルメディアを指定しています。</p><p>続いて、アクセスポリシーを制御するための <code>allow_different_access_to_different_rules.xml</code> を確認します。</p><p><code>Step 3 - Deny all other USBs</code> ルールはシナリオ 1、2 と同じく、<code>All removable media devices</code> グループに対してアクセス拒否を構成しています。</p><p>ただし、<code>ExcludedIdList</code> にて <code>Writeable USBs</code> と <code>Readonly USBs</code> の 2 つのグループを適用対象外としています。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;7beca8fe-313a-46f2-a090-399eb3d74318&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 3 - Deny all other USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;23c24566-98a5-4218-8802-59614513b97e&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;c82cb32c-4c56-4c76-8897-b2cc99558299&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Deny<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;70582e83-ea91-4b14-8f6c-f3921dab9d7a&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>AuditDenied<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>3<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;a054bbcf-3454-4b95-9058-f7ed00deeee9&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>63<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 3 - Allow Full Access to Writeable USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;b2b9cfc0-799d-457c-babc-da617d9a8b83&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;23c24566-98a5-4218-8802-59614513b97e&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>9<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 3 - Allow Read Only Access to Read Only USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRules</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>allow_different_access_to_different_rules.xml</code> の中には、<code>Step 3 - Deny all other USBs</code> ルールの他に以下の 2 つのルールが記述されています。(Intune の OMA-URI を使用する場合は、ルールの定義ごとに OMA-URI を追加します)</p><p>まず、<code>Step 3 - Allow Full Access to Writeable USBs</code> ルールはシナリオ 2 と同じく <code>AccessMask</code> が 63 の <code>Allow</code> ルールによって <code>Writeable USBs</code> に完全なアクセス許可を構成しています。</p><p>一方で、<code>Step 3 - Allow Read Only Access to Read Only USBs</code> では、 <code>Readonly USBs</code> の GroupID に対して  <code>AccessMask</code> が 9 の <code>Allow</code> ルールを構成しています。</p><p><code>AccessMask</code> が 9(1 + 8) の場合、DiskLevel と FileSystemLevel の読み取りアクセスを同時に指定していることを意味します。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;a054bbcf-3454-4b95-9058-f7ed00deeee9&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>63<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 3 - Allow Full Access to Writeable USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;b2b9cfc0-799d-457c-babc-da617d9a8b83&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;23c24566-98a5-4218-8802-59614513b97e&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>9<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 3 - Allow Read Only Access to Read Only USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br></pre></td></tr></table></figure><p>このポリシーを適用すると、 <code>Writeable USBs</code> グループにて指定したリムーバブルメディアにのみ完全なアクセス許可が構成されます。</p><p>また、<code>Readonly USBs</code> グループで指定したリムーバブルメディアには読み取りアクセスのみが許可され、それ以外のすべてのリムーバブルメディアはアクセスが拒否されます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-walkthroughs?view=o365-worldwide#step-3-allow-different-levels-of-access-for-different-types-of-devices">手順 3: さまざまな種類のデバイスに対してさまざまなレベルのアクセスを許可する | Microsoft Learn</a></p><h3 id="シナリオ-4-特定のユーザに対してアクセスを許可する"><a href="#シナリオ-4-特定のユーザに対してアクセスを許可する" class="headerlink" title="シナリオ 4 - 特定のユーザに対してアクセスを許可する"></a>シナリオ 4 - 特定のユーザに対してアクセスを許可する</h3><p>このサンプルポリシーのファイルは、以下の Github リポジトリからダウンロード可能です。</p><p>参考情報：<a href="https://github.com/microsoft/mdatp-devicecontrol/tree/main/windows/Getting%20Started/Step%204">Step 4 - Allow different access to different devices for different users</a></p><p>デバイスコントロールグループを定義するグループポリシー用の XML ファイル <code>allow_different_access_to_different_user_groups.xml</code> は、シナリオ 3 で使用したものと同一です。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Groups</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Name</span>&gt;</span>All removable media devices<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PrimaryId</span>&gt;</span>RemovableMediaDevices<span class="tag">&lt;/<span class="name">PrimaryId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Writeable USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is an example.  Replace this with the instance path id of your device --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">InstancePathId</span>&gt;</span>USB\VID_154B<span class="symbol">&amp;amp;</span>PID_0028\6EA9150055800605<span class="tag">&lt;/<span class="name">InstancePathId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Group</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;23c24566-98a5-4218-8802-59614513b97e&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Readonly USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MatchType</span>&gt;</span>MatchAny<span class="tag">&lt;/<span class="name">MatchType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is an example.  Replace this with the VID PID of another device --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VID_PID</span>&gt;</span>090C_1000<span class="tag">&lt;/<span class="name">VID_PID</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">DescriptorIdList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Groups</span>&gt;</span></span><br></pre></td></tr></table></figure><p>アクセス制御ポリシーを記述している <code>allow_different_access_to_different_users_rules.xml</code> もシナリオ 3 のものとほぼ同一ですが、書き込みや読み取りアクセスを許可するルールの <code>Entry</code> に <code>&lt;Sid&gt;S-1-1-0&lt;/Sid&gt;</code> という項目が追加で記述されています。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PolicyRules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;7beca8fe-313a-46f2-a090-399eb3d74318&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 4 - Deny all other USBs<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;d8819053-24f4-444a-a0fb-9ce5a9e97862&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;23c24566-98a5-4218-8802-59614513b97e&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ExcludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;c82cb32c-4c56-4c76-8897-b2cc99558299&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Deny<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;70582e83-ea91-4b14-8f6c-f3921dab9d7a&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>AuditDenied<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>3<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>7<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;a054bbcf-3454-4b95-9058-f7ed00deeee9&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;368a2c82-17be-4137-bffa-370bbdff9672&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>63<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Sid</span>&gt;</span>S-1-1-0<span class="tag">&lt;/<span class="name">Sid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 4 - Allow Access to Writeable USBs for some users<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PolicyRule</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;b2b9cfc0-799d-457c-babc-da617d9a8b83&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GroupId</span>&gt;</span>&#123;23c24566-98a5-4218-8802-59614513b97e&#125;<span class="tag">&lt;/<span class="name">GroupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IncludedIdList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Id</span>=<span class="string">&quot;&#123;e78857e3-9e36-473b-a07c-fe1a1f356ec9&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Allow<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Options</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Options</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AccessMask</span>&gt;</span>9<span class="tag">&lt;/<span class="name">AccessMask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Sid</span>&gt;</span>S-1-1-0<span class="tag">&lt;/<span class="name">Sid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Step 4 - Allow Read Only Access to Read Only USBs for some users<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PolicyRules</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ルールの <code>Entry</code> に <code>Sid</code> という項目が追加で記述されている場合、その  <code>Entry</code>  には追加の条件が定義されます。</p><p> <code>Sid</code> 要素にはローカルユーザやコンピュータ、または Microsoft Entra オブジェクトの SID などを含めることができます。</p><p>この設定によって、<code>Entry</code> 要素で記述されたルールを特定のユーザやユーザグループに適用するかどうかを指定できます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=XML#determine-the-security-id-of-a-user-group-or-device">Device control policies in Microsoft Defender for Endpoint | Microsoft Learn</a></p><p>上記のサンプルでは <code>S-1-1-0</code> という<a href="(https://learn.microsoft.com/ja-jp/windows/win32/secauthz/well-known-sids)">すべてのユーザを表すグループの SID</a> を指定していますが、特定のローカルユーザの SID に置き換えることで、その SID を持つユーザにのみリムーバブルメディアへのアクセスを許可を構成することが可能です。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-walkthroughs?view=o365-worldwide#step-4-allow-different-levels-of-access-to-devices-for-specific-users-or-groups">手順 4: 特定のユーザーまたはグループのデバイスへのさまざまなレベルのアクセスを許可する | Microsoft Learn</a></p><h2 id="リムーバブルメディアアクセス制御に関するよくある質問"><a href="#リムーバブルメディアアクセス制御に関するよくある質問" class="headerlink" title="リムーバブルメディアアクセス制御に関するよくある質問"></a>リムーバブルメディアアクセス制御に関するよくある質問</h2><p>デバイスコントロール機能やリムーバブルメディアアクセス制御に関するよくある質問の多くは、以下の公開情報におまとめしております。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-faq?view=o365-worldwide">Microsoft Defender for Endpoint Device Control frequently asked questions | Microsoft Learn</a></p><h3 id="特定のメディアを指定するために使用するデバイスインスタンスパスなどの確認方法がわかりません"><a href="#特定のメディアを指定するために使用するデバイスインスタンスパスなどの確認方法がわかりません" class="headerlink" title="特定のメディアを指定するために使用するデバイスインスタンスパスなどの確認方法がわかりません"></a>特定のメディアを指定するために使用するデバイスインスタンスパスなどの確認方法がわかりません</h3><p>特定のメディアを明示的に指定するために使用するデバイスインスタンスパスなどの情報の多くは、Windows のデバイスマネージャーから対象デバイスのプロパティを確認することで特定できます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-faq?view=o365-worldwide#how-do-i-find-the-media-property-in-the-device-manager">How do I find the media property in the Device Manager? |Microsoft Learn</a></p><p>例えば、USB フラッシュメモリのデバイスインスタンスパスは、デバイスマネージャーの以下のプロパティから参照できます。</p><p><img src="../images/Endpoint-MDAV-2023-12-13-020.png" alt="デバイスマネージャーでデバイスインスタンスパスを参照する"></p><p>また、Microsoft Defender ポータルの Advanced Hunging で以下のようなクエリを発行することも有効です。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DeviceEvents</span><br><span class="line"><span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">=</span><span class="operator">=</span> &quot;PnpDeviceConnected&quot;</span><br><span class="line"><span class="operator">|</span> extend parsed<span class="operator">=</span>parse_json(AdditionalFields)</span><br><span class="line"><span class="operator">|</span> extend MediaClass <span class="operator">=</span> tostring(parsed.ClassName)</span><br><span class="line"><span class="operator">|</span> extend MediaDeviceId <span class="operator">=</span> tostring(parsed.DeviceId)</span><br><span class="line"><span class="operator">|</span> extend MediaDescription <span class="operator">=</span> tostring(parsed.DeviceDescription)</span><br><span class="line"><span class="operator">|</span> extend MediaSerialNumber <span class="operator">=</span> tostring(parsed.SerialNumber)</span><br><span class="line"><span class="operator">|</span> project <span class="type">Timestamp</span>, DeviceId, DeviceName, AccountName, AccountDomain, MediaClass, MediaDeviceId, MediaDescription, MediaSerialNumber, parsed</span><br><span class="line"><span class="operator">|</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">Timestamp</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-walkthroughs?view=o365-worldwide">デバイス コントロールのチュートリアル | Microsoft Learn</a></p><p>上記のサンプルクエリを実行すると、デバイスに接続されたリムーバブルメディアのクラス名や DeviceId などの情報を取得できるため、アクセス制御ポリシーの設定に役立てることができます。</p><p>他にも、<a href="#%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA-1-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%A7%E6%97%A2%E5%AE%9A%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%8B%92%E5%90%A6%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">シナリオ 1 - カスタムポリシーで既定のアクセス拒否ポリシーを構成する</a> を参考に、<code>PrimaryId</code> に <code>RemovableMediaDevices</code> や <code>WpdDevices</code>、または <code>CdRomDevices</code> などを設定した広範なアクセス拒否ポリシーを一度端末に適用して制御したいメディアへのアクセスをブロックし、そのイベントを確認する方法も有効です。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-overview?view=o365-worldwide&tabs=Removable#supported-devices">サポート対象のデバイス | Microsoft Learn</a></p><p>このクエリを使用してアクセス拒否ポリシーによりメディアへのアクセスがブロックされた際の <code>RemovableStoragePolicyTriggered</code> イベントを参照すると、デバイスインスタンスパスや Vendor/Product ID など、アクセス制御ポリシーで明示的にデバイスを指定する際に使用できる様々な情報を参照できます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-walkthroughs?view=o365-worldwide#step-1-deny-all-removable-media">手順 1: リムーバブル メディアをすべて拒否する | Microsoft Learn</a></p><h3 id="既定の処理を拒否に設定すると読み取り許可のアクセス制御ポリシーが動作しなくなるのはなぜですか？"><a href="#既定の処理を拒否に設定すると読み取り許可のアクセス制御ポリシーが動作しなくなるのはなぜですか？" class="headerlink" title="既定の処理を拒否に設定すると読み取り許可のアクセス制御ポリシーが動作しなくなるのはなぜですか？"></a>既定の処理を拒否に設定すると読み取り許可のアクセス制御ポリシーが動作しなくなるのはなぜですか？</h3><p>デバイスコントロール機能が有効な環境で既定の処理が [拒否] に設定されている場合、明示的にポリシーで許可されていない限り、すべてのリムーバブルメディアやプリンターへのアクセスは拒否されます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=Removable#controlling-default-behavior">Device control policies in Microsoft Defender for Endpoint | Microsoft Learn</a></p><p>この時、ディスクレベルまたはファイルシステムレベルのみを指定してアクセス許可ポリシーを作成する場合、対象メディアへの読み取り、書き込み、または実行が拒否される問題が発生する場合があります。</p><p>そのため、既定の処理を [拒否] にしている環境で明示的にリムーバブルメディアへのアクセス許可を構成する場合には、ディスクレベルとファイルシステムレベルの両方のアクセス許可を明示的に指定する必要がある点に注意してください。</p><p>例えば、読み取りアクセスのみを許可したい場合は、<code>1+8</code> で 9 を AccessMask として指定します。</p><p>また、すべてのアクセスを許可したい場合には、63 を AccessMask として設定します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-policies?view=o365-worldwide&tabs=XML#understand-mask-access-windows">Understand mask access (Windows) | Microsoft Learn</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>この記事では、Windows マシンでデバイスコントロール機能のアクセス制御ポリシーを構成する方法についておまとめいたしました。</p><p>デバイスコントロール機能に関する最新の情報については公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-control-overview?view=o365-worldwide&tabs=Removable#prerequisites">Microsoft Defender for Endpointのデバイス制御 | Microsoft Learn</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Security &amp;amp; Compliance サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では、Microsoft Defender for Endpoint(MDE) を使用する Windows マシンでデバイスコントロール機能を使用してリムーバブルメデ</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>Windows Server 2012 R2 または Windows Server 2016 を MDE にオンボードする手順と確認ポイント</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2023-09-26/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2023-09-26/</id>
    <published>2023-11-07T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では、Windows Server 2012 R2 と Windows Server 2016 を Microsoft Defender for Endpoint(MDE) にオンボード / オフボードする方法についておまとめいたします。</p><p>なお、本記事の内容は、2023 年 11 月 5 日時点で最新の情報を元に作成いたしております。</p><p>Windows Server のオンボードに関する最新情報については、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide">Microsoft Learn</a> をご参照ください。</p><p>また、サーバを MDE にオンボードした後の正常性確認方法については以下の Blog 記事にておまとめしておりますので、併せてご参照ください。</p><p>参考：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-01/">Microsoft Defender for Endpoint(MDE) にオンボードされたデバイスの正常性確認ポイント | Japan CSS Security Support Blog</a></p><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#Windows-Server-%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E5%89%8D%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">Windows Server を MDE にオンボードする前の確認ポイント</a><ul><li><a href="#%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E7%AB%AF%E6%9C%AB%E3%81%AE-OS-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">オンボード端末の OS バージョンを確認する</a></li><li><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B">サーバをオンボードする方法を決定する</a></li><li><a href="#%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A5%E7%B6%9A%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">端末のネットワーク接続を確認する</a></li><li><a href="#%E3%82%B5%E3%83%BC%E3%83%89%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E8%A3%BD%E3%81%AE%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96%E8%A3%BD%E5%93%81%E3%81%AE%E6%9C%89%E7%84%A1%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">サードパーティ製のウイルス対策製品の有無を確認する</a></li><li><a href="#MMA-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E6%97%A7%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E6%96%B9%E6%B3%95%E3%81%A7-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E6%B8%88%E3%81%BF%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">MMA を使用した旧オンボード方法で MDE にオンボード済みかどうか確認する</a></li></ul></li><li><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B">サーバを MDE にオンボードするためのスクリプトを配置する</a><ul><li><a href="#MDE-%E3%81%B8%E3%81%AE%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B">MDE へのオンボードに必要なファイルを用意する</a></li><li><a href="#%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B">オンボードに必要なファイルを配置する</a></li></ul></li><li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B">インストールスクリプトを使用してサーバを MDE にオンボードする</a><ul><li><a href="#MMA-%E3%81%AB%E3%82%88%E3%82%8A%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E5%A0%B4%E5%90%88">MMA によりサーバを MDE にオンボードしている場合</a></li><li><a href="#%E3%82%B5%E3%83%BC%E3%83%89%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E8%A3%BD%E3%81%AE%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96%E8%A3%BD%E5%93%81%E3%81%8C%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E5%A0%B4%E5%90%88">サードパーティ製のウイルス対策製品がインストールされている場合</a></li><li><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">サーバを MDE にオンボードするコマンド</a></li><li><a href="#MMA-%E3%81%8B%E3%82%89%E3%81%AE%E7%A7%BB%E8%A1%8C%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%82%92%E8%A1%8C%E3%81%86%E5%A0%B4%E5%90%88%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">MMA からの移行オンボードを行う場合のコマンド</a></li><li><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%81%8C-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%95%E3%82%8C%E3%81%9F%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">サーバが MDE にオンボードされたことを確認する</a></li><li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E7%B5%B1%E5%90%88%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E3%82%A2%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E3%82%AA%E3%83%95%E3%83%9C%E3%83%BC%E3%83%89%E6%93%8D%E4%BD%9C%E3%82%92%E8%A1%8C%E3%81%86">インストールスクリプトを使用して統合エージェントのアンインストールとオフボード操作を行う</a></li></ul></li><li><a href="#MDE-%E3%81%AE%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%AB%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">MDE のオンボードに失敗する場合のトラブルシューティング</a><ul><li><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A7%E9%80%9A%E4%BF%A1%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E8%A1%8C%E3%81%86">サーバで通信テストを行う</a></li><li><a href="#%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%81%8B%E3%82%89%E9%80%9A%E4%BF%A1%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">レポートから通信テストの結果を確認する</a></li><li><a href="#%E9%80%9A%E4%BF%A1%E3%81%AB%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">通信にプロキシサーバを利用する場合の確認ポイント</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="Windows-Server-を-MDE-にオンボードする前の確認ポイント"><a href="#Windows-Server-を-MDE-にオンボードする前の確認ポイント" class="headerlink" title="Windows Server を MDE にオンボードする前の確認ポイント"></a>Windows Server を MDE にオンボードする前の確認ポイント</h2><h3 id="オンボード端末の-OS-バージョンを確認する"><a href="#オンボード端末の-OS-バージョンを確認する" class="headerlink" title="オンボード端末の OS バージョンを確認する"></a>オンボード端末の OS バージョンを確認する</h3><p>Windows Server を MDE にオンボードする前に、サーバの OS バージョンを確認します。</p><p>下記リンク先の公開情報に記載の通り、Windows Server 2016 以前と Windows Server 2019 以降のバージョンでは、MDE へのオンボード方法が異なる点にご留意ください。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-003.png" alt="サーバのオンボード"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide">Windows サーバーを Microsoft Defender for Endpoint にオンボードします | Microsoft Learn</a></p><p>なお、この記事では、Windows Server 2012 R2 および Windows Server  2016 を MDE にオンボードする方法について記載します。</p><p>Windows Server 2019 以降のサーバを MDE にオンボードする場合は、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/onboard-windows-client?view=o365-worldwide">Windows クライアント を MDE にオンボードする</a> に記載の手順に従います。</p><blockquote><p>注意： </p><p>Windows Server 2012 R2 は 2023年 10 月 10 日に延長サポートが終了いたしております。</p><p>サポートが終了した OS を MDE にオンボードして利用いただくことは非推奨ですので、MDE をご利用いただく場合は、サポート中の OS バージョンへの更新を実施ください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/lifecycle/products/windows-server-2012-r2">Windows Server 2012 R2 - Microsoft Lifecycle | Microsoft Learn</a></p></blockquote><h3 id="サーバをオンボードする方法を決定する"><a href="#サーバをオンボードする方法を決定する" class="headerlink" title="サーバをオンボードする方法を決定する"></a>サーバをオンボードする方法を決定する</h3><p>MDE にオンボードするサーバのバージョンが Windows Server 2012 R2 または Windows Server 2016 であることを確認したら、次はサーバを MDE にオンボードする方法を決定します。</p><p>サーバを MDE にオンボードする場合のステップを以下の通り簡単にまとめます。</p><ol><li><p><strong>MDE にオンボードするサーバが、システムや通信などの<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/minimum-requirements?view=o365-worldwide">最小要件</a>を満たすことを確認します。また、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide#windows-server-2012-r2-and-windows-server-2016">Windows Server 2012 R2 および 2016 をオンボードする場合の要件</a> についても確認を行います。</strong></p></li><li><p><strong>Microsoft 365 Defender ポータルからダウンロード可能なインストールパッケージ(md4ws.msi) を使用して、サーバに統合エージェントをインストールします。</strong></p></li><li><p><strong>統合エージェントパッケージをインストールしたら、展開方法に合わせてダウンロードしたオンボードスクリプトをサーバで実行することで、オンボード操作が完了します。グループポリシー用のスクリプトを使用する場合は、グループポリシーや <a href="https://github.com/microsoft/mdefordownlevelserver/blob/main/Install.ps1">Install.ps1</a> を用いて実行する必要があります。</strong></p></li></ol><p>なお、上記の手順は、Microsoft Defender for Cloud(MDfC) の <a href="https://learn.microsoft.com/ja-jp/azure/defender-for-cloud/integration-defender-for-endpoint?tabs=windows#enable-the-integration">MDE 統合機能</a>を利用しないサーバを MDE にオンボードする場合の手順です。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/defender-for-cloud/integration-defender-for-endpoint?tabs=windows#enable-the-integration">MDE 統合機能</a>を利用する場合は、ユーザによるパッケージのダウンロードやサーバへの展開作業は不要です。</p><h3 id="端末のネットワーク接続を確認する"><a href="#端末のネットワーク接続を確認する" class="headerlink" title="端末のネットワーク接続を確認する"></a>端末のネットワーク接続を確認する</h3><p>サーバを MDE にオンボードする前に、端末のネットワーク接続を確認する必要があります。</p><p>※ MDE にオンボードされたサーバが上記の通信先との接続に失敗する場合、サーバの情報が Microsoft 365 Defender ポータルに登録されず、EDR などの保護機能の利用に問題が発生する可能性があります。</p><p>MDE を使用してサーバを保護するためには、下記の公開情報の [スプレッドシートをダウンロードします] からダウンロード可能なスプレッドシート内の [Microsoft Defender URLs] シートに一覧されている宛先との通信が可能である必要があります。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-environment?view=o365-worldwide#enable-access-to-microsoft-defender-for-endpoint-service-urls-in-the-proxy-server">商用のお客様向けのMicrosoft Defender for Endpoint URL リスト (標準)</a></p><blockquote><p>注意：</p><p>MDE の稼働に必要な暗号化通信の復号はサポートされておりません。</p><p>そのため、ユーザの環境で TLS(SSL) インスペクションのような HTTPS 通信を復号するシステムを利用する場合は、必ず MDE の通信要件にリストされている通信先を、復号の対象から除外する必要があります。</p></blockquote><p>※ 本記事執筆時点でパブリック プレビュー中の合理化(Streamlined)された接続を使用してオンボードを行う場合には、<code>統合 URL リストのMicrosoft Defender for Endpoint (NEW - 合理化)</code> からダウンロード可能なスプレッドシートを参照します。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-007.png" alt="通信要件が記載されたスプレッドシート"></p><p>なお、もし MDE にオンボードするサーバがインターネットに直接接続できない環境に配置されている場合には、以下の公開情報にてご案内している手順でプロキシサーバを構成いただく必要があります。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#enable-access-to-microsoft-defender-for-endpoint-service-urls-in-the-proxy-server">情報保護のためにデバイス プロキシとインターネット接続の設定を構成する | Microsoft Learn</a></p><p>上記の公開情報にてご案内している通り、 MDE の通信要件を満たすためには、以下のいずれかのプロキシ設定を使用できます。</p><ol><li><p><strong>WinHTTP プロキシ設定</strong></p></li><li><p><strong>EDR センサー用のレジストリベースの静的プロキシ設定</strong></p></li></ol><p>※ WinHTTP プロキシ設定は Windows インターネットブラウザプロキシ(WinINet) とは異なります。</p><p>また、Microsoft  Defender ウイルス対策(MDAV) のクラウド保護やセキュリティインテリジェンスの更新に使用するために、下記公開情報にてご案内している Microsoft Defender ウイルス対策用の静的プロキシ設定も実施いただくことを推奨します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#configure-a-static-proxy-for-microsoft-defender-antivirus">Microsoft Defender ウイルス対策の静的プロキシを構成する | Microsoft Learn</a></p><blockquote><p>情報：</p><p>2023 年 10 月 26 日時点でパプリックプレビューとして提供されている「合理的な接続」を使用してデバイスをオンボードする場合の通信要件については下記の公開情報の記載を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-device-connectivity?view=o365-worldwide&branch=connect-devices">Onboarding devices using streamlined connectivity for Microsoft Defender for Endpoint | Microsoft Learn</a></p></blockquote><h3 id="サードパーティ製のウイルス対策製品の有無を確認する"><a href="#サードパーティ製のウイルス対策製品の有無を確認する" class="headerlink" title="サードパーティ製のウイルス対策製品の有無を確認する"></a>サードパーティ製のウイルス対策製品の有無を確認する</h3><p>MDE にオンボードするサーバが、サードパーティ製のウイルス対策製品を利用しているか、もしくは利用する予定があるか確認します。</p><p>MDE による EDR(Endpoint Detection and Response)保護機能は、EPP(エンドポイント保護)機能を持つサードパーティ製のウイルス対策製品と併用して利用いただくことが可能です。</p><p>しかし、サーバで MDE と他のウイルス対策製品を併用する場合には、サーバで Microsoft Defender ウイルス対策(MDAV)をパッシブモードに変更する必要があります。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-compatibility?view=o365-worldwide">Microsoft Defender ウイルス対策の他のセキュリティ製品との互換性 | Microsoft Learn</a></p><h3 id="MMA-を使用した旧オンボード方法で-MDE-にオンボード済みかどうか確認する"><a href="#MMA-を使用した旧オンボード方法で-MDE-にオンボード済みかどうか確認する" class="headerlink" title="MMA を使用した旧オンボード方法で MDE にオンボード済みかどうか確認する"></a>MMA を使用した旧オンボード方法で MDE にオンボード済みかどうか確認する</h3><p>Windows Server 2012 R2 および 2016 にてすでに MDE をご利用中の場合には、対象のサーバが Microsoft Monitoring Agent(MMA) を使用する旧オンボード方法によって MDE にオンボードされているかどうかを確認します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide">Windows サーバーを Microsoft Defender for Endpoint にオンボードします | Microsoft Learn</a></p><h2 id="サーバを-MDE-にオンボードするためのスクリプトを配置する"><a href="#サーバを-MDE-にオンボードするためのスクリプトを配置する" class="headerlink" title="サーバを MDE にオンボードするためのスクリプトを配置する"></a>サーバを MDE にオンボードするためのスクリプトを配置する</h2><p>本記事では、統合エージェントのインストールとオンボードスクリプトの実行を行うために弊社が提供しているツールである  <a href="https://github.com/microsoft/mdefordownlevelserver/blob/main/Install.ps1">Install.ps1</a> を使用してサーバを MDE にオンボードする方法について紹介します。</p><p><a href="https://github.com/microsoft/mdefordownlevelserver/blob/main/Install.ps1">Install.ps1</a> を使用すると、各端末を手動で MDE にオンボードすることや、Active Directory 管理下のサーバを MDE にオンボードすることなどが可能になります。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide#apply-the-microsoft-defender-for-endpoint-installation-and-onboarding-packages-using-group-policy">グループ ポリシーを使用して Microsoft Defender for Endpoint のインストールパッケージとオンボード パッケージを適用する</a></p><h3 id="MDE-へのオンボードに必要なファイルを用意する"><a href="#MDE-へのオンボードに必要なファイルを用意する" class="headerlink" title="MDE へのオンボードに必要なファイルを用意する"></a>MDE へのオンボードに必要なファイルを用意する</h3><p><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B">サーバをオンボードする方法を決定する</a>  にて Windows Server 2012 R2 または 2016 を MDE にオンボードする方法を決定したら、オンボード操作に必要な以下のファイルを Microsoft 365 Defender ポータルから取得します。</p><p>※ <a href="https://learn.microsoft.com/ja-jp/azure/defender-for-cloud/integration-defender-for-endpoint?tabs=windows#enable-the-integration">MDE 統合機能</a>を利用して MDE へのオンボードを行う場合は、パッケージのダウンロードやサーバへの展開作業は不要です。</p><ul><li><p><strong>インストールパッケージ(md4ws.msi)</strong></p></li><li><p><strong>オンボードスクリプト</strong></p></li><li><p><strong>Install.ps1</strong></p></li></ul><p>MDE へのオンボードに必要なインストールパッケージとオンボードスクリプトは、Microsoft 365 Defender ポータルの [設定]&gt;[エンドポイント]&gt;[オンボーディング] からダウンロードすることが可能です。</p><p>Windows Server 2012 R2 または 2016 用のパッケージを取得する場合は、オペレーティングシステムを「Windows Server 2012 R2 または 2016」に変更します。</p><p>また、[展開方法] は使用するオンボード方法に合わせて選択します。</p><p>Install.ps1 を使用して MDE へのオンボードを行う場合は [展開方法] の設定を「グループポリシー」に変更します。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-001.png" alt="インストール/オンボード パッケージのダウンロード"></p><p>また、Install.ps1 は <a href="https://github.com/microsoft/mdefordownlevelserver/archive/refs/heads/main.zip">ダウンロードリンク</a> からダウンロードできます。</p><p>上記のリンク先からダウンロードした mdefordownlevelserver-main.zip を展開すると、Microsoft によって署名された Install.ps1 ファイルを取得することができます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/server-migration?view=o365-worldwide#installer-script">インストーラースクリプト</a></p><h3 id="オンボードに必要なファイルを配置する"><a href="#オンボードに必要なファイルを配置する" class="headerlink" title="オンボードに必要なファイルを配置する"></a>オンボードに必要なファイルを配置する</h3><p>続いて、取得したインストールパッケージ(md4ws.msi)、オンボードスクリプト(WindowsDefenderATPOnboardingScript.cmd)、Install.ps1 の 3 つのファイルを MDE にオンボードするサーバからアクセス可能なフォルダに配置します。</p><p>特定のサーバのみを MDE にオンボードする場合、これらのファイルはそのサーバのローカルフォルダに配置することができます。</p><p>また、Active Directory を使用して複数のサーバを一斉に MDE にオンボードする場合は、MDE にオンボードするサーバからアクセス可能な共有フォルダにこれらのファイルを配置する必要があります。(共有フォルダを利用する場合は、対象の共有フォルダに対して書き込みアクセスが許可されている必要があります。)</p><p>本記事では、<code>\\FileShareServer\MDEOnboard</code> という UNC パスでアクセス可能な共有フォルダ内に、md4ws.msi、WindowsDefenderATPOnboardingScript.cmd、Install.ps1 の 3 つのファイルを配置した環境で動作確認を実施します。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-006.png" alt="オンボードに必要なファイルの配置"></p><p>なお、Install.ps1 を使用してオンボードを行う場合には、md4ws.msi のファイル名は変更せず、Install.ps1 と同じフォルダに配置する必要がある点に注意が必要です。</p><p>※ オンボーディングスクリプト(WindowsDefenderATPOnboardingScript.cmd) は必ずしも同じフォルダに配置いただく必要はありません。</p><h2 id="インストールスクリプトを使用してサーバを-MDE-にオンボードする"><a href="#インストールスクリプトを使用してサーバを-MDE-にオンボードする" class="headerlink" title="インストールスクリプトを使用してサーバを MDE にオンボードする"></a>インストールスクリプトを使用してサーバを MDE にオンボードする</h2><p>Install.ps1 を使用し、以下の手順で Windows Server 2012 R2 または 2016 を MDE にオンボードします。</p><p>事前に必ず、<a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B">サーバをオンボードする方法を決定する</a> の項を参照し、MDE にオンボードするサーバが Windows Server 2012 R2 または 2016 であることを確認します。</p><p>Windows Server 2019 以降のバージョンを使用する場合は、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/onboard-windows-client?view=o365-worldwide">Windows クライアント を MDE にオンボードする</a> に記載の手順に従います。</p><p><strong>この時、MDE にオンボードするサーバが要件を満たすことを必ず確認してください。</strong></p><p><strong>サーバに必要な更新プログラムが適用されていない場合、統合エージェントのインストールやオンボード操作に失敗する場合があります。</strong></p><p><strong>また、サーバが MDE の通信要件を満たしていない場合には、端末の情報が正常にサービスに連携されずにポータルに端末が登録されない問題や、検知アラートを出力できない問題が発生する可能性があります。</strong></p><p>MDE の通信要件については <a href="#%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A5%E7%B6%9A%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">端末のネットワーク接続を確認する</a> の記載を参照してください。</p><p>サーバを MDE にオンボードした後で通信の問題が発生した場合のトラブルシューティングを行う際には、<a href="#MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%97%E3%81%9F%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E9%80%9A%E4%BF%A1%E3%83%86%E3%82%B9%E3%83%88%E6%96%B9%E6%B3%95">MDE にオンボードしたサーバの通信テスト方法</a> の記載を参照してください。</p><h3 id="MMA-によりサーバを-MDE-にオンボードしている場合"><a href="#MMA-によりサーバを-MDE-にオンボードしている場合" class="headerlink" title="MMA によりサーバを MDE にオンボードしている場合"></a>MMA によりサーバを MDE にオンボードしている場合</h3><p>MDE にオンボードするサーバが、すでに MMA によって MDE にオンボードされているか確認します。</p><p>サーバに MMA がインストールされている場合、<code>C:\Program Files\Microsoft Monitoring Agent\Agent\AgentControlPanel.exe</code> を起動することで MMA に登録されているワークスペース ID などの情報を確認できます。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-004.png" alt="MMA に登録したワークスペース ID の確認"></p><p>なお、ご利用テナントの MDE にサーバをオンボードするために登録するワークスペース ID は、Microsoft 365 Defender ポータルの [設定]&gt;[エンドポイント]&gt;[オンボーディング] 画面でオペレーティングシステムを [Windows Server 2008 R2 SP1] に変更することで確認いただくことが可能です。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-005.png" alt="ご利用テナントのワークスペース ID の確認"></p><p>サーバがすでに MMA によってオンボードされている場合には、事前に MMA をアンインストールするか、MMA に登録されている MDE のオンボードに使用しているワークスペース ID を削除してください。</p><p>また、サーバの台数が多い場合には、[MMA からの移行オンボードを行う場合](#MMA からの移行オンボードを行う場合) に記載の手順で、Install.ps1 を使用して MMA からワークスペース ID の情報を削除し、MDE へのオンボードを行うことも可能です。</p><h3 id="サードパーティ製のウイルス対策製品がインストールされている場合"><a href="#サードパーティ製のウイルス対策製品がインストールされている場合" class="headerlink" title="サードパーティ製のウイルス対策製品がインストールされている場合"></a>サードパーティ製のウイルス対策製品がインストールされている場合</h3><p><a href="#%E3%82%B5%E3%83%BC%E3%83%89%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E8%A3%BD%E3%81%AE%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96%E8%A3%BD%E5%93%81%E3%81%AE%E6%9C%89%E7%84%A1%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">サードパーティ製のウイルス対策製品の有無を確認する</a> の項を参照し、MDE にオンボードするサーバでサードパーティ製のウイルス対策製品を使用している、もしくは使用する予定があるか確認します。</p><p>サードパーティ製のウイルス対策製品を MDE と併用する場合は、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-compatibility?view=o365-worldwide#windows-server-and-passive-mode">Windows Server とパッシブ モード</a> に記載の手順で必ずパッシブモードを有効化する必要があります。</p><p>また、すでにサードパーティ製のウイルス対策製品が稼働しているサーバを MDE にオンボードする場合は、一度サードパーティ製のウイルス対策製品をアンインストールいただき、統合エージェントのインストールと MDE へのオンボード操作を実施後にウイルス対策製品を再インストールいただくことをおすすめします。</p><p>もしサードパーティ製のウイルス対策製品アンインストールせずに統合エージェントのインストールと MDE へのオンボード操作を実施する場合は、オンボード作業の前に必ず <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-compatibility?view=o365-worldwide#windows-server-and-passive-mode">MDAV のパッシブモード設定</a> を有効化してください。</p><p>また、<a href="#%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A5%E7%B6%9A%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">端末のネットワーク接続を確認する</a> ので紹介したスプレッドシートの [Microsoft Defender Processes] シートに記載のプロセスをサードパーティ製のウイルス対策製品のスキャン除外リストに登録いただくとともに、サードパーティ製のウイルス対策製品を <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-exclusions-microsoft-defender-antivirus?view=o365-worldwide">MDAV の除外リスト</a> に登録いただくことをおすすめします。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide#prerequisites-for-running-with-third-party-security-solutions">Windows サーバーを Microsoft Defender for Endpoint にオンボードします | Microsoft Learn</a></p><p><img src="../images/Endpoint-MDAV-2023-09-26-008.png" alt="MDE の関連プロセス"></p><blockquote><p> 注意：</p><p> Windows Server 2016 以降のサーバですでにサードパーティ製のウイルス対策製品を使用している場合、グループポリシーやレジストリ設定にて Microsoft Defender ウイルス対策(MDAV) が無効化されている場合があります。</p><p> サーバ OS の場合はサードパーティ製のウイルス対策製品をアンインストールしても MDAV の無効化設定は解除されないため、MDE をご利用いただく前に必ず設定を解除してください。</p></blockquote><h3 id="サーバを-MDE-にオンボードするコマンド"><a href="#サーバを-MDE-にオンボードするコマンド" class="headerlink" title="サーバを MDE にオンボードするコマンド"></a>サーバを MDE にオンボードするコマンド</h3><p>Install.ps1 を使用してサーバを手動で MDE にオンボードする場合、管理者権限で起動した PowerShell から以下のコマンドを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell.exe <span class="literal">-ExecutionPolicy</span> RemoteSigned \\FileShareServer\MDEOnboard\Install.ps1 <span class="literal">-OnboardingScript</span> \\FileShareServer\MDEOnboard\WindowsDefenderATPOnboardingScript.cmd</span><br></pre></td></tr></table></figure><p>※ 必要なファイルの配置については <a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B">サーバを MDE にオンボードするためのスクリプトを配置する</a> の項を参照します。</p><p>※ 本記事では <code>\\FileShareServer\MDEOnboard</code> という UNC パスでアクセス可能な共有フォルダ内に、md4ws.msi、WindowsDefenderATPOnboardingScript.cmd、Install.ps1 の 3 つのファイルを配置した環境で動作確認を実施しています。</p><p>※ <code>\\FileShareServer\MDEOnboard</code> には任意の UNC パスもしくはローカルのフォルダパスを指定することが可能です。</p><p>グループポリシーを使用して Install.ps1 による MDE へのオンボード操作を行う場合は以下の公開情報の手順を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide#apply-the-microsoft-defender-for-endpoint-installation-and-onboarding-packages-using-group-policy">グループ ポリシーを使用して Microsoft Defender for Endpoint のインストールパッケージとオンボード パッケージを適用する</a></p><h3 id="MMA-からの移行オンボードを行う場合のコマンド"><a href="#MMA-からの移行オンボードを行う場合のコマンド" class="headerlink" title="MMA からの移行オンボードを行う場合のコマンド"></a>MMA からの移行オンボードを行う場合のコマンド</h3><p>すでに MMA を使用して MDE にオンボードしているサーバを、新しい統合エージェントを使用して MDE にオンボードする場合、管理者権限で起動した PowerShell から以下のコマンドを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell.exe <span class="literal">-ExecutionPolicy</span> RemoteSigned \\FileShareServer\MDEOnboard\Install.ps1 <span class="literal">-RemoveMMA</span> &lt;MMA に登録されているワークスペース ID&gt; <span class="literal">-OnboardingScript</span> \\FileShareServer\MDEOnboard\WindowsDefenderATPOnboardingScript.cmd</span><br></pre></td></tr></table></figure><p>※ <code>\\FileShareServer\MDEOnboard</code> には任意の UNC パスもしくはローカルのフォルダパスを指定することが可能です。</p><p>なお、事前に MMA をアンインストール済みの場合や、MMA から MDE のオンボードのために登録しているワークスペース ID を削除している場合は、上記のコマンドではなく <a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">サーバを MDE にオンボードするコマンド</a> に記載のコマンドを使用します。</p><p>また、グループポリシーを使用して Install.ps1 を使用した MMA からの移行操作を行う場合も、以下の公開情報同じ手順をご利用いただくことができます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide#apply-the-microsoft-defender-for-endpoint-installation-and-onboarding-packages-using-group-policy">グループ ポリシーを使用して Microsoft Defender for Endpoint のインストールパッケージとオンボード パッケージを適用する</a></p><h3 id="サーバが-MDE-にオンボードされたことを確認する"><a href="#サーバが-MDE-にオンボードされたことを確認する" class="headerlink" title="サーバが MDE にオンボードされたことを確認する"></a>サーバが MDE にオンボードされたことを確認する</h3><p>サーバが MDE に正常にオンボードされたことを確認したい場合には、以下の公開情報の手順をご利用いただけます。</p><p>参考情報：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-01/">Microsoft Defender for Endpoint(MDE) にオンボードされたデバイスの正常性確認ポイント | Japan CSS Security Support Blog</a></p><h3 id="インストールスクリプトを使用して統合エージェントのアンインストールとオフボード操作を行う"><a href="#インストールスクリプトを使用して統合エージェントのアンインストールとオフボード操作を行う" class="headerlink" title="インストールスクリプトを使用して統合エージェントのアンインストールとオフボード操作を行う"></a>インストールスクリプトを使用して統合エージェントのアンインストールとオフボード操作を行う</h3><p>テナントの移行やトラブルシューティングの目的でサーバを MDE からオフボードし、統合エージェントのアンインストールを行う場合にも Install.ps1 を使用することができます。</p><p>Install.ps1 を使用して統合エージェントのアンインストールとオフボード操作を行う場合は、以下の手順に従います。</p><ol><li><p>Microsoft 365 Defender ポータルにサインインし、[設定]&gt;[オフボーディング] を開きます。</p></li><li><p>プラットフォームを [Windows Server 2012 および 2016]、[展開方法] を [グループポリシー] に変更した上で、オフボードパッケージ(WindowsDefenderATPOffboardingPackage_valid_until_20XX-XX-XX.zip)をダウンロードします。</p><p>※ オフボードスクリプトには 30 日間の有効期限が設定される点にご留意ください。</p></li><li><p>次に、取得したオフボードパッケージ内のオフボードスクリプト(WindowsDefenderATPOffboardingScript_valid_until_XX-XX-XX.cmd) を <a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B">サーバを MDE にオンボードするためのスクリプトを配置する</a> の項と同じ手順で取得した Install.ps1 と同じ、MDE からオフボードするサーバからアクセス可能なフォルダに配置します。</p></li><li><p>MDE からオフボードするサーバにアクセスし、管理者権限で起動した PowerShell から以下のコマンドを実行することで、統合エージェントのアンインストールと MDE からのオフボードが完了します。</p></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell.exe <span class="literal">-ExecutionPolicy</span> RemoteSigned \\FileShareServer\MDEOnboard\Install.ps1 <span class="literal">-Uninstall</span> <span class="literal">-OffboardingScript</span> \\FileShareServer\MDEOnboard\WindowsDefenderATPOffboardingScript_valid_until_XX<span class="literal">-XX</span><span class="literal">-XX</span>.cmd</span><br></pre></td></tr></table></figure><p>※ オフボードスクリプトのファイル名の XX には有効期限の日付の値が入ります。</p><p>※ <code>\\FileShareServer\MDEOnboard</code> には任意の UNC パスもしくはローカルのフォルダパスを指定することが可能です。</p><ol start="5"><li><p>各サーバで MDE からのオフボードと統合エージェントのアンインストールが完了したことを確認したい場合は、[sc.exe query sense] コマンドを実行します。</p><p>Windows Server 2012 R2 および 2016 の場合には、Sense サービスが存在しないことを確認いただくことで、オフボードとアンインストールが正常に完了していると判断することができます。</p></li></ol><p><img src="../images/Endpoint-MDAV-2023-09-26-009.png" alt="Sense サービスの存在確認"></p><p>なお、オフボード操作を行う場合も、下記と同じ手順でグループポリシーを使用することで、 Install.ps1 を使用したオフボード操作を複数のサーバに展開することができます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide#apply-the-microsoft-defender-for-endpoint-installation-and-onboarding-packages-using-group-policy">グループ ポリシーを使用して Microsoft Defender for Endpoint のインストールパッケージとオンボード パッケージを適用する</a></p><h2 id="MDE-のオンボードに失敗する場合のトラブルシューティング"><a href="#MDE-のオンボードに失敗する場合のトラブルシューティング" class="headerlink" title="MDE のオンボードに失敗する場合のトラブルシューティング"></a>MDE のオンボードに失敗する場合のトラブルシューティング</h2><p>サーバを MDE にオンボードした後に以下のような問題が発生する場合、対象のサーバが MDE の利用のための要件を満たしていない可能性が考えられます。</p><ul><li><p><strong>サーバのオンボード後、最大で 24 時間以上経過しても Microsoft 365 Defender ポータルにサーバが登録されない</strong></p></li><li><p><strong>Microsoft 365 Defender ポータルのデバイスインベントリにサーバが登録されたが、[センサーの正常性状態] 列のステータスが [アクティブ] にならない</strong></p></li><li><p><strong>サーバで検知テストを行ったが、 Microsoft 365 Defender ポータルにアラートが出力されない</strong></p></li><li><p><strong><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/live-response?view=o365-worldwide">ライブ応答機能</a> や <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/respond-machine-alerts?view=o365-worldwide#isolate-devices-from-the-network">デバイス分離機能</a> が有効に動作しない</strong></p></li></ul><p>一般的に、これらの問題の多くは、MDE にオンボードしたサーバが通信要件を満たしていない場合に発生します。</p><p>そのため、サーバを MDE にオンボードした後に上記のような問題が発生する場合は、以下の手順にてサーバが MDE の動作に必要な通信要件を満たしているかどうかを確認してください。</p><h3 id="サーバで通信テストを行う"><a href="#サーバで通信テストを行う" class="headerlink" title="サーバで通信テストを行う"></a>サーバで通信テストを行う</h3><p>下記公開情報に記載の手順にてサーバで MDEClientAnalyzer ツールを実行することで、サーバが MDE の通信要件を満たすかどうかテストすることが可能です。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-windows?view=o365-worldwide">Windows でクライアント アナライザーを実行する | Microsoft Learn</a></p><blockquote><p>注意：</p><p>MDEClientAnalyzer ツールをローカルサーバで使用する場合には、 SysInternals に含まれる PsExec.exe ツールを実行できることが <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide#requirements">前提要件</a> に含まれます。</p><p>サーバで PsExec.exe ツールを制限している場合には、一時的に実行を許可した上で MDEClientAnalyzer ツールを使用してください。</p></blockquote><p>テスト結果は以下のようなレポート(MDEClientAnalyzer.htm)として出力され、 MDEClientAnalyzer ツールの実行後に既定のブラウザで自動的に表示されます。 </p><p><img src="../images/Endpoint-MDAV-2023-09-26-010.png" alt="テスト結果のレポート情報"></p><h3 id="レポートから通信テストの結果を確認する"><a href="#レポートから通信テストの結果を確認する" class="headerlink" title="レポートから通信テストの結果を確認する"></a>レポートから通信テストの結果を確認する</h3><p>レポート(MDEClientAnalyzer.htm) から通信テストの結果を確認する場合は、レポートの [Detailed Results] 欄の情報を確認します。</p><p>サーバが MDE の通信要件を満たしている場合、以下の例のように通信テストの結果がすべて <code>[Informational]</code> として表示されます。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-012.png" alt="通信テスト結果の確認①"></p><p>一方で、MDEClientAnalyzer ツールによる通信テストに失敗した項目が存在する場合には、以下のように通信テストの結果が <code>[Error]</code> として表示されます。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-011.png" alt="通信テスト結果の確認②"></p><p>通信テストの結果に  <code>[Error]</code> と表示される項目が存在する場合、[Results] 列にはテストに失敗した通信先の URL が表示されます。</p><p>レポート内に <code>[Error]</code> の項目が存在する場合、MDE の動作に問題が発生する可能性があるため、[Results] 列に表示される情報と <a href="#Windows-Server-%E3%82%92-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E5%89%8D%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">Windows Server を MDE にオンボードする前の確認ポイント</a> の記載を今一度ご確認の上、すべての動作要件を満たすように構成変更を実施します。</p><h3 id="通信にプロキシサーバを利用する場合の確認ポイント"><a href="#通信にプロキシサーバを利用する場合の確認ポイント" class="headerlink" title="通信にプロキシサーバを利用する場合の確認ポイント"></a>通信にプロキシサーバを利用する場合の確認ポイント</h3><p>インターネット通信にプロキシサーバが必要な構成のサーバで通信テストに失敗する場合、レポート(MDEClientAnalyzer.htm) の [Sense service discovered proxy] に適切なプロキシサーバのアドレスとポート番号が指定されているか確認します。</p><p>MDE の稼働に必要な通信要件とプロキシ設定については <a href="#%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A5%E7%B6%9A%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">端末のネットワーク接続を確認する</a> の項を参照します。</p><p><img src="../images/Endpoint-MDAV-2023-09-26-013.png" alt="MDEClientAnalyzer レポートからプロキシ設定を確認する"></p><p>※ 上記は WinHTTP プロキシを構成している場合の出力結果の例です。</p><p>プロキシサーバが適切に設定されているにも関わらず通信テストに失敗する場合には、設定されているプロキシサーバ側で必要な通信が許可されていることを確認します。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では Windows Server 2012 R2 と Windows Server 2016 を Microsoft Defender for Endpoint(MDE) にオンボード / オフボードする方法についておまとめいたしました。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合がありますことご了承ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では、Windows Server 2012 R2 と Windows Server 2016 を Microsoft Defender for Endpoint(MDE) にオンボード </summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>Active Directory Rithts Management Service (AD RMS) の役割は Azure IaaS を含めパブリック クラウドへの移行は許諾されません。</title>
    <link href="https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2023-09-14-01/"/>
    <id>https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2023-09-14-01/</id>
    <published>2023-09-13T15:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.149Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Active-Directory-Rithts-Management-Service-AD-RMS-の役割は-Azure-IaaS-を含めパブリック-クラウドへの移行は許諾されません。"><a href="#Active-Directory-Rithts-Management-Service-AD-RMS-の役割は-Azure-IaaS-を含めパブリック-クラウドへの移行は許諾されません。" class="headerlink" title="Active Directory Rithts Management Service (AD RMS) の役割は Azure IaaS を含めパブリック クラウドへの移行は許諾されません。"></a>Active Directory Rithts Management Service (AD RMS) の役割は Azure IaaS を含めパブリック クラウドへの移行は許諾されません。</h2><p>こんにちは。Azure Security サポートチームです。</p><p>Windows Server 2012 R2 のサポート ライフサイクルの終了日 (2023年10月10日) が迫っています。<br>今回はオンプレミス環境で運用している AD RMS の役割をホストしているサーバーについて、リフト&amp;シフト形式でのパブリック クラウド移行 (Azure/AWS/GCP 等) がライセンス上許諾されない点について注意喚起させていただきます。</p><p>EOS やサポート終了に伴い、ワークロードのクラウド移行を検討しているお客様もいらっしゃるかと存じますが、Windows Server 上で実行される AD RMS の役割についてはパブリック クラウドでの運用をライセンス面で許諾していません。</p><p>また、Azure 仮想マシン環境では機能的にも AD RMS の役割をサポートしてません。</p><p>Windows Server の AD RMS の役割についてアクティブな機能開発は終了しておりますので、アップグレードやクラウド サービスへの移行を検討いただく場合には、SaaS ソリューションである Microsoft Purview Information Protection (旧：Azure Information Protection) への移行を検討いただきたく存じます。</p><p>&lt;参考&gt;<br><br>Title : Azure 仮想マシンに対する Microsoft サーバー ソフトウェアのサポート<br><br>URL : <a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/virtual-machines/server-software-support">https://learn.microsoft.com/ja-jp/troubleshoot/azure/virtual-machines/server-software-support</a></p><p>～～～～～以下抜粋～～～～～<br><br>Microsoft Azure Virtual Machinesでは、次のロールはサポートされていません。</p><p>・動的ホスト構成プロトコル サーバー (Azure VNet に直接接続されている NIC での使用はサポートされていませんが、入れ子になった仮想化シナリオで使用される内部ネットワークでサポートされます)<br><br>・Hyper-V (Hyper-V ロールは Azure Ev3 および Dv3 シリーズ VM でのみサポートされています)<br><br>・Rights Management サービス<br><br>・Windows 展開サービス<br><br>～～～～～抜粋終了～～～～～</p><p>Titel : 秘密度ラベルの詳細<br><br>URL : <a href="https://learn.microsoft.com/ja-jp/purview/sensitivity-labels">https://learn.microsoft.com/ja-jp/purview/sensitivity-labels</a></p><p>Title : AD RMS から Azure Information Protection への移行<br><br>URL : <a href="https://learn.microsoft.com/ja-jp/azure/information-protection/migrate-from-ad-rms-to-azure-rms">https://learn.microsoft.com/ja-jp/azure/information-protection/migrate-from-ad-rms-to-azure-rms</a></p><h3 id="パブリック-クラウド上での-Windows-Server-のライセンスについて"><a href="#パブリック-クラウド上での-Windows-Server-のライセンスについて" class="headerlink" title="パブリック クラウド上での Windows Server のライセンスについて"></a>パブリック クラウド上での Windows Server のライセンスについて</h3><p>Windows Server のライセンスはサーバー本体に割り当てるライセンスと、アクセスするクライアント側に割り当てる “Client Access License (CAL)” があります。</p><p>また、CAL には基本機能を利用するために必ず割り当てる必要のある “ベース CAL” と、リモート デスクトップ サービスや AD RMS など、Windows Server の特定の追加機能を使用するために必要な “追加 CAL” があります。<br>例えば、オンプレミス環境で Windows Server の AD RMS の役割を運用する場合には、クライアント側にベース CAL と AD RMS 追加 CAL の 2 種類の CAL が必要になります。</p><p>&lt;参考&gt;<br><br>Title : Windows Server について<br><br>URL : <a href="https://www.microsoft.com/ja-jp/licensing/product-licensing/windows-server">https://www.microsoft.com/ja-jp/licensing/product-licensing/windows-server</a></p><p>～～～～～以下抜粋～～～～～<br><br>コア単位の Windows Server ライセンスに CAL は必要ですか。</p><p>Windows Server Standard エディションおよび Datacenter エディションでは、引き続き、サーバーにアクセスするすべてのユーザーまたはデバイスに対して Windows Server CAL が必要です (例外については、製品条項を参照)。外部ユーザーがアクセスするサーバーに対しては、Windows Server エクスターナル コネクタ ライセンスが引き続き必要です。Windows Server のベース CAL やエクスターナル コネクタ ライセンス以外にも、一部の機能には追加のアクセス ライセンスの購入が必要になります。たとえば、リモート デスクトップ サービスや Active Directory Rights Management サービスなどの追加機能や高度な機能についてはライセンスを購入する必要があります。<br><br>～～～～～抜粋終了～～～～～</p><p>一方でパブリック クラウド上で Windows Server を運用する場合のライセンス モデルはオンプレミスでのライセンス モデルと少々異なります。パブリック クラウド環境での Windows Server のライセンス モデルでは “ベース CAL” はホスティング サービス側で使用料に含まれる形で提供されます。</p><p>例えば Azure 仮想マシンで実行する Windows Server ではベース CAL のライセンスが含まれた形式で提供されており、お客様側での CAL の準備は不要です。しかしながら、IaaS の Windows Server の利用料金に含まれているのは “ベース CAL” だけであり、リモート デスクトップ サービスや AD RMS など高度な機能を利用する場合には、サービスに対応している “追加 CAL” が必要になります。</p><p>そこでパブリック クラウドへの追加 CAL の持ち込み可否 (ライセンス モビリティ特典) なのですが、拡張権限として許諾されているのはソフトウェア アシュアランス (SA) 付きのリモート デスクトップ サービス CAL のみであり、AD RMS 追加 CAL にはパブリック クラウドへの持ち込みを許諾する特典がありません。</p><p>&lt;参考&gt;<br><br>Title : Virtual Machines のライセンス FAQ<br><br>URL : <a href="https://azure.microsoft.com/ja-jp/pricing/licensing-faq/">https://azure.microsoft.com/ja-jp/pricing/licensing-faq/</a><br></p><p>～～～～～以下抜粋～～～～～<br><br>-Azure Virtual Machines で実行している Windows Server イメージに接続するのに、Windows Server クライアント アクセス ライセンス (CAL) は必要ですか。</p><p>いいえ。Azure 環境で実行している Windows Server にアクセスするためのアクセス権は Virtual Machines の分単位の料金に含まれているため、Windows Server SALs は必要ありません。(VHD かどうかに関係なく) オンプレミスで Windows Server を使用する場合は、別途ライセンスを取得する必要があり、ソフトウェアをオンプレミスで使用するための標準ライセンス要件に従うものとします。</p><p>-ボリューム ライセンス契約の一部として所有している リモート デスクトップ サービス CAL を使用して、Azure または他のサービス プロバイダー環境で実行している Windows Server のインスタンスにアクセスできますか。</p><p>2014 年 1 月 1 日より、リモート デスクトップ サービス ユーザー CAL でソフトウェア アシュアランスをアクティブにしているボリューム ライセンスをご利用のお客様は、リモート デスクトップ サービス CAL 拡張権限を利用できます。</p><p>これにより、Azure またはその他のサービス プロバイダーの共有サーバー環境で実行されている Windows Server に対して、ソフトウェア アシュアランス付きのリモート デスクトップ サービス ユーザー CAL を使用できます。</p><p>このリモート デスクトップ サービス ユーザー CAL ソフトウェア アシュアランスの特典により、それぞれのオンプレミス サーバーへのアクセスに加え、各ユーザーが 1 つの共有サーバー環境 (つまり Azure またはサード パーティのサーバー) でのみリモート デスクトップ サービス機能にアクセスできるようになります。</p><p>この特典を役立てるには、ライセンス モビリティ確認フォームを作成し、ホストされる GUI が実行される Azure または認定モビリティ パートナーに提出してください。詳細については、製品使用権の付録 2 の「Software Assurance Benefits (ソフトウェア アシュアランスの特典)」を参照してください。<br><br>～～～～～抜粋終了～～～～～</p><p>上記の通り、AD RMS 追加 CAL については、パブリック クラウドへのライセンス モビリティ特典を持たないことからパブリック クラウドへの移行が許諾されていません。つきましては運用環境で AD RMS のリプレースが必要な場合には、オンプレミス環境への移行または SaaS ソリューションである Microsoft Purview Information Protection サービスへの移行を検討いただけましたらと存じます。</p><p>今回のお知らせは以上になります。</p><p>※本ブログ記事化にあたり、弊社サポートによる調査にご協力いただきましたお客様に深く感謝いたします。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Active-Directory-Rithts-Management-Service-AD-RMS-の役割は-Azure-IaaS-を含めパブリック-クラウドへの移行は許諾されません。&quot;&gt;&lt;a href=&quot;#Active-Directory-Rithts-Mana</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
    <category term="Active Directory Rithts Management Service" scheme="https://jp-sec.github.io/blog/tags/Active-Directory-Rithts-Management-Service/"/>
    
  </entry>
  
  <entry>
    <title>Windows デバイスの Microsoft Defender ウイルス対策(MDAV) のセキュリティインテリジェンス(定義ファイル)更新設定について</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2023-08-17/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2023-08-17/</id>
    <published>2023-09-06T06:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-windows?view=o365-worldwide">Microsoft Defender ウイルス対策(MDAV)</a> のセキュリティインテリジェンスの更新管理についておまとめします。</p><p>MDAV のセキュリティインテリジェンスの概要や手動更新手順については以下の記事にておまとめしておりますので、参考情報としてご利用ください。</p><p>関連記事：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/">Microsoft Defender ウイルス対策のセキュリティインテリジェンス(定義ファイル)を手動で更新・ロールバック・削除する方法 | Japan CSS Security Support Blog</a></p><p>※ 本記事の内容は 2023 年 9 月 5 日時点で最新の Windows 10 22H2 環境で動作確認を実施しています。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%92%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E4%BA%8B%E5%89%8D%E6%83%85%E5%A0%B1">セキュリティインテリジェンスの更新を管理するための事前情報</a><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E9%A0%BB%E5%BA%A6%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">セキュリティインテリジェンスの更新頻度について</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">セキュリティインテリジェンスの更新ソースについて</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%97%E3%81%8F%E3%81%BF">セキュリティインテリジェンスの更新ソースを決定するしくみ</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E3%81%AE%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC%E3%81%AB%E8%A8%AD%E5%AE%9A%E5%8F%AF%E8%83%BD%E3%81%AA%E9%A0%85%E7%9B%AE">セキュリティインテリジェンス自動更新のトリガーに設定可能な項目</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%89%8B%E5%8B%95%E6%9B%B4%E6%96%B0%E6%96%B9%E6%B3%95%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">セキュリティインテリジェンスの手動更新方法について</a></li></ul></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">グループポリシーを使用してセキュリティインテリジェンスの自動更新を設定する</a><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新ソースを設定する</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E6%99%82%E5%88%BB%E3%81%A8%E6%9B%9C%E6%97%A5%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新時刻と曜日を指定する</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E9%96%93%E9%9A%94%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新間隔を指定する</a></li><li><a href="#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%81%A7%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%82%92%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">特定の条件でセキュリティインテリジェンスを更新する</a></li></ul></li><li><a href="#Intune-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">Intune を使用してセキュリティインテリジェンスの自動更新を設定する</a><ul><li><a href="#Intune-%E3%81%A7%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">Intune でセキュリティインテリジェンスの更新ソースを設定する</a></li><li><a href="#Intune-%E3%81%A7%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E9%96%93%E9%9A%94%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">Intune でセキュリティインテリジェンスの更新間隔を指定する</a></li></ul></li><li><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%85%B1%E6%9C%89%E3%82%92%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%A8%E3%81%97%E3%81%A6%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">ローカルネットワークファイル共有を更新ソースとして設定する</a><ul><li><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A7%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%80%81%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%85%B1%E6%9C%89%E3%82%92%E8%A1%8C%E3%81%86">サーバで更新プログラムを取得し、ネットワークファイル共有を行う</a></li><li><a href="#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E7%AB%AF%E6%9C%AB%E3%81%A7%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%85%B1%E6%9C%89%E3%81%8B%E3%82%89%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%82%92%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">クライアント端末でローカルネットワーク共有からセキュリティインテリジェンスを更新する</a></li></ul></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E8%B3%AA%E5%95%8F">セキュリティインテリジェンスの更新に関するよくある質問</a><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E6%9B%B4%E6%96%B0%E3%81%AB%E4%BC%B4%E3%81%86%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E7%9B%AE%E5%AE%89%E3%82%92%E6%95%99%E3%81%88%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84">セキュリティインテリジェンス更新に伴うダウンロードサイズの目安を教えてください</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%81%AB%E6%88%90%E5%8A%9F%E3%81%97%E3%81%9F%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E6%95%99%E3%81%88%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84">セキュリティインテリジェンスの更新に成功したかどうかを確認する方法を教えてください</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%81%8C%E6%8C%87%E5%AE%9A%E3%81%AE%E6%99%82%E5%88%BB%E3%81%AB%E8%A1%8C%E3%82%8F%E3%82%8C%E3%81%AA%E3%81%84%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">セキュリティインテリジェンスの更新が指定の時刻に行われないのはなぜですか</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E6%99%82%E5%88%BB%E3%81%AB%E6%9B%B4%E6%96%B0%E3%81%8C%E8%A1%8C%E3%82%8F%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E6%95%99%E3%81%88%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84">指定した時刻に更新が行われることを確認する方法を教えてください</a></li><li><a href="#%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%92%E8%A1%8C%E3%81%86%E3%81%93%E3%81%A8%E3%81%AF%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B">プロキシを使用してセキュリティインテリジェンスの更新を行うことは可能ですか</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E5%9B%9E%E7%B7%9A%E3%81%8C%E3%81%B2%E3%81%A3%E8%BF%AB%E3%81%99%E3%82%8B%E5%8F%AF%E8%83%BD%E6%80%A7%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">セキュリティインテリジェンスの更新によってインターネット回線がひっ迫する可能性はありますか</a></li><li><a href="#%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E5%8F%96%E5%BE%97%E5%85%83%E3%82%92-WSUS-%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AB%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%81%AB%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">更新プログラムの取得元を WSUS に変更している場合にセキュリティインテリジェンスの更新に失敗するのはなぜですか</a></li><li><a href="#%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E5%8F%96%E5%BE%97%E5%85%83%E3%82%92-WSUS-%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F%E7%92%B0%E5%A2%83%E3%81%A7%E3%80%81%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E3%81%BF-Microsoft-Update-%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B">更新プログラムの取得元を WSUS に設定した環境で、セキュリティインテリジェンスのみ Microsoft Update で取得することは可能ですか</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="セキュリティインテリジェンスの更新を管理するための事前情報"><a href="#セキュリティインテリジェンスの更新を管理するための事前情報" class="headerlink" title="セキュリティインテリジェンスの更新を管理するための事前情報"></a>セキュリティインテリジェンスの更新を管理するための事前情報</h2><p>以下に、セキュリティインテリジェンスの更新を管理するために事前に把握しておくとよい情報についておまとめいたします。</p><h3 id="セキュリティインテリジェンスの更新頻度について"><a href="#セキュリティインテリジェンスの更新頻度について" class="headerlink" title="セキュリティインテリジェンスの更新頻度について"></a>セキュリティインテリジェンスの更新頻度について</h3><p>Microsoft Defender ウイルス対策が最新の脅威に対応するため、セキュリティインテリジェンスの更新は 1 日に複数回配信されます。</p><p>そして、弊社では、セキュリティ上の観点から可能な限り最新のセキュリティインテリジェンスの適用を推奨しております。</p><p>そのため、セキュリティインテリジェンスの自動更新をスケジュールする際には、最低でも 1 日に 1 度、可能であれば複数回の更新確認を実施いただくことを推奨します。</p><h3 id="セキュリティインテリジェンスの更新ソースについて"><a href="#セキュリティインテリジェンスの更新ソースについて" class="headerlink" title="セキュリティインテリジェンスの更新ソースについて"></a>セキュリティインテリジェンスの更新ソースについて</h3><p>Microsoft Defender ウイルス対策は、セキュリティインテリジェンスの更新プログラムを取得するために複数の更新ソースを指定することが可能です。</p><p>ユーザは、Microsoft Defender ウイルス対策のセキュリティインテリジェンスの更新のためにとして、以下のいずれかを使用することが可能です。</p><ul><li><strong>Microsoft Update</strong></li><li><strong>Windows Server Update Service(WSUS)</strong></li><li><strong>Microsoft Endpoint Configuration Manager</strong></li><li><strong>ネットワークファイル共有</strong></li><li><strong>Microsoft Defende ウイルス対策およびその他の Microsoft マルウェア対策のセキュリティ インテリジェンス更新プログラム(MMPC)</strong></li></ul><p>Microsoft Defender ウイルス対策が指定可能な更新ソースの詳細については以下の公開情報にてご案内しています。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide">Microsoft Defender ウイルス対策が更新プログラムを受け取る方法と場所を管理する | Microsoft Learn</a></p><h3 id="セキュリティインテリジェンスの更新ソースを決定するしくみ"><a href="#セキュリティインテリジェンスの更新ソースを決定するしくみ" class="headerlink" title="セキュリティインテリジェンスの更新ソースを決定するしくみ"></a>セキュリティインテリジェンスの更新ソースを決定するしくみ</h3><p>Microsoft Defender ウイルス対策がセキュリティインテリジェンスの更新を行う場合、使用する更新元は既定では「フォールバック順序」の定義に従います。</p><p>例えば、最新の Windows 10 デバイスではフォールバック順序が既定で <code>MicrosoftUpdateServer|MMPC</code> に設定されています。</p><p>この場合、Microsoft Defender ウイルス対策はセキュリティインテリジェンスの更新を行う際に、まず Microsoft Update を使用して更新を行います。</p><p>何らかの理由で Microsoft Update サービスを利用できなかった場合には、代替更新元として 2 番目に設定されている MMPC を使用した更新を試みます。</p><p>「フォールバック順序」の詳細については以下の公開情報の記載を参照ください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">フォールバック順序 | Microsoft Learn</a></p><h3 id="セキュリティインテリジェンス自動更新のトリガーに設定可能な項目"><a href="#セキュリティインテリジェンス自動更新のトリガーに設定可能な項目" class="headerlink" title="セキュリティインテリジェンス自動更新のトリガーに設定可能な項目"></a>セキュリティインテリジェンス自動更新のトリガーに設定可能な項目</h3><p>Microsoft Defender ウイルス対策 のセキュリティインテリジェンス更新は、複数の機能や設定によってトリガーされます。</p><p>このような仕組みによって、最新の脅威に対応するためのセキュリティインテリジェンスを定期的に端末に適用することができます。</p><p>一般にセキュリティインテリジェンスの更新に利用される機能や設定については以下の通りです。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-updates?view=o365-worldwide#security-intelligence-updates">Microsoft Update による更新</a></li><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-update-schedule-microsoft-defender-antivirus?view=o365-worldwide">Microsoft Defender ウイルス対策によってスケジュールされた更新</a></li><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-outdated-endpoints-microsoft-defender-antivirus?view=o365-worldwide">キャッチアップ更新プログラムの取得</a></li><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-event-based-updates-microsoft-defender-antivirus?view=o365-worldwide">特定のイベントをトリガーとする更新</a></li><li><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/protect/deploy-use/endpoint-definitions-configmgr">Configration Manager を使用した更新</a></li></ul><p>各項目の詳細については、上記のリンク先の公開情報を参照してください。</p><h3 id="セキュリティインテリジェンスの手動更新方法について"><a href="#セキュリティインテリジェンスの手動更新方法について" class="headerlink" title="セキュリティインテリジェンスの手動更新方法について"></a>セキュリティインテリジェンスの手動更新方法について</h3><p>セキュリティインテリジェンスを手動で更新、ロールバックする方法については以下の公開ブログにておまとめしております。</p><p>参考情報：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/">Microsoft Defender ウイルス対策のセキュリティインテリジェンス(定義ファイル)を手動で更新・ロールバック・削除する方法 | Japan CSS Security Support Blog</a></p><h2 id="グループポリシーを使用してセキュリティインテリジェンスの自動更新を設定する"><a href="#グループポリシーを使用してセキュリティインテリジェンスの自動更新を設定する" class="headerlink" title="グループポリシーを使用してセキュリティインテリジェンスの自動更新を設定する"></a>グループポリシーを使用してセキュリティインテリジェンスの自動更新を設定する</h2><p>Windows マシンでスケジュールスキャンを構成する場合、GPOもしくはローカルグループポリシーにて、**[管理用テンプレート]&gt;[Windows コンポーネント]&gt;[Microsoft Defender ウイルス対策]&gt;[セキュリティインテリジェンスの更新]** 下の設定を変更します。</p><p>※ ご利用環境によっては、グループポリシーエディタ上のポリシー名が [Microsoft Defender ウイルス対策] ではなく[Windows Defender ウイルス対策] もしくは [Endpoint Protection] と表示されている場合があります。</p><p>セキュリティインテリジェンスの定期更新をスケジュールする場合、ユーザは以下の 3 つの設定を利用できます。</p><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新ソースを設定する</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E6%99%82%E5%88%BB%E3%81%A8%E6%9B%9C%E6%97%A5%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新時刻と曜日を指定する</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E9%96%93%E9%9A%94%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新間隔を指定する</a></li></ul><p><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新ソースを設定する</a> の設定は前述のフォールバック順序の設定に該当しており、Microsoft Defender ウイルス対策によってトリガーされるすべての更新に影響します。</p><p>上記の 3 つの設定は、同時に構成することも可能です。</p><p>また、キャッチアップ更新やイベントベースなど、<a href="#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%81%A7%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%82%92%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">特定の条件でセキュリティインテリジェンスを更新する</a> ことも可能です。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-update-schedule-microsoft-defender-antivirus?view=o365-worldwide#use-group-policy-to-schedule-protection-updates">ウイルス対策の更新プログラムMicrosoft Defenderスケジュールする | Microsoft Learn</a></p><h3 id="セキュリティインテリジェンスの更新ソースを設定する"><a href="#セキュリティインテリジェンスの更新ソースを設定する" class="headerlink" title="セキュリティインテリジェンスの更新ソースを設定する"></a>セキュリティインテリジェンスの更新ソースを設定する</h3><p>Microsoft Defender ウイルス対策がセキュリティインテリジェンスの更新を行う場合の更新ソースは、前述の通り「フォールバック順序」の定義によって決定されます。</p><p>既定値では、フォールバック順序は「Microsoft Update -&gt; MMPC(<code>MicrosoftUpdateServer|MMPC</code>)」に設定されています。</p><p>そのため、インターネットに接続可能なマシンで、セキュリティインテリジェンスの更新にも Microsoft Update サービスや MMPC を利用する場合には、フォールバック順序の設定変更は不要です。</p><p>一方で、WSUS を主な更新元に利用する場合には、グループポリシーにて、 <strong>[セキュリティインテリジェンスの更新をダウンロードするための更新元の順序を定義する]</strong> を有効化し、フォールバック順序に <code>InternalDefinitionUpdateServer</code> を加える必要があります。</p><p>以下の画面キャプチャは、セキュリティインテリジェンスの主要な更新元を WSUS、代替更新元を MMPC に指定する場合の設定例です。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-001.png" alt="グループポリシー：SignatureFallbackOrder"></p><h3 id="セキュリティインテリジェンスの更新時刻と曜日を指定する"><a href="#セキュリティインテリジェンスの更新時刻と曜日を指定する" class="headerlink" title="セキュリティインテリジェンスの更新時刻と曜日を指定する"></a>セキュリティインテリジェンスの更新時刻と曜日を指定する</h3><p>ユーザは、Microsoft Defender ウイルス対策がセキュリティインテリジェンスの更新を試行する曜日と時刻を指定することができます。</p><p>セキュリティインテリジェンスの更新スケジュールは、[管理用テンプレート]&gt;[Windows コンポーネント]&gt;[Microsoft Defender ウイルス対策]&gt;[セキュリティインテリジェンスの更新] のうち、以下の 2 つのポリシーを使用して設定します。</p><ul><li><strong>[セキュリティインテリジェンスの更新を確認する曜日を指定する] (SignatureScheduleDay)</strong></li><li><strong>[セキュリティインテリジェンスの更新を確認する時刻を指定する] (SignatureScheduleTime)</strong></li></ul><p>具体的には、SignatureScheduleDay で指定した曜日の、SignatureScheduleTime で指定した時刻にセキュリティインテリジェンスの更新が試行されます。</p><p>SignatureScheduleDay には既定で <code>0x8(実行しない)</code> が設定されているため、SignatureScheduleTime  によるセキュリティインテリジェンス更新のスケジュールを行う場合、まず SignatureScheduleDay の設定を変更する必要があります。</p><p>例えば、毎日のセキュリティインテリジェンスの更新時刻を指定する場合は、以下のように [セキュリティインテリジェンスの更新を確認する曜日を指定する] を [有効] に変更し、設定値を [毎日] とします。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-003.png" alt="グループポリシー：SignatureScheduleDay"></p><p>なお、 [セキュリティインテリジェンスの更新を確認する曜日を指定する] の設定を [毎日] にして保存した場合、グループポリシーエディタ上では以下のように [セキュリティインテリジェンスの更新を確認する曜日を指定する] の状態が [無効] と表示される場合があります。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-005.png" alt="グループポリシー：SignatureScheduleDay"></p><p>しかし、上記の表示となる場合でも、SignatureScheduleDay の値が 0 に設定されている場合、セキュリティインテリジェンスの更新は、SignatureScheduleTime  で指定の時刻に [毎日] 実施されます。</p><p>設定が適切に反映されているかについては、後述するように PowerShell で <code>Get-MpPreference | Select-Object SignatureScheduleDay</code> を実行することで確認が可能です。</p><p> [セキュリティインテリジェンスの更新を確認する曜日を指定する] (SignatureScheduleDay) の設定が完了したら、続いて [セキュリティインテリジェンスの更新を確認する時刻を指定する] (SignatureScheduleTime) の設定を行います。</p><p>SignatureScheduleTime は、午前 0 時からの分数で更新をトリガーする時刻を指定します。</p><p>例えば、以下のように 120 を指定した場合、セキュリティインテリジェンスの更新は午前 2 時にトリガーされます。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-004.png" alt="グループポリシー：SignatureScheduleTime"></p><p>上記の 2 つの設定を実施後、設定が反映されていることを確認するためには、PowerShell  で以下のコマンドレットを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpPreference</span> | <span class="built_in">Select-Object</span> SignatureScheduleDay,SignatureScheduleTime</span><br></pre></td></tr></table></figure><p>上記コマンドの実行結果が以下となる場合、セキュリティインテリジェンスの更新は「毎日、午前 2 時」に試行されると判断することができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SignatureScheduleDay SignatureScheduleTime</span><br><span class="line">-------------------- ---------------------</span><br><span class="line">                   <span class="number">0</span> <span class="number">02</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><h3 id="セキュリティインテリジェンスの更新間隔を指定する"><a href="#セキュリティインテリジェンスの更新間隔を指定する" class="headerlink" title="セキュリティインテリジェンスの更新間隔を指定する"></a>セキュリティインテリジェンスの更新間隔を指定する</h3><p>ユーザは、Microsoft Defender ウイルス対策がセキュリティインテリジェンスの更新を試行する間隔を指定することができます。</p><p>セキュリティインテリジェンスの更新間隔は、[管理用テンプレート]&gt;[Windows コンポーネント]&gt;[Microsoft Defender ウイルス対策]&gt;[セキュリティインテリジェンスの更新] のうち、以下のポリシーを使用して設定します。</p><p>この設定によってセキュリティインテリジェンスの更新を試行する間隔は時間単位で指定することができます。</p><p>以下の設定画面では、セキュリティインテリジェンスの更新間隔を 3 時間ごとに指定しています。</p><ul><li><strong>[セキュリティインテリジェンスの更新をチェックする間隔を指定する] (SignatureUpdateInterval)</strong></li></ul><p><img src="../images/Endpoint-MDAV-2023-08-17-006.png" alt="グループポリシー：SignatureUpdateInterval"></p><p>Microsoft Defender ウイルス対策は、最後にセキュリティインテリジェンスを更新してから指定された時間が経過した場合、新たな更新をチェックします。</p><p>例えば、SignatureUpdateInterval を 3 時間に指定した場合には、セキュリティインテリジェンスの最終更新時刻(AntivirusSignatureLastUpdated) から 3 時間ごとのタイミングでセキュリティインテリジェンスの更新確認が行われます。</p><p>なお、この設定は、<a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E6%99%82%E5%88%BB%E3%81%A8%E6%9B%9C%E6%97%A5%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新時刻と曜日を指定する</a> の設定とは独立して動作します。</p><p>そのため、SignatureScheduleDay が既定値の <code>0x8(実行しない)</code> に設定されている場合でも、SignatureUpdateInterval によるセキュリティインテリジェンスの自動更新は実施されます。</p><h3 id="特定の条件でセキュリティインテリジェンスを更新する"><a href="#特定の条件でセキュリティインテリジェンスを更新する" class="headerlink" title="特定の条件でセキュリティインテリジェンスを更新する"></a>特定の条件でセキュリティインテリジェンスを更新する</h3><p>Microsoft Defender ウイルス対策では、スケジュールされた更新とは別に、特定の条件やイベントベースでセキュリティインテリジェンスの更新をトリガーすることができます。</p><p>よく利用される設定項目について以下で紹介します。</p><ol><li><strong>[スタートアップ時に最新のウイルスおよびスパイウェア対策セキュリティインテリジェンスをチェックする]</strong></li></ol><p>この設定を有効化すると、Microsoft Defender ウイルス対策のスタートアップ時に新しいセキュリティインテリジェンスの更新が試行されます。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-007.png" alt="グループポリシー：UpdateOnStartUp"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-event-based-updates-microsoft-defender-antivirus?view=o365-worldwide#check-for-protection-updates-on-startup">起動時に保護の更新プログラムを確認する | Microsoft Learn</a></p><ol start="2"><li><strong>[ウイルス対策セキュリティインテリジェンスが最新でないと見なされるまでの日数を定義する]</strong></li></ol><p>この設定を有効化すると、端末で一定期間セキュリティインテリジェンスの更新が行われていない場合、次回のサインイン時に自動的にセキュリティインテリジェンスの更新がトリガーされます。</p><p>既定では、1 日以上セキュリティインテリジェンスの更新が行われていない場合、この設定によってキャッチアップ更新が実施されます。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-008.png" alt="グループポリシー：SignatureUpdateCatchupInterval "></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-outdated-endpoints-microsoft-defender-antivirus?view=o365-worldwide#use-group-policy-to-enable-and-configure-the-catch-up-update-feature">グループ ポリシーを使用してキャッチアップ更新機能を有効にして構成する | Microsoft Learn</a></p><h2 id="Intune-を使用してセキュリティインテリジェンスの自動更新を設定する"><a href="#Intune-を使用してセキュリティインテリジェンスの自動更新を設定する" class="headerlink" title="Intune を使用してセキュリティインテリジェンスの自動更新を設定する"></a>Intune を使用してセキュリティインテリジェンスの自動更新を設定する</h2><p>Intune からセキュリティインテリジェンスの自動更新を設定する場合、**[エンドポイントセキュリティ]&gt;[ウイルス対策] から作成可能な [Microsoft Defender ウイルス対策] ポリシー**や、構成プロファイルから作成可能な [管理用テンプレート] ポリシーを使用することが可能です。</p><p>[管理用テンプレート] ポリシーを利用する場合は、グループポリシーを使用してセキュリティインテリジェンスの自動更新を構成する方法に関する手順を参照し、対応するポリシーを構成します。</p><p>[Microsoft Defender ウイルス対策] ポリシーを使用する場合は、以下の項目を参照してください。</p><p>※ [Microsoft Defender ウイルス対策] ポリシーを構成する場合、プラットフォームは [Windows 10、Windows 11、Windows Server] を選択します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/mem/Intune/protect/endpoint-security-antivirus-policy">Microsoft Intuneでエンドポイント セキュリティ ポリシーを使用してウイルス対策設定を管理する | Microsoft Learn</a></p><h3 id="Intune-でセキュリティインテリジェンスの更新ソースを設定する"><a href="#Intune-でセキュリティインテリジェンスの更新ソースを設定する" class="headerlink" title="Intune でセキュリティインテリジェンスの更新ソースを設定する"></a>Intune でセキュリティインテリジェンスの更新ソースを設定する</h3><p>Intune の [Microsoft Defender ウイルス対策] ポリシーでセキュリティインテリジェンスの更新ソースを設定する場合、[定義更新のフォールバック順序] のトグルボタンを有効化した上で、設定したい更新ソースをパイプ区切りで入力します。</p><p>既定値では、フォールバック順序は「Microsoft Update -&gt; MMPC(<code>MicrosoftUpdateServer|MMPC</code>)」に設定されています。</p><p>そのため、インターネットに接続可能なマシンで、セキュリティインテリジェンスの更新にも Microsoft Update サービスや MMPC を利用する場合には、フォールバック順序の設定変更は不要です。</p><p>一方で、WSUS を主な更新元に利用する場合には、フォールバック順序に <code>InternalDefinitionUpdateServer</code> を加える必要があります。</p><p>以下の画面キャプチャは、セキュリティインテリジェンスの主要な更新元を WSUS、代替更新元を MMPC に指定する場合の設定例です。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-002.png" alt="Intune でフォールバック順序を設定する"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-Defender?WT.mc_id=Portal-fx#signatureupdatefallbackorder">SignatureUpdateFallbackOrder | Microsoft Learn</a></p><h3 id="Intune-でセキュリティインテリジェンスの更新間隔を指定する"><a href="#Intune-でセキュリティインテリジェンスの更新間隔を指定する" class="headerlink" title="Intune でセキュリティインテリジェンスの更新間隔を指定する"></a>Intune でセキュリティインテリジェンスの更新間隔を指定する</h3><p>Intune のウイルス対策ポリシーを使用する場合、<a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E9%96%93%E9%9A%94%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新間隔を指定する</a> と同じく、SignatureUpdateInterval の設定を変更して Microsoft Defender ウイルス対策は 3 時間ごとにセキュリティインテリジェンスの更新を試行するように構成することができます。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-009.png" alt="Intune：SignatureUpdateInterval"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-Defender?WT.mc_id=Portal-fx#signatureupdateinterval">Defender Policy CSP - Windows Client Management | Microsoft Learn</a></p><h2 id="ローカルネットワークファイル共有を更新ソースとして設定する"><a href="#ローカルネットワークファイル共有を更新ソースとして設定する" class="headerlink" title="ローカルネットワークファイル共有を更新ソースとして設定する"></a>ローカルネットワークファイル共有を更新ソースとして設定する</h2><p>この項では、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#unc-share">セキュリティ インテリジェンスとプラットフォーム更新プログラム用の UNC 共有を作成する</a> の記載に従ってローカルネットワークファイル共有をセキュリティインテリジェンスの更新元に設定する方法を紹介します。</p><p>具体的には、以下の図のように、インターネットからサーバが配布用のセキュリティインテリジェンスの更新プログラムを取得し(①)、各クライアント端末はそのサーバからネットワークファイル共有を通して更新プログラムを取得(②)します。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-013.png" alt="ローカルネットワークファイル共有"></p><h3 id="サーバで更新プログラムを取得し、ネットワークファイル共有を行う"><a href="#サーバで更新プログラムを取得し、ネットワークファイル共有を行う" class="headerlink" title="サーバで更新プログラムを取得し、ネットワークファイル共有を行う"></a>サーバで更新プログラムを取得し、ネットワークファイル共有を行う</h3><p>※ 本記事では、セキュリティインテリジェンス更新プログラムの配布サーバとして Windows Server 2019 を使用します。</p><ol><li>ファイル共有を行うサーバにて管理者権限でコマンドプロンプトを起動し、以下のコマンドでスクリプトと更新プログラムを配置するフォルダを作成します。</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MD</span> C:\Tool\PS<span class="literal">-Scripts</span>\</span><br><span class="line"><span class="built_in">MD</span> C:\Temp\TempSigs\x64</span><br><span class="line"><span class="built_in">MD</span> C:\Temp\TempSigs\x86</span><br></pre></td></tr></table></figure><ol start="2"><li><a href="https://www.powershellgallery.com/packages/SignatureDownloadCustomTask/1.4">SignatureDownloadCustomTask 1.4</a> の配布サイトにアクセスして [Manual Download] のタブを開き、[Download the raw nupkg file] ボタンをクリックして <code>signaturedownloadcustomtask.1.4.0.nupkg</code> をダウンロードします。</li><li>任意の解凍ツールを使用して <code>signaturedownloadcustomtask.1.4.0.nupkg</code> を展開し、取得した<code>SignatureDownloadCustomTask.ps1</code> を作成したスクリプト用フォルダ(<code>C:\Tool\PS-Scripts\</code>) に配置します。</li><li>続いて、管理者権限で起動した PowerShell で以下のコマンドを順に実行し、更新プログラムを定期的に取得するスケジュールタスクを作成します。</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\Tool\PS-Scripts\&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># x64 デルタ更新プログラム を取得するタスクを登録する</span></span><br><span class="line">.\SignatureDownloadCustomTask.ps1 <span class="literal">-action</span> create <span class="literal">-arch</span> x64 <span class="literal">-isDelta</span> <span class="variable">$true</span> <span class="literal">-destDir</span> C:\Temp\TempSigs\x64 <span class="literal">-scriptPath</span> C:\Tool\PS<span class="literal">-Scripts</span>\SignatureDownloadCustomTask.ps1 <span class="literal">-daysInterval</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># x64 完全更新プログラム を取得するタスクを登録する</span></span><br><span class="line">.\SignatureDownloadCustomTask.ps1 <span class="literal">-action</span> create <span class="literal">-arch</span> x64 <span class="literal">-isDelta</span> <span class="variable">$false</span> <span class="literal">-destDir</span> C:\Temp\TempSigs\x64 <span class="literal">-scriptPath</span> C:\Tool\PS<span class="literal">-Scripts</span>\SignatureDownloadCustomTask.ps1 <span class="literal">-daysInterval</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># x86 デルタ更新プログラム を取得するタスクを登録する</span></span><br><span class="line">.\SignatureDownloadCustomTask.ps1 <span class="literal">-action</span> create <span class="literal">-arch</span> x86 <span class="literal">-isDelta</span> <span class="variable">$true</span> <span class="literal">-destDir</span> C:\Temp\TempSigs\x86 <span class="literal">-scriptPath</span> C:\Tool\PS<span class="literal">-Scripts</span>\SignatureDownloadCustomTask.ps1 <span class="literal">-daysInterval</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># x86 完全更新プログラム を取得するタスクを登録する</span></span><br><span class="line">.\SignatureDownloadCustomTask.ps1 <span class="literal">-action</span> create <span class="literal">-arch</span> x86 <span class="literal">-isDelta</span> <span class="variable">$false</span> <span class="literal">-destDir</span> C:\Temp\TempSigs\x86 <span class="literal">-scriptPath</span> C:\Tool\PS<span class="literal">-Scripts</span>\SignatureDownloadCustomTask.ps1 <span class="literal">-daysInterval</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><ol start="5"><li>スケジュールタスクの登録に成功した場合、タスクスケジューラライブラリの [Microsoft]&gt;[Windows]&gt;[Microsoft Defender(もしくは Windows Defender)] に以下のようなスケジュールタスクが登録されます。</li></ol><p><img src="../images/Endpoint-MDAV-2023-08-17-015.png" alt="タスクスケジューラの確認結果"></p><ol start="6"><li>作成された 4 つのスケジュールタスクを右クリックし、[プロパティ] 画面から [操作] タブを開いて [編集] ボタンをクリックします。<br>そして、[引数の追加(オプション)] 欄にて <code>-Noprofile -ExecutionPolicy AllSigned (省略)</code>   の定義を、 <code>-Noprofile -ExecutionPolicy RemoteSigned (省略)</code>  に変更します。</li></ol><p><img src="../images/Endpoint-MDAV-2023-08-17-016.png" alt="タスクスケジューラの引数を RemoteSigned に変更"></p><ol start="7"><li>このスクリプトをシステムで初めて実行する場合は、管理者権限で起動したコマンドプロンプトで以下のコマンドを実行します。</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\windows\system32\windowspowershell\v1.<span class="number">0</span>\powershell.exe <span class="literal">-NoProfile</span> <span class="literal">-executionpolicy</span> RemoteSigned  <span class="literal">-command</span> <span class="string">&quot;&amp;\&quot;</span>C:\Tool\PS<span class="literal">-Scripts</span>\SignatureDownloadCustomTask.ps1\<span class="string">&quot; -action run -arch x64 -isDelta <span class="variable">$False</span> -destDir C:\Temp\TempSigs\x64&quot;</span></span><br></pre></td></tr></table></figure><p>注意：2023 年 9 月 5 日現在、Windows Server 2016 以下のバージョンを使用している環境で「<code>&quot;2&quot; 個の引数を指定して &quot;DownloadFile&quot; を呼び出し中に例外が発生しました: &quot;要求は中止されました: SSL/TLS のセキュリティで保護されているチャネルを作成できませんでした&quot;</code>」というエラーで更新プログラムのダウンロードに失敗する問題が確認されております。問題の解決のためには、PowerShell で TLS1.2 を利用できるように構成する必要があります。詳細については <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/security/enable-tls-1-2-client#bkmk_net">公開情報</a> を参照するか、弊社までお問い合わせください。</p><ol start="8"><li>[7.] の手順の完了後、<code>C:\Temp\TempSigs\x64</code> に更新用のプログラムが配置されていることを確認します。</li><li>最後に、[5.] で確認したスケジュールタスクを右クリックして手動実行し、<code>C:\Temp\TempSigs</code> 以下のフォルダに更新プログラムが配置されることを確認します。</li><li>更新プログラムを配置しているフォルダ <code>C:\Temp\TempSigs</code> を共有フォルダとして構成します。その際、対象フォルダへの匿名アクセスを許可する必要がある点に注意してください。</li></ol><h3 id="クライアント端末でローカルネットワーク共有からセキュリティインテリジェンスを更新する"><a href="#クライアント端末でローカルネットワーク共有からセキュリティインテリジェンスを更新する" class="headerlink" title="クライアント端末でローカルネットワーク共有からセキュリティインテリジェンスを更新する"></a>クライアント端末でローカルネットワーク共有からセキュリティインテリジェンスを更新する</h3><ol><li>事前に、エクスプローラーなどでセキュリティインテリジェンスの配布を行う共有フォルダにクライアント端末から UNC パスでアクセス可能であることを確認しておきます。</li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新ソースを設定する</a> と同じ手順で、フォールバック順序に FileShares を指定します。</li><li>続いて、[セキュリティインテリジェンスの更新をダウンロードするためのファイル共有を定義する] (SignatureDefinitionUpdateFileSharesSources) に作成した共有フォルダの UNC パスを指定します。</li></ol><p><img src="../images/Endpoint-MDAV-2023-08-17-017.png" alt="グループポリシー：SignatureDefinitionUpdateFileSharesSources"></p><ol start="4"><li>以上の設定を実施後、セキュリティインテリジェンスの更新に成功することを確認します。</li></ol><h2 id="セキュリティインテリジェンスの更新に関するよくある質問"><a href="#セキュリティインテリジェンスの更新に関するよくある質問" class="headerlink" title="セキュリティインテリジェンスの更新に関するよくある質問"></a>セキュリティインテリジェンスの更新に関するよくある質問</h2><h3 id="セキュリティインテリジェンス更新に伴うダウンロードサイズの目安を教えてください"><a href="#セキュリティインテリジェンス更新に伴うダウンロードサイズの目安を教えてください" class="headerlink" title="セキュリティインテリジェンス更新に伴うダウンロードサイズの目安を教えてください"></a>セキュリティインテリジェンス更新に伴うダウンロードサイズの目安を教えてください</h3><p>定期的に更新が行われている端末では、セキュリティインテリジェンスの更新に伴うダウンロードサイズを最小限にするため、現在適用されているバージョンと最新のセキュリティインテリジェンスの差分(デルタ)のみをダウンロードします。</p><p>そのため、実際のダウンロードサイズは端末のセキュリティインテリジェンスの更新頻度や更新元などによって変動する可能性があります。</p><p>また、ご利用環境や更新のタイミングによっては、通常より多くの更新を取得したり、セキュリティインテリジェンスの差分(デルタ)ではなく、完全な更新プログラムの取得を行う場合があります。</p><p>以上の理由から、セキュリティインテリジェンスの更新に伴う具体的なダウンロードサイズの目安についてはご案内が困難であり、ユーザの環境で実際に確認いただくようお願いいたしております。</p><p>※ なお、セキュリティインテリジェンスの更新に伴うダウンロードサイズは、環境によっては最大で 110 ~ 130 MB 程度になる可能性があります。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">Microsoft Defender ウイルス対策が更新プログラムを受け取る方法と場所を管理する | Microsoft Learn</a></p><h3 id="セキュリティインテリジェンスの更新に成功したかどうかを確認する方法を教えてください"><a href="#セキュリティインテリジェンスの更新に成功したかどうかを確認する方法を教えてください" class="headerlink" title="セキュリティインテリジェンスの更新に成功したかどうかを確認する方法を教えてください"></a>セキュリティインテリジェンスの更新に成功したかどうかを確認する方法を教えてください</h3><p>セキュリティインテリジェンスの更新に成功した場合、Microsoft Defender ウイルス対策のイベントログ(<code>[アプリケーションとサービスログ]&gt;[Microsoft]&gt;[Windows]&gt;[Windows Defender]&gt;[Operational]</code>) にイベント ID：2000 のイベントが記録されます。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-010.png" alt="イベントログ：セキュリティインテリジェンスの更新"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide#-----id-2000">Microsoft Defender ウイルス対策イベントの ID とエラー コード | Microsoft Learn</a></p><p>PowerShell を使用して、システムで最後にセキュリティインテリジェンスの更新に成功したイベントログを抽出するには以下のコマンドを使用できます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-LogName</span> <span class="string">&quot;Microsoft-Windows-Windows Defender/Operational&quot;</span> <span class="literal">-FilterXPath</span> <span class="string">&quot;*[System[(EventID=2000)]]&quot;</span> <span class="literal">-MaxEvents</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>また、PowerShell  で以下のコマンドレットを使用することで、現在端末に適用されているセキュリティインテリジェンスのバージョンを確認することでも、セキュリティインテリジェンスの更新に成功していることを確認することが可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AntivirusSignatureVersion</span><br></pre></td></tr></table></figure><h3 id="セキュリティインテリジェンスの更新が指定の時刻に行われないのはなぜですか"><a href="#セキュリティインテリジェンスの更新が指定の時刻に行われないのはなぜですか" class="headerlink" title="セキュリティインテリジェンスの更新が指定の時刻に行われないのはなぜですか"></a>セキュリティインテリジェンスの更新が指定の時刻に行われないのはなぜですか</h3><p>スケジュールされたセキュリティインテリジェンスの更新は、端末側のシステム時間に従って開始されます。</p><p>そのため、例えばシステムの時刻設定が UTC や JST(UTC+9) である端末にてそれぞれ同一のスケジュール設定を行った場合には、セキュリティインテリジェンスの更新の開始時刻に差異が発生する点に留意してください。</p><p>また、<a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E3%81%AE%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC%E3%81%AB%E8%A8%AD%E5%AE%9A%E5%8F%AF%E8%83%BD%E3%81%AA%E9%A0%85%E7%9B%AE">セキュリティインテリジェンス自動更新のトリガーに設定可能な項目</a> に記載の通り、セキュリティインテリジェンスの更新は複数のサービスや設定によって実施されるため、一般的な環境では 1 日に複数回セキュリティインテリジェンスの更新確認が行われる場合があります。</p><p>そして、Microsoft Defender ウイルス対策がセキュリティインテリジェンスの更新を試行した際、すでに端末に最新のセキュリティインテリジェンスが適用されている場合、更新はスキップされます。</p><p>そのため、ユーザの端末で最新のセキュリティインテリジェンスが定期的に更新されている場合には、必ずしも指定の時刻に更新が実施される必要はないものとご認識ください。</p><p>なお、もし何らかの理由で <a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E6%99%82%E5%88%BB%E3%81%A8%E6%9B%9C%E6%97%A5%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新時刻と曜日を指定する</a> で設定した時刻にセキュリティインテリジェンスの更新が行われることを確認する必要がある場合は、<a href="#%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E6%99%82%E5%88%BB%E3%81%AB%E6%9B%B4%E6%96%B0%E3%81%8C%E8%A1%8C%E3%82%8F%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E6%95%99%E3%81%88%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84">指定した時刻に更新が行われることを確認する方法を教えてください</a> 手順をお試しください。</p><h3 id="指定した時刻に更新が行われることを確認する方法を教えてください"><a href="#指定した時刻に更新が行われることを確認する方法を教えてください" class="headerlink" title="指定した時刻に更新が行われることを確認する方法を教えてください"></a>指定した時刻に更新が行われることを確認する方法を教えてください</h3><p>※ 事前に <a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%81%8C%E6%8C%87%E5%AE%9A%E3%81%AE%E6%99%82%E5%88%BB%E3%81%AB%E8%A1%8C%E3%82%8F%E3%82%8C%E3%81%AA%E3%81%84%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">セキュリティインテリジェンスの更新が指定の時刻に行われないのはなぜですか</a> を参照ください。</p><p>Windows マシンでは、既定で以下の設定が有効化されているため、スケジュールした時刻ちょうどに更新が行われることを確認するためには、この設定を無効化する必要があります。</p><ul><li><strong>スケジュールされたタスクの実行時間をランダム化する</strong></li></ul><p>※ なお、スケジュールされたタスクの実行時間をランダム化することは、帯域負荷の軽減などのパフォーマンスの上のメリットがあるため、特別な理由がない限り無効化いただく必要はありません。</p><p>上記の設定はグループポリシーまたは Intune の構成プロファイルなどから設定変更が可能です。</p><p>グループポリシーを使用する場合は、[管理用テンプレート]&gt;[Windows コンポーネント]&gt;[Microsoft Defender ウイルス対策] 下の [スケジュールされたタスクの時間をランダム化する] の設定を [無効] に変更します。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-011.png" alt="グループポリシー：RandomizeScheduleTaskTimes"></p><p>検証のために特定の端末のみで設定を変更する場合、PowerShell コマンドレットによる設定変更も可能です。</p><p>スケジュールされたタスクの実行時間をランダム化を無効化する場合は、管理者権限で起動した PowerShell  で以下のコマンドレットを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-MpPreference</span> <span class="literal">-RandomizeScheduleTaskTimes</span> <span class="variable">$False</span></span><br></pre></td></tr></table></figure><p>設定を再有効化する場合は以下のコマンドレットを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-MpPreference</span> <span class="literal">-RandomizeScheduleTaskTimes</span> <span class="variable">$True</span></span><br></pre></td></tr></table></figure><p>テストを行う端末でスケジュールされたタスクの実行時間をランダム化する設定を無効化したら、以下の手順でセキュリティインテリジェンスの更新が指定の時刻に行われることを確認します。</p><ol><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E6%99%82%E5%88%BB%E3%81%A8%E6%9B%9C%E6%97%A5%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">セキュリティインテリジェンスの更新時刻と曜日を指定する</a> の項に記載の以下のコマンドレットを PowerShell  で実行し、セキュリティインテリジェンスの更新スケジュールが意図した時刻に設定されていることを確認します。</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpPreference</span> | <span class="built_in">Select-Object</span> SignatureScheduleDay,SignatureScheduleTime</span><br></pre></td></tr></table></figure><ol start="2"><li>続いて、SignatureScheduleTime で指定した時刻の直前に端末にサインインし、以下のコマンドレットにて現在端末に適用されているセキュリティインテリジェンスのバージョンが最新バージョンではないことを確認します。</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AntivirusSignatureVersion</span><br></pre></td></tr></table></figure><p>※ 現在公開されている最新のセキュリティインテリジェンスのバージョンは <a href="https://www.microsoft.com/en-us/wdsi/defenderupdates">Latest security intelligence update</a> から確認できます。</p><p>※ 指定の時刻の前に更新が実行され、すでに最新のセキュリティインテリジェンスが適用されている場合、セキュリティインテリジェンスの更新はスキップされるため、SignatureScheduleTime で指定の時刻に更新は行われません。</p><ol start="3"><li>SignatureScheduleTime で指定の時刻となったことを確認の後、再度以下のコマンドを実行してセキュリティインテリジェンスのバージョンが最新バージョンに更新されたことを確認します。</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AntivirusSignatureVersion</span><br></pre></td></tr></table></figure><h3 id="プロキシを使用してセキュリティインテリジェンスの更新を行うことは可能ですか"><a href="#プロキシを使用してセキュリティインテリジェンスの更新を行うことは可能ですか" class="headerlink" title="プロキシを使用してセキュリティインテリジェンスの更新を行うことは可能ですか"></a>プロキシを使用してセキュリティインテリジェンスの更新を行うことは可能ですか</h3><p>Microsoft Defender ウイルス対策のセキュリティインテリジェンスの更新にはプロキシを利用することが可能です。</p><p>セキュリティインテリジェンスの更新に使用可能なプロキシ設定は、ユーザの環境で利用する更新方法に依存します。</p><p>セキュリティインテリジェンスの更新に使用可能なサービスや、使用する更新元を指定する方法については以下の項を参照します。</p><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">セキュリティインテリジェンスの更新ソースについて</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%97%E3%81%8F%E3%81%BF">セキュリティインテリジェンスの更新ソースを決定するしくみ</a></li></ul><p>既定で構成されている Microsoft Update サービスと MMPC を更新元として利用する場合は、それぞれの更新に利用可能なプロキシ設定を使用する必要があります。</p><p>Microsoft Update サービスが利用可能なプロキシ設定については、<a href="https://support.microsoft.com/ja-jp/topic/windows-update-%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%8C-windows-update-web-%E3%82%B5%E3%82%A4%E3%83%88%E3%81%B8%E3%81%AE%E6%8E%A5%E7%B6%9A%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95-08612ae5-3722-886c-f1e1-d012516c22a1">公開情報</a> の記載を参照します。</p><p>MMPC を更新元として利用する場合には、WinHTTP プロキシや、[ネットワークへ接続するためのプロキシサーバーを定義する] から設定可能な Microsoft Defender ウイルス対策用のプロキシ設定を利用できます。</p><p>グループポリシーを使用する場合は、[管理用テンプレート]&gt;[Windows コンポーネント]&gt;[Microsoft Defender ウイルス対策] 下の [ネットワークへ接続するためのプロキシサーバーを定義する] の設定を [有効] に変更し、プロキシサーバのアドレスとポート番号を指定します。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-012.png" alt="グループポリシー：ProxyServer"></p><p>この方法で設定したプロキシサーバは、Microsoft Defender ウイルス対策のセキュリティインテリジェンス更新やクラウド保護機能に利用されます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#configure-a-static-proxy-for-microsoft-defender-antivirus">Microsoft Defender ウイルス対策の静的プロキシを構成する | Microsoft Learn</a></p><h3 id="セキュリティインテリジェンスの更新によってインターネット回線がひっ迫する可能性はありますか"><a href="#セキュリティインテリジェンスの更新によってインターネット回線がひっ迫する可能性はありますか" class="headerlink" title="セキュリティインテリジェンスの更新によってインターネット回線がひっ迫する可能性はありますか"></a>セキュリティインテリジェンスの更新によってインターネット回線がひっ迫する可能性はありますか</h3><p><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E6%9B%B4%E6%96%B0%E3%81%AB%E4%BC%B4%E3%81%86%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E7%9B%AE%E5%AE%89%E3%82%92%E6%95%99%E3%81%88%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84">セキュリティインテリジェンス更新に伴うダウンロードサイズの目安を教えてください</a> に記載の通り、定期的に更新が行われている端末では、現在適用されているバージョンと最新のセキュリティインテリジェンスの差分(デルタ)のみをダウンロードするため、セキュリティインテリジェンスの更新に伴うダウンロードサイズは最小限になります。</p><p>しかし、実際に発生する通信量やご利用中の帯域への影響については、環境やタイミングに大きく依存するため、ユーザの環境でご確認いただく必要があります。</p><p>なお、セキュリティインテリジェンスの更新によるインターネット回線のひっ迫を懸念する場合は、インターネット回線の増強や、WSUS やローカルネットワークファイル共有などの更新方法をご利用ください。</p><p>ローカルネットワークファイル共有を更新ソースとしてセキュリティインテリジェンスの更新を行う方法については、<a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%85%B1%E6%9C%89%E3%82%92%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%A8%E3%81%97%E3%81%A6%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">こちら</a> を参照してください。</p><h3 id="更新プログラムの取得元を-WSUS-に変更している場合にセキュリティインテリジェンスの更新に失敗するのはなぜですか"><a href="#更新プログラムの取得元を-WSUS-に変更している場合にセキュリティインテリジェンスの更新に失敗するのはなぜですか" class="headerlink" title="更新プログラムの取得元を WSUS に変更している場合にセキュリティインテリジェンスの更新に失敗するのはなぜですか"></a>更新プログラムの取得元を WSUS に変更している場合にセキュリティインテリジェンスの更新に失敗するのはなぜですか</h3><p>更新プログラムの取得元を WSUS に変更している環境で、設定アプリなどから Windows Update の更新プログラムのチェックを実行した際にはセキュリティインテリジェンスの更新に成功するものの、Microsoft Defender ウイルス対策のイベントログに頻繁に更新失敗のイベント(イベント ID：2001) が記録される場合、<a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%97%E3%81%8F%E3%81%BF">フォールバック順序</a> の設定が変更されていない可能性があります。</p><p>セキュリティインテリジェンスの更新元を WSUS にする場合は、以下のように <code>InternalDefinitionUpdateServer</code> をフォールバック順序に設定する必要があります。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-018.png" alt="グループポリシー：FallbackOrder"></p><h3 id="更新プログラムの取得元を-WSUS-に設定した環境で、セキュリティインテリジェンスのみ-Microsoft-Update-で取得することは可能ですか"><a href="#更新プログラムの取得元を-WSUS-に設定した環境で、セキュリティインテリジェンスのみ-Microsoft-Update-で取得することは可能ですか" class="headerlink" title="更新プログラムの取得元を WSUS に設定した環境で、セキュリティインテリジェンスのみ Microsoft Update で取得することは可能ですか"></a>更新プログラムの取得元を WSUS に設定した環境で、セキュリティインテリジェンスのみ Microsoft Update で取得することは可能ですか</h3><p>[Microsoft Update からのセキュリティインテリジェンスの更新を許可する] の設定を [有効] にすることで、自動更新の既定のサーバを WSUS などに設定している環境でも、Microsoft Defender ウイルス対策が取得するセキュリティインテリジェンスの更新ソースをインターネット上の Microsoft Update にすることが可能です。</p><p><img src="../images/Endpoint-MDAV-2023-08-17-019.png" alt="グループポリシー：ForceUpdateFromMU"></p><p>上記の設定を利用する場合、端末がインターネット経由で Microsoft Update に接続できることを事前に確認します。</p><p>また、フォールバック順序の設定にて、<code>MicrosoftUpdateServer</code> を優先する更新元に設定します。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事ではMicrosoft Defender ウイルス対策(MDAV)のセキュリティインテリジェンスの更新プログラム(定義ファイル/エンジン)の更新に関するよくある質問についておまとめいたしました。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合がありますことご了承ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では &lt;a href=&quot;https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microso</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft 365 Defender ポータルの「デバイスのインベントリ」に関するよくあるご質問</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2023-06-21/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2023-06-21/</id>
    <published>2023-06-22T06:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では、<a href="https://security.microsoft.com/">Microsoft 365 Defender ポータル</a> の「デバイスのインベントリ」に関するよくあるご質問についておまとめします。</p><p>※ 本記事の内容は 2023年 6月 21日時点の情報をものに作成しています。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E3%81%A8%E3%81%AF">デバイスのインベントリとは</a></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B">デバイスのインベントリに関するよくあるお問い合わせ</a><ul><li><a href="#%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E7%AB%AF%E6%9C%AB%E3%81%8C%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E3%81%AB%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">オンボードしていない端末がデバイスのインベントリに登録されているのはなぜですか</a></li><li><a href="#%E5%90%8C%E3%81%98%E5%90%8D%E5%89%8D%E3%81%AE%E7%AB%AF%E6%9C%AB%E3%81%8C%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E3%81%AB%E8%A4%87%E6%95%B0%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">同じ名前の端末がデバイスのインベントリに複数登録されているのはなぜですか</a></li><li><a href="#%E5%90%8C%E3%81%98%E5%90%8D%E5%89%8D%E3%81%AE%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E8%A4%87%E6%95%B0%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%A6%E3%81%97%E3%81%BE%E3%81%84%E3%81%BE%E3%81%97%E3%81%9F%E3%81%8C-MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E7%AB%AF%E6%9C%AB%E3%81%A8%E7%B4%90%E3%81%A5%E3%81%8F%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B">同じ名前のデバイスプロファイルが複数登録されてしまいましたが MDE にオンボードしている端末と紐づくデバイスプロファイルを特定することはできますか</a></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E4%B8%8A%E3%81%A7%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%82%AA%E3%83%95%E3%83%9C%E3%83%BC%E3%83%89%E3%81%8C%E5%AE%8C%E4%BA%86%E3%81%97%E3%81%9F%E3%81%A9%E3%81%86%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">デバイスのインベントリ上で端末のオフボードが完了したどうか確認する方法はありますか</a></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E3%81%8B%E3%82%89%E7%AB%AF%E6%9C%AB%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B">デバイスのインベントリから端末の情報を削除することはできますか</a></li><li><a href="#%E3%82%BB%E3%83%B3%E3%82%B5%E3%83%BC%E3%81%AE%E6%AD%A3%E5%B8%B8%E6%80%A7%E5%88%97%E3%81%AE%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%81%8C-%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96-%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E5%95%8F%E9%A1%8C%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8B">センサーの正常性列のステータスが アクティブ ではない場合どのような問題が発生していますか</a></li><li><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">ユーザによってデバイスのインベントリに表示される情報が異なるのはなぜですか</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="デバイスのインベントリとは"><a href="#デバイスのインベントリとは" class="headerlink" title="デバイスのインベントリとは"></a>デバイスのインベントリとは</h2><p>Microsoft 365 Defender ポータルの「デバイスのインベントリ」は、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint?view=o365-worldwide">Microsoft Defender for Endpoint(MDE)</a> にオンボード(登録)された端末や、MDE の <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-discovery?view=o365-worldwide">デバイス検出機能</a> によって識別されたネットワーク上の端末の情報(デバイスプロファイル)が一覧として表示されます。</p><p><img src="../images/Endpoint-MDAV-2023-06-21-01.png" alt="デバイスのインベントリ画面"></p><p>※ 画像は 2023年 6月時点のものです</p><p>デバイスのインベントリの詳細に関する最新情報ついては、以下の公開情報の記載を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/machines-view-overview?view=o365-worldwide">デバイス一覧 | Microsoft Learn</a></p><h2 id="デバイスのインベントリに関するよくあるお問い合わせ"><a href="#デバイスのインベントリに関するよくあるお問い合わせ" class="headerlink" title="デバイスのインベントリに関するよくあるお問い合わせ"></a>デバイスのインベントリに関するよくあるお問い合わせ</h2><h3 id="オンボードしていない端末がデバイスのインベントリに登録されているのはなぜですか"><a href="#オンボードしていない端末がデバイスのインベントリに登録されているのはなぜですか" class="headerlink" title="オンボードしていない端末がデバイスのインベントリに登録されているのはなぜですか"></a>オンボードしていない端末がデバイスのインベントリに登録されているのはなぜですか</h3><p>テナントで MDE の <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-discovery?view=o365-worldwide">デバイス検出機能</a> が有効化されている場合、<strong>「MDE にオンボードされた端末と同一ネットワーク上に存在する、MDE にオンボードされていない端末」</strong>の情報がデバイスのインベントリに登録される場合があります。</p><p>デバイス検出機能によって登録されたデバイスプロファイル(デバイス情報)の場合、「オンボード状態列」に「オンボードできます」や「サポートされていません」などが表示されます。</p><p>テナントでデバイス検出機能が有効化されているか否かについては、[設定]&gt;[エンドポイント]&gt;[高度な機能] より確認できます。</p><p>デバイス検出機能が有効化されている場合、以下のように [デバイスの検出] の設定がオンになります。</p><p><img src="../images/Endpoint-MDAV-2023-06-21-02.png" alt="デバイス検出機能の有効化設定"></p><p>デバイス検出機能の詳細については、以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/device-discovery?view=o365-worldwide#device-inventory">デバイス検出の概要 | Microsoft Learn</a></p><p>なお、デバイス検出機能で検出されているデバイスは、MDE にはオンボードされていないため、MDE のセキュリティ保護機能は提供されません。</p><p>つまり、MDE にオンボードされており、保護が提供されているデバイスは「オンボード状態列」に「オンボードされました」と表示されているもののみが該当します。</p><h3 id="同じ名前の端末がデバイスのインベントリに複数登録されているのはなぜですか"><a href="#同じ名前の端末がデバイスのインベントリに複数登録されているのはなぜですか" class="headerlink" title="同じ名前の端末がデバイスのインベントリに複数登録されているのはなぜですか"></a>同じ名前の端末がデバイスのインベントリに複数登録されているのはなぜですか</h3><p>MDE では、オンボードされた端末を「デバイス ID」という一意の値で管理しています。</p><p>そのため、端末名が同じでも異なるデバイス ID が割り当てられている場合には、デバイスのインベントリに同じ名前のデバイスプロファイルが複数登録される状況が発生します。</p><p>例えば、以下のような操作を実施いただいた場合には、各端末のデバイス ID が更新され、デバイスインベントリ上でデバイスプロファイルが重複して作成される場合があります。</p><ul><li>端末の所属するドメインを変更した場合</li><li>端末のコンピュータ名を変更した場合(※ 変更後の名前を持つデバイスプロファイルが新規に登録されます)</li><li>端末でクリーンインストールや、MDE オンボード前の状態にバックアップリストアを行った後に再オンボードした場合</li></ul><p>端末でデバイス ID が更新された場合、その端末はデバイスのインベントリに新規に作成されたデバイスプロファイルを紐づき、情報の連携を行います。</p><p>ご利用端末が MDE に正常にオンボードされ、情報の連携を行っているか否かを確認したい場合は以下の公開情報の手順を利用できます。</p><p>参考情報：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-01/">Microsoft Defender for Endpoint(MDE) にオンボードされたデバイスの正常性確認ポイント | Japan CSS Security Support Blog</a></p><h3 id="同じ名前のデバイスプロファイルが複数登録されてしまいましたが-MDE-にオンボードしている端末と紐づくデバイスプロファイルを特定することはできますか"><a href="#同じ名前のデバイスプロファイルが複数登録されてしまいましたが-MDE-にオンボードしている端末と紐づくデバイスプロファイルを特定することはできますか" class="headerlink" title="同じ名前のデバイスプロファイルが複数登録されてしまいましたが MDE にオンボードしている端末と紐づくデバイスプロファイルを特定することはできますか"></a>同じ名前のデバイスプロファイルが複数登録されてしまいましたが MDE にオンボードしている端末と紐づくデバイスプロファイルを特定することはできますか</h3><p>前述の通り、Microsoft 365 Defender ポータル上のデバイスプロファイルと MDE にオンボードされた端末は一意のデバイス ID 情報を用いて紐づけられており、情報連携を行っております。</p><p>そのため、MDE にオンボードした端末に割り当てられているデバイス ID 情報を調査することで、その端末と紐づくデバイスプロファイルの情報を特定することが可能です。</p><p>MDE にオンボードした端末に割り当てられているデバイス ID 情報は、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/analyzer-report?view=o365-worldwide">クライアント アナライザー HTML レポートについて</a> に記載の通り Client Analyzer ツールが出力する HTML レポートから確認できます。</p><p><img src="../images/Endpoint-MDAV-2023-06-21-04.png" alt="Client Analyzer ツールが出力する HTML レポート"></p><p>Client Analyzer ツールの取得と実行方法については以下の公開情報をご参照ください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-windows?view=o365-worldwide">Run the client analyzer on Windows | Microsoft Learn</a></p><p>また、デバイスプロファイルと紐づくデバイス ID については、以下の通り各デバイスプロファイルをクリックした詳細画面内の [概要]&gt;[デバイス ID] より確認できます。</p><p><img src="../images/Endpoint-MDAV-2023-06-21-03.png" alt="デバイスプロファイルの詳細画面"></p><h3 id="デバイスのインベントリ上で端末のオフボードが完了したどうか確認する方法はありますか"><a href="#デバイスのインベントリ上で端末のオフボードが完了したどうか確認する方法はありますか" class="headerlink" title="デバイスのインベントリ上で端末のオフボードが完了したどうか確認する方法はありますか"></a>デバイスのインベントリ上で端末のオフボードが完了したどうか確認する方法はありますか</h3><p>端末が MDE からオフボードされると、端末内では MDE との情報連携が停止いたします。</p><p>そのため、MDE のサービス側では端末の状態を確認することができなくなるため、端末がオフボードされたか否かをデバイスのインベントリ上で明確に判断することはできません。</p><p>ただし、以上の通り MDE をオフボードすると端末と MDE 間の情報連携が停止されるため、デバイスのインベントリ上の「前回のデバイス更新」などの時刻が更新されなくなります。</p><p>また、下記公開情報にてご案内しております通り、端末がオフボードされ、MDE との情報連携が停止した場合には、7 日後にデバイスのインベントリ上の「センサーの正常性状態」列の情報が「アクティブ」から「非アクティブ」切り替わります。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/offboard-machines?view=o365-worldwide">Microsoft Defender for Endpoint サービスのオフボード デバイス | Microsoft Learn</a></p><p>以上の通り、端末がオフボードされたか否かをデバイスのインベントリ上で明確に判断することはできませんが、「前回のデバイス更新」や「センサーの正常性状態」などの情報から、端末と MDE サービス間の情報連携の有無を確認することで、端末のオフボードに成功しているかどうかを判断することが可能です。</p><h3 id="デバイスのインベントリから端末の情報を削除することはできますか"><a href="#デバイスのインベントリから端末の情報を削除することはできますか" class="headerlink" title="デバイスのインベントリから端末の情報を削除することはできますか"></a>デバイスのインベントリから端末の情報を削除することはできますか</h3><p>2023 年 6 月時点ではデバイスのインベントリから端末の情報(デバイスプロファイル)を手動で削除することはできません。</p><p>以下の公開情報に記載の通り、デバイスのインベントリ上に表示されるデバイスプロファイルは、端末からの情報連携が停止して「センサーの正常性状態」が「非アクティブ」になったのち、180 日以上経過すると自動的に削除されます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/offboard-machines?view=o365-worldwide">Microsoft Defender for Endpoint サービスのオフボード デバイス | Microsoft Learn</a></p><p>デバイスのインベントリ上でオフボード済みのデバイスなどの情報を非表示にしたい場合はフィルター機能を利用できます。</p><p>フィルター機能については以下の公開情報でご案内しております。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/machines-view-overview?view=o365-worldwide#use-filters-to-customize-the-device-inventory-views">フィルターを使用してデバイス インベントリ ビューをカスタマイズする | Microsoft Learn</a></p><h3 id="センサーの正常性列のステータスが-アクティブ-ではない場合どのような問題が発生していますか"><a href="#センサーの正常性列のステータスが-アクティブ-ではない場合どのような問題が発生していますか" class="headerlink" title="センサーの正常性列のステータスが アクティブ ではない場合どのような問題が発生していますか"></a>センサーの正常性列のステータスが アクティブ ではない場合どのような問題が発生していますか</h3><p>「センサーの正常性状態」列の情報が「非アクティブ」の場合、そのデバイスプロファイルと紐づくデバイス ID を割り当てられた端末から 7 日間以上情報が連携されていないことを示します。</p><p>これは、通常以下のような要因で発生します。</p><ul><li>端末がオフボード済みで、MDE サービスとの情報連携を停止している場合</li><li>すでに端末のデバイス ID が更新されており、新規作成されたデバイスプロファイルとの情報連携を実施している場合 (<a href="#%E5%90%8C%E3%81%98%E5%90%8D%E5%89%8D%E3%81%AE%E7%AB%AF%E6%9C%AB%E3%81%8C%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%99%E3%83%B3%E3%83%88%E3%83%AA%E3%81%AB%E8%A4%87%E6%95%B0%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">同じ名前の端末がデバイスのインベントリに複数登録されているのはなぜですか</a>  を参照してください)</li><li>通信の問題などにより、端末が 7 日間以上インターネット経由で MDE のサービスと接続していない場合</li><li>端末が 7 日間以上起動しておらず、MDE サービスとの情報連携を実施していない場合</li></ul><p>また、「センサーの正常性状態」列の情報が「センサーデータなし」などの「アクティブ」以外のステータスである場合は、以下の公開情報に記載の通り端末が MDE の動作要件を満たしていないことや、MDE のサービスとの通信要件を満たしていない可能性が考えられます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/check-sensor-status?view=o365-worldwide">Microsoft Defender for Endpointでデバイスの正常性を確認する | Microsoft Learn</a></p><p>MDE にオンボードした端末のステータスに問題が発生している場合は、以下の公開情報を参照するとともに、弊社サポート窓口までお問い合わせください。</p><p>参考情報：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-01/">Microsoft Defender for Endpoint(MDE) にオンボードされたデバイスの正常性確認ポイント | Japan CSS Security Support Blog</a></p><h3 id="ユーザによってデバイスのインベントリに表示される情報が異なるのはなぜですか"><a href="#ユーザによってデバイスのインベントリに表示される情報が異なるのはなぜですか" class="headerlink" title="ユーザによってデバイスのインベントリに表示される情報が異なるのはなぜですか"></a>ユーザによってデバイスのインベントリに表示される情報が異なるのはなぜですか</h3><p>Microsoft 365 Defender ポータルでデバイスグループを作成して特定のユーザグループに割り当てを行っている場合、Microsoft 365 Defender ポータルにサインインするユーザによってデバイスのインベントリから参照できるデバイスプロファイルの種類や数が異なる場合があります。</p><p>MDE のデバイスグループについては以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/machine-groups?view=o365-worldwide">Microsoft Defender for Endpointでデバイス グループを作成および管理する | Microsoft Learn</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>この記事では、Microsoft 365 Defender ポータルのデバイスのインベントリに表示される情報に関するよくあるご質問について紹介しました。</p><p>本記事の内容は執筆時点の情報を基にしておりますので、最新情報については公開情報をご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では、&lt;a href=&quot;https://security.microsoft.com/&quot;&gt;Microsoft 365 Defender ポータル&lt;/a&gt; の「デバイスのインベントリ」に関す</summary>
      
    
    
    
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Defender for Endpoint(MDE) デバイス分離機能の解除ができない場合のトラブルシューティング</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2023-05-02/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2023-05-02/</id>
    <published>2023-05-02T09:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/respond-machine-alerts?view=o365-worldwide#isolate-devices-from-the-network">Microsoft Defender for Endpoint(MDE) のデバイス分離機能</a> を使用した環境でネットワーク隔離を解除できなくなる場合がある問題のトラブルシューティング方法ついて記載します。</p><p>※ 本記事の内容は 2023 年 5 月 2 日時点で最新の Windows 10 22H2 環境で動作確認を実施しています。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E5%88%86%E9%9B%A2%E6%A9%9F%E8%83%BD%E3%81%A8%E3%81%AF">デバイス分離機能とは</a><ul><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E5%88%86%E9%9B%A2%E6%A9%9F%E8%83%BD%E3%81%AE%E5%89%8D%E6%8F%90%E8%A6%81%E4%BB%B6%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">デバイス分離機能の前提要件について</a></li></ul></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E5%88%86%E9%9B%A2%E6%A9%9F%E8%83%BD%E3%81%AE%E3%81%97%E3%81%8F%E3%81%BF">デバイス分離機能のしくみ</a><ul><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E5%88%86%E9%9B%A2%E6%99%82%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9">デバイス分離時の注意点</a></li></ul></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%88%86%E9%9B%A2%E5%BE%8C%E3%81%AB%E8%A7%A3%E9%99%A4%E3%81%8C%E8%A1%8C%E3%81%88%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%AE%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">デバイスの分離後に解除が行えない場合のトラブルシューティング</a><ul><li><a href="#%E5%95%8F%E9%A1%8C%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E4%B8%BB%E3%81%AA%E5%8E%9F%E5%9B%A0">問題が発生する主な原因</a></li><li><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E8%A7%A3%E6%B6%88%E6%96%B9%E6%B3%95">問題の解消方法</a></li></ul></li><li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%88%86%E9%9B%A2%E5%BE%8C%E3%81%AB%E8%A7%A3%E9%99%A4%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C%E3%81%8C%E7%B6%99%E7%B6%9A%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88">デバイスの分離後に解除ができない問題が継続する場合</a></li></ul><h2 id="デバイス分離機能とは"><a href="#デバイス分離機能とは" class="headerlink" title="デバイス分離機能とは"></a>デバイス分離機能とは</h2><p>デバイス分離機能は、デバイスが侵害された可能性がある場合に、そのデバイスをネットワークから分離することでデータ流出や侵害の拡大を防ぐことができる Microsoft Defender for Endpoint(MDE) の機能です。</p><p>デバイス分離機能によるネットワーク隔離を実施すると、対象のデバイスはネットワークから論理的に切断され、 MDE サービスの稼働に必要な通信のみを行います。</p><p>また、本記事作成時点でサポートしているすべての Windows 10 および Windows 11 のデバイスでネットワーク隔離を実施する場合には、MDE サービスの稼働に必要な通信に加えて Outlook や Microsoft Teams、Skype for Business の利用する通信も許可する「選択的分離」機能を利用することも可能です。</p><p><img src="../images/Endpoint-MDAV-2023-05-02-01.png" alt="デバイス分離時のイメージ図"></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/respond-machine-alerts?view=o365-worldwide#isolate-devices-from-the-network">ネットワークからデバイスを分離する</a></p><h3 id="デバイス分離機能の前提要件について"><a href="#デバイス分離機能の前提要件について" class="headerlink" title="デバイス分離機能の前提要件について"></a>デバイス分離機能の前提要件について</h3><p>デバイス分離機能は、本記事作成時点(2023 年 5 月 2 日)では、デバイス分離機能は Windows および Linux マシンでサポートされています。</p><p>※ Linux マシンのデバイス分離機能は本記事作成時点ではパブリックプレビューとして提供しています。</p><p>また、macOS はデバイス分離機能がサポートされておりませんが、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/live-response?view=o365-worldwide">Live Response 機能</a> にてネットワーク分離のアクションを実行できます。</p><p>デバイス分離機能の最新のサポート状況や詳細な要件については以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/respond-machine-alerts?view=o365-worldwide#isolate-devices-from-the-network">ネットワークからデバイスを分離する</a></p><h2 id="デバイス分離機能のしくみ"><a href="#デバイス分離機能のしくみ" class="headerlink" title="デバイス分離機能のしくみ"></a>デバイス分離機能のしくみ</h2><p>デバイス分離機能による端末のネットワーク分離は以下のステップで実施されます。</p><p><img src="../images/Endpoint-MDAV-2023-05-02-02.png" alt="デバイス分離時の通信イメージ図"></p><ol><li><p>管理者の操作もしくはカスタム検出ルールなどによってデバイス分離が実行されると、MDE のサービスは対象の端末と通信を行い、ネットワーク分離を行います(通信 ①)</p></li><li><p>MDE サービスは端末から連携される情報を元に、端末でデバイス分離が正常に完了したかどうか特定します(通信 ②)</p></li><li><p>MDE サービス側に情報が連携されると、Microsoft 365 Defender ポータル上にて [分離から解放する] ボタンを操作できるようになります。</p></li><li><p>管理者が端末のネットワーク分離を解除すると、MDE のサービスは対象の端末と通信を行い、ネットワーク分離を解除します(通信 ③)</p></li></ol><h3 id="デバイス分離時の注意点"><a href="#デバイス分離時の注意点" class="headerlink" title="デバイス分離時の注意点"></a>デバイス分離時の注意点</h3><p>デバイス分離を行うと、MDE のサービスが使用する特定のプロセスと宛先以外の通信が拒否されます。</p><p>そのため、リモートデスクトップや SSH によるリモート接続ができなくなる点に注意します。</p><p>また、前述の通り、端末のネットワーク分離を解除するためには、MDE サービスと端末間の通信を確保する必要があります。</p><p>しかし、例えば端末のすべての通信が VPN トンネルを経由するように構成されている場合には、デバイス分離後に MDE サービスとの通信に失敗するようになり、ネットワーク分離の解除ができない問題が発生する点に注意します。</p><p>そのため、VPN 通信を行う環境で MDE のデバイス分離機能を利用する場合には、スプリットトンネリング VPN により、MDE が利用する通信先に端末が直接接続可能な構成とすることを推奨しています。</p><p><img src="../images/Endpoint-MDAV-2023-05-02-03.png" alt="VPN 環境でデバイス分離を行った場合のイメージ図"></p><p>MDE が使用する通信先については、以下リンク先からダウンロード可能な [商用顧客向けの Microsoft Defender for Endpoint の URL リスト] にてご案内しております。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#enable-access-to-microsoft-defender-for-endpoint-service-urls-in-the-proxy-server">商用顧客向けの Microsoft Defender for Endpoint の URL リスト</a></p><h2 id="デバイスの分離後に解除が行えない場合のトラブルシューティング"><a href="#デバイスの分離後に解除が行えない場合のトラブルシューティング" class="headerlink" title="デバイスの分離後に解除が行えない場合のトラブルシューティング"></a>デバイスの分離後に解除が行えない場合のトラブルシューティング</h2><h3 id="問題が発生する主な原因"><a href="#問題が発生する主な原因" class="headerlink" title="問題が発生する主な原因"></a>問題が発生する主な原因</h3><p>デバイス分離の実施後、[デバイスを分離] ボタンがグレーアウトしたままになり [分離から解放する] ボタンが表示されない問題や、[分離から解放する] 操作を行ったものの端末のネットワーク分離が解除されない問題が発生する場合があります。</p><p>このような問題は通常、何らかの理由で <a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E5%88%86%E9%9B%A2%E6%A9%9F%E8%83%BD%E3%81%AE%E3%81%97%E3%81%8F%E3%81%BF">デバイス分離機能のしくみ</a> に記載の [通信 ②] および [通信 ③] に失敗している場合に発生します。</p><p>問題の解消のためには、ネットワーク分離された端末と MDE サービスとの通信を確立する必要があるため、対象端末が起動しており、かつネットワークに接続可能な構成であることを確認します。</p><p>特に、<a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E5%88%86%E9%9B%A2%E6%99%82%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9">デバイス分離時の注意点</a> に記載の通り、端末のすべての通信が VPN トンネルを経由するように構成されている場合にも、ネットワーク分離後に MDE サービスとの通信に失敗する場合があります。</p><h3 id="問題の解消方法"><a href="#問題の解消方法" class="headerlink" title="問題の解消方法"></a>問題の解消方法</h3><p>ネットワーク分離した端末が MDE サービスに接続できる通信経路を確保いただくことで問題が解消し、デバイス分離からの解放を実施できるようになります。</p><p>MDE サービスの通信先については、以下リンク先からダウンロード可能な [商用顧客向けの Microsoft Defender for Endpoint の URL リスト] を参照します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#enable-access-to-microsoft-defender-for-endpoint-service-urls-in-the-proxy-server">商用顧客向けの Microsoft Defender for Endpoint の URL リスト</a></p><p>ご利用環境が完全な VPN トンネルを構成している場合には、上記の通信先のみ VPN トンネルを経由しないように構成を変更するか、上記の通信先に直接通信できるよう、端末の接続するネットワークを追加・もしくは変更します。</p><p>※ MDE サービスに接続できる通信経路を確保したにも関わらず問題が解消されない場合は、 OS の再起動をお試しください。</p><h2 id="デバイスの分離後に解除ができない問題が継続する場合"><a href="#デバイスの分離後に解除ができない問題が継続する場合" class="headerlink" title="デバイスの分離後に解除ができない問題が継続する場合"></a>デバイスの分離後に解除ができない問題が継続する場合</h2><p>デバイスの分離後に解除が行えない問題が継続する場合は、弊社サポート窓口までお問い合わせください。</p><p>その際、サポート担当者から [MDEClientAnalyzer.cmd -i] コマンドにより、ネットワーク関連の問題のトラブルシューティングに役立つ情報の採取をお願いする場合があります。</p><p>MDEClientAnalyzer による情報採取の詳細については以下にてご案内しております。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-windows?view=o365-worldwide">Windows でクライアントアナライザーを実行する</a></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/data-collection-analyzer?view=o365-worldwide">Windows で高度なトラブルシューティングを行うためのデータ収集</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では &lt;a href=&quot;https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/respond</summary>
      
    
    
    
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>Windows デバイスの Microsoft Defender ウイルス対策(MDAV) スケジュールスキャン設定について</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2023-02-28/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2023-02-28/</id>
    <published>2023-02-28T09:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-windows?view=o365-worldwide">Microsoft Defender ウイルス対策(MDAV)</a> のスケジュールスキャンについてまとめます。</p><p>スケジュールスキャンを構成する際の参考情報としてご利用ください。</p><p>※ 本記事の内容は 2023年 2月 28 日時点で最新の Windows 10 22H2 環境で動作確認を実施しています。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#MDAV-%E3%81%AE%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">MDAV のスケジュールスキャン設定について</a><ul><li><a href="#%E8%A8%AD%E5%AE%9A%E5%8F%AF%E8%83%BD%E3%81%AA%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">設定可能なスケジュールスキャンの種類について</a></li><li><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E7%95%99%E6%84%8F%E7%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">スケジュールスキャンに関するその他の留意点について</a></li></ul></li><li><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">グループポリシーを使用してスケジュールスキャンを構成する</a><ul><li><a href="#%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">クイックスキャンをスケジュールする</a></li><li><a href="#%E3%83%95%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">フルスキャンをスケジュールする</a></li><li><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">スケジュールスキャンに使用するスキャンの種類を変更する</a></li><li><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%97%A5%E6%99%82%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">スケジュールスキャンの実行日時を変更する</a></li><li><a href="#%E6%AF%8E%E6%97%A5%E3%81%AE%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E6%99%82%E5%88%BB%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">毎日のクイックスキャンの時刻を指定する</a></li><li><a href="#1-%E6%97%A5%E3%81%AB%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E9%96%93%E9%9A%94%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">1 日にクイックスキャンを実行する間隔を指定する</a></li></ul></li><li><a href="#Intune-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">Intune を使用してスケジュールスキャンを構成する</a><ul><li><a href="#Intune-%E3%81%A7%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">Intune でクイックスキャンをスケジュールする</a></li><li><a href="#Intune-%E3%81%A7%E3%83%95%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">Intune でフルスキャンをスケジュールする</a></li><li><a href="#%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%A8%E5%AE%9F%E8%A1%8C%E6%99%82%E5%88%BB%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">スキャンの種類と実行時刻を構成する</a></li><li><a href="#%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF-%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%99%82%E5%88%BB%E3%82%92%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">クイック スキャンの実行時刻をスケジュールする</a></li></ul></li><li><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%A8%E5%AE%9F%E8%A1%8C%E5%B1%A5%E6%AD%B4%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">スケジュールスキャンの設定と実行履歴を確認する</a><ul><li><a href="#%E7%AB%AF%E6%9C%AB%E3%81%AB%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%8C%E9%81%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">端末にスケジュールスキャンの設定が適用されていることを確認する</a></li><li><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%AD%E3%82%B0%E3%81%8B%E3%82%89%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E5%B1%A5%E6%AD%B4%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">イベントログからスケジュールスキャンの実行履歴を確認する</a></li></ul></li><li><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B">スケジュールスキャンに関するよくあるお問い合わせ</a><ul><li><a href="#Q1-%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F%E6%99%82%E5%88%BB%E3%81%AB%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%8C%E9%96%8B%E5%A7%8B%E3%81%95%E3%82%8C%E3%81%BE%E3%81%9B%E3%82%93">Q1 設定した時刻にスケジュールスキャンが開始されません</a></li><li><a href="#Q2-%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%95%E3%82%8C%E3%81%9F%E3%83%95%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB-CPU-%E4%BD%BF%E7%94%A8%E7%8E%87%E3%81%8C%E9%AB%98%E9%A8%B0%E3%81%97%E3%81%BE%E3%81%99">Q2 スケジュールされたフルスキャンの実行時に CPU 使用率が高騰します</a></li><li><a href="#Q3-%E3%83%95%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%A7%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8B">Q3 フルスキャンでネットワークドライブはスキャンされますか</a></li><li><a href="#Q4-Microsoft-365-Defender-%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB%E3%81%8B%E3%82%89%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AF%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B">Q4 Microsoft 365 Defender ポータルからスケジュールスキャンの設定はできますか</a></li><li><a href="#Q5-%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%8C%E3%82%B9%E3%82%AD%E3%83%83%E3%83%97%E3%81%95%E3%82%8C%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%9C%E3%81%A7%E3%81%99%E3%81%8B">Q5 クイックスキャンの実行がスキップされる場合があるのはなぜですか</a></li><li><a href="#Q6-%E3%82%BF%E3%82%B9%E3%82%AF%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%A9%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B">Q6 タスクスケジューラーを使用してスケジュールスキャンを構成することはできますか</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="MDAV-のスケジュールスキャン設定について"><a href="#MDAV-のスケジュールスキャン設定について" class="headerlink" title="MDAV のスケジュールスキャン設定について"></a>MDAV のスケジュールスキャン設定について</h2><p>MDAV はスケジュール設定に基づいて定期的なウイルススキャンを実行することができます。</p><p>ユーザは、スケジュール設定に基づいて実行されるスキャンの種類や実行タイミングを構成することができます。</p><p>スケジュールスキャンの設定には、グループポリシーや Intune、Power Shell コマンドレットなどを使用することが可能です。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans?view=o365-worldwide">Microsoft Defender ウイルス対策を使用して定期的なクイック スキャンとフル スキャンをスケジュールする | Microsoft Learn</a></p><h3 id="設定可能なスケジュールスキャンの種類について"><a href="#設定可能なスケジュールスキャンの種類について" class="headerlink" title="設定可能なスケジュールスキャンの種類について"></a>設定可能なスケジュールスキャンの種類について</h3><p>MDAV で設定可能なスケジュールスキャンは、大きく以下の 2 つに分類されます。</p><ul><li><strong>クイックスキャン：マルウェアが登録されている可能性のある対象をスキャンします</strong></li><li><strong>フルスキャン：端末にマウントされているドライブ内のすべてのファイルをスキャンします</strong></li></ul><p>スキャンの種類に関する詳細な情報については以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans?view=o365-worldwide#quick-scan-full-scan-and-custom-scan">クイック スキャン、フル スキャン、カスタム スキャン | Microsoft Learn</a></p><p>グループポリシーや Intune を使用してスケジュールスキャンを構成する場合、ユーザは任意のスキャンの種類を指定することができます。</p><p>ただし、MDAV のスケジュールスキャン設定項目には以下の 2 つが存在しているため、それぞれの設定項目について事前に確認しておく必要があります。</p><ol><li><p><strong>スケジュールされたクイックスキャンまたはフルスキャンに関する設定</strong></p></li><li><p><strong>スケジュールされたクイックスキャンに関する設定</strong></p></li></ol><p>[1] の設定では、クイックスキャンまたはフルスキャンのスケジュール設定を行うことが可能です。</p><p>一方で、[2] の設定ではクイックスキャンのスケジュール設定を構成できます。</p><p>上記の 2 つの設定は同時に構成することが可能であり、例えば [1] の設定にてフルスキャンを毎週日曜日の深夜にスケジュールしつつ、[2] の設定にてクイックスキャンを毎日実行させるような運用が可能です。</p><p>設定方法の詳細については以下の項目を参照してください。</p><p>参考情報：<a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">グループポリシーを使用してスケジュールスキャンを構成する</a></p><p>参考情報：<a href="#Intune-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">Intune を使用してスケジュールスキャンを構成する</a></p><h3 id="スケジュールスキャンに関するその他の留意点について"><a href="#スケジュールスキャンに関するその他の留意点について" class="headerlink" title="スケジュールスキャンに関するその他の留意点について"></a>スケジュールスキャンに関するその他の留意点について</h3><ol><li><strong>スケジュールスキャンの開始時刻に関する留意点</strong></li></ol><p>Windows マシンでは、既定で以下の設定がそれぞれ有効化されています。</p><ul><li>スケジュールされたタスクの実行時間をランダム化する</li><li>コンピュータのアイドル時にスケジュールされたタスクを実行する</li></ul><p>上記の設定が有効な場合、ユーザが構成したスケジュールスキャンが指定の時刻ちょうどに開始されない場合があります。</p><p>スケジュールされたタスクの実行時間をランダム化することやコンピュータのアイドル時にタスクを実行することは、帯域負荷の軽減などのパフォーマンスの上のメリットがありますが、スケジュールスキャンを指定の時刻ちょうどに開始する必要がある場合には、上記の 2 つの設定を無効化します。</p><p>各設定を無効化してスケジュールスキャンを指定の時刻ちょうどに開始する方法については以下の内容を参照してください。</p><p>参考情報：<a href="#Q1-%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F%E6%99%82%E5%88%BB%E3%81%AB%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%8C%E9%96%8B%E5%A7%8B%E3%81%95%E3%82%8C%E3%81%BE%E3%81%9B%E3%82%93">Q1 設定した時刻にスケジュールスキャンが開始されません</a></p><ol start="2"><li><strong>フルスキャンを実行する場合のパフォーマンス影響に関する留意点</strong></li></ol><p>スケジュールされたスキャンを構成してフルスキャンを実施する場合、スキャンの頻度や対象、スキャン時のパフォーマンス影響について留意する必要があります。</p><p>詳細については以下の項目を参照してください。</p><p>参考情報：<a href="#Q2-%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB-cpu-%E4%BD%BF%E7%94%A8%E7%8E%87%E3%81%8C%E9%AB%98%E9%A8%B0%E3%81%97%E3%81%BE%E3%81%99">Q2 スケジュールされたフルスキャンの実行時に CPU 使用率が高騰します</a></p><p>参考情報：<a href="#Q3-%E3%83%95%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%A7%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8B">Q3 フルスキャンでネットワークドライブはスキャンされますか</a></p><ol start="3"><li><strong>スケジュールスキャン設定の競合に関する留意点</strong></li></ol><p>スケジュールスキャンの設定はグループポリシーや Intune など、複数の管理ツールで構成することが可能です。</p><p>しかし、複数の管理ツールからスケジュールスキャンの設定を行う場合、設定が競合し意図しない動作となる可能性があります。</p><p>そのため、複数の管理ツールを用いてスケジュールスキャンの設定を行う場合は、重複する設定が配信されないようにご留意ください。</p><h2 id="グループポリシーを使用してスケジュールスキャンを構成する"><a href="#グループポリシーを使用してスケジュールスキャンを構成する" class="headerlink" title="グループポリシーを使用してスケジュールスキャンを構成する"></a>グループポリシーを使用してスケジュールスキャンを構成する</h2><p>Windows マシンでスケジュールスキャンを構成する場合、GPOもしくはローカルグループポリシーにて、**[管理用テンプレート]&gt;[Windows コンポーネント]&gt;[Microsoft Defender ウイルス対策]&gt;[スキャン]** 配下の設定を変更します。</p><p>※ Windows Server 2016 の場合は、<code>[Microsoft Defender ウイルス対策]</code>ではなく<code>[Endpoint Protection]</code>の設定を変更します。</p><p>一般的によく使用される設定項目について以下に記載します。</p><p>なお、グループポリシーを使用してスケジュールスキャンを構成する方法の詳細については、以下の公開情報の記載を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans-group-policy?view=o365-worldwide#configure-antivirus-scans-using-group-policy">グループ ポリシーを使用してウイルス対策スキャンをスケジュールする | Microsoft Learn</a></p><h3 id="クイックスキャンをスケジュールする"><a href="#クイックスキャンをスケジュールする" class="headerlink" title="クイックスキャンをスケジュールする"></a>クイックスキャンをスケジュールする</h3><p>クイックスキャンの実行をスケジュールする場合、ユーザは以下の 3 つの設定を使用することができます。</p><ul><li><p><strong><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">スケジュールスキャンに使用するスキャンの種類を変更する</a></strong></p></li><li><p><strong><a href="#%E6%AF%8E%E6%97%A5%E3%81%AE%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E6%99%82%E5%88%BB%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">毎日のクイックスキャンの時刻を指定する</a></strong></p></li><li><p><strong><a href="#1-%E6%97%A5%E3%81%AB%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E9%96%93%E9%9A%94%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">1 日にクイックスキャンを実行する間隔を指定する</a></strong></p></li></ul><p>これらの 3 つの設定は同時に構成することも可能です。</p><p>詳細については、各設定項目の記載を参照してください。</p><h3 id="フルスキャンをスケジュールする"><a href="#フルスキャンをスケジュールする" class="headerlink" title="フルスキャンをスケジュールする"></a>フルスキャンをスケジュールする</h3><p>フルスキャンの実行をスケジュールする場合、ユーザは以下の設定を使用することができます。</p><ul><li><strong><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">スケジュールスキャンに使用するスキャンの種類を変更する</a></strong></li></ul><p>また、上記の設定は以下のクイックスキャンの設定と同時に構成することも可能です。</p><ul><li><p><strong><a href="#%E6%AF%8E%E6%97%A5%E3%81%AE%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E6%99%82%E5%88%BB%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">毎日のクイックスキャンの時刻を指定する</a></strong></p></li><li><p><strong><a href="#1-%E6%97%A5%E3%81%AB%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E9%96%93%E9%9A%94%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">1 日にクイックスキャンを実行する間隔を指定する</a></strong></p></li></ul><p>詳細については、各設定項目の記載を参照してください。</p><h3 id="スケジュールスキャンに使用するスキャンの種類を変更する"><a href="#スケジュールスキャンに使用するスキャンの種類を変更する" class="headerlink" title="スケジュールスキャンに使用するスキャンの種類を変更する"></a>スケジュールスキャンに使用するスキャンの種類を変更する</h3><p>スケジュールスキャンに使用する「スキャンの種類」を変更する場合、[スキャン]&gt;[スケジュールされたスキャンに使用するスキャンの種類を指定する] を [有効] に変更し、「クイックスキャン」または「フルシステムスキャン」のいずれかを選択します。</p><p><img src="../images/Endpoint-MDAV-2023-02-28-01.png" alt="Endpoint-MDAV-2023-02-28-01"></p><h3 id="スケジュールスキャンの実行日時を変更する"><a href="#スケジュールスキャンの実行日時を変更する" class="headerlink" title="スケジュールスキャンの実行日時を変更する"></a>スケジュールスキャンの実行日時を変更する</h3><p>スケジュールスキャンの実行日時を変更する場合、以下の 2 つの設定を変更します。</p><ol><li><p><strong>[スキャン]&gt;[スケジュールされたスキャンを実行する曜日を指定する]</strong></p></li><li><p><strong>[スキャン]&gt;[スケジュールされたスキャンを実行する時刻を指定する]</strong></p></li></ol><p>特に、[スケジュールされたスキャンを実行する曜日を指定する] には既定で [(0x8) 実行しない] が設定されているため、この設定を用いてスケジュールスキャンを構成する場合は必ず変更する必要があります。</p><p>また、スケジュールスキャンの時刻については午前 0 時からの分数でスケジュールされます。</p><p>120 が設定された場合は午前 2 時、780 が設定された場合は午後 1 時のようにスケジュールを設定できます。</p><p>詳細な設定方法については 以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans-group-policy?view=o365-worldwide#group-policy-settings-for-scheduling-scans">スキャンのスケジュール設定 | Microsoft Learn</a></p><h3 id="毎日のクイックスキャンの時刻を指定する"><a href="#毎日のクイックスキャンの時刻を指定する" class="headerlink" title="毎日のクイックスキャンの時刻を指定する"></a>毎日のクイックスキャンの時刻を指定する</h3><p>スケジュールされたクイックスキャンを設定する場合、[スキャン]&gt;[毎日のクイックスキャンの時刻を指定する] の設定を使用することができます。</p><p>この設定では、午前 0 時からの分数でスケジュールを構成できます。</p><p>120 が設定された場合は午前 2 時、780 が設定された場合は午後 1 時のようにスケジュールを設定できます。</p><p>詳細な設定方法については 以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans-group-policy?view=o365-worldwide#group-policy-settings-for-scheduling-daily-scans">毎日のスキャンをスケジュールするためのグループ ポリシー設定 | Microsoft Learn</a></p><h3 id="1-日にクイックスキャンを実行する間隔を指定する"><a href="#1-日にクイックスキャンを実行する間隔を指定する" class="headerlink" title="1 日にクイックスキャンを実行する間隔を指定する"></a>1 日にクイックスキャンを実行する間隔を指定する</h3><p>1 日に実行するクイックスキャンの間隔を設定する場合、[スキャン]&gt;[1 日にクイックスキャンを実行する間隔を指定する] の設定を使用することができます。</p><p>この設定は [スケジュールされたスキャンを実行する時刻を指定する] や [毎日のクイックスキャンの時刻を指定する] の設定と同時に構成することが可能です。</p><p>この設定では、1 日のクイックスキャンの実行間隔を 1 時間から 24 時間の範囲で設定できます。</p><p><img src="../images/Endpoint-MDAV-2023-02-28-02.png" alt="Endpoint-MDAV-2023-02-28-02"></p><p>この設定でスケジュールされたクイックスキャンは、起点となるスケジュールスキャンが実行されてからの間隔でトリガーされます。</p><p>起点となるクイックスキャンは、例えば [1 日にクイックスキャンを実行する間隔を指定する] の設定を変更した直後や、シャットダウンされていた端末を起動したタイミングなどで実行される場合があります。</p><p>詳細な設定方法については 以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans-group-policy?view=o365-worldwide#group-policy-settings-for-scheduling-daily-scans">毎日のスキャンをスケジュールするためのグループ ポリシー設定 | Microsoft Learn</a></p><h2 id="Intune-を使用してスケジュールスキャンを構成する"><a href="#Intune-を使用してスケジュールスキャンを構成する" class="headerlink" title="Intune を使用してスケジュールスキャンを構成する"></a>Intune を使用してスケジュールスキャンを構成する</h2><p>Intune からスケジュールスキャンの開始時刻を設定する場合、**[エンドポイントセキュリティ]&gt;[ウイルス対策] から作成可能な [Microsoft Defender ウイルス対策] ポリシー**や、構成プロファイルから作成可能な [管理用テンプレート] ポリシーを使用することが可能です。</p><p>[管理用テンプレート] ポリシーを利用する場合は、<a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">グループポリシーを使用してスケジュールスキャンを構成する</a>の記載を参照し、対応するポリシーを構成します。</p><p>[Microsoft Defender ウイルス対策] ポリシーを使用する場合は、以下の項目を参照してください。</p><p>※ [Microsoft Defender ウイルス対策] ポリシーを構成する場合、プラットフォームは [Windows 10、Windows 11、Windows Server] を選択します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/mem/Intune/protect/endpoint-security-antivirus-policy">Microsoft Intuneでエンドポイント セキュリティ ポリシーを使用してウイルス対策設定を管理する | Microsoft Learn</a></p><h3 id="Intune-でクイックスキャンをスケジュールする"><a href="#Intune-でクイックスキャンをスケジュールする" class="headerlink" title="Intune でクイックスキャンをスケジュールする"></a>Intune でクイックスキャンをスケジュールする</h3><p>Intune からクイックスキャンをスケジュールする場合、[Microsoft Defender ウイルス対策] ポリシーの以下の設定を使用することが可能です。</p><ul><li><p><a href="#%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%A8%E5%AE%9F%E8%A1%8C%E6%99%82%E5%88%BB%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">スキャンの種類と実行時刻を構成する</a></p></li><li><p><a href="#%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF-%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%99%82%E5%88%BB%E3%82%92%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">クイック スキャンの実行時刻をスケジュールする</a></p></li></ul><p>上記の設定は同時に構成することが可能です。</p><h3 id="Intune-でフルスキャンをスケジュールする"><a href="#Intune-でフルスキャンをスケジュールする" class="headerlink" title="Intune でフルスキャンをスケジュールする"></a>Intune でフルスキャンをスケジュールする</h3><p>Intune からクイックスキャンをスケジュールする場合、[Microsoft Defender ウイルス対策] ポリシーの以下の設定を使用することが可能です。</p><ul><li><a href="#%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%A8%E5%AE%9F%E8%A1%8C%E6%99%82%E5%88%BB%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">スキャンの種類と実行時刻を構成する</a></li></ul><p>上記の設定は、<a href="#%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF-%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%99%82%E5%88%BB%E3%82%92%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">クイック スキャンの実行時刻をスケジュールする</a>と同時に構成することが可能です。</p><h3 id="スキャンの種類と実行時刻を構成する"><a href="#スキャンの種類と実行時刻を構成する" class="headerlink" title="スキャンの種類と実行時刻を構成する"></a>スキャンの種類と実行時刻を構成する</h3><p>Intune の [Microsoft Defender ウイルス対策] ポリシーを使用してクイックスキャンもしくはフルスキャンを構成する場合、以下の設定を変更します。</p><ul><li><strong>スキャンパラメーター(ScanParameter)</strong></li><li><strong>スキャンの実行日をスケジュールする(ScheduleScanDay)</strong></li><li><strong>スキャンの実行時刻をスケジュールする(ScheduleScanTime)</strong></li></ul><p>例えば、以下は毎日午前 2 時にフルスキャンの実行をスケジュールするポリシーの例です。</p><p><img src="../images/Endpoint-MDAV-2023-02-28-03.png" alt="Endpoint-MDAV-2023-02-28-03"></p><p>スキャンパラメーター(ScanParameter)の設定はクイックスキャンまたはフルスキャンのいずれかを選択することが可能です。</p><p>各設定項目の詳細については、以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-Defender">Defender Policy CSP - Windows Client Management | Microsoft Learn</a></p><h3 id="クイック-スキャンの実行時刻をスケジュールする"><a href="#クイック-スキャンの実行時刻をスケジュールする" class="headerlink" title="クイック スキャンの実行時刻をスケジュールする"></a>クイック スキャンの実行時刻をスケジュールする</h3><p>Intune  の [Microsoft Defender ウイルス対策] ポリシーを使用してクイックスキャンを構成する場合、以下の設定を変更します。</p><ul><li><strong>クイックスキャンの実行時刻のスケジュール(ScheduleQuickScanTime)</strong></li></ul><p>例えば、以下は毎日午前 2 時にクイックスキャンの実行をスケジュールするポリシーの例です。</p><p><img src="../images/Endpoint-MDAV-2023-02-28-04.png" alt="Endpoint-MDAV-2023-02-28-04"></p><p>この設定は、<a href="#%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%A8%E5%AE%9F%E8%A1%8C%E6%99%82%E5%88%BB%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">スキャンの種類と実行時刻を構成する</a>で構成したクイックスキャンまたはフルスキャンの設定と同時に構成することができます。</p><p>設定項目の詳細については、以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-Defender">Defender Policy CSP - Windows Client Management | Microsoft Learn</a></p><h2 id="スケジュールスキャンの設定と実行履歴を確認する"><a href="#スケジュールスキャンの設定と実行履歴を確認する" class="headerlink" title="スケジュールスキャンの設定と実行履歴を確認する"></a>スケジュールスキャンの設定と実行履歴を確認する</h2><h3 id="端末にスケジュールスキャンの設定が適用されていることを確認する"><a href="#端末にスケジュールスキャンの設定が適用されていることを確認する" class="headerlink" title="端末にスケジュールスキャンの設定が適用されていることを確認する"></a>端末にスケジュールスキャンの設定が適用されていることを確認する</h3><p>MDAV が稼働する Windows マシンで Power Shell を起動して<code>Get-MpPreference</code>コマンドレットを実行することで、端末に適用されているスケジュールスキャンの設定を確認することが可能です。</p><p>各設定項目と出力結果の対応について以下に記載します。</p><ul><li><strong>グループポリシーを使用してスケジュールスキャンを構成する場合</strong></li></ul><table><thead><tr><th align="center">Get-MpPreference</th><th align="center">グループポリシーの設定項目</th></tr></thead><tbody><tr><td align="center">ScanParameters</td><td align="center">スケジュールされたスキャンに使用するスキャンの種類を指定する</td></tr><tr><td align="center">ScanScheduleTime</td><td align="center">スケジュールされたスキャンを実行する時刻を指定する(24 時間表記)</td></tr><tr><td align="center">ScanScheduleOffset</td><td align="center">スケジュールされたスキャンを実行する時刻を指定する(分数)</td></tr><tr><td align="center">ScanScheduleDay</td><td align="center">スケジュールされたスキャンを実行する曜日を指定する</td></tr><tr><td align="center">ScanScheduleQuickScanTime</td><td align="center">毎日のクイックスキャンの時刻を指定する</td></tr></tbody></table><p>※ [1 日にクイックスキャンを実行する間隔を指定する] の設定値は<code>Get-MpPreference</code>コマンドレットの出力結果に含まれませんが、 レジストリキー [HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\Scan\QuickScanInterval] から設定値を確認できます。</p><ul><li><strong>Intune を使用してスケジュールスキャンを構成する場合</strong></li></ul><table><thead><tr><th align="center">Get-MpPreference</th><th align="center">Intune ポリシーの設定項目</th></tr></thead><tbody><tr><td align="center">ScanParameters</td><td align="center">スキャンパラメーター</td></tr><tr><td align="center">ScanScheduleTime</td><td align="center">スキャンの実行時刻をスケジュールする(24 時間表記)</td></tr><tr><td align="center">ScanScheduleTime</td><td align="center">スキャンの実行時刻をスケジュールする(分数)</td></tr><tr><td align="center">ScanScheduleDay</td><td align="center">スキャンの実行日をスケジュールする</td></tr><tr><td align="center">ScanScheduleQuickScanTime</td><td align="center">クイックスキャンの実行時刻のスケジュール</td></tr></tbody></table><h3 id="イベントログからスケジュールスキャンの実行履歴を確認する"><a href="#イベントログからスケジュールスキャンの実行履歴を確認する" class="headerlink" title="イベントログからスケジュールスキャンの実行履歴を確認する"></a>イベントログからスケジュールスキャンの実行履歴を確認する</h3><p>MDAV のスケジュールスキャンの実行履歴はイベントログから確認することが可能です。</p><p>イベントログを参照するには、イベントビューアを起動し、[アプリケーションとサービスログ]&gt;[Microsoft]&gt;[Windows]&gt;[Windows Defender]&gt;[Operational] を開きます。</p><p><img src="../images/Endpoint-MDAV-2023-02-28-05.png" alt="Endpoint-MDAV-2023-02-28-05"></p><p>スケジュールスキャンの実行に関するイベント情報は以下の通りです。</p><table><thead><tr><th align="center">イベント ID</th><th align="center">イベントメッセージ</th></tr></thead><tbody><tr><td align="center">1000</td><td align="center">Microsoft Defender ウイルス対策スキャンが開始されました</td></tr><tr><td align="center">1001</td><td align="center">Microsoft Defender ウイルス対策スキャンが完了しました</td></tr><tr><td align="center">1002</td><td align="center">Microsoft Defender ウイルス対策スキャンが完了する前に停止しました</td></tr><tr><td align="center">1003</td><td align="center">Microsoft Defender ウイルス対策スキャンが一時停止されました</td></tr><tr><td align="center">1004</td><td align="center">Microsoft Defender ウイルス対策スキャンが再開されました</td></tr><tr><td align="center">1005</td><td align="center">Microsoft Defender ウイルス対策スキャンに失敗しました</td></tr></tbody></table><p>詳細およびその他のイベントについては以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide">Microsoft Defender ウイルス対策イベントの ID とエラー コード | Microsoft Learn</a></p><h2 id="スケジュールスキャンに関するよくあるお問い合わせ"><a href="#スケジュールスキャンに関するよくあるお問い合わせ" class="headerlink" title="スケジュールスキャンに関するよくあるお問い合わせ"></a>スケジュールスキャンに関するよくあるお問い合わせ</h2><p>MDAV でスケジュールスキャンを構成する場合のよくあるお問い合わせについて記載します。</p><h3 id="Q1-設定した時刻にスケジュールスキャンが開始されません"><a href="#Q1-設定した時刻にスケジュールスキャンが開始されません" class="headerlink" title="Q1 設定した時刻にスケジュールスキャンが開始されません"></a>Q1 設定した時刻にスケジュールスキャンが開始されません</h3><p>スケジュールされたスキャンは、端末側のシステム時間に従って開始されます。</p><p>そのため、例えばシステムの時刻設定が UTC や JST(UTC+9) である端末にてそれぞれ同一のスケジュール設定を行った場合には、スケジュールスキャンの開始時刻に差異が発生する点に留意してください。</p><p>また、Windows マシンでは、既定で以下の設定がそれぞれ有効化されています。</p><ul><li><strong>スケジュールされたタスクの実行時間をランダム化する</strong></li><li><strong>コンピュータのアイドル時にスケジュールされたタスクを実行する</strong></li></ul><p>上記の設定が有効な場合、ユーザが構成したスケジュールスキャンが指定の時刻ちょうどに開始されない場合があります。</p><p>スケジュールされたタスクの実行時間をランダム化することやコンピュータのアイドル時にタスクを実行することは、帯域負荷の軽減などのパフォーマンスの上のメリットがありますが、スケジュールスキャンを指定の時刻ちょうどに開始する必要がある場合には、上記の 2 つの設定を無効化します。</p><p>上記の設定はグループポリシーまたは Intune の構成プロファイルから設定変更が可能です。</p><ul><li><strong>グループポリシーから設定を変更する場合</strong></li></ul><p>GPOもしくはローカルグループポリシーにて、 [管理用テンプレート]&gt;[Windows コンポーネント] 内の以下の 2 つのポリシー設定を変更します。</p><ol><li>[Microsoft Defender ウイルス対策]&gt;[スケジュールされたタスクの実行時間をランダム化する]</li><li>[Microsoft Defender ウイルス対策]&gt;[スキャン]&gt;[コンピュータのアイドル時にスケジュールされたタスクを実行する]</li></ol><p>※ Windows Server 2016 の場合は、<code>[Microsoft Defender ウイルス対策]</code>ではなく<code>[Endpoint Protection]</code>以下の設定を変更します。</p><ul><li><strong>Intune の構成プロファイルから設定を変更する場合</strong></li></ul><p>Intune から設定を変更する場合、プラットフォームを [Windows 10 以降] に設定し、[テンプレート]&gt;[管理用テンプレート] の構成プロファイルを新規に作成します。</p><p>構成プロファイルの設定から [コンピュータの構成]&gt;[Windows コンポーネント] 内の以下の 2 つのポリシー設定を変更し、デバイスに適用します。</p><ol><li>[Microsoft Defender ウイルス対策]&gt;[スケジュールされたタスクの実行時間をランダム化する]</li><li>[Microsoft Defender ウイルス対策]&gt;[スキャン]&gt;[コンピュータのアイドル時にスケジュールされたタスクを実行する]</li></ol><h3 id="Q2-スケジュールされたフルスキャンの実行時に-CPU-使用率が高騰します"><a href="#Q2-スケジュールされたフルスキャンの実行時に-CPU-使用率が高騰します" class="headerlink" title="Q2 スケジュールされたフルスキャンの実行時に CPU 使用率が高騰します"></a>Q2 スケジュールされたフルスキャンの実行時に CPU 使用率が高騰します</h3><p>フルスキャンはデバイスにマウントされているすべてのディスク領域をスキャンするため、環境によってはスキャンの完了までに数時間から数日以上を要する場合があります。</p><p>また、フルスキャンの実行時には多くのシステムリソースを消費します。</p><p>そのため、一般的にはフルスキャンの実行をスケジュールし、高頻度で運用することは推奨しておりません。</p><p>詳細については以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans?view=o365-worldwide#quick-scan-full-scan-and-custom-scan">クイック スキャン、フル スキャン、カスタム スキャン | Microsoft Learn</a></p><p>なお、[コンピュータのアイドル時にスケジュールされたタスクを実行する] 設定を無効化している場合には、端末で構成されているスケジュールスキャン時の CPU 使用率の上限設定に従ってスキャンを行います。</p><p>スケジュールされたフルスキャンまたはクイックスキャンの実行時に MDAV が使用する CPU 使用率は既定で 50 % を上限に設定されています。</p><p>この設定はグループポリシーまたは Intune の [Microsoft Defender ウイルス対策] ポリシーから変更することが可能です。</p><ul><li><strong>グループポリシー：[Microsoft Defender ウイルス対策]&gt;[スキャン]&gt;[スキャン中の最大 CPU 使用率を指定する]</strong></li><li><strong>Intune ポリシー：平均 CPU 占有率(AvgCPULoadFactor)</strong></li></ul><p>なお、ScanAvgCPULoadFactor による CPU 使用率の上限設定は、システム全体ではなく、MDAV のスケジュールスキャンに対してのみ適用されます。</p><p>そのため、スキャン中のシステム全体の CPU 使用率は設定した値より大きくなる場合があります。</p><p>また、 スキャン中の CPU 使用率の上限設定を小さくする場合には、スキャンに要する時間が長くなる点にご留意ください。</p><h3 id="Q3-フルスキャンでネットワークドライブはスキャンされますか"><a href="#Q3-フルスキャンでネットワークドライブはスキャンされますか" class="headerlink" title="Q3 フルスキャンでネットワークドライブはスキャンされますか"></a>Q3 フルスキャンでネットワークドライブはスキャンされますか</h3><p>既定では、MDAV はフルスキャン時にマップされたネットワークドライブをスキャンしません。</p><p>ただし、端末内にショートカットやシンボリックリンクを介してネットワークドライブ内のパスを参照するリソースが存在する場合には、ネットワークドライブ内のファイルがスキャンされる場合があります。</p><p>フルスキャンの実行時にマップされたネットワークドライブをスキャンしたい場合は、グループポリシーまたは Intune の [Microsoft Defender ウイルス対策] ポリシーから以下の設定を有効化します。</p><ul><li><strong>グループポリシー：[Microsoft Defender ウイルス対策]&gt;[スキャン]&gt;[マップされたネットワークドライブでフルスキャンを実行する]</strong></li><li><strong>Intune ポリシー：マップされたネットワークドライブのフルスキャンを許可する(AllowFullScanOnMappedNetworkDrives)</strong></li></ul><p>なお、上記の設定を有効化した環境でフルスキャン時にスキャンされるネットワークドライブは、システムレベルでマップされているネットワークドライブが対象になります。</p><p>ユーザレベルでマップされたネットワークドライブ(ユーザが自分のセッション内で独自の資格情報を使用して手動でマッピングしたドライブ)については対象に含まれません。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-advanced-scan-types-microsoft-defender-antivirus?view=o365-worldwide#scanning-mapped-network-drives">マップされたネットワーク ドライブのスキャン | Microsoft Learn</a></p><p>フルスキャンの実行時にネットワークドライブ内のファイルがスキャンされることを抑制する場合には、[マップされたネットワークドライブでフルスキャンを実行する] 設定に加えて以下の設定を無効化する必要があります。</p><ul><li><strong>グループポリシー：[Microsoft Defender ウイルス対策]&gt;[スキャン]&gt;[ネットワークファイルをスキャンする]</strong></li><li><strong>Intune ポリシー：ネットワークファイルのスキャンを許可する(AllowScanningNetworkFiles)</strong></li></ul><!-- ※ 弊社では [ネットワークファイルをスキャンする] 設定を無効化することは推奨しておらず、システムで[改ざん防止機能](https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide)を有効化している場合には、無効化設定は適用されない点にご留意ください。--><h3 id="Q4-Microsoft-365-Defender-ポータルからスケジュールスキャンの設定はできますか"><a href="#Q4-Microsoft-365-Defender-ポータルからスケジュールスキャンの設定はできますか" class="headerlink" title="Q4 Microsoft 365 Defender ポータルからスケジュールスキャンの設定はできますか"></a>Q4 Microsoft 365 Defender ポータルからスケジュールスキャンの設定はできますか</h3><p>Microsoft Defender for Endpoint(MDE) を使用しているデバイスの場合、Microsoft 365 Defender ポータルにデバイス情報が登録されますが、Microsoft 365 Defender ポータルから Windows マシンのスケジュールスキャンを構成することはできません。</p><p>※ 上記は本記事執筆時点(2023 年 2 月)の情報です。最新の情報については <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/?view=o365-worldwide">Microsoft Defender for Endpoint ドキュメント | Microsoft Learn</a> を参照してください。</p><h3 id="Q5-クイックスキャンの実行がスキップされる場合があるのはなぜですか"><a href="#Q5-クイックスキャンの実行がスキップされる場合があるのはなぜですか" class="headerlink" title="Q5 クイックスキャンの実行がスキップされる場合があるのはなぜですか"></a>Q5 クイックスキャンの実行がスキップされる場合があるのはなぜですか</h3><p>MDAV ではパフォーマンスの最適化のため、状況によってスケジュールされたクイックスキャンの実行をスキップする場合があります。</p><p>詳細については以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans?view=o365-worldwide#scheduled-quick-scan-performance-optimization">スケジュールされたクイック スキャンのパフォーマンスの最適化 | Microsoft Learn</a></p><h3 id="Q6-タスクスケジューラーを使用してスケジュールスキャンを構成することはできますか"><a href="#Q6-タスクスケジューラーを使用してスケジュールスキャンを構成することはできますか" class="headerlink" title="Q6 タスクスケジューラーを使用してスケジュールスキャンを構成することはできますか"></a>Q6 タスクスケジューラーを使用してスケジュールスキャンを構成することはできますか</h3><p>タスクスケジューラーを使用してユーザがスケジュールスキャンを構成することは非推奨です。</p><p>ユーザがスケジュールスキャンを構成する場合、グループポリシーや Intune、Power Shell コマンドレットや Windows Management Instrumentation(WMI) を利用できます。</p><p>Power Shell コマンドレットや Windows Management Instrumentation(WMI) の使用については以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans-powershell?view=o365-worldwide">PowerShell を使用してウイルス対策スキャンをスケジュールする | Microsoft Learn</a></p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/schedule-antivirus-scans-wmi?view=o365-worldwide">Windows Management Instrumentation を使用してウイルス対策スキャンをスケジュールする | Microsoft Learn</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>この記事では、Windows のデバイスでスケジュールスキャンを構成する主な手順とよくあるお問い合わせについてご紹介しました。</p><p>なお、本記事の内容は執筆時点の情報を基にしておりますので、MDAV のスキャンに関する最新情報については公開情報をご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では &lt;a href=&quot;https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microso</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Defender for Endpoint(MDE) にオンボードされたデバイスをイメージ化・複製する場合の注意事項</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-15/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-15/</id>
    <published>2022-11-16T09:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.153Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint">Microsoft Defender for Endpoint(MDE)</a>にオンボードされたデバイスをイメージ化して展開したり、複製する場合に実施いただく必要がある手順と注意事項についてまとめます。</p><p>この手順は、主に以下の例に挙げるシナリオで重要になる場合があります。</p><ul><li><strong>MDE にオンボードしたことがあるデバイスをイメージ化し、複数のマシンに展開して使用する場合</strong></li><li><strong>MDE にオンボードしたことがあるデバイスをゴールデン イメージとして VDI にデプロイする場合</strong></li><li><strong>MDE にオンボードしたことがあるデバイスにて、ホスト名やドメイン名の変更を伴う構成変更を実施する場合</strong></li><li><strong>MDE にオンボードしたことがあるデバイスにて、Sysprep ツールなどによる一般化を行った場合</strong></li><li><strong>MDE にオンボード済みの仮想マシンをクローンする場合</strong></li></ul><h2 id="MDE-にオンボードしたデバイスをイメージ化する場合の留意事項"><a href="#MDE-にオンボードしたデバイスをイメージ化する場合の留意事項" class="headerlink" title="MDE にオンボードしたデバイスをイメージ化する場合の留意事項"></a>MDE にオンボードしたデバイスをイメージ化する場合の留意事項</h2><p>Microsoft は、お客様の環境を保護するために、セキュリティの強化に継続して取り組んでいます。</p><p>Microsoft Defender は、悪意ある攻撃者によるクライアントのなりすましを防止するために、不審な通信を検出するセキュリティ対策機能をご用意いたしております。(<a href="#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1%EF%BC%9AMicrosoft-Defender-%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E5%BC%B7%E5%8C%96%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">参考情報：Microsoft Defender のセキュリティ強化について</a>)</p><p>ここで、MDE にオンボードしたデバイスをイメージ化して展開したり複製したりする場合、展開されたデバイスの通信が、疑わしいクライアント通信として MDE に検出される問題が発生する既知の制限事項があります。</p><p>そのため、MDE にオンボードしたデバイスをイメージ化いただく場合には、以下の手順にて MDE のオフボードと端末情報の削除を実施いただく必要があります。</p><p>※ すでに MDE からオフボード済みのデバイスをイメージ化する場合にも以下の手順を実施する必要があります。</p><p>※ 以下の手順を実施せずにデバイスを複製いただいた場合、ご利用環境で問題が発生した場合の復旧に時間を要する可能性がありますこと、ご留意くださいますようお願いいたします。</p><p>※ 仮想デスクトップインフラストラクチャ (VDI) 用のイメージを作成いただく場合は、  <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-endpoints-vdi?view=o365-worldwide#updating-virtual-desktop-infrastructure-vdi-images-persistent-or-non-persistent">非永続的な仮想デスクトップ インフラストラクチャ (VDI) デバイスのオンボード</a> の記載も併せてご参照ください。</p><h2 id="デバイスのオフボードと端末情報の削除手順"><a href="#デバイスのオフボードと端末情報の削除手順" class="headerlink" title="デバイスのオフボードと端末情報の削除手順"></a>デバイスのオフボードと端末情報の削除手順</h2><h3 id="Windows-OS-を-MDE-からオフボードして情報を削除する"><a href="#Windows-OS-を-MDE-からオフボードして情報を削除する" class="headerlink" title="Windows OS を MDE からオフボードして情報を削除する"></a>Windows OS を MDE からオフボードして情報を削除する</h3><p>Windows OS を MDE からオフボードして情報を削除する場合は以下の手順を実施します。</p><ol><li><strong>以下の公開情報で案内しているいずれかの手順を使用してデバイスを MDE からオフボードします。</strong></li></ol><p>※ すでにデバイスがオフボードされている場合、この手順をスキップします。</p><ul><li>手順1：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-endpoints-script?view=o365-worldwide#offboard-devices-using-a-local-script">ローカル スクリプトを使用してデバイスをオフボードする | Microsoft Learn</a></li><li>手順2：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-endpoints-gp?view=o365-worldwide#offboard-devices-using-group-policy">グループ ポリシーを使用してデバイスをオフボードする | Microsoft Learn</a></li><li>手順3：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-endpoints-mdm?view=o365-worldwide#offboard-devices-using-mobile-device-management-tools">モバイル デバイス管理ツールを使用してデバイスをオフボードする | Microsoft Learn</a></li></ul><ol start="2"><li><strong>デバイスのオフボード完了後、コマンドプロンプトで以下のコマンドを実行し、 sense のサービスが停止していることを確認します。</strong></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sc</span> query sense</span><br></pre></td></tr></table></figure><p>デバイスが正常にオフボードされ、サービスが停止している場合、以下の出力例のように [STATE] 行に [STOPPED] と表示されます。</p><p><img src="../images/Endpoint-MDAV-2022-11-15-01.png" alt="sense サービスが停止している場合の出力結果"></p><ol start="3"><li><p><strong><a href="https://download.sysinternals.com/files/PSTools.zip">https://download.sysinternals.com/files/PSTools.zip</a> から、PsExec.exe ツールをダウンロードし、展開します。</strong></p></li><li><p><strong>管理者権限でコマンドプロンプトを起動し、PsExec.exe ツールを使用して以下のコマンドを実行します。</strong></p></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PsExec.exe <span class="literal">-s</span> cmd.exe</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>[4.] の手順により SYSTEM アカウントで起動したコマンドプロンプト画面にて、以下のコマンドを順に実行します。</strong></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\ProgramData\Microsoft\Windows Defender Advanced Threat Protection\Cyber&quot;</span></span><br><span class="line"><span class="built_in">del</span> *.* /f /s /q</span><br><span class="line">REG DELETE <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection&quot;</span> /v senseGuid /f</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure><p>※ 誤ったファイルやレジストリキーを削除しないようご留意ください。また、事前にバックアップを取得いただくことを推奨いたします。</p><ol start="8"><li><strong>ダウンロードした PsExec.exe ツールを含むファイルを必要に応じて削除し、OS を再起動します。</strong></li></ol><p>以上が、MDE にオンボードしたデバイスをイメージ化または複製いただく前に実施いただく必要のある作業です。</p><p>なお、本記事の内容は、作成時点でのものであり、予告なく変更される場合があります。</p><p>MDE にオンボードしたデバイスのイメージ化や複製についてのご不明点については、弊社サポート窓口までお問い合わせください。</p><h2 id="参考情報：Microsoft-Defender-のセキュリティ強化について"><a href="#参考情報：Microsoft-Defender-のセキュリティ強化について" class="headerlink" title="参考情報：Microsoft Defender のセキュリティ強化について"></a>参考情報：Microsoft Defender のセキュリティ強化について</h2><p>Microsoft は、2022 年 3 月に <a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23278">CVE-2022-23278</a> に対処する更新プログラムをリリースしました。</p><p>この更新プログラムは、悪意のある攻撃者がクライアントになりすましをして、クラウド上の MDE サービスと接続を行う攻撃に対するセキュリティを強化します。</p><p>このセキュリティ強化には、クラウド上の MDE サービスに対する疑わしいクライアント通信を検出する機能が含まれます。このような疑わしいクライアント通信は、デバイスのなりすましや重複したデバイス ID が原因で発生する可能性があります。</p><p>参考情報：<a href="https://msrc-blog.microsoft.com/2022/03/08/guidance-for-cve-2022-23278-spoofing-in-microsoft-defender-for-endpoint/">Guidance for CVE-2022-23278 spoofing in Microsoft Defender for Endpoint – Microsoft Security Response Center</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では &lt;a href=&quot;https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microso</summary>
      
    
    
    
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Defender for Endpoint(MDE) にオンボードされたデバイスの正常性確認ポイント</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-01/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-11-01/</id>
    <published>2022-11-09T02:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.149Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint">Microsoft Defender for Endpoint(MDE)</a>にオンボードされたデバイスの正常性を確認するための確認ポイントに関する情報をまとめます。</p><p>最新の情報については MDE へのデバイスのオンボードに関する公開情報をご参照ください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/onboard-configure">デバイスにオンボードして、Microsoft Defender for Endpoint 機能を構成します | Microsoft Learn</a></p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#MDE-%E3%81%AB%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%95%E3%82%8C%E3%81%9F%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E6%AD%A3%E5%B8%B8%E6%80%A7%E7%A2%BA%E8%AA%8D%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">MDE にオンボードされたデバイスの正常性確認ポイント</a></li><li><a href="#Windows-%E7%92%B0%E5%A2%83%E3%81%AE%E5%A0%B4%E5%90%88">Windows 環境の場合</a><ul><li><a href="#STEP1-%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B-Windows-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E8%A6%81%E4%BB%B6%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">STEP1：オンボードする Windows デバイスの要件を確認する</a></li><li><a href="#STEP2-MDE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%8E%A5%E7%B6%9A%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%99%E3%82%8B">STEP2：MDE Client Analyzer ツールを使用して接続テストを実施する</a></li><li><a href="#STEP3-Windows-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A7-MDE-%E3%81%AE%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E6%A4%9C%E5%87%BA%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%99%E3%82%8B">STEP3：Windows デバイスで MDE のアラート検出テストを実施する</a></li><li><a href="#STEP4-Windows-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8C%E8%BB%A2%E9%80%81%E3%81%95%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">STEP4：Windows デバイスのレポートデータが転送されることを確認する</a></li></ul></li><li><a href="#Linux-%E7%92%B0%E5%A2%83%E3%81%AE%E5%A0%B4%E5%90%88">Linux 環境の場合</a><ul><li><a href="#STEP1-%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B-Linux-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E8%A6%81%E4%BB%B6%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">STEP1：オンボードする Linux デバイスの要件を確認する</a></li><li><a href="#STEP2-Linux-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%99%E3%82%8B">STEP2：Linux デバイスで接続テストを実施する</a></li><li><a href="#STEP3-Linux-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A7-MDE-%E3%81%AE%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E6%A4%9C%E5%87%BA%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%99%E3%82%8B">STEP3：Linux デバイスで MDE のアラート検出テストを実施する</a></li><li><a href="#STEP4-Linux-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8C%E8%BB%A2%E9%80%81%E3%81%95%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">STEP4：Linux デバイスのレポートデータが転送されることを確認する</a></li></ul></li><li><a href="#macOS-%E7%92%B0%E5%A2%83%E3%81%AE%E5%A0%B4%E5%90%88">macOS 環境の場合</a><ul><li><a href="#STEP1-%E3%82%AA%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B-macOS-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E8%A6%81%E4%BB%B6%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">STEP1：オンボードする macOS デバイスの要件を確認する</a></li><li><a href="#STEP2-macOS-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%99%E3%82%8B">STEP2：macOS デバイスで接続テストを実施する</a></li><li><a href="#STEP3-macOS-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A7-MDE-%E3%81%AE%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E6%A4%9C%E5%87%BA%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%99%E3%82%8B">STEP3：macOS デバイスで MDE のアラート検出テストを実施する</a></li><li><a href="#STEP4-macOS-%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8C%E8%BB%A2%E9%80%81%E3%81%95%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">STEP4：macOS デバイスのレポートデータが転送されることを確認する</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="MDE-にオンボードされたデバイスの正常性確認ポイント"><a href="#MDE-にオンボードされたデバイスの正常性確認ポイント" class="headerlink" title="MDE にオンボードされたデバイスの正常性確認ポイント"></a>MDE にオンボードされたデバイスの正常性確認ポイント</h2><p>MDE にデバイスがオンボードされたことを確認するためには、主に以下のポイントを確認する必要があります。</p><ol><li><strong>オンボード手順を実施した最小要件を満たすデバイスにて、必要なプロセスやサービスが稼働しており、オンボード情報が登録されていることを確認します。</strong></li><li><strong>デバイスで通信テストを実施し、MDEへの接続が可能な構成であることを確認します。</strong></li><li><strong>デバイスにて検出テストを実行し、MDEのアラートが発生することを確認します。</strong></li><li><strong>オンボード作業の完了後より最大で 24 時間程度お待ちいただき、<a href="https://security.microsoft.com/">Microsoft 365 Defender ポータル</a>にてデバイスレポートの転送が完了したことを確認します。</strong></li></ol><p>以下に、各プラットフォーム別の確認方法をご案内します。</p><h2 id="Windows-環境の場合"><a href="#Windows-環境の場合" class="headerlink" title="Windows 環境の場合"></a>Windows 環境の場合</h2><p>※ 本記事の手順は Windows 10 22H2 で動作確認を実施しています。</p><h3 id="STEP1-オンボードする-Windows-デバイスの要件を確認する"><a href="#STEP1-オンボードする-Windows-デバイスの要件を確認する" class="headerlink" title="STEP1 オンボードする Windows デバイスの要件を確認する"></a>STEP1 オンボードする Windows デバイスの要件を確認する</h3><p>確認の前に、デバイスが<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/minimum-requirements?view=o365-worldwide">Microsoft Defender for Endpoint の最小要件</a>にてご案内しております要件を満たす構成であることを必ず確認します。</p><p>また、Windows Server 2016 / 2012 R2 をオンボードする場合には、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-server-endpoints?view=o365-worldwide#prerequisites">Windows Server 2016 と 2012 R2 の前提条件</a>の要件も併せて確認します。</p><p>※ MDE がサポートする OS のバージョンは、OS のライフサイクルに依存します。</p><p>※ <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#product-updates">Microsoft Defender ウイルス対策(MDAV) のマルウェア対策プラットフォーム</a>は、最新から 2 世代以内のバージョンに更新する必要があります。</p><p>※ MDE にオンボードしたデバイスから作成した OS イメージを基に展開・複製したマシンを使用する場合、事前に <a href="/blog/Endpoint-MDAV-2022-11-15">MDE にオンボードされたデバイスをイメージ化・複製する場合の注意事項</a> に記載の内容を必ずご確認ください。</p><h3 id="STEP2-MDE-Client-Analyzer-ツールを使用して接続テストを実施する"><a href="#STEP2-MDE-Client-Analyzer-ツールを使用して接続テストを実施する" class="headerlink" title="STEP2 MDE Client Analyzer ツールを使用して接続テストを実施する"></a>STEP2 MDE Client Analyzer ツールを使用して接続テストを実施する</h3><p>Windows 端末の場合、 MDE Client Analyzer ツールを使用して接続テストを実施することが可能です。</p><p>MDE Client Analyzer ツールに関する最新の情報は以下の公開情報を参照してください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/download-client-analyzer?view=o365-worldwide">Microsoft Defender for Endpoint クライアントアナライザーをダウンロードする | Microsoft Learn</a></p><p>以下のステップで接続テストを実施します。</p><ol><li><strong><a href="https://aka.ms/MDEAnalyzer">MDEClientAnalyzer のダウンロード</a>より、「MDEClientAnalyzer.zip」をダウンロードし、任意のフォルダで展開します。</strong></li><li><strong>管理者権限でコマンドプロンプトを起動し、[1.] で展開されたフォルダをカレントフォルダに変更します。</strong></li><li><strong>コマンドプロンプトにて以下のコマンドを実行します。(使用許諾への同意を求めるポップアップが表示される場合、同意してコマンドを実行します)</strong></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; MDEClientAnalyzer.cmd</span><br></pre></td></tr></table></figure><p>コマンドの実行が完了すると、「MDEClientAnalyzer.htm」が作成され、端末の既定のブラウザアプリケーションで表示されます。</p><ol start="4"><li><strong>MDEClientAnalyzer ツールは、以下の5つの接続テストを実施します。</strong>※ MDE にデバイスをオンボードするためには、すべての接続テストに成功する必要があります。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">・EDRCloud CnC</span><br><span class="line">・EDRCloud Cyber</span><br><span class="line">・EDRCloud AutoIR</span><br><span class="line">・AVCloud SampleUpload</span><br><span class="line">・EDRCloud MdeConfigMgr</span><br></pre></td></tr></table></figure><p>接続テストに成功した場合、以下の例のように<code>[Informational]</code>として接続テストに成功したことが、出力された「MDEClientAnalyzer.htm」の [Detailed Results] 欄に表示されます。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-01.png" alt="接続テストに成功した場合の出力例"></p><p>接続テストに失敗した場合は、「MDEClientAnalyzer.htm」の [Detailed Results] 欄にエラーが表示されます。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-02.png" alt="接続テストに失敗した場合の出力例"></p><p>接続テストに失敗する場合は、 [Results] 列の記載から、接続テストに失敗した URL を確認します。</p><p>通信テストに失敗した場合は、以下公開情報の [商用顧客向けの Microsoft Defender for Endpoint の URL リスト] にてご案内しております通信要件を満たす構成であるか否かを確認します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#enable-access-to-microsoft-defender-for-endpoint-service-urls-in-the-proxy-server">商用顧客向けの Microsoft Defender for Endpoint の URL リスト</a></p><p>また、「MDEClientAnalyzer.htm」の [Detailed Results] 欄に [AntiSpoofingNotActive] の警告が表示される場合、<a href="/blog/Endpoint-MDAV-2022-11-15">MDE にオンボードされたデバイスをイメージ化・複製する場合の注意事項</a> にてご案内しております制限事項に該当する環境の可能性があります。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-08.png" alt="AntiSpoofingNotActive の警告"></p><p>上記の制限事項に該当する場合、デバイスと MDE との接続に問題が発生する可能性があるため、必ず<a href="/blog/Endpoint-MDAV-2022-11-15">リンク先</a>の情報をご確認ください。</p><h3 id="STEP3-Windows-デバイスで-MDE-のアラート検出テストを実施する"><a href="#STEP3-Windows-デバイスで-MDE-のアラート検出テストを実施する" class="headerlink" title="STEP3 Windows デバイスで MDE のアラート検出テストを実施する"></a>STEP3 Windows デバイスで MDE のアラート検出テストを実施する</h3><p>STEP2の通信テストにすべて成功することが確認できたら、デバイスで検出されたアラートが<a href="https://security.microsoft.com/alerts">Microsoft 365 Defender ポータル</a>上で検出されることを確認します。</p><p>アラートの検出テストは以下の手順で実施します。</p><ol><li><strong>MDE にオンボードした Windows デバイスでコマンドプロンプトを起動します。</strong></li><li><strong>コマンドプロンプトで以下のスクリプトを実行します。(コマンドプロンプトは自動的に終了します)</strong></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="literal">-NoExit</span> <span class="literal">-ExecutionPolicy</span> Bypass <span class="literal">-WindowStyle</span> <span class="keyword">Hidden</span> <span class="variable">$ErrorActionPreference</span>= <span class="string">&#x27;silentlycontinue&#x27;</span>;(<span class="built_in">New-Object</span> System.Net.WebClient).DownloadFile(<span class="string">&#x27;http://127.0.0.1/1.exe&#x27;</span>, <span class="string">&#x27;C:\\test-WDATP-test\\invoice.exe&#x27;</span>);<span class="built_in">Start-Process</span> <span class="string">&#x27;C:\\test-WDATP-test\\invoice.exe&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><strong>3~10分程度お待ちいただき、<a href="https://security.microsoft.com/alerts">Microsoft 365 Defender ポータル</a>上に以下のアラートが登録されることを確認します。</strong></li></ol><p><img src="../images/Endpoint-MDAV-2022-11-01-03.png" alt="出力されるテストアラートの例"></p><p>10分以上経過しても新しいアラートが出力されない場合、ポータル上に [状態] 列のステータスが [新規] または [進行中] である既存のアラート <code>[Test Alert] Suspicious Powershell commandline</code>が存在するか否かを確認します。</p><p>もし存在する場合は、既存のアラートのステータスを [解決済み] に変更した上で再度テストを実施します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-alerts?view=o365-worldwide#change-the-status-of-an-alert">アラートの状態を変更する | Microsoft Learn</a></p><p>また、念のため<code>[Test Alert] Suspicious Powershell commandline</code>のアラートを対象とするアラート抑制ルールが構成されていないことも確認します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-alerts?view=o365-worldwide#suppress-alerts">アラートを抑制する | Microsoft Learn</a></p><h3 id="STEP4-Windows-デバイスのレポートデータが転送されることを確認する"><a href="#STEP4-Windows-デバイスのレポートデータが転送されることを確認する" class="headerlink" title="STEP4 Windows デバイスのレポートデータが転送されることを確認する"></a>STEP4 Windows デバイスのレポートデータが転送されることを確認する</h3><p>STEP3までのすべてのテストを完了したら、デバイスがインターネット経由で MDE と接続可能な状態を維持したまま、レポートデータの転送に成功することを確認します。(レポートデータが完全に転送されるまでに、最大で 24 ~ 48時間程度かかる場合があります)</p><p>Microsoft 365 Defender ポータルの<a href="https://security.microsoft.com/machines">デバイスインベントリ</a>画面にて、MDE にオンボードされたデバイスの [前回のデバイス更新] 列の情報から、レポートデータが転送された時刻を確認することが可能です。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-04.png" alt="デバイスインベントリの情報"></p><p>STEP3までのすべてのテストを完了し、[前回のデバイス更新] 列の時刻が更新されることを確認することで、デバイスが MDE に正常にオンボードされたものと判断することができます。</p><h2 id="Linux-環境の場合"><a href="#Linux-環境の場合" class="headerlink" title="Linux 環境の場合"></a>Linux 環境の場合</h2><p>※ 本記事の手順は Red Hat Enterprise Linux 8.2 環境で動作確認を実施しています。</p><h3 id="STEP1-オンボードする-Linux-デバイスの要件を確認する"><a href="#STEP1-オンボードする-Linux-デバイスの要件を確認する" class="headerlink" title="STEP1 オンボードする Linux デバイスの要件を確認する"></a>STEP1 オンボードする Linux デバイスの要件を確認する</h3><p>確認の前に、デバイスが<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/minimum-requirements?view=o365-worldwide">Microsoft Defender for Endpoint の最小要件</a>にてご案内しております要件を満たす構成であることを必ず確認します。</p><p>また、MDE にオンボードするデバイスが <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint-linux?view=o365-worldwide#system-requirements">Linux デバイスをオンボードする場合のシステム要件</a>を満たす構成であることも併せて確認します。</p><h3 id="STEP2-Linux-デバイスで接続テストを実施する"><a href="#STEP2-Linux-デバイスで接続テストを実施する" class="headerlink" title="STEP2 Linux デバイスで接続テストを実施する"></a>STEP2 Linux デバイスで接続テストを実施する</h3><p>Linux デバイスの場合、<code>mdatp connectivity test</code>コマンドを使用して端末がインターネット経由で MDE に接続可能かどうかを確認することが可能です。</p><p>デバイスが MDE と接続可能な構成にある場合、以下のスクリーンショットのようにすべての接続テスト結果が [OK] と表示されます。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-05.png" alt="mdatpコマンドによる接続テスト"></p><p><code>mdatp connectivity test</code>コマンドによる接続テストの詳細は以下にてご案内しています。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/linux-support-connectivity?view=o365-worldwide#run-the-connectivity-test">Linux で接続テストを実施する | Microsoft Learn</a></p><p>なお、透過プロキシまたは静的プロキシを使用する場合の接続テスト方法については、以下の公開情報にてご案内しています。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/linux-support-connectivity?view=o365-worldwide#troubleshooting-steps-for-environments-without-proxy-or-with-transparent-proxy">透過プロキシ、静的プロキシを使用する場合の接続テスト  | Microsoft Learn</a></p><h3 id="STEP3-Linux-デバイスで-MDE-のアラート検出テストを実施する"><a href="#STEP3-Linux-デバイスで-MDE-のアラート検出テストを実施する" class="headerlink" title="STEP3 Linux デバイスで MDE のアラート検出テストを実施する"></a>STEP3 Linux デバイスで MDE のアラート検出テストを実施する</h3><p>STEP2の通信テストにすべて成功することが確認できたら、デバイスで検出されたアラートが<a href="https://security.microsoft.com/alerts">Microsoft 365 Defender ポータル</a>上で検出されることを確認します。</p><p>アラートの検出テストは以下の手順で実施します。</p><ol><li><strong>MDE にオンボードした Linux デバイスでシェルを起動します。</strong></li><li><strong>シェルで以下のコマンドを実行します。</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o ~/Downloads/eicar.com.txt https://www.eicar.org/download/eicar.com.txt</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>Eicar テストウイルスが Microsoft Defender によってブロックされたことを確認します。</strong></li></ol><p><code>mdatp threat list</code>コマンドを実行することで、以下の例のように Eicar テストウイルスが検知されたことを確認することができます。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mdatp threat list</span><br><span class="line">Id: <span class="string">&quot;89fe133a-1e3e-49ce-b50d-67c31f7410c9&quot;</span></span><br><span class="line">Name: Virus:DOS/EICAR_Test_File</span><br><span class="line">Type: <span class="string">&quot;virus&quot;</span></span><br><span class="line">Detection time: Tue Nov  1 03:15:34 2022</span><br><span class="line">Status: <span class="string">&quot;quarantined&quot;</span></span><br></pre></td></tr></table></figure><ol start="4"><li><strong>3~10分程度お待ちいただき、<a href="https://security.microsoft.com/alerts">Microsoft 365 Defender ポータル</a>上に以下のアラートが登録されることを確認します。</strong></li></ol><p><img src="../images/Endpoint-MDAV-2022-11-01-06.png" alt="Eicar テストウイルスの検知アラート"></p><p>10分以上経過しても新しいアラートが出力されない場合、ポータル上に [状態] 列のステータスが [新規] または [進行中] である既存のアラート <code>&#39;EICAR_Test_File&#39; malware was prevented</code>が存在するか否かを確認します。</p><p>もし存在する場合は、既存のアラートのステータスを [解決済み] に変更した上で再度テストを実施します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-alerts?view=o365-worldwide#change-the-status-of-an-alert">アラートの状態を変更する | Microsoft Learn</a></p><p>また、念のため<code>&#39;EICAR_Test_File&#39; malware was prevented</code>のアラートを対象とするアラート抑制ルールが構成されていないことも確認します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-alerts?view=o365-worldwide#suppress-alerts">アラートを抑制する | Microsoft Learn</a></p><h3 id="STEP4-Linux-デバイスのレポートデータが転送されることを確認する"><a href="#STEP4-Linux-デバイスのレポートデータが転送されることを確認する" class="headerlink" title="STEP4 Linux デバイスのレポートデータが転送されることを確認する"></a>STEP4 Linux デバイスのレポートデータが転送されることを確認する</h3><p>STEP3までのすべてのテストを完了したら、デバイスがインターネット経由で MDE と接続可能な状態を維持したまま、レポートデータの転送に成功することを確認します。(レポートデータが完全に転送されるまでに、最大で 24 ~ 48時間程度かかる場合があります)</p><p>Microsoft 365 Defender ポータルの<a href="https://security.microsoft.com/machines">デバイスインベントリ</a>画面にて、MDE にオンボードされたデバイスの [前回のデバイス更新] 列の情報から、レポートデータが転送された時刻を確認することが可能です。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-04.png" alt="デバイスインベントリの情報"></p><p>STEP3までのすべてのテストを完了し、[前回のデバイス更新] 列の時刻が更新されることを確認することで、デバイスが MDE に正常にオンボードされたものと判断することができます。</p><h2 id="macOS-環境の場合"><a href="#macOS-環境の場合" class="headerlink" title="macOS 環境の場合"></a>macOS 環境の場合</h2><p>※ 本記事の手順は macOS 13(Ventura) 環境で動作確認を実施しています。</p><h3 id="STEP1-オンボードする-macOS-デバイスの要件を確認する"><a href="#STEP1-オンボードする-macOS-デバイスの要件を確認する" class="headerlink" title="STEP1 オンボードする macOS デバイスの要件を確認する"></a>STEP1 オンボードする macOS デバイスの要件を確認する</h3><p>確認の前に、デバイスが<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/minimum-requirements?view=o365-worldwide">Microsoft Defender for Endpoint の最小要件</a>にてご案内しております要件を満たす構成であることを必ず確認します。</p><p>また、MDE にオンボードするデバイスが <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint-mac?view=o365-worldwide#system-requirements">macOS デバイスをオンボードする場合の要件</a>を満たす構成であることも併せて確認します。</p><h3 id="STEP2-macOS-デバイスで接続テストを実施する"><a href="#STEP2-macOS-デバイスで接続テストを実施する" class="headerlink" title="STEP2 macOS デバイスで接続テストを実施する"></a>STEP2 macOS デバイスで接続テストを実施する</h3><p>macOS デバイスの場合、Linux デバイスと同じく<code>mdatp connectivity test</code>コマンドを使用して端末がインターネット経由で MDE に接続可能かどうかを確認することが可能です。</p><p>デバイスが MDE と接続可能な構成にある場合、以下のスクリーンショットのようにすべての接続テスト結果が [OK] と表示されます。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-07.png" alt="macOS の接続テスト結果"></p><p>macOS で<code>mdatp connectivity test</code>コマンドを使用して接続テストを実施する方法の詳細については以下の公開情報でご案内しています。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/troubleshoot-cloud-connect-mdemac?view=o365-worldwide#run-the-connectivity-test">macOS で接続テストを実行する | Microsoft Learn</a></p><p>なお、プロキシ構成を使用する場合の接続テスト方法については、以下の公開情報にてご案内しています。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/troubleshoot-cloud-connect-mdemac?view=o365-worldwide#troubleshooting-steps-for-environments-without-proxy-or-with-proxy-autoconfig-pac-or-with-web-proxy-autodiscovery-protocol-wpad">プロキシ自動構成 (PAC) または Web プロキシ自動検出プロトコル (WPAD) を使用した環境で接続テストを実施する | Microsoft Learn</a></p><h3 id="STEP3-macOS-デバイスで-MDE-のアラート検出テストを実施する"><a href="#STEP3-macOS-デバイスで-MDE-のアラート検出テストを実施する" class="headerlink" title="STEP3 macOS デバイスで MDE のアラート検出テストを実施する"></a>STEP3 macOS デバイスで MDE のアラート検出テストを実施する</h3><p>STEP2の通信テストにすべて成功することが確認できたら、デバイスで検出されたアラートが<a href="https://security.microsoft.com/alerts">Microsoft 365 Defender ポータル</a>上で検出されることを確認します。</p><p>アラートの検出テストは以下の手順で実施します。</p><ol><li><strong>MDE にオンボードした macOS デバイスでターミナルを起動します。</strong></li><li><strong>ターミナルで以下のコマンドを実行します。</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o ~/Downloads/eicar.com.txt https://www.eicar.org/download/eicar.com.txt</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>Eicar テストウイルスが Microsoft Defender によってブロックされたことを確認します。</strong></li></ol><p><code>mdatp threat list</code>コマンドを実行することで、以下の例のように Eicar テストウイルスが検知されたことを確認することができます。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">% mdatp threat list</span><br><span class="line">Id: “83dfc88e-8743-4d4a-9022-b85d0ab4c31e”</span><br><span class="line">Name: Virus:DOS/EICAR_Test_File</span><br><span class="line">Type: “virus”</span><br><span class="line">Detection time: Wed Nov 9 00:39:43 2022</span><br><span class="line">Status: “quarantined”</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>3~10分程度お待ちいただき、<a href="https://security.microsoft.com/alerts">Microsoft 365 Defender ポータル</a>上に以下のアラートが登録されることを確認します。</strong></li></ol><p><img src="../images/Endpoint-MDAV-2022-11-01-06.png" alt="Eicar テストウイルスの検知アラート"></p><p>10分以上経過しても新しいアラートが出力されない場合、ポータル上に [状態] 列のステータスが [新規] または [進行中] である既存のアラート <code>&#39;EICAR_Test_File&#39; malware was prevented</code>が存在するか否かを確認します。</p><p>もし存在する場合は、既存のアラートのステータスを [解決済み] に変更した上で再度テストを実施します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-alerts?view=o365-worldwide#change-the-status-of-an-alert">アラートの状態を変更する | Microsoft Learn</a></p><p>また、念のため<code>&#39;EICAR_Test_File&#39; malware was prevented</code>のアラートを対象とするアラート抑制ルールが構成されていないことも確認します。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-alerts?view=o365-worldwide#suppress-alerts">アラートを抑制する | Microsoft Learn</a></p><h3 id="STEP4-macOS-デバイスのレポートデータが転送されることを確認する"><a href="#STEP4-macOS-デバイスのレポートデータが転送されることを確認する" class="headerlink" title="STEP4 macOS デバイスのレポートデータが転送されることを確認する"></a>STEP4 macOS デバイスのレポートデータが転送されることを確認する</h3><p>STEP3までのすべてのテストを完了したら、デバイスがインターネット経由で MDE と接続可能な状態を維持したまま、レポートデータの転送に成功することを確認します。(レポートデータが完全に転送されるまでに、最大で 24 ~ 48時間程度かかる場合があります)</p><p>Microsoft 365 Defender ポータルの<a href="https://security.microsoft.com/machines">デバイスインベントリ</a>画面にて、MDE にオンボードされたデバイスの [前回のデバイス更新] 列の情報から、レポートデータが転送された時刻を確認することが可能です。</p><p><img src="../images/Endpoint-MDAV-2022-11-01-04.png" alt="デバイスインベントリの情報"></p><p>STEP3までのすべてのテストを完了し、[前回のデバイス更新] 列の時刻が更新されることを確認することで、デバイスが MDE に正常にオンボードされたものと判断することができます。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>この記事では、Windows、Linux、macOS のデバイスを MDE にオンボードいただいた際に、正常にオンボードされたかどうかを確認いただく場合の手順についてご紹介しました。</p><p>なお、本記事の内容は執筆時点の情報を基にしております。</p><p>そのため、各デバイスのオンボードに関する最新の情報については以下の公開情報をご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/onboard-windows-client?view=o365-worldwide">Windows クライアントを MDE にオンボードする</a></li><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/onboard-windows-server?view=o365-worldwide">Windows サーバを MDE にオンボードする</a></li><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint-linux?view=o365-worldwide#how-to-install-microsoft-defender-for-endpoint-on-linux">Linux を MDE にオンボードする</a></li><li><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint-mac?view=o365-worldwide#how-to-install-microsoft-defender-for-endpoint-on-mac">macOS を MDE にオンボードする</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では &lt;a href=&quot;https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/microso</summary>
      
    
    
    
    
    <category term="MDE on Linux" scheme="https://jp-sec.github.io/blog/tags/MDE-on-Linux/"/>
    
    <category term="MDE on macOS" scheme="https://jp-sec.github.io/blog/tags/MDE-on-macOS/"/>
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>macOS および Linux デバイスで Client Analyzer ツールによる正常性診断を実行する方法</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-09-28/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-09-28/</id>
    <published>2022-09-28T06:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.149Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では Microsoft Defender for Endpoint on mac(MDE on mac) および Microsoft Defender for Endpoint on Linux(MDE on Linux) のデバイス正常性の評価に役立つ <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide">Microsoft Defender for Endpoint Client Analyzer(MDECA)</a> の使用方法についてご紹介します。</p><p>Client Analyzer ツールの詳細については、以下の公開情報にてご案内いたしております。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide">Microsoft Defender for Endpoint クライアント アナライザーを使用したセンサーの正常性のトラブルシューティング</a></p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E5%89%8D%E3%81%AB">Client Analyzer ツールを使用する前に</a></li><li><a href="#macOS-%E3%81%A7-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">macOS で Client Analyzer ツールを使用する</a><ul><li><a href="#macOS-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">macOS での Client Analyzer ツールの実行方法 (Python3を使用する)</a></li><li><a href="#macOS-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84">macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)</a></li></ul></li><li><a href="#Linux-%E3%81%A7-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">Linux で Client Analyzer ツールを使用する</a><ul><li><a href="#Linux-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">Linux での Client Analyzer ツールの実行方法 (Python3を使用する)</a></li><li><a href="#Linux-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84">Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="Client-Analyzer-ツールを使用する前に"><a href="#Client-Analyzer-ツールを使用する前に" class="headerlink" title="Client Analyzer ツールを使用する前に"></a>Client Analyzer ツールを使用する前に</h2><p>macOS または Linux 端末にてClient Analyzer ツールを使用してデバイスの診断を行う前に、デバイスが以下の前提要件を満たしていることを確認する必要があります。</p><ol><li>プロキシまたはファイアウォールの構成で <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#enable-access-to-microsoft-defender-for-endpoint-service-urls-in-the-proxy-server">Microsoft Defender for Endpoint サービスの使用する URL</a> へのアクセス許可が構成されていることを確認します。</li><li>デバイスが MDE へのオンボードに必要な <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/minimum-requirements?view=o365-worldwide">最小要件</a> を満たしていることを確認します。</li></ol><p>Client Analyzer ツールを使用する場合の前提要件に関する最新の情報は以下のページより確認いただくことができます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide#requirements">Microsoft Defender for Endpoint クライアント アナライザーを使用したセンサーの正常性のトラブルシューティング | 前提要件</a></p><h2 id="macOS-で-Client-Analyzer-ツールを使用する"><a href="#macOS-で-Client-Analyzer-ツールを使用する" class="headerlink" title="macOS で Client Analyzer ツールを使用する"></a>macOS で Client Analyzer ツールを使用する</h2><p>※ 本記事の手順は Intelベースの macOS Big Sur(Version 11.7) にて動作確認を実施しています。</p><p>Client Analyzer ツールを使用する手順に関する最新の情報については、以下の公開情報ページをご参照くださいますようお願いいたします。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-macos-linux?view=o365-worldwide#running-the-analyzer-through-gui-scenario">macOS または Linux でのクライアント アナライザーの実行</a></p><h3 id="macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用する"><a href="#macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用する" class="headerlink" title="macOS での Client Analyzer ツールの実行方法 (Python3を使用する)"></a>macOS での Client Analyzer ツールの実行方法 (Python3を使用する)</h3><p>このセクションでは、コマンドラインインターフェース(CLI)を使用した Client Analyzer ツールの実行方法について紹介します。</p><p>このセクションで紹介する手順を使用するためには、デバイスで <code>python3</code> コマンドと Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が利用可能である必要があります。</p><p>※ <code>python3</code> コマンドが使用できないデバイスで Client Analyzer ツールを実行する手順については、<a href="#macOS-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84">macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)</a> のセクションを参照してください。</p><ol><li>デバイスで ターミナルを起動し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -OL https://aka.ms/XMDEClientAnalyzer</span><br><span class="line">unzip -q XMDEClientAnalyzer</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルとディレクトリが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── mde_support_tool.sh</span><br><span class="line">├── mde_tools/</span><br><span class="line">└── requirements.txt</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドを実行して、<code>mde_support_tool.sh</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x mde_support_tool.sh</span><br></pre></td></tr></table></figure><ol start="4"><li><code>mde_support_tool.sh</code>を実行し、必要なコンポーネントをインストールします。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mde_support_tool.sh</span><br></pre></td></tr></table></figure><p>※ デバイスで<code>python3</code>コマンドが使用できない場合、<code>mde_support_tool.sh</code>の実行に失敗し、以下のようにPython3のインストールを要求する画面が表示される場合があります。</p><p><img src="../images/Endpoint-MDAV-2022-09-28-01.png" alt="Endpoint-MDAV-2022-09-28-01"></p><ol start="5"><li>上記のコマンド実行によりコンポーネントのインストールに成功した後、以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./mde_support_tool.sh -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 03:47:45.646][INFO] Archive created at: /tmp/28_09_2022_03_47_45_output.zip</span><br></pre></td></tr></table></figure><h3 id="macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用しない"><a href="#macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用しない" class="headerlink" title="macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)"></a>macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)</h3><p>このセクションでは、<code>python3</code>コマンドまたは Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が使用できない環境にてClient Analyzer ツールを実行する方法について紹介します。</p><ol><li>デバイスで ターミナルを起動し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -OL https://aka.ms/XMDEClientAnalyzerBinary</span><br><span class="line">unzip -q XMDEClientAnalyzerBinary</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── SupportToolLinuxBinary.zip</span><br><span class="line">└── SupportToolMacOSBinary.zip</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドで、Intel ベースの macOS 用パッケージを展開します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -q SupportToolMacOSBinary.zip</span><br></pre></td></tr></table></figure><ol start="4"><li>以下のコマンドを実行して、展開された<code>MDESupportTool</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x MDESupportTool</span><br></pre></td></tr></table></figure><ol start="5"><li>以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./MDESupportTool -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 03:47:45.646][INFO] Archive created at: /tmp/28_09_2022_03_47_45_output.zip</span><br></pre></td></tr></table></figure><h2 id="Linux-で-Client-Analyzer-ツールを使用する"><a href="#Linux-で-Client-Analyzer-ツールを使用する" class="headerlink" title="Linux で Client Analyzer ツールを使用する"></a>Linux で Client Analyzer ツールを使用する</h2><p>※ 本記事の手順は Red Hat Enterprise Linux Server 7.7 (Maipo) にて動作確認を実施しています。</p><p>Client Analyzer ツールを使用する手順に関する最新の情報については、以下の公開情報ページをご参照ください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-macos-linux?view=o365-worldwide#running-the-analyzer-through-gui-scenario">macOS または Linux でのクライアント アナライザーの実行</a></p><h3 id="Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用する"><a href="#Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用する" class="headerlink" title="Linux での Client Analyzer ツールの実行方法 (Python3を使用する)"></a>Linux での Client Analyzer ツールの実行方法 (Python3を使用する)</h3><p>このセクションでは、コマンドラインインターフェース(CLI)を使用した Client Analyzer ツールの実行方法について紹介します。</p><p>このセクションで紹介する手順を使用するためには、デバイスで <code>python3</code> コマンドと Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が利用可能である必要があります。</p><p>※ <code>python3</code> コマンドが使用できないデバイスで Client Analyzer ツールを実行する手順については、[Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)][#Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)] のセクションを参照してください。</p><ol><li>デバイスの CLI を使用し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet -O XMDEClientAnalyzer.zip https://aka.ms/XMDEClientAnalyzer</span><br><span class="line">unzip -q XMDEClientAnalyzer.zip</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルとディレクトリが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── mde_support_tool.sh</span><br><span class="line">├── mde_tools/</span><br><span class="line">└── requirements.txt</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドを実行して、<code>mde_support_tool.sh</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x mde_support_tool.sh</span><br></pre></td></tr></table></figure><ol start="4"><li><code>mde_support_tool.sh</code>を実行し、必要なコンポーネントをインストールします。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mde_support_tool.sh</span><br></pre></td></tr></table></figure><p>※ デバイスで<code>python3</code>コマンドが使用できない場合、<code>python3: command not found</code>のエラーメッセージが表示され、<code>mde_support_tool.sh</code>の実行に失敗します。</p><ol start="5"><li>上記のコマンド実行によりコンポーネントのインストールに成功した後、以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./mde_support_tool.sh -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 02:27:45.636][INFO] Archive created at: /tmp/28_09_2022_02_26_53_output.zip</span><br></pre></td></tr></table></figure><h3 id="Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用しない"><a href="#Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用しない" class="headerlink" title="Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)"></a>Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)</h3><p>このセクションでは、<code>python3</code>コマンドまたは Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が使用できない環境にてClient Analyzer ツールを実行する方法について紹介します。</p><ol><li>デバイスの CLI を使用し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet -O XMDEClientAnalyzerBinary.zip https://aka.ms/XMDEClientAnalyzerBinary</span><br><span class="line">unzip -q XMDEClientAnalyzerBinary.zip</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── SupportToolLinuxBinary.zip</span><br><span class="line">├── SupportToolmacOS-armBinary.zip</span><br><span class="line">└── SupportToolmacOSBinary.zip</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドで、Linux 用のパッケージを展開します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -q SupportToolLinuxBinary.zip</span><br></pre></td></tr></table></figure><ol start="4"><li>以下のコマンドを実行して、展開された<code>MDESupportTool</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x MDESupportTool</span><br></pre></td></tr></table></figure><ol start="5"><li>以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./MDESupportTool -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 02:40:51.848][INFO] Archive created at: /tmp/28_09_2022_02_40_00_output.zip</span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>この記事では、 MDE にオンボードされた macOS および Linux デバイスの正常性の評価に役立つ <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide">Microsoft Defender for Endpoint Client Analyzer(MDECA)</a> の使用方法についてご紹介しました。</p><p>Client Analyzer ツールによって作成されたパッケージファイルに含まれる情報の概要については<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-macos-linux?view=o365-worldwide#result-package-contents-on-macos-and-linux">macOS と Linux のパッケージの内容</a> にてご案内いたしております。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では Microsoft Defender for Endpoint on mac(MDE on mac) および Microsoft Defender for Endpoint on L</summary>
      
    
    
    
    
    <category term="MDE on Linux" scheme="https://jp-sec.github.io/blog/tags/MDE-on-Linux/"/>
    
    <category term="MDE on macOS" scheme="https://jp-sec.github.io/blog/tags/MDE-on-macOS/"/>
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>日本語 (マルチバイト文字) でカスタム プロパティが構成されている Office ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある。</title>
    <link href="https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2022-09-26-01/"/>
    <id>https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2022-09-26-01/</id>
    <published>2022-09-25T15:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.149Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Security サポートチームです。<br>今回は AIP クライアント (右クリックオプションの「分類して保護する」) や、PowerShell コマンドレット、AIP スキャナーのご利用にあたって、注意する必要があるシナリオが確認できましたのでお知らせいたします。</p><h2 id="日本語-マルチバイト文字-でカスタム-プロパティが構成されている-Office-ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある"><a href="#日本語-マルチバイト文字-でカスタム-プロパティが構成されている-Office-ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある" class="headerlink" title="日本語 (マルチバイト文字) でカスタム プロパティが構成されている Office ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある"></a>日本語 (マルチバイト文字) でカスタム プロパティが構成されている Office ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある</h2><p>Office ドキュメントには、ファイルの内容を識別しやすくするためのプロパティとして、独自の情報を使用できるカスタム プロパティの項目があります。<br>このカスタム プロパティの設定は、例えば Windows Server 標準機能のファイル分類インフラストラクチャ (Windows Server FCI) の分類規則ジョブで付与するシナリオがよく知られています。<br>ドキュメントに設定されているカスタム プロパティ情報の詳細は、Office アプリの [ファイル] &gt; [情報] オプション画面内の “プロパティ (詳細プロパティ)” の [ユーザー設定] タブの箇所から確認することができます。<br>Office ドキュメントに対して秘密度ラベル機能 (Microsoft Information Protection) を利用する場合にも、カスタム プロパティの設定箇所を利用して、秘密度ラベルに関するメタデータ (ラベル ID や) を記述する仕様となっています。<br>一般的なユースケースとして、カスタム プロパティにお客様独自のメタデータ (分類プロパティ) が含まれている場合でも、秘密度ラベルと併用することは問題ありませんが、一部の限定的な条件で Office ドキュメント ファイルが破損する症状を確認いたしました。<br>以下に発生条件や要因、対処方法についてご案内します。</p><h3 id="【事象の発生条件と概要】"><a href="#【事象の発生条件と概要】" class="headerlink" title="【事象の発生条件と概要】"></a>【事象の発生条件と概要】</h3><ol><li>秘密度ラベルの共同編集機能が無効 (既定値) となっているテナント</li><li>対象ファイルに日本語 (マルチバイト文字) で秘密度ラベル以外のカスタム プロパティ情報が含まれていること</li><li>対象ファイルに暗号化設定のある秘密度ラベルが付与されていること</li><li>対象ファイルを AIP クライアント (右クリック &gt;[分類して保護する]) エクスプローラーたは PowerShell コマンドレット (Set-AIPFileLabel) を使用してラベルを削除する or AIP スキャナーのコンテンツ スキャンジョブでラベルを削除する</li></ol><p>上記の条件を満たした場合、Office アプリで対象ファイルを開封する際に「’対象ドキュメント名’ の一部の内容に問題が見つかりました。可能な限り内容を回復しますか？ブックの発行元が信頼できる場合は、[はい]をクリックしてください。」と表示される状態となります。<br>[はい] をクリックすると、Office アプリの修復機能により問題が修復された状態となります。<br>ファイルを保存し直すことで再利用可能な状態となります。</p><h3 id="【事象の要因】"><a href="#【事象の要因】" class="headerlink" title="【事象の要因】"></a>【事象の要因】</h3><p>AIP クライアント モジュールで使用されている一部のコンポーネントがマルチバイト文字に対応しておらず、カスタム プロパティ情報の処理に失敗することが要因であることを確認しております。<br>AIP クライアントは2022年1月よりメンテナンス モードに入っており、セキュリティ上重大な問題以外の修正は行われない状態となっており、本問題についてはシナリオが限定的であることもあり改修されないことが決定されています。</p><h3 id="【対処-回避方法】"><a href="#【対処-回避方法】" class="headerlink" title="【対処/回避方法】"></a>【対処/回避方法】</h3><ol><li><p>該当ファイルを Office アプリの修復機能で修正後、そのまま利用する<br>AIP クライアントによるラベル付与/削除処理によって、マルチバイト文字のカスタム プロパティ情報の処理の一部に失敗することから事象が発生しますが、該当ｎファイルは Office アプリによる修復によって以前の通りに使用できるようになります。<br>エラー メッセージは表示されてしまうものの Office アプリの修復機能を利用して、該当ファイルをそのままご利用いただくことが可能です。</p></li><li><p>秘密度ラベルの共同編集機能を有効にする<br>秘密度ラベルの共同編集機能を利用することで、AIP 側の Office ドキュメントのメタデータの用法が変更されます。<br>これによって事象が発生しなくなります。<br>共同編集機能を有効化する場合には、秘密度ラベル機能を利用するユーザーは共同編集に対応したバージョンの Office アプリである Microsoft 365 Apps を使用する必要があります。<br>テナント内のユーザーでボリュームライセンス版の Office Professional Plus エディションと AIP クライアントの組み合わせで秘密度ラベルを利用している端末などがある場合には共同編集の有効化機能を推奨しておりません。<br>また、AIP のカスタム プロパティを使用した独自アプリケーションなどを運用いただいている場合にも、この設定は推奨されません。<br>この設定はお客様側で元に戻すことができませんので、有効化を検討する場合には前提条件や制限事項などの注意事項をよく確認のうえで計画いただけましたら幸いです。</p></li></ol><p>&lt;参考&gt;<br>Title : 機密度ラベルを使用して暗号化されたファイルの共同編集を有効にする<br>URL : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/compliance/sensitivity-labels-coauthoring?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/compliance/sensitivity-labels-coauthoring?view=o365-worldwide</a></p><ol start="3"><li><p>カスタム プロパティにシングルバイトの英数字を利用する<br>現在日本語で運用いただいているカスタム プロパティの情報をシングルバイト (半角英数字) に書き換えることで事象の発生を緩和させることが可能です。<br>これからカスタム プロパティを利用した運用を計画している場合などにはこのアプローチも有効となる可能性があります。</p></li><li><p>Office アプリを使用してラベルを削除する<br>AIP クライアントや AIP スキャナーを使用して、Office ドキュメントのラベルを削除した場合に問題が発生します。<br>該当ファイルのラベルを削除したい場合に、Office アプリを使用してラベルを削除する場合にはこの問題は発生しません。<br>[秘密度] のアイコンから該当のラベルを再度クリックすることで、ラベルを削除することができます。</p></li></ol><p>ラベルによって保護されたドキュメントを外部に共有したい場合などにラベルを削除してからデータを渡すシナリオがよくあるかと存じます。<br>ラベルを削除する操作は外部共有に限りませんが、特定の条件下でラベルを削除した対象ファイルについては、Office アプリでファイルを開封する際に、破損を検出する動作となる点についてご理解をいただけましたら幸いです。</p><p>今回のお知らせは以上になります。</p><p>※本ブログ記事化にあたり、弊社サポートによる調査にご協力いただきましたお客様に深く感謝いたします。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Security サポートチームです。&lt;br&gt;今回は AIP クライアント (右クリックオプションの「分類して保護する」) や、PowerShell コマンドレット、AIP スキャナーのご利用にあたって、注意する必要があるシナリオが確認できましたので</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Defender ウイルス対策のマルウェア対策プラットフォームを手動で更新・ロールバックする方法</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-08-26/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-08-26/</id>
    <published>2022-09-08T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.149Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>本記事ではMicrosoft  Defender ウイルス対策(MDAV)のマルウェア対策プラットフォームを手動で更新する方法についてご案内いたします。</p><p>MDAVのセキュリティインテリジェンス(定義ファイル)を手動で更新する方法については以下の記事をご参照ください。</p><p>参考情報：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/">Microsoft Defender ウイルス対策のセキュリティインテリジェンス(定義ファイル)を手動で更新・ロールバック・削除する方法</a></p><p>※ 本記事の内容はWindow Server 2019環境にて動作を確認いたしております。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#MDAV%E3%81%AE%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">MDAVのマルウェア対策プラットフォームについて</a></li><li><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">事前準備</a><ul><li><a href="#%E7%AB%AF%E6%9C%AB%E6%83%85%E5%A0%B1%E3%81%AE%E7%A2%BA%E8%AA%8D">端末情報の確認</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">使用するモジュールのダウンロード</a></li></ul></li><li><a href="#%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%AE%E6%89%8B%E5%8B%95%E6%9B%B4%E6%96%B0%E6%96%B9%E6%B3%95">マルウェア対策プラットフォームの手動更新方法</a><ul><li><a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3418200110%E3%81%AE%E6%89%8B%E5%8B%95%E9%81%A9%E7%94%A8%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C418200110%E6%9C%AA%E6%BA%80%E3%81%A7%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E3%81%BF">バージョン<code>4.18.2001.10</code>の手動適用(端末のバージョンが<code>4.18.2001.10</code>未満である場合のみ)</a></li><li><a href="#%E6%9C%80%E6%96%B0%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%AE%E6%89%8B%E5%8B%95%E9%81%A9%E7%94%A8">最新バージョンのマルウェア対策プラットフォームの手動適用</a></li></ul></li><li><a href="#%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E6%89%8B%E9%A0%86">更新プログラムのロールバック手順</a></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="MDAVのマルウェア対策プラットフォームについて"><a href="#MDAVのマルウェア対策プラットフォームについて" class="headerlink" title="MDAVのマルウェア対策プラットフォームについて"></a>MDAVのマルウェア対策プラットフォームについて</h2><p>MDAVにより端末に最新の脅威からの保護を提供するためには、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#security-intelligence-updates">セキュリティインテリジェンスの更新プログラム</a>と<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#product-updates">製品の更新プログラム(マルウェア対策プラットフォーム)</a>を常に最新に保つことが重要です。</p><p><a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#monthly-platform-and-engine-versions">月次プラットフォームとエンジンのバージョン</a>に記載の通り、MDAVのマルウェア対策プラットフォームは公開している最新バージョンから 2 世代前より古いバージョンのサポートはアップグレードに関するサポートのみに縮小されます。</p><p>MDAVのマルウェア対策プラットフォーム更新プログラムは、2022年8月時点では「KB4052623」にてリリースされております。</p><p>この更新プログラムは通常、 Windows Update によってインターネットまたは WSUS などの更新元から取得され、自動的に更新されます。</p><p>本記事では、トラブルシューティングなどの目的で、MDAVのマルウェア対策プラットフォームを手動で更新する方法についてご紹介いたします。</p><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>MDAVのマルウェア対策プラットフォームは、更新プログラム(KB4052623)を端末に手動適用することで更新が可能です。</p><p>本項では、マルウェア対策プラットフォームの手動更新前に必要な準備について記載します。</p><h3 id="端末情報の確認"><a href="#端末情報の確認" class="headerlink" title="端末情報の確認"></a>端末情報の確認</h3><p>マルウェア対策プラットフォームの手動更新前に、更新を行う端末で以下の情報を確認する必要があります。</p><ol><li><strong>MDAVのサービス稼働状況の確認</strong></li></ol><p>Windows Update または手動更新手順によって MDAV のマルウェア対策プラットフォームを更新するためには、前提条件としてMDAVのサービス(WinDefend)が稼働している必要があります。</p><p>MDAV のサービスが停止している場合はマルウェア対策プラットフォームの更新に失敗するため、更新前にサービスが稼働していることを確認します。</p><p>PowerShell またはコマンドプロンプトで以下のコマンドを実行し、[STATE] に [4  RUNNING] と表示されることを確認します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe query WinDefend</span><br></pre></td></tr></table></figure><p>もし Windows Server 2016/ 2019 /2022 などのサーバ OS で MDAV のサービスが停止している場合、グループポリシーまたはレジストリの設定によってMDAVが無効化されているか否かを確認し、無効化されている場合は設定を解除する必要があります。</p><p>上記のサーバ OS を使用している場合は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/use-group-policy-microsoft-defender-antivirus?view=o365-worldwide#configure-microsoft-defender-antivirus-using-group-policy">グループ ポリシーを使用して Microsoft Defender ウイルス対策を構成する</a>に記載の手順に従って、[Microsoft Defender ウイルス対策を無効にする] の設定を [未構成] または [無効] に変更します。</p><p>レジストリ設定により MDAV を無効化している場合は、 <a href="https://docs.microsoft.com/ja-jp/windows-hardware/customize/desktop/unattend/security-malware-windows-defender-disableantispyware">DisableAntiSpyware</a> のレジストリ値を削除します。</p><p>なお、バージョン<code>4.18.2108.4</code>以上のマルウェア対策プラットフォームが適用されている Windows 10 / 11 などのクライアント OS では、前述のグループポリシーや <a href="https://docs.microsoft.com/ja-jp/windows-hardware/customize/desktop/unattend/security-malware-windows-defender-disableantispyware">DisableAntiSpyware</a> を用いた MDAV の無効化設定はサポートされていません。</p><p>これらのクライアント OS では、サードパーティ製のアンチマルウェアソフトがインストールされた際に、 MDAV が自動的に無効化されます。</p><p>そのため、上記のクライアント OS で MDAV を有効化するためには、サードパーティ製のアンチマルウェアソフトを一時的にアンインストールする必要があります。</p><ol start="2"><li><strong>現在適用されているマルウェア対策プラットフォームのバージョン</strong></li></ol><p>端末に適用されているマルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>未満である場合、最新の更新プログラムを適用する前に<code>4.18.2001.10</code>の更新プログラムを適用する必要があります。</p><p>※ バージョン<code>4.18.2001.10</code>を適用する際にはOSの再起動が必要になります。</p><p>※ すでにバージョン<code>4.18.2001.10</code>以降のバージョンが適用されている場合は、マルウェア対策プラットフォームの更新時のOS再起動は不要です。</p><p>現在適用されているマルウェア対策プラットフォームのバージョン情報は、PowerShellにて以下のコマンドレットを実行することで確認が可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AMProductVersion</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>端末のCPUアーキテクチャ</strong></li></ol><p>端末のCPUプラットフォームによって、マルウェア対策プラットフォームの手動更新に使用するモジュールが異なります。</p><p>具体的には、以下の3種類の更新モジュールが用意されておりますため、対象の端末に合わせて更新モジュールを選択する必要があります。</p><ul><li>amd64fre：64 bit CPU アーキテクチャ向けのパッチ</li><li>x86fre：32 bit CPU アーキテクチャ向けのパッチ</li><li>arm64fre：arm64 アーキテクチャ向けのパッチ</li></ul><p>端末の情報については、[設定]アプリの[システム]&gt;[バージョン情報]&gt;[デバイスの仕様]の表示を参照するか、以下のコマンドレットにて特定することが可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ComputerInfo</span> | <span class="built_in">Select-Object</span> WindowsBuildLabEx,CsSystemType</span><br></pre></td></tr></table></figure><h3 id="使用するモジュールのダウンロード"><a href="#使用するモジュールのダウンロード" class="headerlink" title="使用するモジュールのダウンロード"></a>使用するモジュールのダウンロード</h3><p>端末情報を確認した後、更新に使用するモジュールを取得して端末にコピーします。</p><p>更新プログラムは<a href="https://www.catalog.update.microsoft.com/Search.aspx?q=KB4052623">Microsoft Update カタログ</a>からダウンロードできます。</p><p><img src="../images/Endpoint-MDAV-2022-08-26-01.png" alt="Endpoint-MDAV-2022-08-26-01"></p><ol><li><strong>バージョン<code>4.18.2001.10</code>の取得(端末のバージョンが<code>4.18.2001.10</code>未満である場合のみ)</strong></li></ol><p>端末に適用されているマルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>未満である場合は、まずバージョン<code>4.18.2001.10</code>の更新プログラムをダウンロードする必要があります。</p><p>タイトルが「Windows Defender Antivirus マルウェア対策プラットフォームの更新プログラム - KB4052623 (Version 4.18.2001.10)」である行の内、最終更新日時が最も新しい行を選び、右側の[ダウンロード]をクリックします。</p><p>以下の画面が表示されたら、端末のCPUプラットフォームに対応したモジュールをダウンロードします。</p><p><img src="../images/Endpoint-MDAV-2022-08-26-02.png" alt="Endpoint-MDAV-2022-08-26-02"></p><p>各モジュールに対応するプラットフォームを確認する場合は、それぞれのファイルを一度ダウンロードした後、右クリックして [プロパティ]&gt;[詳細] を開きます。</p><p>ここで、[ファイルの説明] 欄の括弧の中に対象となるプラットフォームの情報が記載されています。</p><p><img src="../images/Endpoint-MDAV-2022-08-26-03.png" alt="Endpoint-MDAV-2022-08-26-03"></p><p>なお、本記事執筆時点では、バージョン<code>4.18.2001.10</code>の更新プログラムのファイル名と対象プラットフォームの対応は以下の通りであることを確認しております。</p><table><thead><tr><th align="center">ファイル名</th><th align="center">対応するアーキテクチャ</th></tr></thead><tbody><tr><td align="center">updateplatform_0456e6719c3ee098af03b785230ac020643fa1ac.exe</td><td align="center">amd64</td></tr><tr><td align="center">updateplatform_eaf76728f00b841dc9b3b1722f778e50ed59438a.exe</td><td align="center">x86</td></tr><tr><td align="center">updateplatform_19608225e67d613b65e183e1ca4159bc915cf331.exe</td><td align="center">arm64</td></tr></tbody></table><ol start="2"><li><strong>最新バージョンの取得</strong></li></ol><p>次に、最新の更新プログラムを取得します。</p><p>[1.] の手順と同様に、<a href="https://www.catalog.update.microsoft.com/Search.aspx?q=KB4052623">Microsoft Update カタログ</a>にてタイトルが最新バージョンを指す行の右側 [ダウンロード] ボタンをクリックします。</p><p>※ 本記事執筆時点では<code>4.18.2205.7</code>が最新バージョンです。</p><p>端末のCPUプラットフォームに対応したモジュールをダウンロードするために、3つすべてのモジュールをダウンロードします。</p><p>ダウンロードしたモジュールを右クリックして [プロパティ]&gt;[詳細] を開き、[ファイルの説明] 欄の情報から更新対象のプラットフォームに対応したモジュールを特定し、不要なファイルを端末から削除します。</p><h2 id="マルウェア対策プラットフォームの手動更新方法"><a href="#マルウェア対策プラットフォームの手動更新方法" class="headerlink" title="マルウェア対策プラットフォームの手動更新方法"></a>マルウェア対策プラットフォームの手動更新方法</h2><h3 id="バージョン4-18-2001-10の手動適用-端末のバージョンが4-18-2001-10未満である場合のみ"><a href="#バージョン4-18-2001-10の手動適用-端末のバージョンが4-18-2001-10未満である場合のみ" class="headerlink" title="バージョン4.18.2001.10の手動適用(端末のバージョンが4.18.2001.10未満である場合のみ)"></a>バージョン<code>4.18.2001.10</code>の手動適用(端末のバージョンが<code>4.18.2001.10</code>未満である場合のみ)</h3><p>端末に適用されているマルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>未満である場合、先にバージョン<code>4.18.2001.10</code>の更新プログラムを適用し、OSを再起動する必要があります。</p><p>事前に取得したバージョン<code>4.18.2001.10</code>の更新プログラムを端末にコピーし、右クリックして [管理者権限で実行] をクリックした後、更新が完了するまで1分ほど待機します。</p><p>※ 更新はバックグラウンドで実施されます。</p><p>その後OSを再起動し、PowerShellにて以下のコマンドレットを実行し、マルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>に更新されていることを確認します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AMProductVersion</span><br></pre></td></tr></table></figure><h3 id="最新バージョンのマルウェア対策プラットフォームの手動適用"><a href="#最新バージョンのマルウェア対策プラットフォームの手動適用" class="headerlink" title="最新バージョンのマルウェア対策プラットフォームの手動適用"></a>最新バージョンのマルウェア対策プラットフォームの手動適用</h3><p>事前に取得した最新バージョンの更新プログラムを端末にコピーし、右クリックして [管理者権限で実行] をクリックした後、更新が完了するまで1分ほど待機します。</p><p>※ こちらも更新はバックグラウンドで実行されます。</p><p>PowerShellにて以下のコマンドレットを実行し、マルウェア対策プラットフォームのバージョンが最新バージョンに更新されていることを確認します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AMProductVersion</span><br></pre></td></tr></table></figure><p>※ バージョン<code>4.18.2001.10</code>以降の更新プログラムを適用する際にはOSの再起動は不要です。</p><h2 id="更新プログラムのロールバック手順"><a href="#更新プログラムのロールバック手順" class="headerlink" title="更新プログラムのロールバック手順"></a>更新プログラムのロールバック手順</h2><p>続いて、トラブルシューティングを目的としてMDAVのマルウェア対策プラットフォームをロールバックする方法についてご紹介いたします。</p><p>マルウェア対策プラットフォームのロールバックはコマンドライン ツール<code>MpCmdRun.exe</code>を使用することで実施することが可能です。</p><p><code>MpCmdRun.exe</code>は、システムの以下のフォルダに存在します。<br>(使用するためには、管理者権限でPower Shellかコマンドプロンプトを起動する必要があります)</p><ul><li>C:\Program Files\Windows Defender</li><li>C:\ProgramData\Microsoft\Windows Defender\Platform&lt;最新のプラットフォームバージョン&gt;</li></ul><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/command-line-arguments-microsoft-defender-antivirus?view=o365-worldwide">コマンドラインを使用して Microsoft Defender ウイルス対策を管理する</a></p><p>以下のコマンドで、コマンドラインツール<code>MpCmdRun.exe</code>を使用してマルウェア対策プラットフォームをロールバックすることができます。</p><p>※ <a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide">改ざん防止機能</a>が有効な場合、これらのコマンド実行がブロックされる場合があります。</p><p>※ 公開している最新バージョンより 3 世代以上古いバージョンのサポートはアップグレードに関するサポートのみに縮小されるため、ロールバック後は必ずマルウェア対策プラットフォームを更新いただくようお願いいたします。</p><p>※ Windows 10 1809 / Windows Server 2016 以前のバージョンではロールバックはサポートされていません。</p><ol><li><strong>以前のバージョンにロールバックする方法</strong></li></ol><p>以下のコマンドで、マルウェア対策プラットフォームを以前のバージョンにロールバックすることができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MpCmdRun.exe <span class="literal">-revertplatform</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>更新前のバージョンにロールバックする方法</strong></li></ol><p>以下のコマンドで、マルウェア対策プラットフォームを完全に更新前の状態にロールバックすることができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MpCmdRun.exe <span class="literal">-resetplatform</span></span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事ではMicrosoft Defender ウイルス対策(MDAV)のマルウェア対策プラットフォームを手動で更新・ロールバックする方法についてご紹介いたしました。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合がありますことご了承ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;本記事ではMicrosoft  Defender ウイルス対策(MDAV)のマルウェア対策プラットフォームを手動で更新する方法についてご案内いたします。&lt;/p&gt;
&lt;p&gt;MDAVのセキュリティインテ</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
    <category term="マルウェア対策プラットフォーム" scheme="https://jp-sec.github.io/blog/tags/%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0/"/>
    
  </entry>
  
  <entry>
    <title>AIP スキャナーが対象リポジトリ内のファイルを破損してしまう事例について</title>
    <link href="https://jp-sec.github.io/blog/Azure_Information_Protection_2021_12_8/"/>
    <id>https://jp-sec.github.io/blog/Azure_Information_Protection_2021_12_8/</id>
    <published>2022-08-26T06:13:00.000Z</published>
    <updated>2024-10-21T08:59:25.149Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Security サポートチームです。<br>今回は AIPスキャナーが対象ファイルを破損させてしまう事例とその回避方法についてご案内いたします。</p><p>AIP スキャナーによるスキャンによって対象ファイルが破損するシナリオ</p><h2 id="1-スキャナー-ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。"><a href="#1-スキャナー-ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。" class="headerlink" title="1.スキャナー ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。"></a>1.スキャナー ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。</h2><p>AIP スキャナーはスキャン対象のファイルを検査・ラベル付け処理を行う際に、スキャナー コンピューターの一時領域に対象ファイル データを転送し、秘密度ラベルの適用処理後に<br>スキャン対象のリポジトリ パスにある原本と差し替えます。<br>現状の仕様ではスキャナー ノードの記憶域が十分に確保されていない場合にもコンテンツ スキャン ジョブは実行されてしまいます。この場合、スキャナー本体の記憶域の範囲内で<br>不完全なデータの状態で対象のコンテンツをラベル付けし、元のリポジトリ パスにあるファイルを差し替えるため、結果としてラベル付けされたファイルが故障してしまう場合があります。</p><p>&lt;回避策&gt;<br>スキャナー ノードの記憶域は十分な空き領域を確保いただくようにお願いいたします。<br>公開されている AIP スキャナーの前提条件では一時ファイルとして 10 GB は確保いただくことをお勧めしております。</p><p>&lt;参考&gt;<br><a href="https://docs.microsoft.com/ja-jp/azure/information-protection/deploy-aip-scanner-prereqs#windows-server-requirements">Azure Information Protection (AIP) 統合ラベルスキャナーの前提条件</a></p><p><img src="/blog/images/Azure_Information_Protection_2021_12_8_1.png"></p><h2 id="2-異なるスキャナー-クラスターに参加する複数の-AIP-スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。"><a href="#2-異なるスキャナー-クラスターに参加する複数の-AIP-スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。" class="headerlink" title="2.異なるスキャナー クラスターに参加する複数の AIP スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。"></a>2.異なるスキャナー クラスターに参加する複数の AIP スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。</h2><p>同一のリポジトリを対象にしたコンテンツ スキャン ジョブを設定した別々のクラスターに参加するノードでスキャンを実行すると、コンテンツ スキャンのタイミングがノード間でバッティングしてしまう場合があります。同一のコンテンツに対して複数のノードによるコンテンツ スキャンのタイミングがバッティングしてしまうと、最初のスキャン ジョブによるラベリング処理途中のコンテンツを後続のスキャン ジョブによってキャプチャしてしまう場合があり、この場合にも AIP スキャナーが 1. のシナリオと同様に不完全なデータをキャプチャして元のリポジトリに返すことでラベル付け処理されたコンテンツが故障する場合があります。</p><p>&lt;回避策&gt;<br>AIP スキャナーをスケールアウトする場合、単一のスキャナー クラスターに複数のノードを参加させて構成します。複数のノードで構成されているスキャナー クラスターは共有するデータベースによって、スキャン対象のリポジトリのスキャンに関するデータが共有され、各ノードが効率的にスキャンを行うよう動作します。<br>※以下の図は代表的なスキャナーのアーキテクチャの概要図になります。</p><p><img src="/blog/images/Azure_Information_Protection_2021_12_8_2.png"><br>図 1: Security,Compliance,and Identity に公開された “Best practices for deploying and using the AIP UL scanner“ より抜粋</p><p>上記を踏まえ、スキャナーのパフォーマンス向上の観点でスキャナーのノードの増設を検討する場合には、別々のリポジトリをスキャンするよう複数のクラスターを構成するか、同一のクラスターに<br>複数のノードを参加させるよう構成いただくことを検討ください。</p><p>&lt;参考&gt;<br><a href="https://docs.microsoft.com/ja-jp/azure/information-protection/deploy-aip-scanner-configure-install?tabs=azure-portal-only#optimize-scanner-performance">Azure Information Protection (AIP) 統合ラベル スキャナーをインストールして構成する</a></p><p><img src="/blog/images/Azure_Information_Protection_2021_12_8_3.png"></p><h2 id="3-対象のリポジトリ内のコンテンツが-DFS-レプリケーション等で複数のファイル-サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。"><a href="#3-対象のリポジトリ内のコンテンツが-DFS-レプリケーション等で複数のファイル-サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。" class="headerlink" title="3.対象のリポジトリ内のコンテンツが DFS レプリケーション等で複数のファイル サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。"></a>3.対象のリポジトリ内のコンテンツが DFS レプリケーション等で複数のファイル サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。</h2><p>スキャン対象のコンテンツが DFS レプリケーションなど複数のファイル サーバー間でデータの同期を行うよう構成されている場合、レプリケーション途中のファイルを AIP スキャナーがキャプチャしてしまう場合があります。<br>この場合にも 1. のシナリオと同様のメカニズムにより AIP スキャナーが不完全な状態のデータをキャプチャしラベル付けした上で元のリポジトリにあるファイルと差し替えをしてしまいファイルが故障してしまう場合があります。</p><p>&lt;回避策&gt;<br>DFS レプリケーションを構成している環境では、レプリケーションのスケジュール調整ならびにコンテンツ スキャン ジョブのスケジュールを “手動” に設定いただき、レプリケーションを実施する時間とコンテンツ スキャン ジョブが実行される時間帯が重複しないように調整いただくことを検討ください。</p><h2 id="4-AIP-スキャナーがスキャン対象としているリポジトリに対して、AIP-クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。"><a href="#4-AIP-スキャナーがスキャン対象としているリポジトリに対して、AIP-クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。" class="headerlink" title="4. AIP スキャナーがスキャン対象としているリポジトリに対して、AIP クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。"></a>4. AIP スキャナーがスキャン対象としているリポジトリに対して、AIP クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。</h2><p>上記の 1 ～ 3 のシナリオにて解説いたしました AIP スキャナー と同様に AIP クライアントも対象ファイルをラベル付け処理を行う際に、対象のファイルをローカルのプロファイル内にある一時フォルダにコピーした後に処理を実施します。<br>スキャナーによるファイル処理と AIP クライアントによるファイル処理がバッティングしてしまうと、不完全なファイルをキャプチャする事象が発生し、ラベル付け処理が行われたファイルが破損する可能性があります。</p><p>&lt;回避策&gt;<br>実際の環境でスキャン ジョブによる処理と AIP クライアントによるラベル付け処理がバッティングしてしまう可能性は現実的には低いと考えられますが、理論上はファイルが破損するリスクがあります。<br>AIP クライアントの GUI や PowerShell コマンド (Set-AIPFileLable) コマンドによって一括ラベル付け処理を計画される場合には、対象のフォルダ パスが AIP スキャナーのコンテンツ スキャン ジョブと重複していないか事前に確認いただくなど、運用によってリスクを低減することを検討ください。</p><h2 id="5-スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。"><a href="#5-スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。" class="headerlink" title="5. スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。"></a>5. スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。</h2><p>AIP スキャナーのローカルにある一時記憶域にてラベル付け処理が完了したファイルは、最終的にスキャン対象の元のリポジトリのファイル パスにあるデータと差し替えられます。<br>スキャナーがリポジトリ先の記憶域の逼迫を検出できた場合には、スキャン処理が失敗しますが、リポジトリ側の記憶域の逼迫の検出タイミング等の何らかの要因により、スキャナーがラベル付けを行ったファイルの差し替え処理の継続を試みる可能性があります。<br>対象リポジトリの記憶域が逼迫していることでデータの差し替えに失敗し、スキャン対象のファイルが破損する可能性があります。</p><p>&lt;回避策&gt;<br>スキャナー コンピューター自体の記憶域だけでなく、スキャン対象のリポジトリの記憶の空き容量にも十分注意いただくようお願いいたします。</p><p>AIP スキャナーにはラベル付け処理によって壊れてしまったファイルを復元する機能はありません。<br>今回の記事でご案内させていただいた各シナリオの情報が、AIP スキャナーを適切に展開/運用いただくことに寄与しましたら幸いです。</p><p>※本ブログ記事化にあたり、弊社サポートによる調査にご協力いただきましたお客様に深く感謝いたします。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Security サポートチームです。&lt;br&gt;今回は AIPスキャナーが対象ファイルを破損させてしまう事例とその回避方法についてご案内いたします。&lt;/p&gt;
&lt;p&gt;AIP スキャナーによるスキャンによって対象ファイルが破損するシナリオ&lt;/p&gt;
&lt;h2 </summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Defender ウイルス対策のセキュリティインテリジェンス(定義ファイル)を手動で更新・ロールバック・削除する方法</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/</id>
    <published>2022-08-04T00:00:00.000Z</published>
    <updated>2024-10-21T08:59:25.149Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>本記事ではMicrosoft  Defender ウイルス対策(MDAV)のセキュリティインテリジェンスの更新プログラム(定義ファイル/エンジン)を手動で更新する方法についてご案内いたします。</p><p>※ 本記事の内容はWindow 10 21H2環境にて動作を確認いたしております。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#MDAV%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">MDAVのセキュリティインテリジェンスについて</a></li><li><a href="#MDAV%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%82%92%E6%89%8B%E5%8B%95%E3%81%A7%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95">MDAVのセキュリティインテリジェンスを手動で更新する方法</a><ul><li><a href="#Windows-Update%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">Windows Updateを使用して更新する</a></li><li><a href="#Windows-%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">Windows セキュリティアプリを使用して更新する</a></li><li><a href="#Power-Shell-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%AC%E3%83%83%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">Power Shell コマンドレットを使用して更新する</a></li><li><a href="#MpCmdRun-%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">MpCmdRun ユーティリティを使用して更新する</a></li><li><a href="#%E6%89%8B%E5%8B%95%E6%9B%B4%E6%96%B0%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">手動更新パッケージを取得して更新する</a></li></ul></li><li><a href="#MDAV%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%82%92%E6%89%8B%E5%8B%95%E3%81%A7%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95">MDAVのセキュリティインテリジェンスを手動で削除する方法</a><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%89%8A%E9%99%A4%E6%96%B9%E6%B3%95">セキュリティインテリジェンスのロールバック・削除方法</a></li><li><a href="#%E5%8B%95%E7%9A%84%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%89%8B%E5%8B%95%E5%89%8A%E9%99%A4%E6%96%B9%E6%B3%95">動的セキュリティインテリジェンスの手動削除方法</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="MDAVのセキュリティインテリジェンスについて"><a href="#MDAVのセキュリティインテリジェンスについて" class="headerlink" title="MDAVのセキュリティインテリジェンスについて"></a>MDAVのセキュリティインテリジェンスについて</h2><p>MDAVにより端末に最新の脅威からの保護を提供するためには、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#security-intelligence-updates">セキュリティインテリジェンスの更新プログラム</a>と<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#product-updates">製品の更新プログラム</a>を常に最新に保つことが重要です。</p><p>MDAVのセキュリティインテリジェンスの更新プログラムは、2022年8月時点では「KB2267602」にてリリースされております。</p><p>また、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/cloud-protection-microsoft-defender-antivirus?view=o365-worldwide">クラウド保護(MAPS )</a>をご利用中の環境の場合は、「KB2267602」で配信される通常のセキュリティインテリジェンスの更新プログラムに加えて、動的なセキュリティインテリジェンス更新プログラムを取得し、端末に最新の保護を提供します。</p><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#security-intelligence-updates">セキュリティインテリジェンスの更新プログラム</a></p><p>本記事では、MDAVのセキュリティインテリジェンスの更新プログラムを手動で更新する方法についてご紹介いたします。</p><p>また、トラブルシューティングの目的で、MDAVのセキュリティインテリジェンスおよび動的なセキュリティインテリジェンスを手動でロールバック・削除する方法についてもご紹介いたします。</p><h2 id="MDAVのセキュリティインテリジェンスを手動で更新する方法"><a href="#MDAVのセキュリティインテリジェンスを手動で更新する方法" class="headerlink" title="MDAVのセキュリティインテリジェンスを手動で更新する方法"></a>MDAVのセキュリティインテリジェンスを手動で更新する方法</h2><p>MDAVのセキュリティインテリジェンスを手動で更新する場合、以下のいずれかの方法が利用できます。</p><ul><li>Windows Update</li><li>Windows セキュリティアプリ</li><li>Power Shell コマンドレット</li><li>MpCmdRun ユーティリティ</li><li>手動更新パッケージの取得</li></ul><h3 id="Windows-Updateを使用して更新する"><a href="#Windows-Updateを使用して更新する" class="headerlink" title="Windows Updateを使用して更新する"></a>Windows Updateを使用して更新する</h3><p>セキュリティインテリジェンスの更新は、通常Window Updateを利用して実施されます。</p><p>そのため、Windowの設定アプリを起動し、[更新とセキュリティ]&gt;[Windows Update]の画面から手動でWindows Updateを実行することで、セキュリティインテリジェンスを更新することが可能です。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-001.png" alt="Endpoint-MDAV-2022-07-29-001"></p><h3 id="Windows-セキュリティアプリを使用して更新する"><a href="#Windows-セキュリティアプリを使用して更新する" class="headerlink" title="Windows セキュリティアプリを使用して更新する"></a>Windows セキュリティアプリを使用して更新する</h3><p>Windows セキュリティアプリを開き、[ウイルスと脅威の防止]&gt;[ウイルスと脅威の防止の更新]&gt;[更新プログラムのチェック]を開きます。</p><p>ここで、[更新プログラムのチェック]をクリックすることで、セキュリティインテリジェンスの更新プログラムを手動更新することが可能です。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-002.png" alt="Endpoint-MDAV-2022-07-29-002"></p><p>この時に使用されるセキュリティインテリジェンスの更新元は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">フォールバック順序</a>の設定によって決定されます。</p><h3 id="Power-Shell-コマンドレットを使用して更新する"><a href="#Power-Shell-コマンドレットを使用して更新する" class="headerlink" title="Power Shell コマンドレットを使用して更新する"></a>Power Shell コマンドレットを使用して更新する</h3><p><a href="https://docs.microsoft.com/ja-jp/powershell/module/defender/update-mpsignature?view=windowsserver2022-ps">Update-MpSignature</a>コマンドレットを使用することで、Power Shellから手動でセキュリティインテリジェンスの更新を実施することが可能です。</p><p>セキュリティインテリジェンスを更新するためには、端末でPower Shellを起動し、以下のコマンドレットを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Update-MpSignature</span></span><br></pre></td></tr></table></figure><p><img src="../images/Endpoint-MDAV-2022-07-29-003.png" alt="Endpoint-MDAV-2022-07-29-003"></p><p>この時に使用されるセキュリティインテリジェンスの更新元は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">フォールバック順序</a>の設定によって決定されます。</p><p>特定の更新元を指定する場合は、<code>-UpdateSource</code>オプションを使用します。</p><p>以下の例では、Microsoft Malware Protection Center (MMPC)からセキュリティインテリジェンスの更新元として使用します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Update-MpSignature</span> <span class="literal">-UpdateSource</span> <span class="string">&quot;MMPC&quot;</span></span><br></pre></td></tr></table></figure><p>その他のオプションについては<a href="https://docs.microsoft.com/ja-jp/powershell/module/defender/update-mpsignature?view=windowsserver2022-ps">こちら</a>を参照してください。</p><h3 id="MpCmdRun-ユーティリティを使用して更新する"><a href="#MpCmdRun-ユーティリティを使用して更新する" class="headerlink" title="MpCmdRun ユーティリティを使用して更新する"></a>MpCmdRun ユーティリティを使用して更新する</h3><p>コマンドライン ツール<code>MpCmdRun.exe</code>を使用して手動でセキュリティインテリジェンスの更新を実施することができます。</p><p><code>MpCmdRun.exe</code>は、システムの以下のフォルダに存在します。<br>(使用するためには、管理者権限でPower Shellかコマンドプロンプトを起動する必要があります)</p><ul><li>C:\Program Files\Windows Defender</li><li>C:\ProgramData\Microsoft\Windows Defender\Platform\&lt;最新のプラットフォームバージョン&gt;</li></ul><p><code>MpCmdRun.exe</code>を用いてセキュリティインテリジェンスを手動更新するためには、管理者権限で起動したPower Shellにて以下のコマンドを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-SignatureUpdate</span></span><br></pre></td></tr></table></figure><p>この時に使用されるセキュリティインテリジェンスの更新元についても、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">フォールバック順序</a>の設定によって決定されます。</p><p>更新元を指定する場合は、</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-SignatureUpdate</span></span><br></pre></td></tr></table></figure><p><code>MpCmdRun.exe</code>の詳細については以下の公開情報をご参照ください。</p><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/command-line-arguments-microsoft-defender-antivirus?view=o365-worldwide">コマンドラインを使用して Microsoft Defender ウイルス対策を管理する</a></p><h3 id="手動更新パッケージを取得して更新する"><a href="#手動更新パッケージを取得して更新する" class="headerlink" title="手動更新パッケージを取得して更新する"></a>手動更新パッケージを取得して更新する</h3><p>以下のURLにて公開しているページから、セキュリティインテリジェンスの手動更新用プログラムをダウンロードすることが可能です。</p><p>参考情報：<a href="https://www.microsoft.com/en-us/wdsi/defenderupdates">セキュリティインテリジェンスの更新</a></p><p>上記のページにアクセスし、[Antimalware solution]の表から、更新対象のプラットフォームに対応したリンクをクリックします。</p><p>例：Intel CPU / Windows 10 21h2 の場合は、[Microsoft Defender Antivirus for Windows 11, Windows 10, Windows 8.1, and Windows Server]の行の[64-bit]のリンクをクリックします</p><p><img src="../images/Endpoint-MDAV-2022-07-29-004.png" alt="Endpoint-MDAV-2022-07-29-004"></p><p>ダウンロードしたファイルを右クリックして[管理者として実行]をクリックすることで、バックグラウンドでセキュリティインテリジェンスの更新が完了します。</p><h2 id="MDAVのセキュリティインテリジェンスを手動で削除する方法"><a href="#MDAVのセキュリティインテリジェンスを手動で削除する方法" class="headerlink" title="MDAVのセキュリティインテリジェンスを手動で削除する方法"></a>MDAVのセキュリティインテリジェンスを手動で削除する方法</h2><p>続いて、トラブルシューティングを目的としてMDAVのセキュリティインテリジェンスをロールバック/削除する方法についてご紹介いたします。</p><p>セキュリティインテリジェンスのリストア・削除は、コマンドライン ツール<code>MpCmdRun.exe</code>を使用することで実施することが可能です。</p><p><code>MpCmdRun.exe</code>は、システムの以下のフォルダに存在します。<br>(使用するためには、管理者権限でPower Shellかコマンドプロンプトを起動する必要があります)</p><ul><li>C:\Program Files\Windows Defender</li><li>C:\ProgramData\Microsoft\Windows Defender\Platform\&lt;最新のプラットフォームバージョン&gt;</li></ul><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/command-line-arguments-microsoft-defender-antivirus?view=o365-worldwide">コマンドラインを使用して Microsoft Defender ウイルス対策を管理する</a></p><h3 id="セキュリティインテリジェンスのロールバック・削除方法"><a href="#セキュリティインテリジェンスのロールバック・削除方法" class="headerlink" title="セキュリティインテリジェンスのロールバック・削除方法"></a>セキュリティインテリジェンスのロールバック・削除方法</h3><p><strong>注意：セキュリティインテリジェンスを削除するとMDAVによる保護が提供できなくなりますためご留意ください。</strong></p><p><code>-RemoveDefinitions</code>オプションを使用してコマンドを実行することで、セキュリティインテリジェンス(定義ファイル/エンジン)を更新前のバージョンにロールバックできます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-RemoveDefinitions</span></span><br></pre></td></tr></table></figure><p>また、<code>-All</code>オプションを付与することで、MDAVのセキュリティインテリジェンスを完全に削除することが可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-RemoveDefinitions</span> <span class="literal">-All</span></span><br></pre></td></tr></table></figure><p><strong>注意：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide">改ざん防止機能</a>が有効な場合、MDAVのセキュリティインテリジェンスを完全に削除することはできません。</strong></p><p>セキュリティインテリジェンスが削除されたことを確認するためには、Power Shellを起動して<code>Get-MpComputerStatus | Select-Object AMEngineVersion,AntivirusSignatureVersion</code>コマンドレットを実行します。</p><p>セキュリティインテリジェンスが完全に削除されている場合、<code>0.0.0.0</code>が出力されます。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-005.png" alt="Endpoint-MDAV-2022-07-29-005"></p><h3 id="動的セキュリティインテリジェンスの手動削除方法"><a href="#動的セキュリティインテリジェンスの手動削除方法" class="headerlink" title="動的セキュリティインテリジェンスの手動削除方法"></a>動的セキュリティインテリジェンスの手動削除方法</h3><p>コマンドライン ツール<code>MpCmdRun.exe</code>を使用することで、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/cloud-protection-microsoft-defender-antivirus?view=o365-worldwide">クラウド保護(MAPS )</a>が利用する動的セキュリティインテリジェンスを手動で削除することが可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-RemoveDefinitions</span> <span class="literal">-DynamicSignatures</span></span><br></pre></td></tr></table></figure><p>動的セキュリティインテリジェンスが削除されたことを確認するためには、MDAVのイベントログにイベントID:2013のイベントの出力を確認します。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-006.png" alt="Endpoint-MDAV-2022-07-29-006"></p><p>MDAVのイベントログの詳細については以下の公開情報にてご案内いたしております。</p><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide">Microsoft Defender ウイルス対策イベントの ID とエラー コード</a></p><p>また、Power Shellにて以下のコマンドレットを実行することで、動的セキュリティインテリジェンスが最後に削除されたイベントを取得することができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-WinEvent</span> <span class="selector-tag">@</span>&#123;ProviderName=<span class="string">&#x27;Microsoft-Windows-Windows Defender&#x27;</span>;ID=<span class="number">2013</span>&#125; <span class="literal">-MaxEvents</span> <span class="number">1</span></span><br><span class="line">TimeCreated                      Id LevelDisplayName Message</span><br><span class="line">-----------                      -- ---------------- -------</span><br><span class="line"><span class="number">2022</span>/<span class="number">08</span>/<span class="number">03</span> <span class="number">22</span>:<span class="number">39</span>:<span class="number">14</span>            <span class="number">2013</span> 情報             Microsoft Defender ウイルス対策 ですべての動的セキュリティ インテリジェンスが破棄されました。...</span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事ではMicrosoft  Defender ウイルス対策(MDAV)のセキュリティインテリジェンスの更新プログラム(定義ファイル/エンジン)を手動で更新・ロールバック・削除する方法についてご紹介いたしました。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合がありますことご了承ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;本記事ではMicrosoft  Defender ウイルス対策(MDAV)のセキュリティインテリジェンスの更新プログラム(定義ファイル/エンジン)を手動で更新する方法についてご案内いたします。&lt;/</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
    <category term="セキュリティインテリジェンス" scheme="https://jp-sec.github.io/blog/tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9/"/>
    
  </entry>
  
</feed>
