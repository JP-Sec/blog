<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan CSS Security Support Blog</title>
  
  <subtitle>日本マイクロソフトのセキュリティ製品に関するサポート情報のブログです。</subtitle>
  <link href="https://jp-sec.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jp-sec.github.io/blog/"/>
  <updated>2022-10-28T08:39:56.862Z</updated>
  <id>https://jp-sec.github.io/blog/</id>
  
  <author>
    <name>CSS Japan Secuirty team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>macOS および Linux デバイスで Client Analyzer ツールによる正常性診断を実行する方法</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-09-28/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-09-28/</id>
    <published>2022-09-28T06:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>この記事では Microsoft Defender for Endpoint on mac(MDE on mac) および Microsoft Defender for Endpoint on Linux(MDE on Linux) のデバイス正常性の評価に役立つ <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide">Microsoft Defender for Endpoint Client Analyzer(MDECA)</a> の使用方法についてご紹介します。</p><p>Client Analyzer ツールの詳細については、以下の公開情報にてご案内いたしております。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide">Microsoft Defender for Endpoint クライアント アナライザーを使用したセンサーの正常性のトラブルシューティング</a></p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E5%89%8D%E3%81%AB">Client Analyzer ツールを使用する前に</a></li><li><a href="#macOS-%E3%81%A7-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">macOS で Client Analyzer ツールを使用する</a><ul><li><a href="#macOS-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">macOS での Client Analyzer ツールの実行方法 (Python3を使用する)</a></li><li><a href="#macOS-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84">macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)</a></li></ul></li><li><a href="#Linux-%E3%81%A7-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">Linux で Client Analyzer ツールを使用する</a><ul><li><a href="#Linux-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">Linux での Client Analyzer ツールの実行方法 (Python3を使用する)</a></li><li><a href="#Linux-%E3%81%A7%E3%81%AE-Client-Analyzer-%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95-Python3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84">Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="Client-aAnalyzer-ツールを使用する前に"><a href="#Client-aAnalyzer-ツールを使用する前に" class="headerlink" title="Client aAnalyzer ツールを使用する前に"></a>Client aAnalyzer ツールを使用する前に</h2><p>macOS または Linux 端末にてClient Analyzer ツールを使用してデバイスの診断を行う前に、デバイスが以下の前提要件を満たしていることを確認する必要があります。</p><ol><li>プロキシまたはファイアウォールの構成で <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/configure-proxy-internet?view=o365-worldwide#enable-access-to-microsoft-defender-for-endpoint-service-urls-in-the-proxy-server">Microsoft Defender for Endpoint サービスの使用する URL</a> へのアクセス許可が構成されていることを確認します。</li><li>デバイスが MDE へのオンボードに必要な <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/minimum-requirements?view=o365-worldwide">最小要件</a> を満たしていることを確認します。</li></ol><p>Client Analyzer ツールを使用する場合の前提要件に関する最新の情報は以下のページより確認いただくことができます。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide#requirements">Microsoft Defender for Endpoint クライアント アナライザーを使用したセンサーの正常性のトラブルシューティング | 前提要件</a></p><h2 id="macOS-で-Client-Analyzer-ツールを使用する"><a href="#macOS-で-Client-Analyzer-ツールを使用する" class="headerlink" title="macOS で Client Analyzer ツールを使用する"></a>macOS で Client Analyzer ツールを使用する</h2><p>※ 本記事の手順は Intelベースの macOS Big Sur(Version 11.7) にて動作確認を実施しています。</p><p>Client Analyzer ツールを使用する手順に関する最新の情報については、以下の公開情報ページをご参照くださいますようお願いいたします。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-macos-linux?view=o365-worldwide#running-the-analyzer-through-gui-scenario">macOS または Linux でのクライアント アナライザーの実行</a></p><h3 id="macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用する"><a href="#macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用する" class="headerlink" title="macOS での Client Analyzer ツールの実行方法 (Python3を使用する)"></a>macOS での Client Analyzer ツールの実行方法 (Python3を使用する)</h3><p>このセクションでは、コマンドラインインターフェース(CLI)を使用した Client Analyzer ツールの実行方法について紹介します。</p><p>このセクションで紹介する手順を使用するためには、デバイスで <code>python3</code> コマンドと Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が利用可能である必要があります。</p><p>※ <code>python3</code> コマンドが使用できないデバイスで Client Analyzer ツールを実行する手順については、[macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)][#macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)] のセクションを参照してください。</p><ol><li>デバイスで ターミナルを起動し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -OL https://aka.ms/XMDEClientAnalyzer</span><br><span class="line">$ unzip -q XMDEClientAnalyzer</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルとディレクトリが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── mde_support_tool.sh</span><br><span class="line">├── mde_tools/</span><br><span class="line">└── requirements.txt</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドを実行して、<code>mde_support_tool.sh</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x mde_support_tool.sh</span><br></pre></td></tr></table></figure><ol start="4"><li><code>mde_support_tool.sh</code>を実行し、必要なコンポーネントをインストールします。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./mde_support_tool.sh</span><br></pre></td></tr></table></figure><p>※ デバイスで<code>python3</code>コマンドが使用できない場合、<code>mde_support_tool.sh</code>の実行に失敗し、以下のようにPython3のインストールを要求する画面が表示される場合があります。</p><p><img src="../images/Endpoint-MDAV-2022-09-28-01.png" alt="Endpoint-MDAV-2022-09-28-01"></p><ol start="5"><li>上記のコマンド実行によりコンポーネントのインストールに成功した後、以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./mde_support_tool.sh -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 03:47:45.646][INFO] Archive created at: /tmp/28_09_2022_03_47_45_output.zip</span><br></pre></td></tr></table></figure><h3 id="macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用しない"><a href="#macOS-での-Client-Analyzer-ツールの実行方法-Python3を使用しない" class="headerlink" title="macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)"></a>macOS での Client Analyzer ツールの実行方法 (Python3を使用しない)</h3><p>このセクションでは、<code>python3</code>コマンドまたは Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が使用できない環境にてClient Analyzer ツールを実行する方法について紹介します。</p><ol><li>デバイスで ターミナルを起動し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -OL https://aka.ms/XMDEClientAnalyzerBinary</span><br><span class="line">$ unzip -q XMDEClientAnalyzerBinary</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── SupportToolLinuxBinary.zip</span><br><span class="line">├── SupportToolmacOS-armBinary.zip</span><br><span class="line">└── SupportToolmacOSBinary.zip</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドで、Intel ベースの macOS 用パッケージを展開します。</li></ol><p>※ M1 ベースの macOS を使用する場合は<code>SupportToolmacOS-armBinary.zip</code>を展開します。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -q SupportToolmacOSBinary.zip</span><br></pre></td></tr></table></figure><ol start="4"><li>以下のコマンドを実行して、展開された<code>MDESupportTool</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x MDESupportTool</span><br></pre></td></tr></table></figure><ol start="5"><li>以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./MDESupportTool -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 03:47:45.646][INFO] Archive created at: /tmp/28_09_2022_03_47_45_output.zip</span><br></pre></td></tr></table></figure><h2 id="Linux-で-Client-Analyzer-ツールを使用する"><a href="#Linux-で-Client-Analyzer-ツールを使用する" class="headerlink" title="Linux で Client Analyzer ツールを使用する"></a>Linux で Client Analyzer ツールを使用する</h2><p>※ 本記事の手順は Red Hat Enterprise Linux Server 7.7 (Maipo) にて動作確認を実施しています。</p><p>Client Analyzer ツールを使用する手順に関する最新の情報については、以下の公開情報ページをご参照ください。</p><p>参考情報：<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-macos-linux?view=o365-worldwide#running-the-analyzer-through-gui-scenario">macOS または Linux でのクライアント アナライザーの実行</a></p><h3 id="Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用する"><a href="#Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用する" class="headerlink" title="Linux での Client Analyzer ツールの実行方法 (Python3を使用する)"></a>Linux での Client Analyzer ツールの実行方法 (Python3を使用する)</h3><p>このセクションでは、コマンドラインインターフェース(CLI)を使用した Client Analyzer ツールの実行方法について紹介します。</p><p>このセクションで紹介する手順を使用するためには、デバイスで <code>python3</code> コマンドと Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が利用可能である必要があります。</p><p>※ <code>python3</code> コマンドが使用できないデバイスで Client Analyzer ツールを実行する手順については、[Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)][#Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)] のセクションを参照してください。</p><ol><li>デバイスの CLI を使用し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget --quiet -O XMDEClientAnalyzer.zip https://aka.ms/XMDEClientAnalyzer</span><br><span class="line">$ unzip -q XMDEClientAnalyzer.zip</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルとディレクトリが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── mde_support_tool.sh</span><br><span class="line">├── mde_tools/</span><br><span class="line">└── requirements.txt</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドを実行して、<code>mde_support_tool.sh</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x mde_support_tool.sh</span><br></pre></td></tr></table></figure><ol start="4"><li><code>mde_support_tool.sh</code>を実行し、必要なコンポーネントをインストールします。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./mde_support_tool.sh</span><br></pre></td></tr></table></figure><p>※ デバイスで<code>python3</code>コマンドが使用できない場合、<code>python3: command not found</code>のエラーメッセージが表示され、<code>mde_support_tool.sh</code>の実行に失敗します。</p><ol start="5"><li>上記のコマンド実行によりコンポーネントのインストールに成功した後、以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./mde_support_tool.sh -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 02:27:45.636][INFO] Archive created at: /tmp/28_09_2022_02_26_53_output.zip</span><br></pre></td></tr></table></figure><h3 id="Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用しない"><a href="#Linux-での-Client-Analyzer-ツールの実行方法-Python3を使用しない" class="headerlink" title="Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)"></a>Linux での Client Analyzer ツールの実行方法 (Python3を使用しない)</h3><p>このセクションでは、<code>python3</code>コマンドまたは Python パッケージ <a href="https://pypi.org/search/?q=lxml">lxml</a> が使用できない環境にてClient Analyzer ツールを実行する方法について紹介します。</p><ol><li>デバイスの CLI を使用し、任意のディレクトリで以下のコマンドを順に実行します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget --quiet -O XMDEClientAnalyzerBinary.zip https://aka.ms/XMDEClientAnalyzerBinary</span><br><span class="line">$ unzip -q XMDEClientAnalyzerBinary.zip</span><br></pre></td></tr></table></figure><ol start="2"><li>圧縮ファイルが展開され、以下のファイルが存在することを確認します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── SupportToolLinuxBinary.zip</span><br><span class="line">├── SupportToolmacOS-armBinary.zip</span><br><span class="line">└── SupportToolmacOSBinary.zip</span><br></pre></td></tr></table></figure><ol start="3"><li>以下のコマンドで、Linux 用のパッケージを展開します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -q SupportToolLinuxBinary.zip</span><br></pre></td></tr></table></figure><ol start="4"><li>以下のコマンドを実行して、展開された<code>MDESupportTool</code>に実行権限を付与します。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x MDESupportTool</span><br></pre></td></tr></table></figure><ol start="5"><li>以下のコマンドで Client Analyzer ツールを実行します。(プロンプトが表示された場合は <code>y</code> と入力して Enter を押下します)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./MDESupportTool -d</span><br></pre></td></tr></table></figure><ol start="6"><li>Client Analyzer ツールの実行に成功すると、下記出力例の通り、Client Analyzer ツールによって収集された情報が含まれるファイルのパスが表示されます。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-09-28 02:40:51.848][INFO] Archive created at: /tmp/28_09_2022_02_40_00_output.zip</span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>この記事では、 MDE にオンボードされた macOS および Linux デバイスの正常性の評価に役立つ <a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/overview-client-analyzer?view=o365-worldwide">Microsoft Defender for Endpoint Client Analyzer(MDECA)</a> の使用方法についてご紹介しました。</p><p>Client Analyzer ツールによって作成されたパッケージファイルに含まれる情報の概要については<a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/run-analyzer-macos-linux?view=o365-worldwide#result-package-contents-on-macos-and-linux">macOS と Linux のパッケージの内容</a> にてご案内いたしております。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;この記事では Microsoft Defender for Endpoint on mac(MDE on mac) および Microsoft Defender for Endpoint on L</summary>
      
    
    
    
    
    <category term="MDE on Linux" scheme="https://jp-sec.github.io/blog/tags/MDE-on-Linux/"/>
    
    <category term="MDE on macOS" scheme="https://jp-sec.github.io/blog/tags/MDE-on-macOS/"/>
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>日本語 (マルチバイト文字) でカスタム プロパティが構成されている Office ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある。</title>
    <link href="https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2022-09-26-01/"/>
    <id>https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2022-09-26-01/</id>
    <published>2022-09-25T15:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.858Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Security サポートチームです。<br>今回は AIP クライアント (右クリックオプションの「分類して保護する」) や、PowerShell コマンドレット、AIP スキャナーのご利用にあたって、注意する必要があるシナリオが確認できましたのでお知らせいたします。</p><h2 id="日本語-マルチバイト文字-でカスタム-プロパティが構成されている-Office-ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある"><a href="#日本語-マルチバイト文字-でカスタム-プロパティが構成されている-Office-ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある" class="headerlink" title="日本語 (マルチバイト文字) でカスタム プロパティが構成されている Office ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある"></a>日本語 (マルチバイト文字) でカスタム プロパティが構成されている Office ドキュメントの秘密度ラベルを削除するとファイルが破損する場合がある</h2><p>Office ドキュメントには、ファイルの内容を識別しやすくするためのプロパティとして、独自の情報を使用できるカスタム プロパティの項目があります。<br>このカスタム プロパティの設定は、例えば Windows Server 標準機能のファイル分類インフラストラクチャ (Windows Server FCI) の分類規則ジョブで付与するシナリオがよく知られています。<br>ドキュメントに設定されているカスタム プロパティ情報の詳細は、Office アプリの [ファイル] &gt; [情報] オプション画面内の “プロパティ (詳細プロパティ)” の [ユーザー設定] タブの箇所から確認することができます。<br>Office ドキュメントに対して秘密度ラベル機能 (Microsoft Information Protection) を利用する場合にも、カスタム プロパティの設定箇所を利用して、秘密度ラベルに関するメタデータ (ラベル ID や) を記述する仕様となっています。<br>一般的なユースケースとして、カスタム プロパティにお客様独自のメタデータ (分類プロパティ) が含まれている場合でも、秘密度ラベルと併用することは問題ありませんが、一部の限定的な条件で Office ドキュメント ファイルが破損する症状を確認いたしました。<br>以下に発生条件や要因、対処方法についてご案内します。</p><h3 id="【事象の発生条件と概要】"><a href="#【事象の発生条件と概要】" class="headerlink" title="【事象の発生条件と概要】"></a>【事象の発生条件と概要】</h3><ol><li>秘密度ラベルの共同編集機能が無効 (既定値) となっているテナント</li><li>対象ファイルに日本語 (マルチバイト文字) で秘密度ラベル以外のカスタム プロパティ情報が含まれていること</li><li>対象ファイルに暗号化設定のある秘密度ラベルが付与されていること</li><li>対象ファイルを AIP クライアント (右クリック &gt;[分類して保護する]) エクスプローラーたは PowerShell コマンドレット (Set-AIPFileLabel) を使用してラベルを削除する or AIP スキャナーのコンテンツ スキャンジョブでラベルを削除する</li></ol><p>上記の条件を満たした場合、Office アプリで対象ファイルを開封する際に「’対象ドキュメント名’ の一部の内容に問題が見つかりました。可能な限り内容を回復しますか？ブックの発行元が信頼できる場合は、[はい]をクリックしてください。」と表示される状態となります。<br>[はい] をクリックすると、Office アプリの修復機能により問題が修復された状態となります。<br>ファイルを保存し直すことで再利用可能な状態となります。</p><h3 id="【事象の要因】"><a href="#【事象の要因】" class="headerlink" title="【事象の要因】"></a>【事象の要因】</h3><p>AIP クライアント モジュールで使用されている一部のコンポーネントがマルチバイト文字に対応しておらず、カスタム プロパティ情報の処理に失敗することが要因であることを確認しております。<br>AIP クライアントは2022年1月よりメンテナンス モードに入っており、セキュリティ上重大な問題以外の修正は行われない状態となっており、本問題についてはシナリオが限定的であることもあり改修されないことが決定されています。</p><h3 id="【対処-回避方法】"><a href="#【対処-回避方法】" class="headerlink" title="【対処/回避方法】"></a>【対処/回避方法】</h3><ol><li><p>該当ファイルを Office アプリの修復機能で修正後、そのまま利用する<br>AIP クライアントによるラベル付与/削除処理によって、マルチバイト文字のカスタム プロパティ情報の処理の一部に失敗することから事象が発生しますが、該当ｎファイルは Office アプリによる修復によって以前の通りに使用できるようになります。<br>エラー メッセージは表示されてしまうものの Office アプリの修復機能を利用して、該当ファイルをそのままご利用いただくことが可能です。</p></li><li><p>秘密度ラベルの共同編集機能を有効にする<br>秘密度ラベルの共同編集機能を利用することで、AIP 側の Office ドキュメントのメタデータの用法が変更されます。<br>これによって事象が発生しなくなります。<br>共同編集機能を有効化する場合には、秘密度ラベル機能を利用するユーザーは共同編集に対応したバージョンの Office アプリである Microsoft 365 Apps を使用する必要があります。<br>テナント内のユーザーでボリュームライセンス版の Office Professional Plus エディションと AIP クライアントの組み合わせで秘密度ラベルを利用している端末などがある場合には共同編集の有効化機能を推奨しておりません。<br>また、AIP のカスタム プロパティを使用した独自アプリケーションなどを運用いただいている場合にも、この設定は推奨されません。<br>この設定はお客様側で元に戻すことができませんので、有効化を検討する場合には前提条件や制限事項などの注意事項をよく確認のうえで計画いただけましたら幸いです。</p></li></ol><p>&lt;参考&gt;<br>Title : 機密度ラベルを使用して暗号化されたファイルの共同編集を有効にする<br>URL : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/compliance/sensitivity-labels-coauthoring?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/compliance/sensitivity-labels-coauthoring?view=o365-worldwide</a></p><ol start="3"><li><p>カスタム プロパティにシングルバイトの英数字を利用する<br>現在日本語で運用いただいているカスタム プロパティの情報をシングルバイト (半角英数字) に書き換えることで事象の発生を緩和させることが可能です。<br>これからカスタム プロパティを利用した運用を計画している場合などにはこのアプローチも有効となる可能性があります。</p></li><li><p>Office アプリを使用してラベルを削除する<br>AIP クライアントや AIP スキャナーを使用して、Office ドキュメントのラベルを削除した場合に問題が発生します。<br>該当ファイルのラベルを削除したい場合に、Office アプリを使用してラベルを削除する場合にはこの問題は発生しません。<br>[秘密度] のアイコンから該当のラベルを再度クリックすることで、ラベルを削除することができます。</p></li></ol><p>ラベルによって保護されたドキュメントを外部に共有したい場合などにラベルを削除してからデータを渡すシナリオがよくあるかと存じます。<br>ラベルを削除する操作は外部共有に限りませんが、特定の条件下でラベルを削除した対象ファイルについては、Office アプリでファイルを開封する際に、破損を検出する動作となる点についてご理解をいただけましたら幸いです。</p><p>今回のお知らせは以上になります。</p><p>※本ブログ記事化にあたり、弊社サポートによる調査にご協力いただきましたお客様に深く感謝いたします。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Security サポートチームです。&lt;br&gt;今回は AIP クライアント (右クリックオプションの「分類して保護する」) や、PowerShell コマンドレット、AIP スキャナーのご利用にあたって、注意する必要があるシナリオが確認できましたので</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Defender ウイルス対策のマルウェア対策プラットフォームを手動で更新・ロールバックする方法</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-08-26/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-08-26/</id>
    <published>2022-09-08T00:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>本記事ではMicrosoft  Defender ウイルス対策(MDAV)のマルウェア対策プラットフォームを手動で更新する方法についてご案内いたします。</p><p>MDAVのセキュリティインテリジェンス(定義ファイル)を手動で更新する方法については以下の記事をご参照ください。</p><p>参考情報：<a href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/">Microsoft Defender ウイルス対策のセキュリティインテリジェンス(定義ファイル)を手動で更新・ロールバック・削除する方法</a></p><p>※ 本記事の内容はWindow Server 2019環境にて動作を確認いたしております。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#MDAV%E3%81%AE%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">MDAVのマルウェア対策プラットフォームについて</a></li><li><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">事前準備</a><ul><li><a href="#%E7%AB%AF%E6%9C%AB%E6%83%85%E5%A0%B1%E3%81%AE%E7%A2%BA%E8%AA%8D">端末情報の確認</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">使用するモジュールのダウンロード</a></li></ul></li><li><a href="#%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%AE%E6%89%8B%E5%8B%95%E6%9B%B4%E6%96%B0%E6%96%B9%E6%B3%95">マルウェア対策プラットフォームの手動更新方法</a><ul><li><a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3418200110%E3%81%AE%E6%89%8B%E5%8B%95%E9%81%A9%E7%94%A8%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C418200110%E6%9C%AA%E6%BA%80%E3%81%A7%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E3%81%BF">バージョン<code>4.18.2001.10</code>の手動適用(端末のバージョンが<code>4.18.2001.10</code>未満である場合のみ)</a></li><li><a href="#%E6%9C%80%E6%96%B0%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%AE%E6%89%8B%E5%8B%95%E9%81%A9%E7%94%A8">最新バージョンのマルウェア対策プラットフォームの手動適用</a></li></ul></li><li><a href="#%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E6%89%8B%E9%A0%86">更新プログラムのロールバック手順</a></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="MDAVのマルウェア対策プラットフォームについて"><a href="#MDAVのマルウェア対策プラットフォームについて" class="headerlink" title="MDAVのマルウェア対策プラットフォームについて"></a>MDAVのマルウェア対策プラットフォームについて</h2><p>MDAVにより端末に最新の脅威からの保護を提供するためには、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#security-intelligence-updates">セキュリティインテリジェンスの更新プログラム</a>と<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#product-updates">製品の更新プログラム(マルウェア対策プラットフォーム)</a>を常に最新に保つことが重要です。</p><p><a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#monthly-platform-and-engine-versions">月次プラットフォームとエンジンのバージョン</a>に記載の通り、MDAVのマルウェア対策プラットフォームは公開している最新バージョンから 2 世代前より古いバージョンのサポートはアップグレードに関するサポートのみに縮小されます。</p><p>MDAVのマルウェア対策プラットフォーム更新プログラムは、2022年8月時点では「KB4052623」にてリリースされております。</p><p>この更新プログラムは通常、 Windows Update によってインターネットまたは WSUS などの更新元から取得され、自動的に更新されます。</p><p>本記事では、トラブルシューティングなどの目的で、MDAVのマルウェア対策プラットフォームを手動で更新する方法についてご紹介いたします。</p><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>MDAVのマルウェア対策プラットフォームは、更新プログラム(KB4052623)を端末に手動適用することで更新が可能です。</p><p>本項では、マルウェア対策プラットフォームの手動更新前に必要な準備について記載します。</p><h3 id="端末情報の確認"><a href="#端末情報の確認" class="headerlink" title="端末情報の確認"></a>端末情報の確認</h3><p>マルウェア対策プラットフォームの手動更新前に、更新を行う端末で以下の情報を確認する必要があります。</p><ol><li><strong>MDAVのサービス稼働状況の確認</strong></li></ol><p>Windows Update または手動更新手順によって MDAV のマルウェア対策プラットフォームを更新するためには、前提条件としてMDAVのサービス(WinDefend)が稼働している必要があります。</p><p>MDAV のサービスが停止している場合はマルウェア対策プラットフォームの更新に失敗するため、更新前にサービスが稼働していることを確認します。</p><p>PowerShell またはコマンドプロンプトで以下のコマンドを実行し、[STATE] に [4  RUNNING] と表示されることを確認します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe query WinDefend</span><br></pre></td></tr></table></figure><p>もし Windows Server 2016/ 2019 /2022 などのサーバ OS で MDAV のサービスが停止している場合、グループポリシーまたはレジストリの設定によってMDAVが無効化されているか否かを確認し、無効化されている場合は設定を解除する必要があります。</p><p>上記のサーバ OS を使用している場合は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/use-group-policy-microsoft-defender-antivirus?view=o365-worldwide#configure-microsoft-defender-antivirus-using-group-policy">グループ ポリシーを使用して Microsoft Defender ウイルス対策を構成する</a>に記載の手順に従って、[Microsoft Defender ウイルス対策を無効にする] の設定を [未構成] または [無効] に変更します。</p><p>レジストリ設定により MDAV を無効化している場合は、 <a href="https://docs.microsoft.com/ja-jp/windows-hardware/customize/desktop/unattend/security-malware-windows-defender-disableantispyware">DisableAntiSpyware</a> のレジストリ値を削除します。</p><p>なお、バージョン<code>4.18.2108.4</code>以上のマルウェア対策プラットフォームが適用されている Windows 10 / 11 などのクライアント OS では、前述のグループポリシーや <a href="https://docs.microsoft.com/ja-jp/windows-hardware/customize/desktop/unattend/security-malware-windows-defender-disableantispyware">DisableAntiSpyware</a> を用いた MDAV の無効化設定はサポートされていません。</p><p>これらのクライアント OS では、サードパーティ製のアンチマルウェアソフトがインストールされた際に、 MDAV が自動的に無効化されます。</p><p>そのため、上記のクライアント OS で MDAV を有効化するためには、サードパーティ製のアンチマルウェアソフトを一時的にアンインストールする必要があります。</p><ol start="2"><li><strong>現在適用されているマルウェア対策プラットフォームのバージョン</strong></li></ol><p>端末に適用されているマルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>未満である場合、最新の更新プログラムを適用する前に<code>4.18.2001.10</code>の更新プログラムを適用する必要があります。</p><p>※ バージョン<code>4.18.2001.10</code>を適用する際にはOSの再起動が必要になります。</p><p>※ すでにバージョン<code>4.18.2001.10</code>以降のバージョンが適用されている場合は、マルウェア対策プラットフォームの更新時のOS再起動は不要です。</p><p>現在適用されているマルウェア対策プラットフォームのバージョン情報は、PowerShellにて以下のコマンドレットを実行することで確認が可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AMProductVersion</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>端末のCPUアーキテクチャ</strong></li></ol><p>端末のCPUプラットフォームによって、マルウェア対策プラットフォームの手動更新に使用するモジュールが異なります。</p><p>具体的には、以下の3種類の更新モジュールが用意されておりますため、対象の端末に合わせて更新モジュールを選択する必要があります。</p><ul><li>amd64fre：64 bit CPU アーキテクチャ向けのパッチ</li><li>x86fre：32 bit CPU アーキテクチャ向けのパッチ</li><li>arm64fre：arm64 アーキテクチャ向けのパッチ</li></ul><p>端末の情報については、[設定]アプリの[システム]&gt;[バージョン情報]&gt;[デバイスの仕様]の表示を参照するか、以下のコマンドレットにて特定することが可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ComputerInfo</span> | <span class="built_in">Select-Object</span> WindowsBuildLabEx,CsSystemType</span><br></pre></td></tr></table></figure><h3 id="使用するモジュールのダウンロード"><a href="#使用するモジュールのダウンロード" class="headerlink" title="使用するモジュールのダウンロード"></a>使用するモジュールのダウンロード</h3><p>端末情報を確認した後、更新に使用するモジュールを取得して端末にコピーします。</p><p>更新プログラムは<a href="https://www.catalog.update.microsoft.com/Search.aspx?q=KB4052623">Microsoft Update カタログ</a>からダウンロードできます。</p><p><img src="../images/Endpoint-MDAV-2022-08-26-01.png" alt="Endpoint-MDAV-2022-08-26-01"></p><ol><li><strong>バージョン<code>4.18.2001.10</code>の取得(端末のバージョンが<code>4.18.2001.10</code>未満である場合のみ)</strong></li></ol><p>端末に適用されているマルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>未満である場合は、まずバージョン<code>4.18.2001.10</code>の更新プログラムをダウンロードする必要があります。</p><p>タイトルが「Windows Defender Antivirus マルウェア対策プラットフォームの更新プログラム - KB4052623 (Version 4.18.2001.10)」である行の内、最終更新日時が最も新しい行を選び、右側の[ダウンロード]をクリックします。</p><p>以下の画面が表示されたら、端末のCPUプラットフォームに対応したモジュールをダウンロードします。</p><p><img src="../images/Endpoint-MDAV-2022-08-26-02.png" alt="Endpoint-MDAV-2022-08-26-02"></p><p>各モジュールに対応するプラットフォームを確認する場合は、それぞれのファイルを一度ダウンロードした後、右クリックして [プロパティ]&gt;[詳細] を開きます。</p><p>ここで、[ファイルの説明] 欄の括弧の中に対象となるプラットフォームの情報が記載されています。</p><p><img src="../images/Endpoint-MDAV-2022-08-26-03.png" alt="Endpoint-MDAV-2022-08-26-03"></p><p>なお、本記事執筆時点では、バージョン<code>4.18.2001.10</code>の更新プログラムのファイル名と対象プラットフォームの対応は以下の通りであることを確認しております。</p><table><thead><tr><th align="center">ファイル名</th><th align="center">対応するアーキテクチャ</th></tr></thead><tbody><tr><td align="center">updateplatform_0456e6719c3ee098af03b785230ac020643fa1ac.exe</td><td align="center">amd64</td></tr><tr><td align="center">updateplatform_eaf76728f00b841dc9b3b1722f778e50ed59438a.exe</td><td align="center">x86</td></tr><tr><td align="center">updateplatform_19608225e67d613b65e183e1ca4159bc915cf331.exe</td><td align="center">arm64</td></tr></tbody></table><ol start="2"><li><strong>最新バージョンの取得</strong></li></ol><p>次に、最新の更新プログラムを取得します。</p><p>[1.] の手順と同様に、<a href="https://www.catalog.update.microsoft.com/Search.aspx?q=KB4052623">Microsoft Update カタログ</a>にてタイトルが最新バージョンを指す行の右側 [ダウンロード] ボタンをクリックします。</p><p>※ 本記事執筆時点では<code>4.18.2205.7</code>が最新バージョンです。</p><p>端末のCPUプラットフォームに対応したモジュールをダウンロードするために、3つすべてのモジュールをダウンロードします。</p><p>ダウンロードしたモジュールを右クリックして [プロパティ]&gt;[詳細] を開き、[ファイルの説明] 欄の情報から更新対象のプラットフォームに対応したモジュールを特定し、不要なファイルを端末から削除します。</p><h2 id="マルウェア対策プラットフォームの手動更新方法"><a href="#マルウェア対策プラットフォームの手動更新方法" class="headerlink" title="マルウェア対策プラットフォームの手動更新方法"></a>マルウェア対策プラットフォームの手動更新方法</h2><h3 id="バージョン4-18-2001-10の手動適用-端末のバージョンが4-18-2001-10未満である場合のみ"><a href="#バージョン4-18-2001-10の手動適用-端末のバージョンが4-18-2001-10未満である場合のみ" class="headerlink" title="バージョン4.18.2001.10の手動適用(端末のバージョンが4.18.2001.10未満である場合のみ)"></a>バージョン<code>4.18.2001.10</code>の手動適用(端末のバージョンが<code>4.18.2001.10</code>未満である場合のみ)</h3><p>端末に適用されているマルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>未満である場合、先にバージョン<code>4.18.2001.10</code>の更新プログラムを適用し、OSを再起動する必要があります。</p><p>事前に取得したバージョン<code>4.18.2001.10</code>の更新プログラムを端末にコピーし、右クリックして [管理者権限で実行] をクリックした後、更新が完了するまで1分ほど待機します。</p><p>※ 更新はバックグラウンドで実施されます。</p><p>その後OSを再起動し、PowerShellにて以下のコマンドレットを実行し、マルウェア対策プラットフォームのバージョンが<code>4.18.2001.10</code>に更新されていることを確認します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AMProductVersion</span><br></pre></td></tr></table></figure><h3 id="最新バージョンのマルウェア対策プラットフォームの手動適用"><a href="#最新バージョンのマルウェア対策プラットフォームの手動適用" class="headerlink" title="最新バージョンのマルウェア対策プラットフォームの手動適用"></a>最新バージョンのマルウェア対策プラットフォームの手動適用</h3><p>事前に取得した最新バージョンの更新プログラムを端末にコピーし、右クリックして [管理者権限で実行] をクリックした後、更新が完了するまで1分ほど待機します。</p><p>※ こちらも更新はバックグラウンドで実行されます。</p><p>PowerShellにて以下のコマンドレットを実行し、マルウェア対策プラットフォームのバージョンが最新バージョンに更新されていることを確認します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-MpComputerStatus</span> | <span class="built_in">Select-Object</span> AMProductVersion</span><br></pre></td></tr></table></figure><p>※ バージョン<code>4.18.2001.10</code>以降の更新プログラムを適用する際にはOSの再起動は不要です。</p><h2 id="更新プログラムのロールバック手順"><a href="#更新プログラムのロールバック手順" class="headerlink" title="更新プログラムのロールバック手順"></a>更新プログラムのロールバック手順</h2><p>続いて、トラブルシューティングを目的としてMDAVのマルウェア対策プラットフォームをロールバックする方法についてご紹介いたします。</p><p>マルウェア対策プラットフォームのロールバックはコマンドライン ツール<code>MpCmdRun.exe</code>を使用することで実施することが可能です。</p><p><code>MpCmdRun.exe</code>は、システムの以下のフォルダに存在します。<br>(使用するためには、管理者権限でPower Shellかコマンドプロンプトを起動する必要があります)</p><ul><li>C:\Program Files\Windows Defender</li><li>C:\ProgramData\Microsoft\Windows Defender\Platform&lt;最新のプラットフォームバージョン&gt;</li></ul><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/command-line-arguments-microsoft-defender-antivirus?view=o365-worldwide">コマンドラインを使用して Microsoft Defender ウイルス対策を管理する</a></p><p>以下のコマンドで、コマンドラインツール<code>MpCmdRun.exe</code>を使用してマルウェア対策プラットフォームをロールバックすることができます。</p><p>※ <a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide">改ざん防止機能</a>が有効な場合、これらのコマンド実行がブロックされる場合があります。</p><p>※ 公開している最新バージョンより 3 世代以上古いバージョンのサポートはアップグレードに関するサポートのみに縮小されるため、ロールバック後は必ずマルウェア対策プラットフォームを更新いただくようお願いいたします。</p><p>※ Windows 10 1809 / Windows Server 2016 以前のバージョンではロールバックはサポートされていません。</p><ol><li><strong>以前のバージョンにロールバックする方法</strong></li></ol><p>以下のコマンドで、マルウェア対策プラットフォームを以前のバージョンにロールバックすることができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MpCmdRun.exe <span class="literal">-revertplatform</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>更新前のバージョンにロールバックする方法</strong></li></ol><p>以下のコマンドで、マルウェア対策プラットフォームを完全に更新前の状態にロールバックすることができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MpCmdRun.exe <span class="literal">-resetplatform</span></span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事ではMicrosoft Defender ウイルス対策(MDAV)のマルウェア対策プラットフォームを手動で更新・ロールバックする方法についてご紹介いたしました。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合がありますことご了承ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;本記事ではMicrosoft  Defender ウイルス対策(MDAV)のマルウェア対策プラットフォームを手動で更新する方法についてご案内いたします。&lt;/p&gt;
&lt;p&gt;MDAVのセキュリティインテ</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
    <category term="マルウェア対策プラットフォーム" scheme="https://jp-sec.github.io/blog/tags/%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%AF%BE%E7%AD%96%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0/"/>
    
  </entry>
  
  <entry>
    <title>AIP スキャナーが対象リポジトリ内のファイルを破損してしまう事例について</title>
    <link href="https://jp-sec.github.io/blog/Azure_Information_Protection_2021_12_8/"/>
    <id>https://jp-sec.github.io/blog/Azure_Information_Protection_2021_12_8/</id>
    <published>2022-08-26T06:13:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Security サポートチームです。<br>今回は AIPスキャナーが対象ファイルを破損させてしまう事例とその回避方法についてご案内いたします。</p><p>AIP スキャナーによるスキャンによって対象ファイルが破損するシナリオ</p><h2 id="1-スキャナー-ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。"><a href="#1-スキャナー-ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。" class="headerlink" title="1.スキャナー ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。"></a>1.スキャナー ノードの記憶域の空き領域が逼迫している状態でラベル付け処理を行うとファイルが故障します。</h2><p>AIP スキャナーはスキャン対象のファイルを検査・ラベル付け処理を行う際に、スキャナー コンピューターの一時領域に対象ファイル データを転送し、秘密度ラベルの適用処理後に<br>スキャン対象のリポジトリ パスにある原本と差し替えます。<br>現状の仕様ではスキャナー ノードの記憶域が十分に確保されていない場合にもコンテンツ スキャン ジョブは実行されてしまいます。この場合、スキャナー本体の記憶域の範囲内で<br>不完全なデータの状態で対象のコンテンツをラベル付けし、元のリポジトリ パスにあるファイルを差し替えるため、結果としてラベル付けされたファイルが故障してしまう場合があります。</p><p>&lt;回避策&gt;<br>スキャナー ノードの記憶域は十分な空き領域を確保いただくようにお願いいたします。<br>公開されている AIP スキャナーの前提条件では一時ファイルとして 10 GB は確保いただくことをお勧めしております。</p><p>&lt;参考&gt;<br><a href="https://docs.microsoft.com/ja-jp/azure/information-protection/deploy-aip-scanner-prereqs#windows-server-requirements">Azure Information Protection (AIP) 統合ラベルスキャナーの前提条件</a></p><p><img src="/blog/images/Azure_Information_Protection_2021_12_8_1.png"></p><h2 id="2-異なるスキャナー-クラスターに参加する複数の-AIP-スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。"><a href="#2-異なるスキャナー-クラスターに参加する複数の-AIP-スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。" class="headerlink" title="2.異なるスキャナー クラスターに参加する複数の AIP スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。"></a>2.異なるスキャナー クラスターに参加する複数の AIP スキャナーで同一のリポジトリをラベル付け処理するよう構成するとファイルが故障する場合があります。</h2><p>同一のリポジトリを対象にしたコンテンツ スキャン ジョブを設定した別々のクラスターに参加するノードでスキャンを実行すると、コンテンツ スキャンのタイミングがノード間でバッティングしてしまう場合があります。同一のコンテンツに対して複数のノードによるコンテンツ スキャンのタイミングがバッティングしてしまうと、最初のスキャン ジョブによるラベリング処理途中のコンテンツを後続のスキャン ジョブによってキャプチャしてしまう場合があり、この場合にも AIP スキャナーが 1. のシナリオと同様に不完全なデータをキャプチャして元のリポジトリに返すことでラベル付け処理されたコンテンツが故障する場合があります。</p><p>&lt;回避策&gt;<br>AIP スキャナーをスケールアウトする場合、単一のスキャナー クラスターに複数のノードを参加させて構成します。複数のノードで構成されているスキャナー クラスターは共有するデータベースによって、スキャン対象のリポジトリのスキャンに関するデータが共有され、各ノードが効率的にスキャンを行うよう動作します。<br>※以下の図は代表的なスキャナーのアーキテクチャの概要図になります。</p><p><img src="/blog/images/Azure_Information_Protection_2021_12_8_2.png"><br>図 1: Security,Compliance,and Identity に公開された “Best practices for deploying and using the AIP UL scanner“ より抜粋</p><p>上記を踏まえ、スキャナーのパフォーマンス向上の観点でスキャナーのノードの増設を検討する場合には、別々のリポジトリをスキャンするよう複数のクラスターを構成するか、同一のクラスターに<br>複数のノードを参加させるよう構成いただくことを検討ください。</p><p>&lt;参考&gt;<br><a href="https://docs.microsoft.com/ja-jp/azure/information-protection/deploy-aip-scanner-configure-install?tabs=azure-portal-only#optimize-scanner-performance">Azure Information Protection (AIP) 統合ラベル スキャナーをインストールして構成する</a></p><p><img src="/blog/images/Azure_Information_Protection_2021_12_8_3.png"></p><h2 id="3-対象のリポジトリ内のコンテンツが-DFS-レプリケーション等で複数のファイル-サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。"><a href="#3-対象のリポジトリ内のコンテンツが-DFS-レプリケーション等で複数のファイル-サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。" class="headerlink" title="3.対象のリポジトリ内のコンテンツが DFS レプリケーション等で複数のファイル サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。"></a>3.対象のリポジトリ内のコンテンツが DFS レプリケーション等で複数のファイル サーバーと同期途中の状態でラベル付け処理を行うとファイルが故障する可能性があります。</h2><p>スキャン対象のコンテンツが DFS レプリケーションなど複数のファイル サーバー間でデータの同期を行うよう構成されている場合、レプリケーション途中のファイルを AIP スキャナーがキャプチャしてしまう場合があります。<br>この場合にも 1. のシナリオと同様のメカニズムにより AIP スキャナーが不完全な状態のデータをキャプチャしラベル付けした上で元のリポジトリにあるファイルと差し替えをしてしまいファイルが故障してしまう場合があります。</p><p>&lt;回避策&gt;<br>DFS レプリケーションを構成している環境では、レプリケーションのスケジュール調整ならびにコンテンツ スキャン ジョブのスケジュールを “手動” に設定いただき、レプリケーションを実施する時間とコンテンツ スキャン ジョブが実行される時間帯が重複しないように調整いただくことを検討ください。</p><h2 id="4-AIP-スキャナーがスキャン対象としているリポジトリに対して、AIP-クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。"><a href="#4-AIP-スキャナーがスキャン対象としているリポジトリに対して、AIP-クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。" class="headerlink" title="4. AIP スキャナーがスキャン対象としているリポジトリに対して、AIP クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。"></a>4. AIP スキャナーがスキャン対象としているリポジトリに対して、AIP クライアント側から一括ラベル付け処理を実施するとファイルが破損する可能性があります。</h2><p>上記の 1 ～ 3 のシナリオにて解説いたしました AIP スキャナー と同様に AIP クライアントも対象ファイルをラベル付け処理を行う際に、対象のファイルをローカルのプロファイル内にある一時フォルダにコピーした後に処理を実施します。<br>スキャナーによるファイル処理と AIP クライアントによるファイル処理がバッティングしてしまうと、不完全なファイルをキャプチャする事象が発生し、ラベル付け処理が行われたファイルが破損する可能性があります。</p><p>&lt;回避策&gt;<br>実際の環境でスキャン ジョブによる処理と AIP クライアントによるラベル付け処理がバッティングしてしまう可能性は現実的には低いと考えられますが、理論上はファイルが破損するリスクがあります。<br>AIP クライアントの GUI や PowerShell コマンド (Set-AIPFileLable) コマンドによって一括ラベル付け処理を計画される場合には、対象のフォルダ パスが AIP スキャナーのコンテンツ スキャン ジョブと重複していないか事前に確認いただくなど、運用によってリスクを低減することを検討ください。</p><h2 id="5-スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。"><a href="#5-スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。" class="headerlink" title="5. スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。"></a>5. スキャン対象のリポジトリのファイル容量が逼迫している場合、スキャン対象のファイルが破損する可能性があります。</h2><p>AIP スキャナーのローカルにある一時記憶域にてラベル付け処理が完了したファイルは、最終的にスキャン対象の元のリポジトリのファイル パスにあるデータと差し替えられます。<br>スキャナーがリポジトリ先の記憶域の逼迫を検出できた場合には、スキャン処理が失敗しますが、リポジトリ側の記憶域の逼迫の検出タイミング等の何らかの要因により、スキャナーがラベル付けを行ったファイルの差し替え処理の継続を試みる可能性があります。<br>対象リポジトリの記憶域が逼迫していることでデータの差し替えに失敗し、スキャン対象のファイルが破損する可能性があります。</p><p>&lt;回避策&gt;<br>スキャナー コンピューター自体の記憶域だけでなく、スキャン対象のリポジトリの記憶の空き容量にも十分注意いただくようお願いいたします。</p><p>AIP スキャナーにはラベル付け処理によって壊れてしまったファイルを復元する機能はありません。<br>今回の記事でご案内させていただいた各シナリオの情報が、AIP スキャナーを適切に展開/運用いただくことに寄与しましたら幸いです。</p><p>※本ブログ記事化にあたり、弊社サポートによる調査にご協力いただきましたお客様に深く感謝いたします。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Security サポートチームです。&lt;br&gt;今回は AIPスキャナーが対象ファイルを破損させてしまう事例とその回避方法についてご案内いたします。&lt;/p&gt;
&lt;p&gt;AIP スキャナーによるスキャンによって対象ファイルが破損するシナリオ&lt;/p&gt;
&lt;h2 </summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Defender ウイルス対策のセキュリティインテリジェンス(定義ファイル)を手動で更新・ロールバック・削除する方法</title>
    <link href="https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/"/>
    <id>https://jp-sec.github.io/blog/Endpoint-MDAV-2022-07-29/</id>
    <published>2022-08-04T00:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure Security サポートチームです。</p><p>本記事ではMicrosoft  Defender ウイルス対策(MDAV)のセキュリティインテリジェンスの更新プログラム(定義ファイル/エンジン)を手動で更新する方法についてご案内いたします。</p><p>※ 本記事の内容はWindow 10 21H2環境にて動作を確認いたしております。</p><!-- omit in toc --><h2 id="本記事の内容"><a href="#本記事の内容" class="headerlink" title="本記事の内容"></a>本記事の内容</h2><ul><li><a href="#MDAV%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">MDAVのセキュリティインテリジェンスについて</a></li><li><a href="#MDAV%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%82%92%E6%89%8B%E5%8B%95%E3%81%A7%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95">MDAVのセキュリティインテリジェンスを手動で更新する方法</a><ul><li><a href="#Windows-Update%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">Windows Updateを使用して更新する</a></li><li><a href="#Windows-%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">Windows セキュリティアプリを使用して更新する</a></li><li><a href="#Power-Shell-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%AC%E3%83%83%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">Power Shell コマンドレットを使用して更新する</a></li><li><a href="#MpCmdRun-%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">MpCmdRun ユーティリティを使用して更新する</a></li><li><a href="#%E6%89%8B%E5%8B%95%E6%9B%B4%E6%96%B0%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%81%A6%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">手動更新パッケージを取得して更新する</a></li></ul></li><li><a href="#MDAV%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%82%92%E6%89%8B%E5%8B%95%E3%81%A7%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95">MDAVのセキュリティインテリジェンスを手動で削除する方法</a><ul><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%89%8A%E9%99%A4%E6%96%B9%E6%B3%95">セキュリティインテリジェンスのロールバック・削除方法</a></li><li><a href="#%E5%8B%95%E7%9A%84%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9%E3%81%AE%E6%89%8B%E5%8B%95%E5%89%8A%E9%99%A4%E6%96%B9%E6%B3%95">動的セキュリティインテリジェンスの手動削除方法</a></li></ul></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="MDAVのセキュリティインテリジェンスについて"><a href="#MDAVのセキュリティインテリジェンスについて" class="headerlink" title="MDAVのセキュリティインテリジェンスについて"></a>MDAVのセキュリティインテリジェンスについて</h2><p>MDAVにより端末に最新の脅威からの保護を提供するためには、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#security-intelligence-updates">セキュリティインテリジェンスの更新プログラム</a>と<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#product-updates">製品の更新プログラム</a>を常に最新に保つことが重要です。</p><p>MDAVのセキュリティインテリジェンスの更新プログラムは、2022年8月時点では「KB2267602」にてリリースされております。</p><p>また、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/cloud-protection-microsoft-defender-antivirus?view=o365-worldwide">クラウド保護(MAPS )</a>をご利用中の環境の場合は、「KB2267602」で配信される通常のセキュリティインテリジェンスの更新プログラムに加えて、動的なセキュリティインテリジェンス更新プログラムを取得し、端末に最新の保護を提供します。</p><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-updates-baselines-microsoft-defender-antivirus?view=o365-worldwide#security-intelligence-updates">セキュリティインテリジェンスの更新プログラム</a></p><p>本記事では、MDAVのセキュリティインテリジェンスの更新プログラムを手動で更新する方法についてご紹介いたします。</p><p>また、トラブルシューティングの目的で、MDAVのセキュリティインテリジェンスおよび動的なセキュリティインテリジェンスを手動でロールバック・削除する方法についてもご紹介いたします。</p><h2 id="MDAVのセキュリティインテリジェンスを手動で更新する方法"><a href="#MDAVのセキュリティインテリジェンスを手動で更新する方法" class="headerlink" title="MDAVのセキュリティインテリジェンスを手動で更新する方法"></a>MDAVのセキュリティインテリジェンスを手動で更新する方法</h2><p>MDAVのセキュリティインテリジェンスを手動で更新する場合、以下のいずれかの方法が利用できます。</p><ul><li>Windows Update</li><li>Windows セキュリティアプリ</li><li>Power Shell コマンドレット</li><li>MpCmdRun ユーティリティ</li><li>手動更新パッケージの取得</li></ul><h3 id="Windows-Updateを使用して更新する"><a href="#Windows-Updateを使用して更新する" class="headerlink" title="Windows Updateを使用して更新する"></a>Windows Updateを使用して更新する</h3><p>セキュリティインテリジェンスの更新は、通常Window Updateを利用して実施されます。</p><p>そのため、Windowの設定アプリを起動し、[更新とセキュリティ]&gt;[Windows Update]の画面から手動でWindows Updateを実行することで、セキュリティインテリジェンスを更新することが可能です。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-001.png" alt="Endpoint-MDAV-2022-07-29-001"></p><h3 id="Windows-セキュリティアプリを使用して更新する"><a href="#Windows-セキュリティアプリを使用して更新する" class="headerlink" title="Windows セキュリティアプリを使用して更新する"></a>Windows セキュリティアプリを使用して更新する</h3><p>Windows セキュリティアプリを開き、[ウイルスと脅威の防止]&gt;[ウイルスと脅威の防止の更新]&gt;[更新プログラムのチェック]を開きます。</p><p>ここで、[更新プログラムのチェック]をクリックすることで、セキュリティインテリジェンスの更新プログラムを手動更新することが可能です。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-002.png" alt="Endpoint-MDAV-2022-07-29-002"></p><p>この時に使用されるセキュリティインテリジェンスの更新元は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">フォールバック順序</a>の設定によって決定されます。</p><h3 id="Power-Shell-コマンドレットを使用して更新する"><a href="#Power-Shell-コマンドレットを使用して更新する" class="headerlink" title="Power Shell コマンドレットを使用して更新する"></a>Power Shell コマンドレットを使用して更新する</h3><p><a href="https://docs.microsoft.com/ja-jp/powershell/module/defender/update-mpsignature?view=windowsserver2022-ps">Update-MpSignature</a>コマンドレットを使用することで、Power Shellから手動でセキュリティインテリジェンスの更新を実施することが可能です。</p><p>セキュリティインテリジェンスを更新するためには、端末でPower Shellを起動し、以下のコマンドレットを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Update-MpSignature</span></span><br></pre></td></tr></table></figure><p><img src="../images/Endpoint-MDAV-2022-07-29-003.png" alt="Endpoint-MDAV-2022-07-29-003"></p><p>この時に使用されるセキュリティインテリジェンスの更新元は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">フォールバック順序</a>の設定によって決定されます。</p><p>特定の更新元を指定する場合は、<code>-UpdateSource</code>オプションを使用します。</p><p>以下の例では、Microsoft Malware Protection Center (MMPC)からセキュリティインテリジェンスの更新元として使用します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Update-MpSignature</span> <span class="literal">-UpdateSource</span> <span class="string">&quot;MMPC&quot;</span></span><br></pre></td></tr></table></figure><p>その他のオプションについては<a href="https://docs.microsoft.com/ja-jp/powershell/module/defender/update-mpsignature?view=windowsserver2022-ps">こちら</a>を参照してください。</p><h3 id="MpCmdRun-ユーティリティを使用して更新する"><a href="#MpCmdRun-ユーティリティを使用して更新する" class="headerlink" title="MpCmdRun ユーティリティを使用して更新する"></a>MpCmdRun ユーティリティを使用して更新する</h3><p>コマンドライン ツール<code>MpCmdRun.exe</code>を使用して手動でセキュリティインテリジェンスの更新を実施することができます。</p><p><code>MpCmdRun.exe</code>は、システムの以下のフォルダに存在します。<br>(使用するためには、管理者権限でPower Shellかコマンドプロンプトを起動する必要があります)</p><ul><li>C:\Program Files\Windows Defender</li><li>C:\ProgramData\Microsoft\Windows Defender\Platform\&lt;最新のプラットフォームバージョン&gt;</li></ul><p><code>MpCmdRun.exe</code>を用いてセキュリティインテリジェンスを手動更新するためには、管理者権限で起動したPower Shellにて以下のコマンドを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-SignatureUpdate</span></span><br></pre></td></tr></table></figure><p>この時に使用されるセキュリティインテリジェンスの更新元についても、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/manage-protection-updates-microsoft-defender-antivirus?view=o365-worldwide#fallback-order">フォールバック順序</a>の設定によって決定されます。</p><p>更新元を指定する場合は、</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-SignatureUpdate</span></span><br></pre></td></tr></table></figure><p><code>MpCmdRun.exe</code>の詳細については以下の公開情報をご参照ください。</p><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/command-line-arguments-microsoft-defender-antivirus?view=o365-worldwide">コマンドラインを使用して Microsoft Defender ウイルス対策を管理する</a></p><h3 id="手動更新パッケージを取得して更新する"><a href="#手動更新パッケージを取得して更新する" class="headerlink" title="手動更新パッケージを取得して更新する"></a>手動更新パッケージを取得して更新する</h3><p>以下のURLにて公開しているページから、セキュリティインテリジェンスの手動更新用プログラムをダウンロードすることが可能です。</p><p>参考情報：<a href="https://www.microsoft.com/en-us/wdsi/defenderupdates">セキュリティインテリジェンスの更新</a></p><p>上記のページにアクセスし、[Antimalware solution]の表から、更新対象のプラットフォームに対応したリンクをクリックします。</p><p>例：Intel CPU / Windows 10 21h2 の場合は、[Microsoft Defender Antivirus for Windows 11, Windows 10, Windows 8.1, and Windows Server]の行の[64-bit]のリンクをクリックします</p><p><img src="../images/Endpoint-MDAV-2022-07-29-004.png" alt="Endpoint-MDAV-2022-07-29-004"></p><p>ダウンロードしたファイルを右クリックして[管理者として実行]をクリックすることで、バックグラウンドでセキュリティインテリジェンスの更新が完了します。</p><h2 id="MDAVのセキュリティインテリジェンスを手動で削除する方法"><a href="#MDAVのセキュリティインテリジェンスを手動で削除する方法" class="headerlink" title="MDAVのセキュリティインテリジェンスを手動で削除する方法"></a>MDAVのセキュリティインテリジェンスを手動で削除する方法</h2><p>続いて、トラブルシューティングを目的としてMDAVのセキュリティインテリジェンスをロールバック/削除する方法についてご紹介いたします。</p><p>セキュリティインテリジェンスのリストア・削除は、コマンドライン ツール<code>MpCmdRun.exe</code>を使用することで実施することが可能です。</p><p><code>MpCmdRun.exe</code>は、システムの以下のフォルダに存在します。<br>(使用するためには、管理者権限でPower Shellかコマンドプロンプトを起動する必要があります)</p><ul><li>C:\Program Files\Windows Defender</li><li>C:\ProgramData\Microsoft\Windows Defender\Platform\&lt;最新のプラットフォームバージョン&gt;</li></ul><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/command-line-arguments-microsoft-defender-antivirus?view=o365-worldwide">コマンドラインを使用して Microsoft Defender ウイルス対策を管理する</a></p><h3 id="セキュリティインテリジェンスのロールバック・削除方法"><a href="#セキュリティインテリジェンスのロールバック・削除方法" class="headerlink" title="セキュリティインテリジェンスのロールバック・削除方法"></a>セキュリティインテリジェンスのロールバック・削除方法</h3><p><strong>注意：セキュリティインテリジェンスを削除するとMDAVによる保護が提供できなくなりますためご留意ください。</strong></p><p><code>-RemoveDefinitions</code>オプションを使用してコマンドを実行することで、セキュリティインテリジェンス(定義ファイル/エンジン)を更新前のバージョンにロールバックできます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-RemoveDefinitions</span></span><br></pre></td></tr></table></figure><p>また、<code>-All</code>オプションを付与することで、MDAVのセキュリティインテリジェンスを完全に削除することが可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-RemoveDefinitions</span> <span class="literal">-All</span></span><br></pre></td></tr></table></figure><p><strong>注意：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide">改ざん防止機能</a>が有効な場合、MDAVのセキュリティインテリジェンスを完全に削除することはできません。</strong></p><p>セキュリティインテリジェンスが削除されたことを確認するためには、Power Shellを起動して<code>Get-MpComputerStatus | Select-Object AMEngineVersion,AntivirusSignatureVersion</code>コマンドレットを実行します。</p><p>セキュリティインテリジェンスが完全に削除されている場合、<code>0.0.0.0</code>が出力されます。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-005.png" alt="Endpoint-MDAV-2022-07-29-005"></p><h3 id="動的セキュリティインテリジェンスの手動削除方法"><a href="#動的セキュリティインテリジェンスの手動削除方法" class="headerlink" title="動的セキュリティインテリジェンスの手動削除方法"></a>動的セキュリティインテリジェンスの手動削除方法</h3><p>コマンドライン ツール<code>MpCmdRun.exe</code>を使用することで、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/cloud-protection-microsoft-defender-antivirus?view=o365-worldwide">クラウド保護(MAPS )</a>が利用する動的セキュリティインテリジェンスを手動で削除することが可能です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Program Files\Windows Defender&gt; .\MpCmdRun.exe <span class="literal">-RemoveDefinitions</span> <span class="literal">-DynamicSignatures</span></span><br></pre></td></tr></table></figure><p>動的セキュリティインテリジェンスが削除されたことを確認するためには、MDAVのイベントログにイベントID:2013のイベントの出力を確認します。</p><p><img src="../images/Endpoint-MDAV-2022-07-29-006.png" alt="Endpoint-MDAV-2022-07-29-006"></p><p>MDAVのイベントログの詳細については以下の公開情報にてご案内いたしております。</p><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/microsoft-365/security/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide">Microsoft Defender ウイルス対策イベントの ID とエラー コード</a></p><p>また、Power Shellにて以下のコマンドレットを実行することで、動的セキュリティインテリジェンスが最後に削除されたイベントを取得することができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-WinEvent</span> <span class="selector-tag">@</span>&#123;ProviderName=<span class="string">&#x27;Microsoft-Windows-Windows Defender&#x27;</span>;ID=<span class="number">2013</span>&#125; <span class="literal">-MaxEvents</span> <span class="number">1</span></span><br><span class="line">TimeCreated                      Id LevelDisplayName Message</span><br><span class="line">-----------                      -- ---------------- -------</span><br><span class="line"><span class="number">2022</span>/<span class="number">08</span>/<span class="number">03</span> <span class="number">22</span>:<span class="number">39</span>:<span class="number">14</span>            <span class="number">2013</span> 情報             Microsoft Defender ウイルス対策 ですべての動的セキュリティ インテリジェンスが破棄されました。...</span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事ではMicrosoft  Defender ウイルス対策(MDAV)のセキュリティインテリジェンスの更新プログラム(定義ファイル/エンジン)を手動で更新・ロールバック・削除する方法についてご紹介いたしました。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合がありますことご了承ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;本記事ではMicrosoft  Defender ウイルス対策(MDAV)のセキュリティインテリジェンスの更新プログラム(定義ファイル/エンジン)を手動で更新する方法についてご案内いたします。&lt;/</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
    <category term="セキュリティインテリジェンス" scheme="https://jp-sec.github.io/blog/tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AA%E3%82%B8%E3%82%A7%E3%83%B3%E3%82%B9/"/>
    
  </entry>
  
  <entry>
    <title>分類して保護するが Microsoft.Azip.RightClick になってしまう事象について</title>
    <link href="https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2022-06-08-01/"/>
    <id>https://jp-sec.github.io/blog/AIP-AzureInformationProtection-2022-06-08-01/</id>
    <published>2022-06-07T15:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.858Z</updated>
    
    <content type="html"><![CDATA[<h2 id="“分類して保護する”-が-“Microsoft-Azip-RightClick”-になってしまう"><a href="#“分類して保護する”-が-“Microsoft-Azip-RightClick”-になってしまう" class="headerlink" title="“分類して保護する” が “Microsoft.Azip.RightClick” になってしまう"></a>“分類して保護する” が “Microsoft.Azip.RightClick” になってしまう</h2><p>こんにちは Azure Security サポートチームです。</p><p>本記事では Azure Information Protection の統合ラベルクライアントに関する既知の事象についてご案内を差し上げます。</p><h3 id="ご紹介する事象について"><a href="#ご紹介する事象について" class="headerlink" title="ご紹介する事象について"></a>ご紹介する事象について</h3><p>統合ラベルクライアントでは、秘密度ラベルを付与したいファイルを右クリックすることで [分類して保護する] というメニューを表示できます。[分類して保護する] を選択することで、当該ファイルに秘密度を付与するためのコンソールを起動できます。</p><p><img src="/blog/images/AIP-AzureInformationProtection-2022-06-08-01.png" alt="分類して保護する"></p><p>本記事でご案内する事象は、この “分類して保護する” の表記が “Microsoft.Azip.RightClick” に変わってしまうという事象です。</p><h3 id="事象の発生契機について"><a href="#事象の発生契機について" class="headerlink" title="事象の発生契機について"></a>事象の発生契機について</h3><p>本事象は Windows Feature Update 起因で発生いたします。現時点では Windows Quality Update による事象の発生は確認されておりません。もし Windows Feature Update 以外の契機で当該事象が発生した場合には Azure Security サポートまでお問い合わせいただけますようお願い申し上げます。</p><h3 id="統合ラベルクライアントの動作への影響について"><a href="#統合ラベルクライアントの動作への影響について" class="headerlink" title="統合ラベルクライアントの動作への影響について"></a>統合ラベルクライアントの動作への影響について</h3><p>画面の表記が “Microsoft.Azip.RightClick” に変化する以外に影響はございません。統合ラベルクライアントとしての機能は継続してご利用いただけます。</p><h3 id="事象の発生事由について"><a href="#事象の発生事由について" class="headerlink" title="事象の発生事由について"></a>事象の発生事由について</h3><p>Windows Feature Update により統合ラベルクライアントが利用している、次のレジストリ情報が削除されることにより発生いたします。</p><ul><li>HKEY_CLASSES_ROOT\AllFilesystemObjects\shell\Microsoft.Azip.RightClick</li></ul><p>本事象は事前に対処する方法がございません。ご迷惑をおかけいたします。</p><h3 id="事象の復旧方法について"><a href="#事象の復旧方法について" class="headerlink" title="事象の復旧方法について"></a>事象の復旧方法について</h3><p>事象が発生してしまった端末を復旧させるためには、次のいずれかの方法でご対応いただく必要がございます。</p><ol><li>統合ラベルクライアントの再インストール</li><li>正常に動作している環境から “HKEY_CLASSES_ROOT\AllFilesystemObjects\shell\Microsoft.Azip.RightClick” のレジストリ値をコピーする</li></ol><p>なお、OS や統合ラベルクライアントのバージョンにより、レジストリ値の内容には差分が無いことを確認しております。</p><p>参考情報として “HKEY_CLASSES_ROOT\AllFilesystemObjects\shell\Microsoft.Azip.RightClick” のレジストリ情報を記載いたします。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\AllFilesystemObjects\shell\Microsoft.Azip.RightClick]</span><br><span class="line">@=&quot;Classify and protect&quot;</span><br><span class="line">&quot;MultiSelectModel&quot;=&quot;Player&quot;</span><br><span class="line">&quot;Icon&quot;=hex(2):43,00,3a,00,5c,00,50,00,72,00,6f,00,67,00,72,00,61,00,6d,00,20,\</span><br><span class="line">  00,46,00,69,00,6c,00,65,00,73,00,20,00,28,00,78,00,38,00,36,00,29,00,5c,00,\</span><br><span class="line">  4d,00,69,00,63,00,72,00,6f,00,73,00,6f,00,66,00,74,00,20,00,41,00,7a,00,75,\</span><br><span class="line">  00,72,00,65,00,20,00,49,00,6e,00,66,00,6f,00,72,00,6d,00,61,00,74,00,69,00,\</span><br><span class="line">  6f,00,6e,00,20,00,50,00,72,00,6f,00,74,00,65,00,63,00,74,00,69,00,6f,00,6e,\</span><br><span class="line">  00,5c,00,4d,00,53,00,49,00,50,00,2e,00,4e,00,61,00,74,00,69,00,76,00,65,00,\</span><br><span class="line">  52,00,65,00,73,00,2e,00,64,00,6c,00,6c,00,2c,00,2d,00,31,00,30,00,31,00,00,\</span><br><span class="line">  00</span><br><span class="line">&quot;MUIVerb&quot;=hex(2):40,00,43,00,3a,00,5c,00,50,00,72,00,6f,00,67,00,72,00,61,00,\</span><br><span class="line">  6d,00,20,00,46,00,69,00,6c,00,65,00,73,00,20,00,28,00,78,00,38,00,36,00,29,\</span><br><span class="line">  00,5c,00,4d,00,69,00,63,00,72,00,6f,00,73,00,6f,00,66,00,74,00,20,00,41,00,\</span><br><span class="line">  7a,00,75,00,72,00,65,00,20,00,49,00,6e,00,66,00,6f,00,72,00,6d,00,61,00,74,\</span><br><span class="line">  00,69,00,6f,00,6e,00,20,00,50,00,72,00,6f,00,74,00,65,00,63,00,74,00,69,00,\</span><br><span class="line">  6f,00,6e,00,5c,00,4d,00,53,00,49,00,50,00,2e,00,4e,00,61,00,74,00,69,00,76,\</span><br><span class="line">  00,65,00,52,00,65,00,73,00,2e,00,64,00,6c,00,6c,00,2c,00,2d,00,31,00,30,00,\</span><br><span class="line">  30,00,31,00,00,00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\AllFilesystemObjects\shell\Microsoft.Azip.RightClick\DropTarget]</span><br><span class="line">&quot;CLSID&quot;=&quot;&#123;5D3CE662-96C7-4852-8D01-AF2E619598D2&#125;&quot;</span><br></pre></td></tr></table></figure><p>今回のご案内は以上となります。</p><ul><li>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;“分類して保護する”-が-“Microsoft-Azip-RightClick”-になってしまう&quot;&gt;&lt;a href=&quot;#“分類して保護する”-が-“Microsoft-Azip-RightClick”-になってしまう&quot; class=&quot;headerlink&quot; tit</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>AIP クライアントで共有フォルダ内にある複数ファイルを一括保護する場合の注意事項について</title>
    <link href="https://jp-sec.github.io/blog/Azure_Information_Protection_2022_05_20/"/>
    <id>https://jp-sec.github.io/blog/Azure_Information_Protection_2022_05_20/</id>
    <published>2022-05-19T15:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Security サポートチームです。</p><p>今回は AIP クライアント (右クリックオプションの「分類して保護する」) コンソールのご利用にあたって注意する必要のシナリオがございますのでお知らせいたします。<br>AIP クライアントでは、個別のファイル上で右クリックを押下し、オプション内の [分類して保護する] をクリックすることで、ラベル付けを行うためのコンソールを起動できます。</p><p>この右クリックの [分類して保護する] をフォルダ上で起動させると、そのフォルダに格納されているすべてのファイルを再帰的にラベル付け処理できます。特定のフォルダ下部に含まれるコンテンツを一括処理でき、処理の終了時には処理の成功可否も確認できる便利な機能です。</p><p><strong>参考 URL</strong></p><p>エクスプローラーを使用してファイルを分類および保護する<br><br><a href="https://docs.microsoft.com/ja-jp/azure/information-protection/rms-client/clientv2-classify-protect#use-the-file-explorer-to-classify-and-protect-files">分類&amp;保護 - Azure Information Protection統合ラベル付けクライアント | Microsoft Docs</a></p><p><strong>注意が必要なシナリオ</strong></p><p>複数ユーザーが使用するファイル共有内のフォルダについて、一括でラベル付け処理を行う際には注意が必要です。</p><p>ファイル共有に対して一括でラベル付け処理を行うユーザーとは別のユーザーが、同一フォルダ内のラベル付け対象のファイルを開いている場合、クライアントによるラベル付け処理はスキップされます。<br>そのため、対象フォルダに格納されているファイルが他のユーザーに利用されていても、クライアントによるラベル付けの一括操作を実施することは問題ございません。</p><p>しかしながら、複数のユーザーで同時に AIP クライアントを使用してラベル付け処理を実施した場合に、稀にファイルが破損してしまう動作を確認いたしました。</p><p>AIP クライアントでは、次のような流れでファイルに対するラベル付けが処理されます。</p><ol><li>クライアントにて対象ファイルのラベルのステータスを確認する。</li><li>ラベル付けが必要な場合には端末の一時領域にファイルをコピーする。</li><li>ラベル付け処理の後に元のフォルダ パスにファイルを差し替える。</li></ol><p>このラベル付け処理について、複数のクライアントが同一ファイルに対して全く同じタイミングで処理を行おうとすると、対象ファイルに二重に暗号化メタデータの付与を行ってしまったり、片側のクライアントによる処理で差し替え途中の不完全なデータの状態で対象ファイルがもう片方のクライアントによってキャプチャとラベル付け処理が行われてしまうことによってファイルが破損してしまう場合があります。</p><p>AIP クライアントによる一括処理を行う際に、複数のユーザーが “まったく同じタイミング” で操作を実施する状況は一般的なシナリオとしては想定されておりません。特定フォルダに対して一括でラベル付け/暗号化処理を行う場合、複数のユーザー/端末で同時に実施いただくことは避けていただけますようお願い申し上げます。</p><p>今回のお知らせは以上になります。</p><ul><li>※本ブログ記事化にあたり、弊社サポートによる調査にご協力いただきましたお客様に深く感謝いたします。</li><li>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Security サポートチームです。&lt;/p&gt;
&lt;p&gt;今回は AIP クライアント (右クリックオプションの「分類して保護する」) コンソールのご利用にあたって注意する必要のシナリオがございますのでお知らせいたします。&lt;br&gt;AIP クライアントでは</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>AIP クライアント (分類して保護する) におけるカスタム アクセス許可設定について</title>
    <link href="https://jp-sec.github.io/blog/Azure_Information_Protection_2022_05_18/"/>
    <id>https://jp-sec.github.io/blog/Azure_Information_Protection_2022_05_18/</id>
    <published>2022-05-17T15:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Security サポートチームです。<br>今回は AIP クライアント (分類して保護する) を利用してドキュメントに対してカスタム アクセス許可を設定した場合に、アクセスの有効期限が適用されないシナリオが確認できたため共有させていただきます。<br><br></p><p><strong>【具体的なシナリオ】</strong><br>任意のファイルまたはフォルダ上で右クリック オプションの [分類して保護する] をクリックして起動する AIP クライアント コンソールの操作メニューにある [カスタム アクセス許可で保護する] を使用することで、組織の管理者が事前に定義した保護設定を使用するのではなく、ユーザー独自の保護設定を指定することができます。<br>カスタム アクセス許可は、アクセス許可レベルとして以下の 5 種類を選択できます。  </p><p>閲覧者 - 表示のみ<br>レビュー担当者 – 表示、編集<br>共同作成者 - 表示、編集、コピー、印刷<br>共同所有者 – すべてのアクセス許可<br>自分のみ  </p><p>上記のアクセス許可レベルを組織の内外を含め、任意の Azure AD ユーザーを指定してコンテンツを保護することができるため、例えば組織外のユーザーに対して個別に重要なデータを保護した状態で共有したい場合に活用できます。  </p><p><strong>&lt;参考情報&gt;</strong><br><a href="https://docs.microsoft.com/ja-jp/azure/information-protection/rms-client/clientv2-classify-protect#use-the-file-explorer-to-classify-and-protect-files">エクスプローラーを使用してファイルを分類および保護する</a></p><p>このカスタム アクセス許可設定では、”アクセスの有効期限” を定義できるため、保護されたコンテンツをユーザーが利用できる期間を制限することもできます。<br>上記のアクセス許可レベルの内 “共同所有者 – すべてのアクセス許可” を設定した場合には、”アクセスの有効期限” の設定が適用されませんのでご注意ください。 (※ファイルの保護を設定したユーザー自身にも常にフル コントロール権限が付与されるため “自分のみ” を選択した場合にも有効期限は適用されません。)<br>保護設定の解除まで行える “共同所有者” のアクセス許可については、許可を与えられたユーザーがコンテンツを受信したタイミングで保護設定を解除できてしまい、コンテンツの有効期限自体も無効化することが可能な状態となります。<br>共有前などのドキュメントの保護 (暗号化) 設定にあたって、アクセス許可レベルを選択する場合には上記の動作仕様を踏まえて注意いただきますようお願いいたします。  </p><p><strong>【補足】</strong><br>Office アプリ上からも [ファイル] &gt; [情報] &gt; [文書/ブック/スライドの保護] &gt; [アクセスの制限] &gt; “アクセス制限あり“ を選択することでアドホック保護を適用することができます。<br>このアドホック保護機能においても “その他のオプション” の箇所からアクセス レベルを設定することに加えてコンテンツの有効期限を設定できます。<br>Office アプリの保護機能を利用する場合には、アクセス レベルを “フル コントロール” に設定した場合でもコンテンツの有効期限が動作する仕様となっております。<br>アプリケーションの違い (AIP クライアントによるものか Office アプリによるか等) によって、有効期限の動作処理に違いがありますのでご留意ください。<br>なお、AIP クライアントで保護する場合や Office アプリで保護する場合のいずれも、アクセス許可レベルでフル コントロール権限を付与している場合には、コンテンツを受信したユーザーは、そのコンテンツに対して付与されている保護 (暗号化) 設定を解除できてしまいます。<br>有効期限の反映有無は異なりますが、Office アプリで保護した場合にも受信したユーザーが有効期限内に Office アプリを使用して保護設定を解除 (“アクセス制限なし” に設定して保存) した場合には、当初のユーザーが設定された有効期限は適用されなくなりますので、アクセス許可レベルの設定についてはご注意くださいますようお願いいたします。  </p><p>※本ブログ記事化にあたり、弊社サポートによる調査にご協力いただきましたお客様に深く感謝いたします。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Security サポートチームです。&lt;br&gt;今回は AIP クライアント (分類して保護する) を利用してドキュメントに対してカスタム アクセス許可を設定した場合に、アクセスの有効期限が適用されないシナリオが確認できたため共有させていただきます。&lt;</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Red Hat Enterprise Linux へ Microsoft Defender for Endpoint をインストールする際の依存関係について</title>
    <link href="https://jp-sec.github.io/blog/Microsoft_Defender_for_Endpoint_2021_11_22/"/>
    <id>https://jp-sec.github.io/blog/Microsoft_Defender_for_Endpoint_2021_11_22/</id>
    <published>2021-11-22T08:30:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>いつも弊社製品をご利用いただきまして誠にありがとうございます。<br>日本マイクロソフト Azure Security サポートチームです。<br>本記事では、Red Hat Enterprise Linux へ Microsoft Defender for Endpoint(以降 MDE) をインストール、及びアップデートいただく際の依存関係について紹介します。</p><p>[発生する事象]<br>MDE のインストール、及びアップデートでは、yum コマンドによる依存関係の確認や解決が行われます。<br>依存関係が自動解決されない場合、インストールやアップデートに失敗します。</p><p>[発生する事象例]<br>MDE のコンポーネントである mdatp モジュールのバージョン 101.45.13 以降では、mde-netfilter モジュールが依存関係モジュールとして追加されています。<br>※ mde-netfilterモジュールを依存関係とするmdatpモジュールのバージョン 101.45.13は、2021/10/15時点で prod チャネルから配信しています<br>mde-netfilter モジュールは、libnetfilter_queue と依存関係があります。<br>libnetfilter_queue が未インストールの場合、自動解決が試行されます。<br>自動解決によるインストールに失敗した場合、mde-netfilter モジュール、及び mdatp モジュールのインストールに失敗します。</p><p>エラーの例:<br>問題: package mdatp-101.45.13-1.x86_64 requires mde-netfilter, but none of the providers can be installed</p><ul><li>cannot install the best candidate for the job</li><li>nothing provides libnetfilter_queue needed by mde-netfilter-100.69.32-1.x86_64</li></ul><p>[発生する事象例の想定原因]<br>デフォルトでは、libnetfilter_queueはrhui-rhel-8-for-x86_64-baseos-rhui-rpms リポジトリから libnetfilter_queue のダウンロードを試行します。<br>libnetfilter_queueはrhui-rhel-8-for-x86_64-baseos-rhui-rpms リポジトリへのアクセス制限やリポジトリの未構成、モジュールのインストール制限が行われている可能性があります。</p><p>[発生する事象例の対処策]<br>rhui-rhel-8-for-x86_64-baseos-rhui-rpms リポジトリへのアクセスやリポジトリの構成、及びモジュールのインストール許可を Red Hat Enterprise Linux やネットワーク観点でご確認ください。</p><p>この情報は2021/11/22 時点のものとなります。<br>今後予期せず変更される可能性がございますので、ご留意くださいますようお願い申し上げます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;いつも弊社製品をご利用いただきまして誠にありがとうございます。&lt;br&gt;日本マイクロソフト Azure Security サポートチームです。&lt;br&gt;本記事では、Red Hat Enterprise Linux へ Microsoft Defender for Endpoin</summary>
      
    
    
    
    
    <category term="Microsoft Defender for Endpoint" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-for-Endpoint/"/>
    
  </entry>
  
  <entry>
    <title>AD サーバーの OS 起動における PCNS サービスの起動シーケンスについて</title>
    <link href="https://jp-sec.github.io/blog/Identity_Manager_2021_08_31/"/>
    <id>https://jp-sec.github.io/blog/Identity_Manager_2021_08_31/</id>
    <published>2021-08-31T08:30:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Identity Manager サポートです。<br>今回、Microsoft Identity Manager (以降 MIM) のパスワード同期に使用する<br>Active Directory (以降 AD) ドメイン上の Password Change Notification Service (以降 PCNS) の重要な動作シーケンスについてご紹介いたします。</p><p>■ シーケンス概要<br>以下に AD サーバーの OS 起動における PCNS サービスの 簡易起動シーケンスをご紹介いたします。<br>① AD サーバーの OS 起動<br>② PCNS サービスの起動<br>③ PCNS サービスによる稼働条件確認と再起動要求の実施<br>※ PCNS サービスの稼働条件を確認した後、セキュリティアカウントマネージャーや RPC サービス間の連携処理を行った後、連携を反映するため PCNS サービスの再起動処理要求を実施<br>④ PCNS サービスの再起動</p><p>■ 重要<br>PCNS サービスを構成している環境下において、AD サーバーの再起動行った場合の動作を補足いたします。<br>PCNS サービスを構成している AD サーバーの OS を再起動した場合、PCNS サービスの再起動に伴い、一時的にパスワード同期が正常に行えない状態となります。</p><p>上記③処理の間にユーザー側でパスワード処理が行われてしまった場合、PCNS サービスが停止しているため、ユーザーのパスワード同期処理が行われない状態となります。</p><p>■ 補足<br>AD サーバーの OS 起動直後、アプリケーションの仕様により、PCNS サービスの再起動が行われます。<br>PCNS サービスは、サービスの前提条件となっているセキュリティアカウントマネージャー、RPC サービスとの連携処理を確実に遂行する必要があります。<br>本重要事項を実装するにあたり、AD サーバーの OS 起動直後、上記依存関係にあるサービスと連携した処理を確実に実行するため、PCNS サービスの再起動 (初期化処理）を行う処理をアプリケーションの仕様としてコーディングしております。<br>上記理由から、PCNS サービスの ②～④ の動作は必ず発生いたします。</p><p>アプリケーションの仕様として、上記 ③ 処理の間にパスワード処理が行われてしまった場合は、ユーザーのパスワード同期処理が行われず失敗する事象が発生いたします。<br>※その際に PCNS サービスが起動していないことで 4001 のエラーが発生します。</p><p>こちらに関しましては、PCNS サービス仕様となりますため、PCNS サービスでの回避方法はございません。</p><p>■ 回避策<br>PCNS サービスとしての回避策はございませんが、OS 起動直後に AD サーバーとクライアントとの通信を ファイアウォールなどを利用して<br>一時的に遮断することで PCNS サービスが停止中でのユーザーのパスワード変更を行わせないようにすることが可能となります。<br>以下参考例となりますが、記載させていただきます。</p><p>[留意事項]<br>以下の 回避策(参考例) については、複数台の AD 構成で実施いただくことを想定しております。<br>また、お客様の環境、設定状況により有効な回避策とならない場合がございますため、必ず事前に手順をご確認いただき、検証を実施いただけますようお願いいたします。<br>※お客様の環境により、回避策の手順を変更するなど、状況にあわせた対応が必要となる可能性がございます。</p><p>===================================================<br>回避策(参考例)<br>===================================================</p><ol><li><p>ドメイン コントローラーに管理者権限を持ったユーザーでログオンします。</p></li><li><p>セキュリティが強化された Windows ファイアウォール [受信の規則] にてすべての通信をブロックするポリシーを作成し有効化して、ネットワークを遮断します。</p></li><li><p>OS のスタート メニューから [電源ボタン] - [再起動] をクリックします。</p></li><li><p>OS が起動後、管理者権限を持ったユーザーでログオンします。</p></li><li><p>システムのイベントログで、PCNS サービスが起動することを確認します。停止されて起動しない場合は、手動で実行します。<br>※Active Directory として必要なサービスは後述 [※Active Directory の稼働に必要なサービス] でご案内しておりますのであわせて起動していることを確認します。<br>※PCNS として必要なサービスは後述 [※PCNSサービス に依存関係があるサービス] でご案内しておりますのであわせて起動していることを確認します。</p></li><li><p>セキュリティが強化された Windows ファイアウォールの [受信の規則]、 [受信の規則] にてすべての通信をブロックするポリシーを無効化して、ネットワークを接続します。</p></li><li><p>[ファイル名を指定して実行] で services.msc を入力して [OK] をクリックします。</p></li><li><p>“Intersite Messaging” サービスが開始されていることを確認します。</p></li></ol><p>※開始されていない場合は、”Intersite Messaging” サービスを右クリックから [開始] をクリックします。<br>9. 管理者としてコマンド プロンプトを起動し、以下のコマンドを実行し入力方向の複製を行います。</p><p>CMD&gt; repadmin /syncall /Ae<br>10.正常に複製されていることが確認できましたら、同期元のADにてテスト用のアカウントで、パスワードを変更します。<br>11.再起動をおこなったドメインコントローラーのイベントログにて、エラーイベント 4001 が発生していないことを確認します。<br>12.同期先のAD のテスト用のアカウントのパスワードが変更されていることを、ログインを行いパスワードが更新されていることを確認します。</p><p>===================================================<br>※Active Directory の稼働に必要なサービス<br>===================================================<br>以下のサービスが Active Directory の稼働に必要なサービスとなります。<br>なお、File Replication Service と Distributed File System Replication のサービスは、ご利用環境により、いずれかが使用されております。</p><p>・ File Replication Service ※<br>・ Distributed File System Replication ※<br>・ Intersite Messaging<br>・ Kerberos Key Distribution Center<br>・ Server<br>・ Workstation<br>・ Remote Procedure Call (RPC)<br>・ Windows Time<br>・ Netlogon<br>・ Active Directory Domain Services<br>・ DFS Namespace<br>・ DNS Server<br>・ DNS Client</p><ul><li>参考情報<br>Title: Essential Services<br>URL:docs.microsoft.com/en-us/previous-versions/system-center/packs/dd262096(v=technet.10)?redirectedfrom=MSDN</li></ul><p>===================================================<br>※PCNSサービス に依存関係があるサービス<br>===================================================<br>Security Account Manager<br>Remote Procedure Call(RPC)<br>DCOM Server Process Launcher<br>RPC Endpoint Mapper</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Identity Manager サポートです。&lt;br&gt;今回、Microsoft Identity Manager (以降 MIM) のパスワード同期に使用する&lt;br&gt;Active Directory (以降 AD) ドメイン上の Password Change</summary>
      
    
    
    
    
    <category term="Identity Manager" scheme="https://jp-sec.github.io/blog/tags/Identity-Manager/"/>
    
  </entry>
  
  <entry>
    <title>Excel ファイルに対する暗号/復号処理の遅延について</title>
    <link href="https://jp-sec.github.io/blog/RightsManagementServicesClient2.1_1/"/>
    <id>https://jp-sec.github.io/blog/RightsManagementServicesClient2.1_1/</id>
    <published>2020-06-23T18:19:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>本フォーラムは 日本マイクロソフトサポートより Rights Management Services Client 2.1 で確認しております動作仕様について情報を掲載しております。</p><p>[事象]<br>Rights Management Services Client 2.1 を使用して、ネットワーク共有フォルダーに格納されている Excel ファイルを暗号/復号する際に、ファイル形式によって、処理時間に差異があることを確認しております。<br>同じファイル サイズの XLSX 形式と XLS 形式のファイルの処理を比較した場合に、Office ファイルの構造の違いにより、処理されるデータ量などが異なることから、より多くの通信が発生し、XLSX 形式のファイルの処理に、より多くの時間がかかることを確認しております。</p><p>[詳細]<br>以下の方法にて、XLSX 形式のファイルを暗号/復号した場合に事象が発生することを確認しております。</p><p>・Rights Management Service Client 2.1 の IpcfEncryptFile/IpcfDecryptFile を使用</p><p>XLSX 形式のファイル構造に起因しておりますため、Rights Management Service Client 2.1 のバージョンに関わらず、すべてのバージョンにて事象が発生することが想定されます。<br>※ 現在最新のバージョン 1.0.4114.0 でも事象の再現を確認しております。</p><p>また、DOCX や PPTX 形式など、その他の Open XML 形式のファイルにおきましても、DOC や PPT 形式などと比較した場合に、同様に処理時間に差異が発生する可能性があります。</p><p>[回避策]<br>暗号/復号対象となるファイルを、暗号/復号処理を行う端末のローカル フォルダー上に、事前に配置することで、遅延を回避することが可能です。</p><p>なお、本情報の内容は、作成日時点でのものであり、予告なく変更される場合があります。<br>何卒ご留意いただけますようお願い申し上げます。</p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/ceadc243-ec23-4c42-879f-9f6431fbad42/excel?forum=jpsecurity">https://social.technet.microsoft.com/Forums/ja-JP/ceadc243-ec23-4c42-879f-9f6431fbad42/excel?forum=jpsecurity</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本フォーラムは 日本マイクロソフトサポートより Rights Management Services Client 2.1 で確認しております動作仕様について情報を掲載しております。&lt;/p&gt;
&lt;p&gt;[事象]&lt;br&gt;Rights Management Services Cli</summary>
      
    
    
    
    
    <category term="Rights Management Service" scheme="https://jp-sec.github.io/blog/tags/Rights-Management-Service/"/>
    
  </entry>
  
  <entry>
    <title>FAQ Microsoft Advanced Threat Analytics(ATA)/ AzureAdvanced Threat Protection(AATP)</title>
    <link href="https://jp-sec.github.io/blog/AdvancedThreat_2020_02_12/"/>
    <id>https://jp-sec.github.io/blog/AdvancedThreat_2020_02_12/</id>
    <published>2020-02-12T02:56:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>マイクロソフトサポート部門より Microsoft Advanced Threat Analytics(ATA)/ AzureAdvanced Threat Protection(AATP)について良くあるお問い合わせをまとめております。</p><p>以下のとおり製品毎の公開情報もございますが、サポートへのお問い合わせ数が多い項目についてまとめておりますので、是非併せてご参照くださいますと幸いです。</p><p>『ATAに関してよく寄せられる質問』<br><a href="https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-technical-faq">https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-technical-faq</a></p><p>『AzureATPに関してよく寄せられる質問』<br><a href="https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-technical-faq">https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-technical-faq</a></p><p>Q1どんな製品か<br>ActiveDirectoryの通信を監視し、不正な認証が行われていないか認証観点でアラートを通知します。<br>攻撃のための認証情報の搾取などの兆候を捉える製品となります。<br>他製品との連携で可能となる場合もございますが、動作制御、及び、マルウェア検出などは対象外となりますので予めご留意ください。</p><p>[ATA]<br>専用のツールで各ADの通信を監視し、オンプレミスに監視サーバーを構築して認証アラートを監視します。</p><p>[AATP]<br>専用のツールで各ADの通信を監視し、AzureATPに通信を送ることでAzureATP上で認証アラートを監視します。</p><p>Q2ライセンスについて</p><p>[ATA]<br>サーバーのアクティブ化のためのライセンス、及び、EMSE3などのクライアント用のライセンスが必要となります。</p><p>[AATP]<br>こちらはEMSE5などのクライアント用のライセンスのみが必要となります。<br>ATACenterサーバーのアクティブ化のライセンスについては以下をご参照ください。</p><p>『AdvancedThreatAnalytics(ATA)のライセンスはどこで取得できますか。』<br><a href="https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-technical-faq#where-can-i-get-a-license-for-advanced-threat-analytics-ata">https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-technical-faq#where-can-i-get-a-license-for-advanced-threat-analytics-ata</a></p><p>Q3お問合せ方法について</p><p>[ATA]<br>オンプレミスで完結する製品となりますので、オンプレミスの契約での問合せが必要となります。</p><p>[AATP]<br>Azureのご契約でお問い合わせいただけます。</p><p>Q4モジュールのインストールができない/サービスが起動しない<br>通信を監視するため、モジュールをインストールする必要がございます。<br>このモジュールはATACenterサーバー、または、AzureATPと接続ができる必要があり、この接続ができない場合にはモジュールのインストールに失敗します。</p><p>このような場合には以下の前提条件をご確認ください。</p><p>『ATAの前提条件』<br><a href="https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-prerequisites">https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-prerequisites</a></p><p>『AzureATPの前提条件』<br><a href="https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-prerequisites">https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-prerequisites</a></p><p>Q5サービスが頻繁に再起動する/リソース不足が発生する<br>これらの製品は通信を全て監視するため、CPU,メモリリソースを消費します。<br>また、メモリの使用量、CPUの使用率が高くなりますと自動的にサービスを再起動し、リソースを開放する処理が行われます。<br>その為、事前のサイジングを実施いただくことを推奨いたします。</p><p>『ATA容量計画』<br><a href="https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-capacity-planning">https://docs.microsoft.com/ja-jp/advanced-threat-analytics/ata-capacity-planning</a></p><p>『クイックスタート:AzureATP用の容量を計画する』<br><a href="https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-capacity-planning">https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-capacity-planning</a></p><p>また、アンチマルウェアソフトやネットワークアナライザーのようなツールが干渉し、環境によっては正常に動作がしない可能性がございます。<br>上記の影響が懸念される場合、対象のアプリケーションを停止して事象が改善するか、また、マルウェア対策ソフトの除外設定を推奨いたします。</p><p>ATACenterサーバーについては以下に記載がございます。</p><p>『ウイルス対策の除外リストの設定』<br><a href="https://docs.microsoft.com/ja-jp/advanced-threat-analytics/install-ata-step1#set-anti-virus-exclusions">https://docs.microsoft.com/ja-jp/advanced-threat-analytics/install-ata-step1#set-anti-virus-exclusions</a></p><hr><p>フォルダー<br>C:\ProgramFiles\MicrosoftAdvancedThreatAnalytics\Center\MongoDB\bin\data<br>C:\ProgramFiles\MicrosoftAdvancedThreatAnalytics\Center\ParentKerberosAsBloomFilters<br>C:\ProgramFiles\MicrosoftAdvancedThreatAnalytics\Center\ParentKerberosTgsBloomFilters<br>C:\ProgramFiles\MicrosoftAdvancedThreatAnalytics\Center\Backup<br>C:\ProgramFiles\MicrosoftAdvancedThreatAnalytics\Center\Logs</p><p>プロセス<br>mongod.exe<br>Microsoft.Tri.Center.exe</p><hr><h2 id="ATAGatewayの対象フォルダ、及び、プロセスは以下になります。"><a href="#ATAGatewayの対象フォルダ、及び、プロセスは以下になります。" class="headerlink" title="ATAGatewayの対象フォルダ、及び、プロセスは以下になります。"></a>ATAGatewayの対象フォルダ、及び、プロセスは以下になります。</h2><p>フォルダー<br>C:\ProgramFiles\MicrosoftAdvancedThreatAnalytics\</p><p>プロセス<br>Microsoft.Tri.Gateway.exe<br>Microsoft.Tri.Gateway.updater.exe</p><hr><h2 id="AzureATPの対象フォルダ、及び、プロセスは以下になります。"><a href="#AzureATPの対象フォルダ、及び、プロセスは以下になります。" class="headerlink" title="AzureATPの対象フォルダ、及び、プロセスは以下になります。"></a>AzureATPの対象フォルダ、及び、プロセスは以下になります。</h2><p>フォルダー<br>C:\ProgramFiles\AzureAdvancedThreatProtectionSensor\</p><p>プロセス<br>Microsoft.Tri.Sensor.exe<br>Microsoft.Tri.Sensor.updater.exe</p><hr><p>Q6.AzureATP構築時に一度MicrosoftCloudAppSecurity(MCAS)のページに遷移する<br>こちらは仕様となります。<br>現在AzureATPはMCASと連携ができるようになっており、MCASポータルからもアラートが確認できるようになっております。<br>今後、ポータルを統合する計画もあり、このような動作となりますこと、ご了承ください。</p><p>Q7.製品のログの出力先<br>ATA,AATP共に動作時にログを出力いたします。<br>こちらを確認し、トラブルシュートを行うこととなります。<br>ATAの動作ログについては以下をご参照ください。</p><p>『ATAログを使用したATAのトラブルシューティング』<br><a href="https://docs.microsoft.com/ja-jp/advanced-threat-analytics/troubleshooting-ata-using-logs">https://docs.microsoft.com/ja-jp/advanced-threat-analytics/troubleshooting-ata-using-logs</a></p><p>AATPの動作ログについては以下をご参照ください。</p><p>『ATPログを使用したAATPセンサーのトラブルシューティング』<br><a href="https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/troubleshooting-atp-using-logs">https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/troubleshooting-atp-using-logs</a></p><p>Q8.アラートが出力されたら何を確認すればよいか<br>基本的にはユーザー（端末）側の処理と照らし併せ、意図的な処理かどうかを確認します。<br>ATA/AATPは不正と”思われる”認証動作を検出するため、必ずしも危険が存在するわけではございませんが、ユーザーが意図していないアラートが出力された場合には以下の公開情報にある対処策を実施することを推奨いたします。</p><p>[ATA]<br>以下のサイトより、対処方法をご参照ください。</p><p>『AdvancedThreatAnalytics疑わしいアクティビティガイド』<br><a href="https://docs.microsoft.com/ja-jp/advanced-threat-analytics/suspicious-activity-guide">https://docs.microsoft.com/ja-jp/advanced-threat-analytics/suspicious-activity-guide</a></p><p>[AATP]<br>以下のサイトから”チュートリアル”に記載されているアラートの対処方法をご参照ください。</p><p>『チュートリアル:偵察のアラート』<br><a href="https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-reconnaissance-alerts">https://docs.microsoft.com/ja-jp/azure-advanced-threat-protection/atp-reconnaissance-alerts</a></p><p>上記情報が少しでもお客様のお役に立てば幸いです。</p><p>この情報は2020/02/12時点のものとなります。<br>今後予期せず変更される可能性がございますので、ご留意くださいますようお願い申し上げます。</p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/880d1907-e5e3-46ef-9475-6861d80eab39/faq-microsoft-advanced-threat-analyticsataazure-advanced-threat-protectionaatp?forum=jpsecurity">https://social.technet.microsoft.com/Forums/ja-JP/880d1907-e5e3-46ef-9475-6861d80eab39/faq-microsoft-advanced-threat-analyticsataazure-advanced-threat-protectionaatp?forum=jpsecurity</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;マイクロソフトサポート部門より Microsoft Advanced Threat Analytics(ATA)/ AzureAdvanced Threat Protection(AATP)について良くあるお問い合わせをまとめております。&lt;/p&gt;
&lt;p&gt;以下のとおり製品毎の</summary>
      
    
    
    
    
    <category term="Azure AdvancedThreat Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-AdvancedThreat-Protection/"/>
    
    <category term="Microsoft AdvancedThreat Analytics(ATA)" scheme="https://jp-sec.github.io/blog/tags/Microsoft-AdvancedThreat-Analytics-ATA/"/>
    
  </entry>
  
  <entry>
    <title>Azure Information Protection の通信要件に関する補足情報</title>
    <link href="https://jp-sec.github.io/blog/Azure_Information_Protection_2019_11_18/"/>
    <id>https://jp-sec.github.io/blog/Azure_Information_Protection_2019_11_18/</id>
    <published>2019-11-18T00:50:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>◆ この情報はマイクロソフトサポートからのご案内となります(更新: 2019/11/18) ◆</p><p>Azure Information Protection にてコンテンツの保護や復号機能をご利用いただく場合の通信要件につきましては、以下のように弊社公開情報にてお纏めしております。</p><p>&lt;ファイアウォールとネットワーク インフラストラクチャ&gt;<br><a href="https://docs.microsoft.com/ja-jp/azure/information-protection/requirements#firewalls-and-network-infrastructure">https://docs.microsoft.com/ja-jp/azure/information-protection/requirements#firewalls-and-network-infrastructure</a></p><p>上記公開情報内に記載のリンクより、許可が必要な URL などの詳細を確認することが可能です。</p><p>なお、上記は、Azure information Protection 固有の通信要件となります。<br>そのため、その他にも Windows OS 観点などにて許可が必要な URL があることを確認しておりますので、以下にご案内いたします。</p><p>Azure information Protection では、SSL 通信を利用いたしますので、SSL 証明書を取得する際に以下のエンドポイントへの通信が発生する場合がございます。</p><p>ctldl.windowsupdate.com</p><p>こちらは、ルート証明書更新プログラムが、Windows Update 上の信頼機関の一覧を自動的に確認し、更新プログラムがあるかどうかを確認するために使用されます。<br>この URL への通信が許可されていない場合に、Azure information Protection ビューアーによるファイル閲覧時にエラーが発生する事象の報告を確認しております。<br>そのため、Azure information Protection 利用時には、必要に応じて、こちらの URL を許可することをご検討ください。</p><p>※ 現時点では、上記以外の URL は確認できておりませんが、今後他にも通信許可が必要な URL が報告されました際には、情報を更新して参ります。</p><p>[その他の参考 URL]<br>ルート証明書更新プログラムについては、以下の弊社公開情報およびブログをご参照ください。</p><p>&lt;Windows Vista、Windows Server 2008、Windows 7、および Windows Server 2008 R2 の信頼されていない証明書の自動更新ツールについて&gt;<br><a href="https://support.microsoft.com/ja-jp/help/2677070/an-automatic-updater-of-untrusted-certificates-is-available-for-window">https://support.microsoft.com/ja-jp/help/2677070/an-automatic-updater-of-untrusted-certificates-is-available-for-window</a></p><p>&lt;マイクロソフトが提供する信頼できる証明書利用基盤 ～ルート証明書更新プログラムと更新ツール ～&gt;<br><a href="https://blogs.technet.microsoft.com/jpsecurity/2013/01/16/65374/">https://blogs.technet.microsoft.com/jpsecurity/2013/01/16/65374/</a></p><p>Windows 10 端末が接続するエンドポイントについては、以下の弊社公開情報をご参考ください。</p><p>&lt;Windows 10 Enterprise Version 1903 の接続エンドポイントの管理&gt;<br><a href="https://docs.microsoft.com/ja-jp/windows/privacy/manage-windows-1903-endpoints">https://docs.microsoft.com/ja-jp/windows/privacy/manage-windows-1903-endpoints</a></p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/6c111ee2-675f-4c27-915b-2e055bc176fd/azure-information-protection?forum=jpsecurity">https://social.technet.microsoft.com/Forums/ja-JP/6c111ee2-675f-4c27-915b-2e055bc176fd/azure-information-protection?forum=jpsecurity</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;◆ この情報はマイクロソフトサポートからのご案内となります(更新: 2019/11/18) ◆&lt;/p&gt;
&lt;p&gt;Azure Information Protection にてコンテンツの保護や復号機能をご利用いただく場合の通信要件につきましては、以下のように弊社公開情報にてお</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Azure Information Protection サービスプリンシパルを用いた認証が失敗する事象について 更新:2019/12/3</title>
    <link href="https://jp-sec.github.io/blog/Azure_Information_Protection_2019_08_30/"/>
    <id>https://jp-sec.github.io/blog/Azure_Information_Protection_2019_08_30/</id>
    <published>2019-08-29T15:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>◆ この情報はマイクロソフトサポートからのご案内となります(更新: 2019/12/3) ◆</p><p>Azure Information Protection サービスをご利用される場合にサービスプリンシパル（Set-RMSServerAuthentication）を用いる場合に認証ができず、処理に失敗する事象が確認できております。<br>この事象について以下のとおりご連絡いたします。</p><p>[事象]<br>2019 年 8 月初旬より、サービスプリンシパルを用いて、Azure Information Protection の機能を利用する場合に 0x80040211 や 0x800704dc など、認証に関するエラーが発生いたします。<br>なお、ユーザーアカウントで AIP をご利用されている場合については影響を受けません。</p><p>[対象製品]<br>・Azure Information Protection Client<br>・RMS Client 2.1</p><p>[対象バージョン]<br>・1.53.10.0 未満のバージョンの Azure Information Protection Client<br>・1.0.4114.0 未満のバージョンの RMS Client 2.1</p><p>[回避策]<br>各アプリケーションのバージョンアップが回避策となります。</p><ul><li>Azure Information Protection Client</li><li>RMS Client 2.1 </li></ul><p>[原因]<br>2018 年に Symmetric Key の実装が更新され、RMS サービス側で下位互換性のサポートを行わなくなったため、サポート対象外のバージョンのアプリケーションをご利用されていた場合に当該事象が発生したことを確認いたしました。<br>ご迷惑をおかけいたしまして誠に申し訳ございませんが、当該事象が確認された場合には AIP Client、及び、RMS Client のバージョンアップを実施いただけますようお願いいたします。</p><p>この情報は 2019/12/3 時点のものとなります。<br>今後予期せず変更される可能性がございますので、ご留意くださいますようお願い申し上げます。</p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/c3ec69b1-6133-45ff-9470-11c7e022437a/azure-information-protection-2019123?forum=jpsecurity">https://social.technet.microsoft.com/Forums/ja-JP/c3ec69b1-6133-45ff-9470-11c7e022437a/azure-information-protection-2019123?forum=jpsecurity</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;◆ この情報はマイクロソフトサポートからのご案内となります(更新: 2019/12/3) ◆&lt;/p&gt;
&lt;p&gt;Azure Information Protection サービスをご利用される場合にサービスプリンシパル（Set-RMSServerAuthentication）を</summary>
      
    
    
    
    
    <category term="Azure Information Protection" scheme="https://jp-sec.github.io/blog/tags/Azure-Information-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Windows Defender Antivirus 前回の更新日付が未来日になる</title>
    <link href="https://jp-sec.github.io/blog/Defender_2019_05_08/"/>
    <id>https://jp-sec.github.io/blog/Defender_2019_05_08/</id>
    <published>2019-05-08T05:27:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>皆さま、こんにちは、Windows Defender サポート です。</p><p>今回は Windows Defender Antivirus の更新日付の表示不具合についてについてご紹介致します。</p><p>Windows 10 バージョン 1809 に標準で実装されている Windows Defender Antivirus において、前回の更新日付が実際の時間より + 9 時間された日付になる不具合がございます。<br>当該不具合は表示上の問題であり、その他の機能に関しては一切影響はございません。</p><p><img src="../images/Defender_2019_05_08-01.jpg" alt="Defender_2019_05_08-01"></p><p>代替策として、イベントログ ビューアー (eventvwr.msc) を起動し、以下ログより最新の ID 2000 のログの日付をご確認くだい。</p><p>・ [アプリケーションとサービス ログ] - [Microsoft] - [Windows] - [Windows Defender] - Operational</p><p><img src="../images/Defender_2019_05_08-02.jpg" alt="Defender_2019_05_08-02"></p><p>本不具合はバージョン 1903 によって修正されております。<br>また、現時点でバージョン 1809 での修正は未定となっております。</p><p>恐れ入りますが、何卒ご理解賜りますようお願い申し上げます。</p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/6458cc33-9564-4944-b45e-7c5446a0ffd0/windows-defender-antivirus?forum=jpsecurity">https://social.technet.microsoft.com/Forums/ja-JP/6458cc33-9564-4944-b45e-7c5446a0ffd0/windows-defender-antivirus?forum=jpsecurity</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆さま、こんにちは、Windows Defender サポート です。&lt;/p&gt;
&lt;p&gt;今回は Windows Defender Antivirus の更新日付の表示不具合についてについてご紹介致します。&lt;/p&gt;
&lt;p&gt;Windows 10 バージョン 1809 に標準で実装</summary>
      
    
    
    
    
    <category term="Microsoft Defender ウイルス対策" scheme="https://jp-sec.github.io/blog/tags/Microsoft-Defender-%E3%82%A6%E3%82%A4%E3%83%AB%E3%82%B9%E5%AF%BE%E7%AD%96/"/>
    
  </entry>
  
  <entry>
    <title>MIM 2016 SP1 にて PAM を利用する際に、http 404 / 500 エラーが発生する。</title>
    <link href="https://jp-sec.github.io/blog/PAM_http_error/"/>
    <id>https://jp-sec.github.io/blog/PAM_http_error/</id>
    <published>2019-03-29T22:42:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Identity Manager サポート です。<br>MIM 2016 SP1 の Privilege Access Management(PAM) をご利用いただく際に、いくつかの rest API が HTTP 404 や 500 エラーが出力される場合があります。</p><p><img src="../images/PAM_http_error-01.png" alt="該当画面1"></p><p><img src="../images/PAM_http_error-02.png" alt="該当画面2"></p><p>この際の対応手順について、ご紹介します。<br>回避策としては、以下の通り MIM のサービスアカウントの権限の委譲を以下の通り実施します。<br>実施後は、MIM サーバー上にて、iisreset にて IIS サービスの再起動を実施ください。</p><p>変更前</p><p><img src="../images/PAM_http_error-03.png" alt="変更前画面"></p><p>変更後</p><p><img src="../images/PAM_http_error-04.png" alt="変更前画面"></p><p>この事象は、Off box と呼ばれる新しい委任に関連する機能の問題によるものとなります。</p><p>MIM 2016 SP1 にて PAM 機能をご活用の際はご注意ください。</p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/9534b9f4-043f-4582-97c3-5353def2729b/mim-2016-sp1-1239512390-pam?forum=jpidentitymanager">https://social.technet.microsoft.com/Forums/ja-JP/9534b9f4-043f-4582-97c3-5353def2729b/mim-2016-sp1-1239512390-pam?forum=jpidentitymanager</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Identity Manager サポート です。&lt;br&gt;MIM 2016 SP1 の Privilege Access Management(PAM) をご利用いただく際に、いくつかの rest API が HTTP 404 や 500 エラーが出力される場合</summary>
      
    
    
    
    
    <category term="Identity Manager" scheme="https://jp-sec.github.io/blog/tags/Identity-Manager/"/>
    
  </entry>
  
  <entry>
    <title>FIM/MIM ADMAのExport処理で 0x80004005 エラー</title>
    <link href="https://jp-sec.github.io/blog/MIM_ADMA_Export_0x80004005/"/>
    <id>https://jp-sec.github.io/blog/MIM_ADMA_Export_0x80004005/</id>
    <published>2019-03-29T22:33:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Identity Manager サポート です。<br>たびたびお問い合わせいただく、ADMA Export 時のエラーについて、ご紹介いたします。</p><p>FIM/MIM をご利用いただく目的の一つとして、Active Directory Domain Controller との連携があります。<br>通常、FIM/MIM 上にて更新処理が発生した場合などには、Export 処理にて、対象のドメインコントローラーへ更新処理を実施します。<br>その際に、稀に unexpected-error (0x80004005) のエラーにて Export が失敗する場合があります。<br>このとき、イベントログには ID 6401 と 6301 のエラーログが記録されます。</p><p>たびたびお問い合わせをいただくものの、稀に発生し再現ができず、原因究明が難しいエラーとなります。<br>今回は、想定原因と影響範囲についてご紹介します。</p><p>=============================<br>考えられる原因について<br>=============================<br>類似の現象で弊社に報告されている事例からは、以下の状況で上記のエラーが発生しております。</p><ol><li><p>AD-MA のコネクタ スペースに破損した情報が含まれていた状態で Export した場合</p></li><li><p>Export にて、何らかの要因で AD によって属性が書き込み拒否された場合</p></li><li><p>の現象に関しましては、全てのコネクタ スペースを削除し、再作成にて対応が可能となりますが、多くは 2 のケースに該当しています。</p></li><li><p>の現象に関しましては、既存のオブジェクトが存在するような同期環境において、userAccountControl 属性や unicodePwd 属性などの特殊な属性の上書きが、一時的に AD で拒否された場合に事象発生したとの報告がされておりました。<br>一時的な発生のために、事例からは原因の特定は難しく、お客様には影響範囲の確認と、正常性の確認を依頼しております。</p></li></ol><p>=====================<br>影響の範囲について<br>=====================<br>イベント ID 6401 と 6301 が記録された場合の影響範囲は、イベント 6301 に記録される GUID のコネクタ スペース オブジェクトに関するオブジェクトのみとなります。<br>従いまして、万が一再び上記のイベントが記録された場合には、該当の GUID に関連するオブジェクトの状況をご確認ください。<br>正しく同期先の AD に同期されているか、FIM/MIM 上でエラーが起こっていないかが確認できた場合は、上記のイベントの発生に関しましては無視することができます。<br>また、頻発する場合には、別の問題である可能性もありますので、その際は、弊社サポートまでご相談ください。</p><p>イベントログの例:<br>＜アプリケーションイベントログ / ソース : FIMSynchronizationService / イベント ID: 6301＞<br>BAIL: MMS(5872): ..\tower.cpp(3993): 0x80004005 (エラーを特定できません)<br>BAIL: MMS(5872): ..\tower.cpp(12030): 0x80004005 (エラーを特定できません)<br>BAIL: MMS(5872): ..\csobj.cpp(1870): 0x80004005 (エラーを特定できません)<br>BAIL: MMS(5872): ..\expcall.cpp(905): 0x80004005 (エラーを特定できません)<br>ERR_: MMS(5872): ..\expbase.cpp(2957): PutAnchorWithDnInternal failed on CS object {XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXX} with 0x80004005 (pass 1 of 5) Forefront Identity Manager 4.4.1302.0</p><p>CS object {XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXX} に対して属性値等の精査をします。</p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/8bb002c3-7f20-4709-9a50-d83e1334b8cc/fimmim-adma12398export209662970212391-0x80004005-124561252112540?forum=jpidentitymanager">https://social.technet.microsoft.com/Forums/ja-JP/8bb002c3-7f20-4709-9a50-d83e1334b8cc/fimmim-adma12398export209662970212391-0x80004005-124561252112540?forum=jpidentitymanager</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Identity Manager サポート です。&lt;br&gt;たびたびお問い合わせいただく、ADMA Export 時のエラーについて、ご紹介いたします。&lt;/p&gt;
&lt;p&gt;FIM/MIM をご利用いただく目的の一つとして、Active Directory Domain</summary>
      
    
    
    
    
    <category term="Identity Manager" scheme="https://jp-sec.github.io/blog/tags/Identity-Manager/"/>
    
  </entry>
  
  <entry>
    <title>Identity Manager サービス再起動時の PCNS への影響について</title>
    <link href="https://jp-sec.github.io/blog/Identity_Manager_2019_03_30/"/>
    <id>https://jp-sec.github.io/blog/Identity_Manager_2019_03_30/</id>
    <published>2019-03-29T15:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Identity Manager サポート です。<br>今回は Password Change Notification Service (PCNS) を利用している環境で、連携先の Identity Manager のサービスを再起動した場合の影響について紹介します。</p><p>Identity Manager を再起動後、当該 Identity Manager と連携している PCNS を利用して、パスワード同期を行いますと以下のエラー (イベント ID: 6025) が発生します。<br>エラーのとおりパスワード同期は失敗しますが、1 分後にリトライされることで正常にパスワード同期が完了しますので、ご安心ください。<br>運用においてログを監視されている場合は、下図のとおりアプリケーション ログにエラーが出力されますので、サービス再起動時の想定された動作としてご認識いただけると幸いです。</p><p>&lt;PCNS 稼働サーバーのアプリケーション ログ&gt;<br><img src="../images/Identity_Manager_2019_03_30-01.png"></p><p>また、複数の Identity Manager と連携してパスワード同期を行っている PCNS 環境もあると思います。そのような環境においても、いずれかの Identity Manager のサービスが停止 (再起動) した場合は上記と同様の動作 (エラー &amp; リトライ) となることをご考慮ください。</p><p>&lt;補足情報：エラーを出力させない方法&gt;<br>上述のとおり、本エラーが発生したとしても 1 分後のリトライでパスワード同期は正常に処理されますが、運用要件によってはエラーの発生自体を回避されたい管理者もいるかと思います。<br>そのような場合は、Identity Manager のサービス再起動に併せて、PCNS のサービス再起動も行うことで、本エラーの発生を回避することができます。</p><p>この情報は 2019/3/30 時点のものとなります。<br>今後予期せず変更される可能性がございますので、ご留意くださいますようお願い申し上げます。</p><p>元の記事<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/57239319-1aaf-4414-bffa-2d6c278f8b18/identity-manager-pcns-?forum=jpidentitymanager">https://social.technet.microsoft.com/Forums/ja-JP/57239319-1aaf-4414-bffa-2d6c278f8b18/identity-manager-pcns-?forum=jpidentitymanager</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Identity Manager サポート です。&lt;br&gt;今回は Password Change Notification Service (PCNS) を利用している環境で、連携先の Identity Manager のサービスを再起動した場合の影響について紹</summary>
      
    
    
    
    
    <category term="Identity Manager" scheme="https://jp-sec.github.io/blog/tags/Identity-Manager/"/>
    
  </entry>
  
  <entry>
    <title>Information</title>
    <link href="https://jp-sec.github.io/blog/information/README/"/>
    <id>https://jp-sec.github.io/blog/information/README/</id>
    <published>2016-01-01T03:00:00.000Z</published>
    <updated>2022-10-28T08:39:56.862Z</updated>
    
    <content type="html"><![CDATA[<p>日本マイクロソフト Azure セキュリティ サポート チームのブログです。<br>チームの担当製品であるセキュリティ製品の情報を中心にお届けします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;日本マイクロソフト Azure セキュリティ サポート チームのブログです。&lt;br&gt;チームの担当製品であるセキュリティ製品の情報を中心にお届けします。&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="Information" scheme="https://jp-sec.github.io/blog/tags/Information/"/>
    
  </entry>
  
</feed>
